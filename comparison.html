<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8" />

<title>Splink comparison viewer</title>
<meta name="description" content="desc" />

<style>:root {
  --table-gray: rgb(245, 245, 245);
  --table-white: rgb(255, 255, 255);
  --table-hover: rgb(255, 253, 190);
  --table-border-width: 2px;
  --table-text-colour: rgb(0, 0, 0);
  --font-very-large: 2.5rem;
  --font-large: 1.5rem;
  --font-regular: 1.2rem;
  --font-small: 1rem;
  --font-very-small: 0.8rem;
}

div#outer_container {
  font-family: "Source Sans Pro", "Helvetica Neue", Helvetica, Arial, sans-serif;
  margin: 20px;

  font-size: var(--font-regular);
  color: #3c3c3c;
}

/* center margins */
div#outer_container > div {
  margin: 0 auto;
}

.observablehq {
  margin-bottom: 10px;
}

label {
  display: inline-block;
  margin-right: 12px;
}

/* Controls */

#controls {
  border: 1px solid #e7e7e7;
  background-color: var(--table-gray);
  padding: 10px;
  color: #3c3c3c;
  margin-bottom: 10px;
}

#controls input,
select,
label {
  display: inline-block;
  font-size: var(--font-small);
  margin-bottom: 0px;
  color: #3c3c3c;
}

input[type="checkbox"],
input[type="radio"],
input[type="range"] {
  vertical-align: middle;
  position: relative;
  bottom: 1px;
  color: #3c3c3c;
}

#observablehq-corresponding_probability {
  font-size: var(--font-small);
}
/* Table */
.observablehq table {
  display: block;
  border-collapse: collapse;
  border-spacing: 0;
  border: none;
  color: var(--table-text-colour);
  font-size: var(--font-very-small);

  margin-left: auto;
  margin-right: auto;
  max-width: 100%;
  max-height: 500px;
  overflow: auto;
}

.observablehq thead {
  border-bottom: var(--table-border-width) solid var(--table-gray);
  vertical-align: bottom;
}

.observablehq td,
.observablehq th,
.observablehq tr {
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}

.observablehq th {
  font-weight: bold;
}

.observablehq tbody tr:nth-child(odd) {
  background: var(--table-white);
}

.observablehq tbody tr:nth-child(even) {
  background: var(--table-gray);
}

.observablehq tbody tr:hover {
  background: var(--table-hover);
}

.observablehq table {
  margin-bottom: 1em;
}

/* Headers */

h2 {
  margin-bottom: 5px;
  font-size: var(--font-very-large);
  color: black;
}
h3 {
  margin-bottom: 5px;
  font-size: var(--font-large);
  color: black;
}
</style>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro&display=swap" rel="stylesheet">

</head>

<body>















<script>/**
 * Skipped minification because the original files appears to be already minified.
 * Original file: /npm/@observablehq/stdlib@5.8.3/dist/stdlib.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
// @observablehq/stdlib v5.8.3 Copyright 2023 Observable, Inc.
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).observablehq=e.observablehq||{})}(this,(function(e){"use strict";var t={},n={};function r(e){return new Function("d","return {"+e.map((function(e,t){return JSON.stringify(e)+": d["+t+'] || ""'})).join(",")+"}")}function a(e){var t=Object.create(null),n=[];return e.forEach((function(e){for(var r in e)r in t||n.push(t[r]=r)})),n}function o(e,t){var n=e+"",r=n.length;return r<t?new Array(t-r+1).join(0)+n:n}function s(e){var t,n=e.getUTCHours(),r=e.getUTCMinutes(),a=e.getUTCSeconds(),s=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":((t=e.getUTCFullYear())<0?"-"+o(-t,6):t>9999?"+"+o(t,6):o(t,4))+"-"+o(e.getUTCMonth()+1,2)+"-"+o(e.getUTCDate(),2)+(s?"T"+o(n,2)+":"+o(r,2)+":"+o(a,2)+"."+o(s,3)+"Z":a?"T"+o(n,2)+":"+o(r,2)+":"+o(a,2)+"Z":r||n?"T"+o(n,2)+":"+o(r,2)+"Z":"")}function i(e){var o=new RegExp('["'+e+"\n\r]"),i=e.charCodeAt(0);function c(e,r){var a,o=[],s=e.length,c=0,u=0,l=s<=0,f=!1;function d(){if(l)return n;if(f)return f=!1,t;var r,a,o=c;if(34===e.charCodeAt(o)){for(;c++<s&&34!==e.charCodeAt(c)||34===e.charCodeAt(++c););return(r=c)>=s?l=!0:10===(a=e.charCodeAt(c++))?f=!0:13===a&&(f=!0,10===e.charCodeAt(c)&&++c),e.slice(o+1,r-1).replace(/""/g,'"')}for(;c<s;){if(10===(a=e.charCodeAt(r=c++)))f=!0;else if(13===a)f=!0,10===e.charCodeAt(c)&&++c;else if(a!==i)continue;return e.slice(o,r)}return l=!0,e.slice(o,s)}for(10===e.charCodeAt(s-1)&&--s,13===e.charCodeAt(s-1)&&--s;(a=d())!==n;){for(var m=[];a!==t&&a!==n;)m.push(a),a=d();r&&null==(m=r(m,u++))||o.push(m)}return o}function u(t,n){return t.map((function(t){return n.map((function(e){return f(t[e])})).join(e)}))}function l(t){return t.map(f).join(e)}function f(e){return null==e?"":e instanceof Date?s(e):o.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:function(e,t){var n,a,o=c(e,(function(e,o){if(n)return n(e,o-1);a=e,n=t?function(e,t){var n=r(e);return function(r,a){return t(n(r),a,e)}}(e,t):r(e)}));return o.columns=a||[],o},parseRows:c,format:function(t,n){return null==n&&(n=a(t)),[n.map(f).join(e)].concat(u(t,n)).join("\n")},formatBody:function(e,t){return null==t&&(t=a(e)),u(e,t).join("\n")},formatRows:function(e){return e.map(l).join("\n")},formatRow:l,formatValue:f}}var c=i(","),u=c.parse,l=c.parseRows,f=i("\t"),d=f.parse,m=f.parseRows;function p(e){for(var t in e){var n,r,a=e[t].trim();if(a)if("true"===a)a=!0;else if("false"===a)a=!1;else if("NaN"===a)a=NaN;else if(isNaN(n=+a)){if(!(r=a.match(/^([-+]\d{2})?\d{4}(-\d{2}(-\d{2})?)?(T\d{2}:\d{2}(:\d{2}(\.\d{3})?)?(Z|[-+]\d{2}:\d{2})?)?$/)))continue;h&&r[4]&&!r[7]&&(a=a.replace(/-/g,"/").replace(/T/," ")),a=new Date(a)}else a=n;else a=null;e[t]=a}return e}const h=new Date("2019-01-01T00:00").getHours()||new Date("2019-07-01T00:00").getHours();function b(e,t,n){return{resolve:(r=n)=>`${e}@${t}/${r}`}}const w=b("d3","7.8.5","dist/d3.min.js"),y=b("@observablehq/inputs","0.10.6","dist/inputs.min.js"),v=b("@observablehq/plot","0.6.11","dist/plot.umd.min.js"),g=b("@observablehq/graphviz","0.2.1","dist/graphviz.min.js"),E=b("@observablehq/highlight.js","2.0.0","highlight.min.js"),A=b("@observablehq/katex","0.11.1","dist/katex.min.js"),T=b("lodash","4.17.21","lodash.min.js"),N=b("htl","0.3.1","dist/htl.min.js"),j=b("jszip","3.10.1","dist/jszip.min.js"),x=b("marked","0.3.12","marked.min.js"),O=b("sql.js","1.8.0","dist/sql-wasm.js"),$=b("vega","5.22.1","build/vega.min.js"),C=b("vega-lite","5.6.0","build/vega-lite.min.js"),q=b("vega-lite-api","5.0.0","build/vega-lite-api.min.js"),R=b("apache-arrow","4.0.1","Arrow.es2015.min.js"),k=b("apache-arrow","9.0.0","+esm"),L=b("apache-arrow","11.0.0","+esm"),I=b("arquero","4.8.8","dist/arquero.min.js"),S=b("topojson-client","3.1.0","dist/topojson-client.min.js"),M=b("exceljs","4.3.0","dist/exceljs.min.js"),P=b("mermaid","9.2.2","dist/mermaid.min.js"),_=b("leaflet","1.9.3","dist/leaflet.js"),D=b("@duckdb/duckdb-wasm","1.24.0","+esm"),U=new Map,F=[],B=F.map,W=F.some,H=F.hasOwnProperty,z=/^((?:@[^/@]+\/)?[^/@]+)(?:@([^/]+))?(?:\/(.*))?$/,V=/^\d+\.\d+\.\d+(-[\w-.+]+)?$/,G=/(?:\.[^/]*|\/)$/;class RequireError extends Error{constructor(e){super(e)}}function Y(e){const t=z.exec(e);return t&&{name:t[1],version:t[2],path:t[3]}}function Z(e="https://cdn.jsdelivr.net/npm/",t=["unpkg","jsdelivr","browser","main"]){if(!/\/$/.test(e))throw new Error("origin lacks trailing slash");function n(t){const n=`${e}${t.name}${t.version?`@${t.version}`:""}/package.json`;let r=U.get(n);return r||U.set(n,r=fetch(n).then((e=>{if(!e.ok)throw new RequireError("unable to load package.json");return e.redirected&&!U.has(e.url)&&U.set(e.url,r),e.json()}))),r}return async function(r,a){if(r.startsWith(e)&&(r=r.substring(e.length)),/^(\w+:)|\/\//i.test(r))return r;if(/^[.]{0,2}\//i.test(r))return new URL(r,null==a?location:a).href;if(!r.length||/^[\s._]/.test(r)||/\s$/.test(r))throw new RequireError("illegal name");const o=Y(r);if(!o)return`${e}${r}`;if(!o.version&&null!=a&&a.startsWith(e)){const t=await n(Y(a.substring(e.length)));o.version=t.dependencies&&t.dependencies[o.name]||t.peerDependencies&&t.peerDependencies[o.name]}if(o.path&&!G.test(o.path)&&(o.path+=".js"),o.path&&o.version&&V.test(o.version))return`${e}${o.name}@${o.version}/${o.path}`;const s=await n(o);return`${e}${s.name}@${s.version}/${o.path||function(e){for(const n of t){let t=e[n];if("string"==typeof t)return t.startsWith("./")&&(t=t.slice(2)),G.test(t)?t:`${t}.js`}}(s)||"index.js"}`}}RequireError.prototype.name=RequireError.name;var J=Q(Z());function Q(e){const t=new Map,n=a(null);function r(e){if("string"!=typeof e)return e;let n=t.get(e);return n||t.set(e,n=new Promise(((t,n)=>{const r=document.createElement("script");r.onload=()=>{try{t(F.pop()(a(e)))}catch(e){n(new RequireError("invalid module"))}r.remove()},r.onerror=()=>{n(new RequireError("unable to load module")),r.remove()},r.async=!0,r.src=e,window.define=te,document.head.appendChild(r)}))),n}function a(t){return n=>Promise.resolve(e(n,t)).then(r)}function o(e){return arguments.length>1?Promise.all(B.call(arguments,n)).then(X):n(e)}return o.alias=function(t){return Q(((n,r)=>n in t&&(r=null,"string"!=typeof(n=t[n]))?n:e(n,r)))},o.resolve=e,o}function X(e){const t={};for(const n of e)for(const e in n)H.call(n,e)&&(null==n[e]?Object.defineProperty(t,e,{get:K(n,e)}):t[e]=n[e]);return t}function K(e,t){return()=>e[t]}function ee(e){return"exports"===(e+="")||"module"===e}function te(e,t,n){const r=arguments.length;r<2?(n=e,t=[]):r<3&&(n=t,t="string"==typeof e?[]:e),F.push(W.call(t,ee)?e=>{const r={},a={exports:r};return Promise.all(B.call(t,(t=>"exports"===(t+="")?r:"module"===t?a:e(t)))).then((e=>(n.apply(null,e),a.exports)))}:e=>Promise.all(B.call(t,e)).then((e=>"function"==typeof n?n.apply(null,e):n)))}te.amd={};const ne="https://cdn.observableusercontent.com/npm/";let re,ae=J;async function oe(e){const[t,n]=await Promise.all([e(O.resolve()),e.resolve(O.resolve("dist/"))]);return t({locateFile:e=>`${n}${e}`})}class SQLiteDatabaseClient{constructor(e){Object.defineProperties(this,{_db:{value:e}})}static async open(e){const[t,n]=await Promise.all([oe(ae),Promise.resolve(e).then(ie)]);return new SQLiteDatabaseClient(new t.Database(n))}async query(e,t){return await async function(e,t,n){const[r]=await e.exec(t,n);if(!r)return[];const{columns:a,values:o}=r,s=o.map((e=>Object.fromEntries(e.map(((e,t)=>[a[t],e])))));return s.columns=a,s}(this._db,e,t)}async queryRow(e,t){return(await this.query(e,t))[0]||null}async explain(e,t){return ce("pre",{className:"observablehq--inspect"},[ue((await this.query(`EXPLAIN QUERY PLAN ${e}`,t)).map((e=>e.detail)).join("\n"))])}async describeTables({schema:e}={}){return this.query(`SELECT NULLIF(schema, 'main') AS schema, name FROM pragma_table_list() WHERE type = 'table'${null==e?"":" AND schema = ?"} AND name NOT LIKE 'sqlite_%' ORDER BY schema, name`,null==e?[]:[e])}async describeColumns({schema:e,table:t}={}){if(null==t)throw new Error("missing table");const n=await this.query(`SELECT name, type, "notnull" FROM pragma_table_info(?${null==e?"":", ?"}) ORDER BY cid`,null==e?[t]:[t,e]);if(!n.length)throw new Error(`table not found: ${t}`);return n.map((({name:e,type:t,notnull:n})=>({name:e,type:se(t),databaseType:t,nullable:!n})))}async describe(e){const t=await(void 0===e?this.query("SELECT name FROM sqlite_master WHERE type = 'table'"):this.query("SELECT * FROM pragma_table_info(?)",[e]));if(!t.length)throw new Error("Not found");const{columns:n}=t;return ce("table",{value:t},[ce("thead",[ce("tr",n.map((e=>ce("th",[ue(e)]))))]),ce("tbody",t.map((e=>ce("tr",n.map((t=>ce("td",[ue(e[t])])))))))])}async sql(){return this.query(...this.queryTag.apply(this,arguments))}queryTag(e,...t){return[e.join("?"),t]}}function se(e){switch(e){case"NULL":return"null";case"INT":case"INTEGER":case"TINYINT":case"SMALLINT":case"MEDIUMINT":case"BIGINT":case"UNSIGNED BIG INT":case"INT2":case"INT8":return"integer";case"TEXT":case"CLOB":case"DATE":case"DATETIME":return"string";case"REAL":case"DOUBLE":case"DOUBLE PRECISION":case"FLOAT":case"NUMERIC":return"number";case"BLOB":return"buffer";default:return/^(?:(?:(?:VARYING|NATIVE) )?CHARACTER|(?:N|VAR|NVAR)CHAR)\(/.test(e)?"string":/^(?:DECIMAL|NUMERIC)\(/.test(e)?"number":"other"}}function ie(e){return"string"==typeof e?fetch(e).then(ie):e instanceof Response||e instanceof Blob?e.arrayBuffer().then(ie):e instanceof ArrayBuffer?new Uint8Array(e):e}function ce(e,t,n){2===arguments.length&&(n=t,t=void 0);const r=document.createElement(e);if(void 0!==t)for(const e in t)r[e]=t[e];if(void 0!==n)for(const e of n)r.appendChild(e);return r}function ue(e){return document.createTextNode(e)}function le(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function fe(e,t=le){let n,r=!1;if(1===t.length){let a;for(const o of e){const e=t(o);(r?le(e,a)>0:0===le(e,e))&&(n=o,a=e,r=!0)}}else for(const a of e)(r?t(a,n)>0:0===t(a,a))&&(n=a,r=!0);return n}function de(e){return e&&"function"==typeof e.toArrowBuffer}function me(e){return e&&"function"==typeof e.getChild&&"function"==typeof e.toArray&&e.schema&&Array.isArray(e.schema.fields)}function pe(e){return e.schema.fields.map(he)}function he(e){return{name:e.name,type:be(e.type),nullable:e.nullable,databaseType:String(e.type)}}function be(e){switch(e.typeId){case 2:return"integer";case 3:case 7:return"number";case 4:case 15:return"buffer";case 5:return"string";case 6:return"boolean";case 8:case 9:case 10:return"date";case 12:case 16:return"array";case 13:case 14:return"object";default:return"other"}}async function we(){return await import(`${ne}${L.resolve()}`)}Object.defineProperty(SQLiteDatabaseClient.prototype,"dialect",{value:"sqlite"});class DuckDBClient{constructor(e){Object.defineProperties(this,{_db:{value:e}})}async queryStream(e,t){const n=await this._db.connect();let r,a;try{if(t?.length>0){const a=await n.prepare(e);r=await a.send(...t)}else r=await n.send(e);if(a=await r.next(),a.done)throw new Error("missing first batch")}catch(e){throw await n.close(),e}return{schema:pe(a.value),async*readRows(){try{for(;!a.done;)yield a.value.toArray(),a=await r.next()}finally{await n.close()}}}}async query(e,t){const n=await this.queryStream(e,t),r=[];for await(const e of n.readRows())for(const t of e)r.push(t);return r.schema=n.schema,r}async queryRow(e,t){const n=(await this.queryStream(e,t)).readRows();try{const{done:e,value:t}=await n.next();return e||!t.length?null:t[0]}finally{await n.return()}}async sql(e,...t){return await this.query(e.join("?"),t)}queryTag(e,...t){return[e.join("?"),t]}escape(e){return`"${e}"`}async describeTables(){return(await this.query("SHOW TABLES")).map((({name:e})=>({name:e})))}async describeColumns({table:e}={}){return(await this.query(`DESCRIBE ${this.escape(e)}`)).map((({column_name:e,column_type:t,null:n})=>({name:e,type:Ee(t),nullable:"NO"!==n,databaseType:t})))}static async of(e={},t={}){const n=await async function(){void 0===re&&(re=async function(){const e=await import(`${ne}${D.resolve()}`),t=await e.selectBundle({mvp:{mainModule:`${ne}${D.resolve("dist/duckdb-mvp.wasm")}`,mainWorker:`${ne}${D.resolve("dist/duckdb-browser-mvp.worker.js")}`},eh:{mainModule:`${ne}${D.resolve("dist/duckdb-eh.wasm")}`,mainWorker:`${ne}${D.resolve("dist/duckdb-browser-eh.worker.js")}`}}),n=new e.ConsoleLogger;return{module:e,bundle:t,logger:n}}());const{module:e,bundle:t,logger:n}=await re,r=await e.createWorker(t.mainWorker),a=new e.AsyncDuckDB(n,r);return await a.instantiate(t.mainModule),a}();return void 0===t.query?.castTimestampToDate&&(t={...t,query:{...t.query,castTimestampToDate:!0}}),void 0===t.query?.castBigIntToDouble&&(t={...t,query:{...t.query,castBigIntToDouble:!0}}),await n.open(t),await Promise.all(Object.entries(e).map((async([e,t])=>{if(t instanceof FileAttachment)await ye(n,e,t);else if(me(t))await ve(n,e,t);else if(Array.isArray(t))await ge(n,e,t);else if(de(t))await async function(e,t,n){const r=(await we()).tableFromIPC(n.toArrowBuffer());return await ve(e,t,r)}(n,e,t);else if("data"in t){const{data:r,...a}=t;me(r)?await ve(n,e,r,a):await ge(n,e,r,a)}else{if(!("file"in t))throw new Error(`invalid source: ${t}`);{const{file:r,...a}=t;await ye(n,e,r,a)}}}))),new DuckDBClient(n)}}async function ye(e,t,n,r){const a=await n.url();if(a.startsWith("blob:")){const t=await n.arrayBuffer();await e.registerFileBuffer(n.name,new Uint8Array(t))}else await e.registerFileURL(n.name,a,4);const o=await e.connect();try{switch(n.mimeType){case"text/csv":case"text/tab-separated-values":return await o.insertCSVFromPath(n.name,{name:t,schema:"main",...r}).catch((async e=>{if(e.toString().includes("Could not convert"))return await async function(e,t,n){const r=await e.prepare(`CREATE TABLE '${n}' AS SELECT * FROM read_csv_auto(?, ALL_VARCHAR=TRUE)`);return await r.send(t.name)}(o,n,t);throw e}));case"application/json":return await o.insertJSONFromPath(n.name,{name:t,schema:"main",...r});default:if(/\.arrow$/i.test(n.name)){const e=new Uint8Array(await n.arrayBuffer());return await o.insertArrowFromIPCStream(e,{name:t,schema:"main",...r})}if(/\.parquet$/i.test(n.name))return await o.query(`CREATE VIEW '${t}' AS SELECT * FROM parquet_scan('${n.name}')`);throw new Error(`unknown file type: ${n.mimeType}`)}}finally{await o.close()}}async function ve(e,t,n,r){const a=await e.connect();try{await a.insertArrowTable(n,{name:t,schema:"main",...r})}finally{await a.close()}}async function ge(e,t,n,r){const a=(await we()).tableFromJSON(n);return await ve(e,t,a,r)}function Ee(e){switch(e){case"BIGINT":case"HUGEINT":case"UBIGINT":return"bigint";case"DOUBLE":case"REAL":case"FLOAT":return"number";case"INTEGER":case"SMALLINT":case"TINYINT":case"USMALLINT":case"UINTEGER":case"UTINYINT":return"integer";case"BOOLEAN":return"boolean";case"DATE":case"TIMESTAMP":case"TIMESTAMP WITH TIME ZONE":return"date";case"VARCHAR":case"UUID":return"string";default:return/^DECIMAL\(/.test(e)?"integer":"other"}}Object.defineProperty(DuckDBClient.prototype,"dialect",{value:"duckdb"});function Ae(e,t){return e&&("function"==typeof e.sql||"function"==typeof e.queryTag&&("function"==typeof e.query||"function"==typeof e.queryStream))&&("table"!==t||"function"==typeof e.describeColumns)&&e!==Re}function Te(e){return Array.isArray(e)&&(Ne(e.schema)||je(e.columns)||function(e){const t=Math.min(20,e.length);for(let n=0;n<t;++n){const t=e[n];if(null===t||"object"!=typeof t)return!1}return t>0&&function(e){for(const t in e)return!0;return!1}(e[0])}(e)||$e(e)||Ce(e))||qe(e)}function Ne(e){return Array.isArray(e)&&e.every(xe)}function je(e){return Array.isArray(e)&&e.every((e=>"string"==typeof e))}function xe(e){return e&&"string"==typeof e.name&&"string"==typeof e.type}function Oe(e){return qe(e)||$e(e)||Ce(e)}function $e(e){const t=Math.min(20,e.length);if(!(t>0))return!1;let n,r=!1;for(let a=0;a<t;++a){const t=e[a];if(null==t)continue;const o=typeof t;if(void 0===n)switch(o){case"number":case"boolean":case"string":case"bigint":n=o;break;default:return!1}else if(o!==n)return!1;r=!0}return r}function Ce(e){const t=Math.min(20,e.length);if(!(t>0))return!1;let n=!1;for(let r=0;r<t;++r){const t=e[r];if(null!=t){if(!(t instanceof Date))return!1;n=!0}}return n}function qe(e){return e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array}const Re=Object.assign((async(e,t,n,r)=>{if(Ae(e=await Ie(await e,r)))return Pe(e,_e(t,e),n);if(Te(e))return ut(e,t);if(!e)throw new Error("missing data source");throw new Error("invalid data source")}),{sql:(e,t,n)=>async function(){return Pe(await Se(await e,n),arguments,t)}});function ke(e){const t=new WeakMap;return(n,r)=>{if(!n||"object"!=typeof n)throw new Error("invalid data source");let a=t.get(n);return(!a||Te(n)&&n.length!==a._numRows)&&(a=e(n,r),a._numRows=n.length,t.set(n,a)),a}}const Le=ke((async e=>{if(e instanceof FileAttachment){switch(e.mimeType){case"text/csv":return e.csv({typed:"auto"});case"text/tab-separated-values":return e.tsv({typed:"auto"});case"application/json":return e.json()}throw new Error(`unsupported file type: ${e.mimeType}`)}return e})),Ie=ke((async(e,t)=>{if(e instanceof FileAttachment){switch(e.mimeType){case"text/csv":return e.csv();case"text/tab-separated-values":return e.tsv();case"application/json":return e.json();case"application/x-sqlite3":return e.sqlite()}if(/\.(arrow|parquet)$/i.test(e.name))return Me(e,t);throw new Error(`unsupported file type: ${e.mimeType}`)}return me(e)||de(e)?Me(e,t):Te(e)&&Oe(e)?Array.from(e,(e=>({value:e}))):e})),Se=ke((async(e,t)=>{if(e instanceof FileAttachment){switch(e.mimeType){case"text/csv":case"text/tab-separated-values":case"application/json":return Me(e,t);case"application/x-sqlite3":return e.sqlite()}if(/\.(arrow|parquet)$/i.test(e.name))return Me(e,t);throw new Error(`unsupported file type: ${e.mimeType}`)}return Te(e)?Me(await async function(e,t){const n=await we();return Oe(e)?n.tableFromArrays({[t]:e}):n.tableFromJSON(e)}(e,t),t):me(e)||de(e)?Me(e,t):e}));function Me(e,t=(e instanceof FileAttachment?function(e){return e.name.replace(/@\d+(?=\.|$)/,"").replace(/\.\w+$/,"")}(e):"__table")){return DuckDBClient.of({[t]:e})}async function Pe(e,t,n){if(!e)throw new Error("missing data source");if("function"==typeof e.queryTag){const r=new AbortController,a={signal:r.signal};if(n.then((()=>r.abort("invalidated"))),"function"==typeof e.queryStream)return async function*(e){let t=performance.now();const n=await e,r=[];r.done=!1,r.error=null,r.schema=n.schema;try{for await(const e of n.readRows()){performance.now()-t>150&&r.length>0&&(yield r,t=performance.now());for(const t of e)r.push(t)}r.done=!0,yield r}catch(e){r.error=e,yield r}}(e.queryStream(...e.queryTag.apply(e,t),a));if("function"==typeof e.query)return e.query(...e.queryTag.apply(e,t),a)}if("function"==typeof e.sql)return e.sql.apply(e,t);throw new Error("source does not implement query, queryStream, or sql")}function _e(e,t){const n="function"==typeof t.escape?t.escape:e=>e,{select:r,from:a,filter:o,sort:s,slice:i}=e;if(!a.table)throw new Error("missing from table");if(r.columns&&0===r.columns.length)throw new Error("at least one column must be selected");const c=new Map(e.names?.map((({column:e,name:t})=>[e,t]))),u=[[`SELECT ${r.columns?r.columns.map((e=>{const t=c.get(e);return t?`${n(e)} AS ${n(t)}`:n(e)})).join(", "):"*"} FROM ${De(a.table,n)}`]];for(let e=0;e<o.length;++e)Ue(e?"\nAND ":"\nWHERE ",u),Be(o[e],u,n);for(let e=0;e<s.length;++e)Ue(e?", ":"\nORDER BY ",u),Fe(s[e],u,n);if("mssql"===t.dialect||"oracle"===t.dialect){if(null!==i.to||null!==i.from){if(!s.length){if(!r.columns)throw new Error("at least one column must be explicitly specified. Received '*'.");Ue("\nORDER BY ",u),Fe({column:r.columns[0],direction:"ASC"},u,n)}Ue(`\nOFFSET ${i.from||0} ROWS`,u),Ue(`\nFETCH NEXT ${null!==i.to?i.to-(i.from||0):1e9} ROWS ONLY`,u)}}else null===i.to&&null===i.from||Ue("\nLIMIT "+(null!==i.to?i.to-(i.from||0):1e9),u),null!==i.from&&Ue(` OFFSET ${i.from}`,u);return u}function De(e,t){if("object"==typeof e){let n="";return null!=e.database&&(n+=t(e.database)+"."),null!=e.schema&&(n+=t(e.schema)+"."),n+=t(e.table),n}return t(e)}function Ue(e,t){const n=t[0];n[n.length-1]+=e}function Fe({column:e,direction:t},n,r){Ue(`${r(e)} ${t.toUpperCase()}`,n)}function Be({type:e,operands:t},n,r){if(t.length<1)throw new Error("Invalid operand length");if(1===t.length||"v"===e||"nv"===e)switch(We(t[0],n,r),e){case"n":case"nv":return void Ue(" IS NULL",n);case"nn":case"v":return void Ue(" IS NOT NULL",n);default:throw new Error("Invalid filter operation")}if(2!==t.length||["in","nin"].includes(e)){var a;switch(We(t[0],n,r),e){case"in":Ue(" IN (",n);break;case"nin":Ue(" NOT IN (",n);break;default:throw new Error("Invalid filter operation")}!function(e,t){let n=!0;for(const r of e)n?n=!1:Ue(",",t),t.push(r.value),t[0].push("")}(t.slice(1),n),Ue(")",n)}else{if(["c","nc"].includes(e)){switch(We(t[0],n,r),e){case"c":Ue(" LIKE ",n);break;case"nc":Ue(" NOT LIKE ",n)}return void We((a=t[1],{...a,value:`%${a.value}%`}),n,r)}switch(We(t[0],n,r),e){case"eq":Ue(" = ",n);break;case"ne":Ue(" <> ",n);break;case"gt":Ue(" > ",n);break;case"lt":Ue(" < ",n);break;case"gte":Ue(" >= ",n);break;case"lte":Ue(" <= ",n);break;default:throw new Error("Invalid filter operation")}We(t[1],n,r)}}function We(e,t,n){"column"===e.type?Ue(n(e.value),t):(t.push(e.value),t[0].push(""))}function He(e,t){return(null==e||!(e>=e))-(null==t||!(t>=t))}function ze(e,t){return He(e,t)||(e<t?-1:e>t?1:0)}function Ve(e,t){return He(e,t)||(e>t?-1:e<t?1:0)}const Ge=e=>"number"==typeof e&&!Number.isNaN(e),Ye=e=>Number.isInteger(e)&&!Number.isNaN(e),Ze=e=>"string"==typeof e,Je=e=>"boolean"==typeof e,Qe=e=>"bigint"==typeof e,Xe=e=>e instanceof Date&&!isNaN(e),Ke=e=>e instanceof ArrayBuffer,et=e=>Array.isArray(e),tt=e=>"object"==typeof e&&null!==e,nt=e=>null!=e;function rt(e){switch(e){case"string":return Ze;case"bigint":return Qe;case"boolean":return Je;case"number":return Ge;case"integer":return Ye;case"date":return Xe;case"buffer":return Ke;case"array":return et;case"object":return tt;default:return nt}}const at=/^(([-+]\d{2})?\d{4}(-\d{2}(-\d{2}))|(\d{1,2})\/(\d{1,2})\/(\d{2,4}))([T ]\d{2}:\d{2}(:\d{2}(\.\d{3})?)?(Z|[-+]\d{2}:\d{2})?)?$/;function ot(e,t){switch(t){case"string":return"string"==typeof e||null==e?e:String(e);case"boolean":if("string"==typeof e){const t=e.trim().toLowerCase();return"true"===t||"false"!==t&&null}return"boolean"==typeof e||null==e?e:Boolean(e);case"bigint":return"bigint"==typeof e||null==e?e:Number.isInteger("string"!=typeof e||e.trim()?+e:NaN)?BigInt(e):void 0;case"integer":case"number":return"number"==typeof e?e:null==e||"string"==typeof e&&!e.trim()?NaN:Number(e);case"date":{if(e instanceof Date||null==e)return e;if("number"==typeof e)return new Date(e);const t=String(e).trim();return"string"!=typeof e||t?new Date(at.test(t)?t:NaN):null}case"array":case"object":case"buffer":case"other":return e;default:throw new Error(`Unable to coerce to type: ${t}`)}}function st(e){const{columns:t}=e;let{schema:n}=e;return Ne(n)?{schema:n,inferred:!1}:(n=dt(e,je(t)?t:void 0),{schema:n,inferred:!0})}function it(e,t){const n=e;let{schema:r,inferred:a}=st(e);const o=new Map(r.map((({name:e,type:t})=>[e,t])));if(t.types){for(const{name:e,type:a}of t.types){o.set(e,a),r===n.schema&&(r=r.slice());const t=r.findIndex((t=>t.name===e));t>-1&&(r[t]={...r[t],type:a})}e=e.map((e=>lt(e,o,r)))}else a&&(e=e.map((e=>lt(e,o,r))));return{source:e,schema:r}}function ct(e,t){if(!t.names)return e;const n=new Map(t.names.map((e=>[e.column,e])));return e.map((e=>Object.fromEntries(Object.keys(e).map((t=>[n.get(t)?.name??t,e[t]])))))}function ut(e,t){const n=new Map,r=e,a=it(e,t);e=a.source;let o=a.schema;if(t.derive){const r=[];t.derive.map((({name:a,value:o})=>{let s=[];ct(e,t).map(((e,t)=>{let n;try{n=o(e)}catch(e){s.push({index:t,error:e}),n=void 0}r[t]?r[t]={...r[t],[a]:n}:r.push({[a]:n})})),s.length&&n.set(a,s)}));const a=it(r,t);e=e.map(((e,t)=>({...e,...a.source[t]}))),o=[...o,...a.schema]}for(const{type:n,operands:r}of t.filter){const[{value:t}]=r,a=r.slice(1).map((({value:e})=>e));switch(n){case"v":{const[n]=a,r=rt(n);e=e.filter((e=>r(e[t])));break}case"nv":{const[n]=a,r=rt(n);e=e.filter((e=>!r(e[t])));break}case"eq":{const[n]=a;if(n instanceof Date){const r=+n;e=e.filter((e=>+e[t]===r))}else e=e.filter((e=>e[t]===n));break}case"ne":{const[n]=a;e=e.filter((e=>e[t]!==n));break}case"c":{const[n]=a;e=e.filter((e=>"string"==typeof e[t]&&e[t].includes(n)));break}case"nc":{const[n]=a;e=e.filter((e=>"string"==typeof e[t]&&!e[t].includes(n)));break}case"in":{const n=new Set(a);e=e.filter((e=>n.has(e[t])));break}case"nin":{const n=new Set(a);e=e.filter((e=>!n.has(e[t])));break}case"n":e=e.filter((e=>null==e[t]));break;case"nn":e=e.filter((e=>null!=e[t]));break;case"lt":{const[n]=a;e=e.filter((e=>e[t]<n));break}case"lte":{const[n]=a;e=e.filter((e=>e[t]<=n));break}case"gt":{const[n]=a;e=e.filter((e=>e[t]>n));break}case"gte":{const[n]=a;e=e.filter((e=>e[t]>=n));break}default:throw new Error(`unknown filter type: ${n}`)}}for(const{column:n,direction:a}of function(e){if("function"!=typeof e[Symbol.iterator])throw new TypeError("values is not iterable");return Array.from(e).reverse()}(t.sort)){const t="desc"===a?Ve:ze;e===r&&(e=e.slice()),e.sort(((e,r)=>t(e[n],r[n])))}let{from:s,to:i}=t.slice;s=null==s?0:Math.max(0,s),i=null==i?1/0:Math.max(0,i),(s>0||i<1/0)&&(e=e.slice(Math.max(0,s),Math.max(0,i)));let c=o.slice();if(t.select.columns){if(o){const e=new Map(o.map((e=>[e.name,e])));o=t.select.columns.map((t=>e.get(t)))}e=e.map((e=>Object.fromEntries(t.select.columns.map((t=>[t,e[t]])))))}if(t.names){const n=new Map(t.names.map((e=>[e.column,e])));o&&(o=o.map((e=>{const t=n.get(e.name);return{...e,...t?{name:t.name}:null}}))),c&&(c=c.map((e=>{const t=n.get(e.name);return{...e,...t?{name:t.name}:null}}))),e=ct(e,t)}return e!==r&&o&&(e.schema=o),e.fullSchema=c,e.errors=n,e}function lt(e,t,n){const r={};for(const a of n){const n=t.get(a.name),o=e[a.name];r[a.name]="raw"===n?o:ot(o,n)}return r}const ft=["boolean","integer","number","date","bigint","array","object","buffer"];function dt(e,t=function(e){const t=new Set;for(const n of e)if(n)for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&t.add(e);return Array.from(t)}(e)){const n=[],r=e.slice(0,100);for(const e of t){const t={boolean:0,integer:0,number:0,date:0,string:0,array:0,object:0,bigint:0,buffer:0,defined:0};for(const n of r){let r=n[e];if(null==r)continue;const a=typeof r;if("string"!==a)++t.defined,Array.isArray(r)?++t.array:r instanceof Date?++t.date:r instanceof ArrayBuffer?++t.buffer:"number"===a?(++t.number,Number.isInteger(r)&&++t.integer):a in t&&++t[a];else{if(r=r.trim(),!r)continue;++t.defined,++t.string,/^(true|false)$/i.test(r)?++t.boolean:r&&!isNaN(r)?(++t.number,Number.isInteger(+r)&&++t.integer):at.test(r)&&++t.date}}const a=Math.max(1,.9*t.defined),o=fe(ft,(e=>t[e]>=a?t[e]:NaN))??(t.string>=a?"string":"other");n.push({name:e,type:o,inferred:o})}return n}class Workbook{constructor(e){Object.defineProperties(this,{_:{value:e},sheetNames:{value:e.worksheets.map((e=>e.name)),enumerable:!0}})}sheet(e,t){const n="number"==typeof e?this.sheetNames[e]:this.sheetNames.includes(e+="")?e:null;if(null==n)throw new Error(`Sheet not found: ${e}`);return function(e,{range:t,headers:n}={}){let[[r,a],[o,s]]=function(e=":",{columnCount:t,rowCount:n}){if(!(e+="").match(/^[A-Z]*\d*:[A-Z]*\d*$/))throw new Error("Malformed range specifier");const[[r=0,a=0],[o=t-1,s=n-1]]=e.split(":").map(bt);return[[r,a],[o,s]]}(t,e);const i=n?e._rows[a++]:null;let c=new Set(["#"]);for(let e=r;e<=o;e++){const t=i?mt(i.findCell(e+1)):null;let n=t&&t+""||ht(e);for(;c.has(n);)n+="_";c.add(n)}c=new Array(r).concat(Array.from(c));const u=new Array(s-a+1);for(let t=a;t<=s;t++){const n=u[t-a]=Object.create(null,{"#":{value:t+1}}),s=e.getRow(t+1);if(s.hasValues)for(let e=r;e<=o;e++){const t=mt(s.findCell(e+1));null!=t&&(n[c[e+1]]=t)}}return u.columns=c.filter((()=>!0)),u}(this._.getWorksheet(n),t)}}function mt(e){if(!e)return;const{value:t}=e;if(t&&"object"==typeof t&&!(t instanceof Date)){if(t.formula||t.sharedFormula)return t.result&&t.result.error?NaN:t.result;if(t.richText)return pt(t);if(t.text){let{text:e}=t;return e.richText&&(e=pt(e)),t.hyperlink&&t.hyperlink!==e?`${t.hyperlink} ${e}`:e}return t}return t}function pt(e){return e.richText.map((e=>e.text)).join("")}function ht(e){let t="";e++;do{t=String.fromCharCode(64+(e%26||26))+t}while(e=Math.floor((e-1)/26));return t}function bt(e){const[,t,n]=e.match(/^([A-Z]*)(\d*)$/);let r=0;if(t)for(let e=0;e<t.length;e++)r+=Math.pow(26,t.length-e-1)*(t.charCodeAt(e)-64);return[r?r-1:void 0,n?+n-1:void 0]}async function wt(e){const t=await fetch(await e.url());if(!t.ok)throw new Error(`Unable to load file: ${e.name}`);return t}async function yt(e,t,{array:n=!1,typed:r=!1}={}){const a=await e.text(),o="\t"===t?n?m:d:n?l:u;if("auto"===r&&!n){const e=o(a);return function(e,t){const n=new Map(t.map((({name:e,type:t})=>[e,t])));return Object.assign(e.map((e=>lt(e,n,t))),{schema:t})}(e,dt(e,e.columns))}return o(a,r&&p)}class vt{constructor(e,t){Object.defineProperty(this,"name",{value:e,enumerable:!0}),void 0!==t&&Object.defineProperty(this,"mimeType",{value:t+"",enumerable:!0})}async blob(){return(await wt(this)).blob()}async arrayBuffer(){return(await wt(this)).arrayBuffer()}async text(){return(await wt(this)).text()}async json(){return(await wt(this)).json()}async stream(){return(await wt(this)).body}async csv(e){return yt(this,",",e)}async tsv(e){return yt(this,"\t",e)}async image(e){const t=await this.url();return new Promise(((n,r)=>{const a=new Image;new URL(t,document.baseURI).origin!==new URL(location).origin&&(a.crossOrigin="anonymous"),Object.assign(a,e),a.onload=()=>n(a),a.onerror=()=>r(new Error(`Unable to load file: ${this.name}`)),a.src=t}))}async arrow({version:e=4}={}){switch(e){case 4:{const[e,t]=await Promise.all([ae(R.resolve()),wt(this)]);return e.Table.from(t)}case 9:{const[e,t]=await Promise.all([import(`${ne}${k.resolve()}`),wt(this)]);return e.tableFromIPC(t)}case 11:{const[e,t]=await Promise.all([import(`${ne}${L.resolve()}`),wt(this)]);return e.tableFromIPC(t)}default:throw new Error(`unsupported arrow version: ${e}`)}}async sqlite(){return SQLiteDatabaseClient.open(wt(this))}async zip(){const[e,t]=await Promise.all([ae(j.resolve()),this.arrayBuffer()]);return new ZipArchive(await e.loadAsync(t))}async xml(e="application/xml"){return(new DOMParser).parseFromString(await this.text(),e)}async html(){return this.xml("text/html")}async xlsx(){const[e,t]=await Promise.all([ae(M.resolve()),this.arrayBuffer()]);return new Workbook(await(new e.Workbook).xlsx.load(t))}}class FileAttachment extends vt{constructor(e,t,n){super(t,n),Object.defineProperty(this,"_url",{value:e})}async url(){return await this._url+""}}function gt(e){throw new Error(`File not found: ${e}`)}class ZipArchive{constructor(e){Object.defineProperty(this,"_",{value:e}),this.filenames=Object.keys(e.files).filter((t=>!e.files[t].dir))}file(e){const t=this._.file(e+="");if(!t||t.dir)throw new Error(`file not found: ${e}`);return new ZipArchiveEntry(t)}}class ZipArchiveEntry extends vt{constructor(e){super(e.name),Object.defineProperty(this,"_",{value:e}),Object.defineProperty(this,"_url",{writable:!0})}async url(){return this._url||(this._url=this.blob().then(URL.createObjectURL))}async blob(){return this._.async("blob")}async arrayBuffer(){return this._.async("arraybuffer")}async text(){return this._.async("text")}async json(){return JSON.parse(await this.text())}}var Et={math:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};var At=0;function Tt(e){return new Nt("O-"+(null==e?"":e+"-")+ ++At)}function Nt(e){this.id=e,this.href=new URL(`#${e}`,location)+""}Nt.prototype.toString=function(){return"url("+this.href+")"};var jt=Object.freeze({__proto__:null,canvas:function(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,n},context2d:function(e,t,n){null==n&&(n=devicePixelRatio);var r=document.createElement("canvas");r.width=e*n,r.height=t*n,r.style.width=e+"px";var a=r.getContext("2d");return a.scale(n,n),a},download:function(e,t="untitled",n="Save"){const r=document.createElement("a"),a=r.appendChild(document.createElement("button"));async function o(){await new Promise(requestAnimationFrame),URL.revokeObjectURL(r.href),r.removeAttribute("href"),a.textContent=n,a.disabled=!1}return a.textContent=n,r.download=t,r.onclick=async t=>{if(a.disabled=!0,r.href)return o();a.textContent="Savingâ€¦";try{const t=await("function"==typeof e?e():e);a.textContent="Download",r.href=URL.createObjectURL(t)}catch(e){a.textContent=n}if(t.eventPhase)return o();a.disabled=!1},r},element:function(e,t){var n,r=e+="",a=r.indexOf(":");a>=0&&"xmlns"!==(r=e.slice(0,a))&&(e=e.slice(a+1));var o=Et.hasOwnProperty(r)?document.createElementNS(Et[r],e):document.createElement(e);if(t)for(var s in t)a=(r=s).indexOf(":"),n=t[s],a>=0&&"xmlns"!==(r=s.slice(0,a))&&(s=s.slice(a+1)),Et.hasOwnProperty(r)?o.setAttributeNS(Et[r],s,n):o.setAttribute(s,n);return o},input:function(e){var t=document.createElement("input");return null!=e&&(t.type=e),t},range:function(e,t,n){1===arguments.length&&(t=e,e=null);var r=document.createElement("input");return r.min=e=null==e?0:+e,r.max=t=null==t?1:+t,r.step=null==n?"any":n=+n,r.type="range",r},select:function(e){var t=document.createElement("select");return Array.prototype.forEach.call(e,(function(e){var n=document.createElement("option");n.value=n.textContent=e,t.appendChild(n)})),t},svg:function(e,t){var n=document.createElementNS("http://www.w3.org/2000/svg","svg");return n.setAttribute("viewBox",[0,0,e,t]),n.setAttribute("width",e),n.setAttribute("height",t),n},text:function(e){return document.createTextNode(e)},uid:Tt});var xt=Object.freeze({__proto__:null,buffer:function(e){return new Promise((function(t,n){var r=new FileReader;r.onload=function(){t(r.result)},r.onerror=n,r.readAsArrayBuffer(e)}))},text:function(e){return new Promise((function(t,n){var r=new FileReader;r.onload=function(){t(r.result)},r.onerror=n,r.readAsText(e)}))},url:function(e){return new Promise((function(t,n){var r=new FileReader;r.onload=function(){t(r.result)},r.onerror=n,r.readAsDataURL(e)}))}});function Ot(){return this}function $t(e,t){let n=!1;if("function"!=typeof t)throw new Error("dispose is not a function");return{[Symbol.iterator]:Ot,next:()=>n?{done:!0}:(n=!0,{done:!1,value:e}),return:()=>(n=!0,t(e),{done:!0}),throw:()=>({done:n=!0})}}function Ct(e){let t,n,r=!1;const a=e((function(e){n?(n(e),n=null):r=!0;return t=e}));if(null!=a&&"function"!=typeof a)throw new Error("function"==typeof a.then?"async initializers are not supported":"initializer returned something, but not a dispose function");return{[Symbol.iterator]:Ot,throw:()=>({done:!0}),return:()=>(null!=a&&a(),{done:!0}),next:function(){return{done:!1,value:r?(r=!1,Promise.resolve(t)):new Promise((e=>n=e))}}}}function qt(e){switch(e.type){case"range":case"number":return e.valueAsNumber;case"date":return e.valueAsDate;case"checkbox":return e.checked;case"file":return e.multiple?e.files:e.files[0];case"select-multiple":return Array.from(e.selectedOptions,(e=>e.value));default:return e.value}}var Rt=Object.freeze({__proto__:null,disposable:$t,filter:function*(e,t){for(var n,r=-1;!(n=e.next()).done;)t(n.value,++r)&&(yield n.value)},input:function(e){return Ct((function(t){var n=function(e){switch(e.type){case"button":case"submit":case"checkbox":return"click";case"file":return"change";default:return"input"}}(e),r=qt(e);function a(){t(qt(e))}return e.addEventListener(n,a),void 0!==r&&t(r),function(){e.removeEventListener(n,a)}}))},map:function*(e,t){for(var n,r=-1;!(n=e.next()).done;)yield t(n.value,++r)},observe:Ct,queue:function(e){let t;const n=[],r=e((function(e){n.push(e),t&&(t(n.shift()),t=null);return e}));if(null!=r&&"function"!=typeof r)throw new Error("function"==typeof r.then?"async initializers are not supported":"initializer returned something, but not a dispose function");return{[Symbol.iterator]:Ot,throw:()=>({done:!0}),return:()=>(null!=r&&r(),{done:!0}),next:function(){return{done:!1,value:n.length?Promise.resolve(n.shift()):new Promise((e=>t=e))}}}},range:function*(e,t,n){e=+e,t=+t,n=(a=arguments.length)<2?(t=e,e=0,1):a<3?1:+n;for(var r=-1,a=0|Math.max(0,Math.ceil((t-e)/n));++r<a;)yield e+r*n},valueAt:function(e,t){if(!(!isFinite(t=+t)||t<0||t!=t|0))for(var n,r=-1;!(n=e.next()).done;)if(++r===t)return n.value},worker:function(e){const t=URL.createObjectURL(new Blob([e],{type:"text/javascript"})),n=new Worker(t);return $t(n,(()=>{n.terminate(),URL.revokeObjectURL(t)}))}});function kt(e,t){return function(n){var r,a,o,s,i,c,u,l,f=n[0],d=[],m=null,p=-1;for(i=1,c=arguments.length;i<c;++i){if((r=arguments[i])instanceof Node)d[++p]=r,f+="\x3c!--o:"+p+"--\x3e";else if(Array.isArray(r)){for(u=0,l=r.length;u<l;++u)(a=r[u])instanceof Node?(null===m&&(d[++p]=m=document.createDocumentFragment(),f+="\x3c!--o:"+p+"--\x3e"),m.appendChild(a)):(m=null,f+=a);m=null}else f+=r;f+=n[i]}if(m=e(f),++p>0){for(o=new Array(p),s=document.createTreeWalker(m,NodeFilter.SHOW_COMMENT,null,!1);s.nextNode();)a=s.currentNode,/^o:/.test(a.nodeValue)&&(o[+a.nodeValue.slice(2)]=a);for(i=0;i<p;++i)(a=o[i])&&a.parentNode.replaceChild(d[i],a)}return 1===m.childNodes.length?m.removeChild(m.firstChild):11===m.nodeType?((a=t()).appendChild(m),a):m}}const Lt=kt((function(e){var t=document.createElement("template");return t.innerHTML=e.trim(),document.importNode(t.content,!0)}),(function(){return document.createElement("span")}));function It(e){let t;Object.defineProperties(this,{generator:{value:Ct((e=>{t=e}))},value:{get:()=>e,set:n=>t(e=n)}}),void 0!==e&&t(e)}function*St(){for(;;)yield Date.now()}var Mt=new Map;function Pt(e,t){var n;return(n=Mt.get(e=+e))?n.then((()=>t)):(n=Date.now())>=e?Promise.resolve(t):function(e,t){var n=new Promise((function(n){Mt.delete(t);var r=t-e;if(!(r>0))throw new Error("invalid time");if(r>2147483647)throw new Error("too long to wait");setTimeout(n,r)}));return Mt.set(t,n),n}(n,e).then((()=>t))}var _t=Object.freeze({__proto__:null,delay:function(e,t){return new Promise((function(n){setTimeout((function(){n(t)}),e)}))},tick:function(e,t){return Pt(Math.ceil((Date.now()+1)/e)*e,t)},when:Pt});function Dt(e,t){if(/^(\w+:)|\/\//i.test(e))return e;if(/^[.]{0,2}\//i.test(e))return new URL(e,null==t?location:t).href;if(!e.length||/^[\s._]/.test(e)||/\s$/.test(e))throw new Error("illegal name");return"https://unpkg.com/"+e}const Ut=kt((function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","g");return t.innerHTML=e.trim(),t}),(function(){return document.createElementNS("http://www.w3.org/2000/svg","g")}));var Ft=String.raw;function Bt(e){return new Promise((function(t,n){var r=document.createElement("link");r.rel="stylesheet",r.href=e,r.onerror=n,r.onload=t,document.head.appendChild(r)}))}function Wt(){return Ct((function(e){var t=e(document.body.clientWidth);function n(){var n=document.body.clientWidth;n!==t&&e(t=n)}return window.addEventListener("resize",n),function(){window.removeEventListener("resize",n)}}))}const Ht=Object.assign(Object.defineProperties((function(e){const t=function(e){return null==e?ae:Q(e)}(e);var n;Object.defineProperties(this,(n={FileAttachment:()=>gt,Mutable:()=>It,now:St,width:Wt,dot:()=>t(g.resolve()),htl:()=>t(N.resolve()),html:()=>Lt,md:()=>function(e){return e(x.resolve()).then((function(t){return kt((function(n){var r=document.createElement("div");r.innerHTML=t(n,{langPrefix:""}).trim();var a=r.querySelectorAll("pre code[class]");return a.length>0&&e(E.resolve()).then((function(t){a.forEach((function(n){function r(){t.highlightBlock(n),n.parentNode.classList.add("observablehq--md-pre")}t.getLanguage(n.className)?r():e(E.resolve("async-languages/index.js")).then((r=>{if(r.has(n.className))return e(E.resolve("async-languages/"+r.get(n.className))).then((e=>{t.registerLanguage(n.className,e)}))})).then(r,r)}))})),r}),(function(){return document.createElement("div")}))}))}(t),svg:()=>Ut,tex:()=>function(e){return Promise.all([e(A.resolve()),e.resolve(A.resolve("dist/katex.min.css")).then(Bt)]).then((function(e){var t=e[0],n=r();function r(e){return function(){var n=document.createElement("div");return t.render(Ft.apply(String,arguments),n,e),n.removeChild(n.firstChild)}}return n.options=r,n.block=r({displayMode:!0}),n}))}(t),_:()=>t(T.resolve()),aq:()=>t.alias({"apache-arrow":R.resolve()})(I.resolve()),Arrow:()=>t(R.resolve()),d3:()=>t(w.resolve()),DuckDBClient:()=>DuckDBClient,Inputs:()=>t(y.resolve()).then((e=>({...e,file:e.fileOf(vt)}))),L:()=>async function(e){const t=await e(_.resolve());if(!t._style){const n=document.createElement("link");n.rel="stylesheet",n.href=await e.resolve(_.resolve("dist/leaflet.css")),t._style=document.head.appendChild(n)}return t}(t),mermaid:()=>async function(e){const t=await e(P.resolve());return t.initialize({securityLevel:"loose",theme:"neutral"}),function(){const e=document.createElement("div");return e.innerHTML=t.render(Tt().id,String.raw.apply(String,arguments)),e.removeChild(e.firstChild)}}(t),Plot:()=>t(v.resolve()),__query:()=>Re,require:()=>t,resolve:()=>Dt,SQLite:()=>oe(t),SQLiteDatabaseClient:()=>SQLiteDatabaseClient,topojson:()=>t(S.resolve()),vl:()=>async function(e){const[t,n,r]=await Promise.all([$,C,q].map((t=>e(t.resolve()))));return r.register(t,n)}(t),aapl:()=>new FileAttachment("https://static.observableusercontent.com/files/3ccff97fd2d93da734e76829b2b066eafdaac6a1fafdec0faf6ebc443271cfc109d29e80dd217468fcb2aff1e6bffdc73f356cc48feb657f35378e6abbbb63b9").csv({typed:!0}),alphabet:()=>new FileAttachment("https://static.observableusercontent.com/files/75d52e6c3130b1cae83cda89305e17b50f33e7420ef205587a135e8562bcfd22e483cf4fa2fb5df6dff66f9c5d19740be1cfaf47406286e2eb6574b49ffc685d").csv({typed:!0}),cars:()=>new FileAttachment("https://static.observableusercontent.com/files/048ec3dfd528110c0665dfa363dd28bc516ffb7247231f3ab25005036717f5c4c232a5efc7bb74bc03037155cb72b1abe85a33d86eb9f1a336196030443be4f6").csv({typed:!0}),citywages:()=>new FileAttachment("https://static.observableusercontent.com/files/39837ec5121fcc163131dbc2fe8c1a2e0b3423a5d1e96b5ce371e2ac2e20a290d78b71a4fb08b9fa6a0107776e17fb78af313b8ea70f4cc6648fad68ddf06f7a").csv({typed:!0}),diamonds:()=>new FileAttachment("https://static.observableusercontent.com/files/87942b1f5d061a21fa4bb8f2162db44e3ef0f7391301f867ab5ba718b225a63091af20675f0bfe7f922db097b217b377135203a7eab34651e21a8d09f4e37252").csv({typed:!0}),flare:()=>new FileAttachment("https://static.observableusercontent.com/files/a6b0d94a7f5828fd133765a934f4c9746d2010e2f342d335923991f31b14120de96b5cb4f160d509d8dc627f0107d7f5b5070d2516f01e4c862b5b4867533000").csv({typed:!0}),industries:()=>new FileAttachment("https://static.observableusercontent.com/files/76f13741128340cc88798c0a0b7fa5a2df8370f57554000774ab8ee9ae785ffa2903010cad670d4939af3e9c17e5e18e7e05ed2b38b848ac2fc1a0066aa0005f").csv({typed:!0}),miserables:()=>new FileAttachment("https://static.observableusercontent.com/files/31d904f6e21d42d4963ece9c8cc4fbd75efcbdc404bf511bc79906f0a1be68b5a01e935f65123670ed04e35ca8cae3c2b943f82bf8db49c5a67c85cbb58db052").json(),olympians:()=>new FileAttachment("https://static.observableusercontent.com/files/31ca24545a0603dce099d10ee89ee5ae72d29fa55e8fc7c9ffb5ded87ac83060d80f1d9e21f4ae8eb04c1e8940b7287d179fe8060d887fb1f055f430e210007c").csv({typed:!0}),penguins:()=>new FileAttachment("https://static.observableusercontent.com/files/715db1223e067f00500780077febc6cebbdd90c151d3d78317c802732252052ab0e367039872ab9c77d6ef99e5f55a0724b35ddc898a1c99cb14c31a379af80a").csv({typed:!0}),pizza:()=>new FileAttachment("https://static.observableusercontent.com/files/c653108ab176088cacbb338eaf2344c4f5781681702bd6afb55697a3f91b511c6686ff469f3e3a27c75400001a2334dbd39a4499fe46b50a8b3c278b7d2f7fb5").csv({typed:!0}),weather:()=>new FileAttachment("https://static.observableusercontent.com/files/693a46b22b33db0f042728700e0c73e836fa13d55446df89120682d55339c6db7cc9e574d3d73f24ecc9bc7eb9ac9a1e7e104a1ee52c00aab1e77eb102913c1f").csv({typed:!0}),DOM:jt,Files:xt,Generators:Rt,Promises:_t},Object.fromEntries(Object.entries(n).map(zt))))}),{resolve:{get:()=>ae.resolve,enumerable:!0,configurable:!0},require:{get:()=>ae,set:function(e){ae=e},enumerable:!0,configurable:!0}}),{resolveFrom:Z,requireFrom:Q});function zt([e,t]){return[e,{value:t,writable:!0,enumerable:!0}]}e.AbstractFile=vt,e.FileAttachments=function(e){return Object.assign((t=>{const n=e(t+="");if(null==n)throw new Error(`File not found: ${t}`);if("object"==typeof n&&"url"in n){const{url:e,mimeType:r}=n;return new FileAttachment(e,t,r)}return new FileAttachment(n,t)}),{prototype:FileAttachment.prototype})},e.Library=Ht,e.applyDataTableOperations=ut,e.arrayIsPrimitive=Oe,e.getArrowTableSchema=pe,e.getSchema=st,e.getTypeValidator=rt,e.inferSchema=dt,e.isArqueroTable=de,e.isArrowTable=me,e.isDataArray=Te,e.isDatabaseClient=Ae,e.loadDataSource=async function(e,t,n){switch(t){case"chart":return Le(e);case"table":return Ie(e,n);case"sql":return Se(e,n)}return e},e.makeQueryTemplate=_e,e.observe=Ct}));
</script>






<script>
const lib = new window.observablehq.Library()
Generators = lib.Generators
width = lib.width()
html = lib.html()
</script>


<script>!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).vega={})}(this,(function(t){"use strict";function e(t,e,n){return t.fields=e||[],t.fname=n,t}function n(t){return null==t?null:t.fname}function r(t){return null==t?null:t.fields}function i(t){return 1===t.length?o(t[0]):a(t)}const o=t=>function(e){return e[t]},a=t=>{const e=t.length;return function(n){for(let r=0;r<e;++r)n=n[t[r]];return n}};function s(t){throw Error(t)}function u(t){const e=[],n=t.length;let r,i,o,a=null,u=0,l="";function c(){e.push(l+t.substring(r,i)),l="",r=i+1}for(t+="",r=i=0;i<n;++i)if(o=t[i],"\\"===o)l+=t.substring(r,i++),r=i;else if(o===a)c(),a=null,u=-1;else{if(a)continue;r===u&&'"'===o||r===u&&"'"===o?(r=i+1,a=o):"."!==o||u?"["===o?(i>r&&c(),u=r=i+1):"]"===o&&(u||s("Access path missing open bracket: "+t),u>0&&c(),u=0,r=i+1):i>r?c():r=i+1}return u&&s("Access path missing closing bracket: "+t),a&&s("Access path missing closing quote: "+t),i>r&&(i++,c()),e}function l(t,n,r){const o=u(t);return t=1===o.length?o[0]:t,e((r&&r.get||i)(o),[t],n||t)}const c=l("id"),f=e((t=>t),[],"identity"),h=e((()=>0),[],"zero"),d=e((()=>1),[],"one"),p=e((()=>!0),[],"true"),g=e((()=>!1),[],"false");function m(t,e,n){const r=[e].concat([].slice.call(n));console[t].apply(console,r)}const y=0,v=1,_=2,x=3,b=4;function w(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m,r=t||y;return{level(t){return arguments.length?(r=+t,this):r},error(){return r>=v&&n(e||"error","ERROR",arguments),this},warn(){return r>=_&&n(e||"warn","WARN",arguments),this},info(){return r>=x&&n(e||"log","INFO",arguments),this},debug(){return r>=b&&n(e||"log","DEBUG",arguments),this}}}var k=Array.isArray;function A(t){return t===Object(t)}const M=t=>"__proto__"!==t;function E(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.reduce(((t,e)=>{for(const n in e)if("signals"===n)t.signals=C(t.signals,e.signals);else{const r="legend"===n?{layout:1}:"style"===n||null;D(t,n,e[n],r)}return t}),{})}function D(t,e,n,r){if(!M(e))return;let i,o;if(A(n)&&!k(n))for(i in o=A(t[e])?t[e]:t[e]={},n)r&&(!0===r||r[i])?D(o,i,n[i]):M(i)&&(o[i]=n[i]);else t[e]=n}function C(t,e){if(null==t)return e;const n={},r=[];function i(t){n[t.name]||(n[t.name]=1,r.push(t))}return e.forEach(i),t.forEach(i),r}function F(t){return t[t.length-1]}function S(t){return null==t||""===t?null:+t}const $=t=>e=>t*Math.exp(e),T=t=>e=>Math.log(t*e),B=t=>e=>Math.sign(e)*Math.log1p(Math.abs(e/t)),z=t=>e=>Math.sign(e)*Math.expm1(Math.abs(e))*t,N=t=>e=>e<0?-Math.pow(-e,t):Math.pow(e,t);function O(t,e,n,r){const i=n(t[0]),o=n(F(t)),a=(o-i)*e;return[r(i-a),r(o-a)]}function R(t,e){return O(t,e,S,f)}function L(t,e){var n=Math.sign(t[0]);return O(t,e,T(n),$(n))}function U(t,e,n){return O(t,e,N(n),N(1/n))}function q(t,e,n){return O(t,e,B(n),z(n))}function P(t,e,n,r,i){const o=r(t[0]),a=r(F(t)),s=null!=e?r(e):(o+a)/2;return[i(s+(o-s)*n),i(s+(a-s)*n)]}function j(t,e,n){return P(t,e,n,S,f)}function I(t,e,n){const r=Math.sign(t[0]);return P(t,e,n,T(r),$(r))}function W(t,e,n,r){return P(t,e,n,N(r),N(1/r))}function H(t,e,n,r){return P(t,e,n,B(r),z(r))}function Y(t){return 1+~~(new Date(t).getMonth()/3)}function G(t){return 1+~~(new Date(t).getUTCMonth()/3)}function V(t){return null!=t?k(t)?t:[t]:[]}function X(t,e,n){let r,i=t[0],o=t[1];return o<i&&(r=o,o=i,i=r),r=o-i,r>=n-e?[e,n]:[i=Math.min(Math.max(i,e),n-r),i+r]}function J(t){return"function"==typeof t}const Z="descending";function Q(t,n,i){i=i||{},n=V(n)||[];const o=[],a=[],s={},u=i.comparator||tt;return V(t).forEach(((t,e)=>{null!=t&&(o.push(n[e]===Z?-1:1),a.push(t=J(t)?t:l(t,null,i)),(r(t)||[]).forEach((t=>s[t]=1)))})),0===a.length?null:e(u(a,o),Object.keys(s))}const K=(t,e)=>(t<e||null==t)&&null!=e?-1:(t>e||null==e)&&null!=t?1:(e=e instanceof Date?+e:e,(t=t instanceof Date?+t:t)!==t&&e==e?-1:e!=e&&t==t?1:0),tt=(t,e)=>1===t.length?et(t[0],e[0]):nt(t,e,t.length),et=(t,e)=>function(n,r){return K(t(n),t(r))*e},nt=(t,e,n)=>(e.push(0),function(r,i){let o,a=0,s=-1;for(;0===a&&++s<n;)o=t[s],a=K(o(r),o(i));return a*e[s]});function rt(t){return J(t)?t:()=>t}function it(t,e){let n;return r=>{n&&clearTimeout(n),n=setTimeout((()=>(e(r),n=null)),t)}}function ot(t){for(let e,n,r=1,i=arguments.length;r<i;++r)for(n in e=arguments[r],e)t[n]=e[n];return t}function at(t,e){let n,r,i,o,a=0;if(t&&(n=t.length))if(null==e){for(r=t[a];a<n&&(null==r||r!=r);r=t[++a]);for(i=o=r;a<n;++a)r=t[a],null!=r&&(r<i&&(i=r),r>o&&(o=r))}else{for(r=e(t[a]);a<n&&(null==r||r!=r);r=e(t[++a]));for(i=o=r;a<n;++a)r=e(t[a]),null!=r&&(r<i&&(i=r),r>o&&(o=r))}return[i,o]}function st(t,e){const n=t.length;let r,i,o,a,s,u=-1;if(null==e){for(;++u<n;)if(i=t[u],null!=i&&i>=i){r=o=i;break}if(u===n)return[-1,-1];for(a=s=u;++u<n;)i=t[u],null!=i&&(r>i&&(r=i,a=u),o<i&&(o=i,s=u))}else{for(;++u<n;)if(i=e(t[u],u,t),null!=i&&i>=i){r=o=i;break}if(u===n)return[-1,-1];for(a=s=u;++u<n;)i=e(t[u],u,t),null!=i&&(r>i&&(r=i,a=u),o<i&&(o=i,s=u))}return[a,s]}function ut(t,e){return Object.hasOwn(t,e)}const lt={};function ct(t){let e,n={};function r(t){return ut(n,t)&&n[t]!==lt}const i={size:0,empty:0,object:n,has:r,get:t=>r(t)?n[t]:void 0,set(t,e){return r(t)||(++i.size,n[t]===lt&&--i.empty),n[t]=e,this},delete(t){return r(t)&&(--i.size,++i.empty,n[t]=lt),this},clear(){i.size=i.empty=0,i.object=n={}},test(t){return arguments.length?(e=t,i):e},clean(){const t={};let r=0;for(const i in n){const o=n[i];o===lt||e&&e(o)||(t[i]=o,++r)}i.size=r,i.empty=0,i.object=n=t}};return t&&Object.keys(t).forEach((e=>{i.set(e,t[e])})),i}function ft(t,e,n,r,i,o){if(!n&&0!==n)return o;const a=+n;let s,u=t[0],l=F(t);l<u&&(s=u,u=l,l=s),s=Math.abs(e-u);const c=Math.abs(l-e);return s<c&&s<=a?r:c<=a?i:o}function ht(t,e,n){const r=t.prototype=Object.create(e.prototype);return Object.defineProperty(r,"constructor",{value:t,writable:!0,enumerable:!0,configurable:!0}),ot(r,n)}function dt(t,e,n,r){let i,o=e[0],a=e[e.length-1];return o>a&&(i=o,o=a,a=i),r=void 0===r||r,((n=void 0===n||n)?o<=t:o<t)&&(r?t<=a:t<a)}function pt(t){return"boolean"==typeof t}function gt(t){return"[object Date]"===Object.prototype.toString.call(t)}function mt(t){return t&&J(t[Symbol.iterator])}function yt(t){return"number"==typeof t}function vt(t){return"[object RegExp]"===Object.prototype.toString.call(t)}function _t(t){return"string"==typeof t}function xt(t,n,r){t&&(t=n?V(t).map((t=>t.replace(/\\(.)/g,"$1"))):V(t));const o=t&&t.length,a=r&&r.get||i,s=t=>a(n?[t]:u(t));let l;if(o)if(1===o){const e=s(t[0]);l=function(t){return""+e(t)}}else{const e=t.map(s);l=function(t){let n=""+e[0](t),r=0;for(;++r<o;)n+="|"+e[r](t);return n}}else l=function(){return""};return e(l,t,"key")}function bt(t,e){const n=t[0],r=F(t),i=+e;return i?1===i?r:n+i*(r-n):n}function wt(t){let e,n,r;t=+t||1e4;const i=()=>{e={},n={},r=0},o=(i,o)=>(++r>t&&(n=e,e={},r=1),e[i]=o);return i(),{clear:i,has:t=>ut(e,t)||ut(n,t),get:t=>ut(e,t)?e[t]:ut(n,t)?o(t,n[t]):void 0,set:(t,n)=>ut(e,t)?e[t]=n:o(t,n)}}function kt(t,e,n,r){const i=e.length,o=n.length;if(!o)return e;if(!i)return n;const a=r||new e.constructor(i+o);let s=0,u=0,l=0;for(;s<i&&u<o;++l)a[l]=t(e[s],n[u])>0?n[u++]:e[s++];for(;s<i;++s,++l)a[l]=e[s];for(;u<o;++u,++l)a[l]=n[u];return a}function At(t,e){let n="";for(;--e>=0;)n+=t;return n}function Mt(t,e,n,r){const i=n||" ",o=t+"",a=e-o.length;return a<=0?o:"left"===r?At(i,a)+o:"center"===r?At(i,~~(a/2))+o+At(i,Math.ceil(a/2)):o+At(i,a)}function Et(t){return t&&F(t)-t[0]||0}function Dt(t){return k(t)?"["+t.map(Dt)+"]":A(t)||_t(t)?JSON.stringify(t).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):t}function Ct(t){return null==t||""===t?null:!(!t||"false"===t||"0"===t)&&!!t}const Ft=t=>yt(t)||gt(t)?t:Date.parse(t);function St(t,e){return e=e||Ft,null==t||""===t?null:e(t)}function $t(t){return null==t||""===t?null:t+""}function Tt(t){const e={},n=t.length;for(let r=0;r<n;++r)e[t[r]]=!0;return e}function Bt(t,e,n,r){const i=null!=r?r:"â€¦",o=t+"",a=o.length,s=Math.max(0,e-i.length);return a<=e?o:"left"===n?i+o.slice(a-s):"center"===n?o.slice(0,Math.ceil(s/2))+i+o.slice(a-~~(s/2)):o.slice(0,s)+i}function zt(t,e,n){if(t)if(e){const r=t.length;for(let i=0;i<r;++i){const r=e(t[i]);r&&n(r,i,t)}}else t.forEach(n)}var Nt={},Ot={},Rt=34,Lt=10,Ut=13;function qt(t){return new Function("d","return {"+t.map((function(t,e){return JSON.stringify(t)+": d["+e+'] || ""'})).join(",")+"}")}function Pt(t){var e=Object.create(null),n=[];return t.forEach((function(t){for(var r in t)r in e||n.push(e[r]=r)})),n}function jt(t,e){var n=t+"",r=n.length;return r<e?new Array(e-r+1).join(0)+n:n}function It(t){var e,n=t.getUTCHours(),r=t.getUTCMinutes(),i=t.getUTCSeconds(),o=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":((e=t.getUTCFullYear())<0?"-"+jt(-e,6):e>9999?"+"+jt(e,6):jt(e,4))+"-"+jt(t.getUTCMonth()+1,2)+"-"+jt(t.getUTCDate(),2)+(o?"T"+jt(n,2)+":"+jt(r,2)+":"+jt(i,2)+"."+jt(o,3)+"Z":i?"T"+jt(n,2)+":"+jt(r,2)+":"+jt(i,2)+"Z":r||n?"T"+jt(n,2)+":"+jt(r,2)+"Z":"")}function Wt(t){var e=new RegExp('["'+t+"\n\r]"),n=t.charCodeAt(0);function r(t,e){var r,i=[],o=t.length,a=0,s=0,u=o<=0,l=!1;function c(){if(u)return Ot;if(l)return l=!1,Nt;var e,r,i=a;if(t.charCodeAt(i)===Rt){for(;a++<o&&t.charCodeAt(a)!==Rt||t.charCodeAt(++a)===Rt;);return(e=a)>=o?u=!0:(r=t.charCodeAt(a++))===Lt?l=!0:r===Ut&&(l=!0,t.charCodeAt(a)===Lt&&++a),t.slice(i+1,e-1).replace(/""/g,'"')}for(;a<o;){if((r=t.charCodeAt(e=a++))===Lt)l=!0;else if(r===Ut)l=!0,t.charCodeAt(a)===Lt&&++a;else if(r!==n)continue;return t.slice(i,e)}return u=!0,t.slice(i,o)}for(t.charCodeAt(o-1)===Lt&&--o,t.charCodeAt(o-1)===Ut&&--o;(r=c())!==Ot;){for(var f=[];r!==Nt&&r!==Ot;)f.push(r),r=c();e&&null==(f=e(f,s++))||i.push(f)}return i}function i(e,n){return e.map((function(e){return n.map((function(t){return a(e[t])})).join(t)}))}function o(e){return e.map(a).join(t)}function a(t){return null==t?"":t instanceof Date?It(t):e.test(t+="")?'"'+t.replace(/"/g,'""')+'"':t}return{parse:function(t,e){var n,i,o=r(t,(function(t,r){if(n)return n(t,r-1);i=t,n=e?function(t,e){var n=qt(t);return function(r,i){return e(n(r),i,t)}}(t,e):qt(t)}));return o.columns=i||[],o},parseRows:r,format:function(e,n){return null==n&&(n=Pt(e)),[n.map(a).join(t)].concat(i(e,n)).join("\n")},formatBody:function(t,e){return null==e&&(e=Pt(t)),i(t,e).join("\n")},formatRows:function(t){return t.map(o).join("\n")},formatRow:o,formatValue:a}}function Ht(t){return t}function Yt(t,e){return"string"==typeof e&&(e=t.objects[e]),"GeometryCollection"===e.type?{type:"FeatureCollection",features:e.geometries.map((function(e){return Gt(t,e)}))}:Gt(t,e)}function Gt(t,e){var n=e.id,r=e.bbox,i=null==e.properties?{}:e.properties,o=Vt(t,e);return null==n&&null==r?{type:"Feature",properties:i,geometry:o}:null==r?{type:"Feature",id:n,properties:i,geometry:o}:{type:"Feature",id:n,bbox:r,properties:i,geometry:o}}function Vt(t,e){var n=function(t){if(null==t)return Ht;var e,n,r=t.scale[0],i=t.scale[1],o=t.translate[0],a=t.translate[1];return function(t,s){s||(e=n=0);var u=2,l=t.length,c=new Array(l);for(c[0]=(e+=t[0])*r+o,c[1]=(n+=t[1])*i+a;u<l;)c[u]=t[u],++u;return c}}(t.transform),r=t.arcs;function i(t,e){e.length&&e.pop();for(var i=r[t<0?~t:t],o=0,a=i.length;o<a;++o)e.push(n(i[o],o));t<0&&function(t,e){for(var n,r=t.length,i=r-e;i<--r;)n=t[i],t[i++]=t[r],t[r]=n}(e,a)}function o(t){return n(t)}function a(t){for(var e=[],n=0,r=t.length;n<r;++n)i(t[n],e);return e.length<2&&e.push(e[0]),e}function s(t){for(var e=a(t);e.length<4;)e.push(e[0]);return e}function u(t){return t.map(s)}return function t(e){var n,r=e.type;switch(r){case"GeometryCollection":return{type:r,geometries:e.geometries.map(t)};case"Point":n=o(e.coordinates);break;case"MultiPoint":n=e.coordinates.map(o);break;case"LineString":n=a(e.arcs);break;case"MultiLineString":n=e.arcs.map(a);break;case"Polygon":n=u(e.arcs);break;case"MultiPolygon":n=e.arcs.map(u);break;default:return null}return{type:r,coordinates:n}}(e)}function Xt(t,e){var n={},r={},i={},o=[],a=-1;function s(t,e){for(var r in t){var i=t[r];delete e[i.start],delete i.start,delete i.end,i.forEach((function(t){n[t<0?~t:t]=1})),o.push(i)}}return e.forEach((function(n,r){var i,o=t.arcs[n<0?~n:n];o.length<3&&!o[1][0]&&!o[1][1]&&(i=e[++a],e[a]=n,e[r]=i)})),e.forEach((function(e){var n,o,a=function(e){var n,r=t.arcs[e<0?~e:e],i=r[0];t.transform?(n=[0,0],r.forEach((function(t){n[0]+=t[0],n[1]+=t[1]}))):n=r[r.length-1];return e<0?[n,i]:[i,n]}(e),s=a[0],u=a[1];if(n=i[s])if(delete i[n.end],n.push(e),n.end=u,o=r[u]){delete r[o.start];var l=o===n?n:n.concat(o);r[l.start=n.start]=i[l.end=o.end]=l}else r[n.start]=i[n.end]=n;else if(n=r[u])if(delete r[n.start],n.unshift(e),n.start=s,o=i[s]){delete i[o.end];var c=o===n?n:o.concat(n);r[c.start=o.start]=i[c.end=n.end]=c}else r[n.start]=i[n.end]=n;else r[(n=[e]).start=s]=i[n.end=u]=n})),s(i,r),s(r,i),e.forEach((function(t){n[t<0?~t:t]||o.push([t])})),o}function Jt(t){return Vt(t,Zt.apply(this,arguments))}function Zt(t,e,n){var r,i,o;if(arguments.length>1)r=function(t,e,n){var r,i=[],o=[];function a(t){var e=t<0?~t:t;(o[e]||(o[e]=[])).push({i:t,g:r})}function s(t){t.forEach(a)}function u(t){t.forEach(s)}function l(t){t.forEach(u)}function c(t){switch(r=t,t.type){case"GeometryCollection":t.geometries.forEach(c);break;case"LineString":s(t.arcs);break;case"MultiLineString":case"Polygon":u(t.arcs);break;case"MultiPolygon":l(t.arcs)}}return c(e),o.forEach(null==n?function(t){i.push(t[0].i)}:function(t){n(t[0].g,t[t.length-1].g)&&i.push(t[0].i)}),i}(0,e,n);else for(i=0,r=new Array(o=t.arcs.length);i<o;++i)r[i]=i;return{type:"MultiLineString",arcs:Xt(t,r)}}function Qt(t,e){return null==t||null==e?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Kt(t,e){return null==t||null==e?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function te(t){let e,n,r;function i(t,r){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.length;if(i<o){if(0!==e(r,r))return o;do{const e=i+o>>>1;n(t[e],r)<0?i=e+1:o=e}while(i<o)}return i}return 2!==t.length?(e=Qt,n=(e,n)=>Qt(t(e),n),r=(e,n)=>t(e)-n):(e=t===Qt||t===Kt?t:ee,n=t,r=t),{left:i,center:function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const o=i(t,e,n,(arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.length)-1);return o>n&&r(t[o-1],e)>-r(t[o],e)?o-1:o},right:function(t,r){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.length;if(i<o){if(0!==e(r,r))return o;do{const e=i+o>>>1;n(t[e],r)<=0?i=e+1:o=e}while(i<o)}return i}}}function ee(){return 0}function ne(t){return null===t?NaN:+t}const re=te(Qt),ie=re.right,oe=re.left;te(ne).center;class ae{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const e=this._partials;let n=0;for(let r=0;r<this._n&&r<32;r++){const i=e[r],o=t+i,a=Math.abs(t)<Math.abs(i)?t-(o-i):i-(o-t);a&&(e[n++]=a),t=o}return e[n]=t,this._n=n+1,this}valueOf(){const t=this._partials;let e,n,r,i=this._n,o=0;if(i>0){for(o=t[--i];i>0&&(e=o,n=t[--i],o=e+n,r=n-(o-e),!r););i>0&&(r<0&&t[i-1]<0||r>0&&t[i-1]>0)&&(n=2*r,e=o+n,n==e-o&&(o=e))}return o}}class se extends Map{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:he;if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:e}}),null!=t)for(const[e,n]of t)this.set(e,n)}get(t){return super.get(le(this,t))}has(t){return super.has(le(this,t))}set(t,e){return super.set(ce(this,t),e)}delete(t){return super.delete(fe(this,t))}}class ue extends Set{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:he;if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:e}}),null!=t)for(const e of t)this.add(e)}has(t){return super.has(le(this,t))}add(t){return super.add(ce(this,t))}delete(t){return super.delete(fe(this,t))}}function le(t,e){let{_intern:n,_key:r}=t;const i=r(e);return n.has(i)?n.get(i):e}function ce(t,e){let{_intern:n,_key:r}=t;const i=r(e);return n.has(i)?n.get(i):(n.set(i,e),e)}function fe(t,e){let{_intern:n,_key:r}=t;const i=r(e);return n.has(i)&&(e=n.get(i),n.delete(i)),e}function he(t){return null!==t&&"object"==typeof t?t.valueOf():t}function de(t,e){return(null==t||!(t>=t))-(null==e||!(e>=e))||(t<e?-1:t>e?1:0)}const pe=Math.sqrt(50),ge=Math.sqrt(10),me=Math.sqrt(2);function ye(t,e,n){const r=(e-t)/Math.max(0,n),i=Math.floor(Math.log10(r)),o=r/Math.pow(10,i),a=o>=pe?10:o>=ge?5:o>=me?2:1;let s,u,l;return i<0?(l=Math.pow(10,-i)/a,s=Math.round(t*l),u=Math.round(e*l),s/l<t&&++s,u/l>e&&--u,l=-l):(l=Math.pow(10,i)*a,s=Math.round(t/l),u=Math.round(e/l),s*l<t&&++s,u*l>e&&--u),u<s&&.5<=n&&n<2?ye(t,e,2*n):[s,u,l]}function ve(t,e,n){if(!((n=+n)>0))return[];if((t=+t)===(e=+e))return[t];const r=e<t,[i,o,a]=r?ye(e,t,n):ye(t,e,n);if(!(o>=i))return[];const s=o-i+1,u=new Array(s);if(r)if(a<0)for(let t=0;t<s;++t)u[t]=(o-t)/-a;else for(let t=0;t<s;++t)u[t]=(o-t)*a;else if(a<0)for(let t=0;t<s;++t)u[t]=(i+t)/-a;else for(let t=0;t<s;++t)u[t]=(i+t)*a;return u}function _e(t,e,n){return ye(t=+t,e=+e,n=+n)[2]}function xe(t,e,n){n=+n;const r=(e=+e)<(t=+t),i=r?_e(e,t,n):_e(t,e,n);return(r?-1:1)*(i<0?1/-i:i)}function be(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n<e||void 0===n&&e>=e)&&(n=e);else{let r=-1;for(let i of t)null!=(i=e(i,++r,t))&&(n<i||void 0===n&&i>=i)&&(n=i)}return n}function we(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n>e||void 0===n&&e>=e)&&(n=e);else{let r=-1;for(let i of t)null!=(i=e(i,++r,t))&&(n>i||void 0===n&&i>=i)&&(n=i)}return n}function ke(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0,i=arguments.length>4?arguments[4]:void 0;if(e=Math.floor(e),n=Math.floor(Math.max(0,n)),r=Math.floor(Math.min(t.length-1,r)),!(n<=e&&e<=r))return t;for(i=void 0===i?de:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Qt;if(t===Qt)return de;if("function"!=typeof t)throw new TypeError("compare is not a function");return(e,n)=>{const r=t(e,n);return r||0===r?r:(0===t(n,n))-(0===t(e,e))}}(i);r>n;){if(r-n>600){const o=r-n+1,a=e-n+1,s=Math.log(o),u=.5*Math.exp(2*s/3),l=.5*Math.sqrt(s*u*(o-u)/o)*(a-o/2<0?-1:1);ke(t,e,Math.max(n,Math.floor(e-a*u/o+l)),Math.min(r,Math.floor(e+(o-a)*u/o+l)),i)}const o=t[e];let a=n,s=r;for(Ae(t,n,e),i(t[r],o)>0&&Ae(t,n,r);a<s;){for(Ae(t,a,s),++a,--s;i(t[a],o)<0;)++a;for(;i(t[s],o)>0;)--s}0===i(t[n],o)?Ae(t,n,s):(++s,Ae(t,s,r)),s<=e&&(n=s+1),e<=s&&(r=s-1)}return t}function Ae(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function Me(t,e,n){if(t=Float64Array.from(function*(t,e){if(void 0===e)for(let e of t)null!=e&&(e=+e)>=e&&(yield e);else{let n=-1;for(let r of t)null!=(r=e(r,++n,t))&&(r=+r)>=r&&(yield r)}}(t,n)),(r=t.length)&&!isNaN(e=+e)){if(e<=0||r<2)return we(t);if(e>=1)return be(t);var r,i=(r-1)*e,o=Math.floor(i),a=be(ke(t,o).subarray(0,o+1));return a+(we(t.subarray(o+1))-a)*(i-o)}}function Ee(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ne;if((r=t.length)&&!isNaN(e=+e)){if(e<=0||r<2)return+n(t[0],0,t);if(e>=1)return+n(t[r-1],r-1,t);var r,i=(r-1)*e,o=Math.floor(i),a=+n(t[o],o,t);return a+(+n(t[o+1],o+1,t)-a)*(i-o)}}function De(t,e){return Me(t,.5,e)}function Ce(t){return Array.from(function*(t){for(const e of t)yield*e}(t))}function Fe(t,e,n){t=+t,e=+e,n=(i=arguments.length)<2?(e=t,t=0,1):i<3?1:+n;for(var r=-1,i=0|Math.max(0,Math.ceil((e-t)/n)),o=new Array(i);++r<i;)o[r]=t+r*n;return o}function Se(t,e){let n=0;for(let e of t)(e=+e)&&(n+=e);return n}function $e(t){return t instanceof ue?t:new ue(t)}function Te(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function Be(t){return(t=Te(Math.abs(t)))?t[1]:NaN}var ze,Ne=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Oe(t){if(!(e=Ne.exec(t)))throw new Error("invalid format: "+t);var e;return new Re({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function Re(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function Le(t,e){var n=Te(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}Oe.prototype=Re.prototype,Re.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var Ue={"%":(t,e)=>(100*t).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:function(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)},e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Le(100*t,e),r:Le,s:function(t,e){var n=Te(t,e);if(!n)return t+"";var r=n[0],i=n[1],o=i-(ze=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+Te(t,Math.max(0,e+o-1))[0]},X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function qe(t){return t}var Pe,je,Ie,We=Array.prototype.map,He=["y","z","a","f","p","n","Âµ","m","","k","M","G","T","P","E","Z","Y"];function Ye(t){var e,n,r=void 0===t.grouping||void 0===t.thousands?qe:(e=We.call(t.grouping,Number),n=t.thousands+"",function(t,r){for(var i=t.length,o=[],a=0,s=e[0],u=0;i>0&&s>0&&(u+s+1>r&&(s=Math.max(1,r-u)),o.push(t.substring(i-=s,i+s)),!((u+=s+1)>r));)s=e[a=(a+1)%e.length];return o.reverse().join(n)}),i=void 0===t.currency?"":t.currency[0]+"",o=void 0===t.currency?"":t.currency[1]+"",a=void 0===t.decimal?".":t.decimal+"",s=void 0===t.numerals?qe:function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(We.call(t.numerals,String)),u=void 0===t.percent?"%":t.percent+"",l=void 0===t.minus?"âˆ’":t.minus+"",c=void 0===t.nan?"NaN":t.nan+"";function f(t){var e=(t=Oe(t)).fill,n=t.align,f=t.sign,h=t.symbol,d=t.zero,p=t.width,g=t.comma,m=t.precision,y=t.trim,v=t.type;"n"===v?(g=!0,v="g"):Ue[v]||(void 0===m&&(m=12),y=!0,v="g"),(d||"0"===e&&"="===n)&&(d=!0,e="0",n="=");var _="$"===h?i:"#"===h&&/[boxX]/.test(v)?"0"+v.toLowerCase():"",x="$"===h?o:/[%p]/.test(v)?u:"",b=Ue[v],w=/[defgprs%]/.test(v);function k(t){var i,o,u,h=_,k=x;if("c"===v)k=b(t)+k,t="";else{var A=(t=+t)<0||1/t<0;if(t=isNaN(t)?c:b(Math.abs(t),m),y&&(t=function(t){t:for(var e,n=t.length,r=1,i=-1;r<n;++r)switch(t[r]){case".":i=e=r;break;case"0":0===i&&(i=r),e=r;break;default:if(!+t[r])break t;i>0&&(i=0)}return i>0?t.slice(0,i)+t.slice(e+1):t}(t)),A&&0==+t&&"+"!==f&&(A=!1),h=(A?"("===f?f:l:"-"===f||"("===f?"":f)+h,k=("s"===v?He[8+ze/3]:"")+k+(A&&"("===f?")":""),w)for(i=-1,o=t.length;++i<o;)if(48>(u=t.charCodeAt(i))||u>57){k=(46===u?a+t.slice(i+1):t.slice(i))+k,t=t.slice(0,i);break}}g&&!d&&(t=r(t,1/0));var M=h.length+t.length+k.length,E=M<p?new Array(p-M+1).join(e):"";switch(g&&d&&(t=r(E+t,E.length?p-k.length:1/0),E=""),n){case"<":t=h+t+k+E;break;case"=":t=h+E+t+k;break;case"^":t=E.slice(0,M=E.length>>1)+h+t+k+E.slice(M);break;default:t=E+h+t+k}return s(t)}return m=void 0===m?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,m)):Math.max(0,Math.min(20,m)),k.toString=function(){return t+""},k}return{format:f,formatPrefix:function(t,e){var n=f(((t=Oe(t)).type="f",t)),r=3*Math.max(-8,Math.min(8,Math.floor(Be(e)/3))),i=Math.pow(10,-r),o=He[8+r/3];return function(t){return n(i*t)+o}}}}function Ge(t){return Math.max(0,-Be(Math.abs(t)))}function Ve(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Be(e)/3)))-Be(Math.abs(t)))}function Xe(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Be(e)-Be(t))+1}!function(t){Pe=Ye(t),je=Pe.format,Ie=Pe.formatPrefix}({thousands:",",grouping:[3],currency:["$",""]});const Je=new Date,Ze=new Date;function Qe(t,e,n,r){function i(e){return t(e=0===arguments.length?new Date:new Date(+e)),e}return i.floor=e=>(t(e=new Date(+e)),e),i.ceil=n=>(t(n=new Date(n-1)),e(n,1),t(n),n),i.round=t=>{const e=i(t),n=i.ceil(t);return t-e<n-t?e:n},i.offset=(t,n)=>(e(t=new Date(+t),null==n?1:Math.floor(n)),t),i.range=(n,r,o)=>{const a=[];if(n=i.ceil(n),o=null==o?1:Math.floor(o),!(n<r&&o>0))return a;let s;do{a.push(s=new Date(+n)),e(n,o),t(n)}while(s<n&&n<r);return a},i.filter=n=>Qe((e=>{if(e>=e)for(;t(e),!n(e);)e.setTime(e-1)}),((t,r)=>{if(t>=t)if(r<0)for(;++r<=0;)for(;e(t,-1),!n(t););else for(;--r>=0;)for(;e(t,1),!n(t););})),n&&(i.count=(e,r)=>(Je.setTime(+e),Ze.setTime(+r),t(Je),t(Ze),Math.floor(n(Je,Ze))),i.every=t=>(t=Math.floor(t),isFinite(t)&&t>0?t>1?i.filter(r?e=>r(e)%t==0:e=>i.count(0,e)%t==0):i:null)),i}const Ke=Qe((()=>{}),((t,e)=>{t.setTime(+t+e)}),((t,e)=>e-t));Ke.every=t=>(t=Math.floor(t),isFinite(t)&&t>0?t>1?Qe((e=>{e.setTime(Math.floor(e/t)*t)}),((e,n)=>{e.setTime(+e+n*t)}),((e,n)=>(n-e)/t)):Ke:null),Ke.range;const tn=1e3,en=6e4,nn=36e5,rn=864e5,on=6048e5,an=2592e6,sn=31536e6,un=Qe((t=>{t.setTime(t-t.getMilliseconds())}),((t,e)=>{t.setTime(+t+e*tn)}),((t,e)=>(e-t)/tn),(t=>t.getUTCSeconds()));un.range;const ln=Qe((t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*tn)}),((t,e)=>{t.setTime(+t+e*en)}),((t,e)=>(e-t)/en),(t=>t.getMinutes()));ln.range;const cn=Qe((t=>{t.setUTCSeconds(0,0)}),((t,e)=>{t.setTime(+t+e*en)}),((t,e)=>(e-t)/en),(t=>t.getUTCMinutes()));cn.range;const fn=Qe((t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*tn-t.getMinutes()*en)}),((t,e)=>{t.setTime(+t+e*nn)}),((t,e)=>(e-t)/nn),(t=>t.getHours()));fn.range;const hn=Qe((t=>{t.setUTCMinutes(0,0,0)}),((t,e)=>{t.setTime(+t+e*nn)}),((t,e)=>(e-t)/nn),(t=>t.getUTCHours()));hn.range;const dn=Qe((t=>t.setHours(0,0,0,0)),((t,e)=>t.setDate(t.getDate()+e)),((t,e)=>(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*en)/rn),(t=>t.getDate()-1));dn.range;const pn=Qe((t=>{t.setUTCHours(0,0,0,0)}),((t,e)=>{t.setUTCDate(t.getUTCDate()+e)}),((t,e)=>(e-t)/rn),(t=>t.getUTCDate()-1));pn.range;const gn=Qe((t=>{t.setUTCHours(0,0,0,0)}),((t,e)=>{t.setUTCDate(t.getUTCDate()+e)}),((t,e)=>(e-t)/rn),(t=>Math.floor(t/rn)));function mn(t){return Qe((e=>{e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)}),((t,e)=>{t.setDate(t.getDate()+7*e)}),((t,e)=>(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*en)/on))}gn.range;const yn=mn(0),vn=mn(1),_n=mn(2),xn=mn(3),bn=mn(4),wn=mn(5),kn=mn(6);function An(t){return Qe((e=>{e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)}),((t,e)=>{t.setUTCDate(t.getUTCDate()+7*e)}),((t,e)=>(e-t)/on))}yn.range,vn.range,_n.range,xn.range,bn.range,wn.range,kn.range;const Mn=An(0),En=An(1),Dn=An(2),Cn=An(3),Fn=An(4),Sn=An(5),$n=An(6);Mn.range,En.range,Dn.range,Cn.range,Fn.range,Sn.range,$n.range;const Tn=Qe((t=>{t.setDate(1),t.setHours(0,0,0,0)}),((t,e)=>{t.setMonth(t.getMonth()+e)}),((t,e)=>e.getMonth()-t.getMonth()+12*(e.getFullYear()-t.getFullYear())),(t=>t.getMonth()));Tn.range;const Bn=Qe((t=>{t.setUTCDate(1),t.setUTCHours(0,0,0,0)}),((t,e)=>{t.setUTCMonth(t.getUTCMonth()+e)}),((t,e)=>e.getUTCMonth()-t.getUTCMonth()+12*(e.getUTCFullYear()-t.getUTCFullYear())),(t=>t.getUTCMonth()));Bn.range;const zn=Qe((t=>{t.setMonth(0,1),t.setHours(0,0,0,0)}),((t,e)=>{t.setFullYear(t.getFullYear()+e)}),((t,e)=>e.getFullYear()-t.getFullYear()),(t=>t.getFullYear()));zn.every=t=>isFinite(t=Math.floor(t))&&t>0?Qe((e=>{e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)}),((e,n)=>{e.setFullYear(e.getFullYear()+n*t)})):null,zn.range;const Nn=Qe((t=>{t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),((t,e)=>{t.setUTCFullYear(t.getUTCFullYear()+e)}),((t,e)=>e.getUTCFullYear()-t.getUTCFullYear()),(t=>t.getUTCFullYear()));function On(t,e,n,r,i,o){const a=[[un,1,tn],[un,5,5e3],[un,15,15e3],[un,30,3e4],[o,1,en],[o,5,3e5],[o,15,9e5],[o,30,18e5],[i,1,nn],[i,3,108e5],[i,6,216e5],[i,12,432e5],[r,1,rn],[r,2,1728e5],[n,1,on],[e,1,an],[e,3,7776e6],[t,1,sn]];function s(e,n,r){const i=Math.abs(n-e)/r,o=te((t=>{let[,,e]=t;return e})).right(a,i);if(o===a.length)return t.every(xe(e/sn,n/sn,r));if(0===o)return Ke.every(Math.max(xe(e,n,r),1));const[s,u]=a[i/a[o-1][2]<a[o][2]/i?o-1:o];return s.every(u)}return[function(t,e,n){const r=e<t;r&&([t,e]=[e,t]);const i=n&&"function"==typeof n.range?n:s(t,e,n),o=i?i.range(t,+e+1):[];return r?o.reverse():o},s]}Nn.every=t=>isFinite(t=Math.floor(t))&&t>0?Qe((e=>{e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),((e,n)=>{e.setUTCFullYear(e.getUTCFullYear()+n*t)})):null,Nn.range;const[Rn,Ln]=On(Nn,Bn,Mn,gn,hn,cn),[Un,qn]=On(zn,Tn,yn,dn,fn,ln),Pn="year",jn="quarter",In="month",Wn="week",Hn="date",Yn="day",Gn="dayofyear",Vn="hours",Xn="minutes",Jn="seconds",Zn="milliseconds",Qn=[Pn,jn,In,Wn,Hn,Yn,Gn,Vn,Xn,Jn,Zn],Kn=Qn.reduce(((t,e,n)=>(t[e]=1+n,t)),{});function tr(t){const e=V(t).slice(),n={};e.length||s("Missing time unit."),e.forEach((t=>{ut(Kn,t)?n[t]=1:s(`Invalid time unit: ${t}.`)}));return(n[Wn]||n[Yn]?1:0)+(n[jn]||n[In]||n[Hn]?1:0)+(n[Gn]?1:0)>1&&s(`Incompatible time units: ${t}`),e.sort(((t,e)=>Kn[t]-Kn[e])),e}const er={[Pn]:"%Y ",[jn]:"Q%q ",[In]:"%b ",[Hn]:"%d ",[Wn]:"W%U ",[Yn]:"%a ",[Gn]:"%j ",[Vn]:"%H:00",[Xn]:"00:%M",[Jn]:":%S",[Zn]:".%L",[`${Pn}-${In}`]:"%Y-%m ",[`${Pn}-${In}-${Hn}`]:"%Y-%m-%d ",[`${Vn}-${Xn}`]:"%H:%M"};function nr(t,e){const n=ot({},er,e),r=tr(t),i=r.length;let o,a,s="",u=0;for(u=0;u<i;)for(o=r.length;o>u;--o)if(a=r.slice(u,o).join("-"),null!=n[a]){s+=n[a],u=o;break}return s.trim()}const rr=new Date;function ir(t){return rr.setFullYear(t),rr.setMonth(0),rr.setDate(1),rr.setHours(0,0,0,0),rr}function or(t){return sr(new Date(t))}function ar(t){return ur(new Date(t))}function sr(t){return dn.count(ir(t.getFullYear())-1,t)}function ur(t){return yn.count(ir(t.getFullYear())-1,t)}function lr(t){return ir(t).getDay()}function cr(t,e,n,r,i,o,a){if(0<=t&&t<100){const s=new Date(-1,e,n,r,i,o,a);return s.setFullYear(t),s}return new Date(t,e,n,r,i,o,a)}function fr(t){return dr(new Date(t))}function hr(t){return pr(new Date(t))}function dr(t){const e=Date.UTC(t.getUTCFullYear(),0,1);return pn.count(e-1,t)}function pr(t){const e=Date.UTC(t.getUTCFullYear(),0,1);return Mn.count(e-1,t)}function gr(t){return rr.setTime(Date.UTC(t,0,1)),rr.getUTCDay()}function mr(t,e,n,r,i,o,a){if(0<=t&&t<100){const t=new Date(Date.UTC(-1,e,n,r,i,o,a));return t.setUTCFullYear(n.y),t}return new Date(Date.UTC(t,e,n,r,i,o,a))}function yr(t,e,n,r,i){const o=e||1,a=F(t),s=(t,e,i)=>function(t,e,n,r){const i=n<=1?t:r?(e,i)=>r+n*Math.floor((t(e,i)-r)/n):(e,r)=>n*Math.floor(t(e,r)/n);return e?(t,n)=>e(i(t,n),n):i}(n[i=i||t],r[i],t===a&&o,e),u=new Date,l=Tt(t),c=l[Pn]?s(Pn):rt(2012),f=l[In]?s(In):l[jn]?s(jn):h,p=l[Wn]&&l[Yn]?s(Yn,1,Wn+Yn):l[Wn]?s(Wn,1):l[Yn]?s(Yn,1):l[Hn]?s(Hn,1):l[Gn]?s(Gn,1):d,g=l[Vn]?s(Vn):h,m=l[Xn]?s(Xn):h,y=l[Jn]?s(Jn):h,v=l[Zn]?s(Zn):h;return function(t){u.setTime(+t);const e=c(u);return i(e,f(u),p(u,e),g(u),m(u),y(u),v(u))}}function vr(t,e,n){return e+7*t-(n+6)%7}const _r={[Pn]:t=>t.getFullYear(),[jn]:t=>Math.floor(t.getMonth()/3),[In]:t=>t.getMonth(),[Hn]:t=>t.getDate(),[Vn]:t=>t.getHours(),[Xn]:t=>t.getMinutes(),[Jn]:t=>t.getSeconds(),[Zn]:t=>t.getMilliseconds(),[Gn]:t=>sr(t),[Wn]:t=>ur(t),[Wn+Yn]:(t,e)=>vr(ur(t),t.getDay(),lr(e)),[Yn]:(t,e)=>vr(1,t.getDay(),lr(e))},xr={[jn]:t=>3*t,[Wn]:(t,e)=>vr(t,0,lr(e))};function br(t,e){return yr(t,e||1,_r,xr,cr)}const wr={[Pn]:t=>t.getUTCFullYear(),[jn]:t=>Math.floor(t.getUTCMonth()/3),[In]:t=>t.getUTCMonth(),[Hn]:t=>t.getUTCDate(),[Vn]:t=>t.getUTCHours(),[Xn]:t=>t.getUTCMinutes(),[Jn]:t=>t.getUTCSeconds(),[Zn]:t=>t.getUTCMilliseconds(),[Gn]:t=>dr(t),[Wn]:t=>pr(t),[Yn]:(t,e)=>vr(1,t.getUTCDay(),gr(e)),[Wn+Yn]:(t,e)=>vr(pr(t),t.getUTCDay(),gr(e))},kr={[jn]:t=>3*t,[Wn]:(t,e)=>vr(t,0,gr(e))};function Ar(t,e){return yr(t,e||1,wr,kr,mr)}const Mr={[Pn]:zn,[jn]:Tn.every(3),[In]:Tn,[Wn]:yn,[Hn]:dn,[Yn]:dn,[Gn]:dn,[Vn]:fn,[Xn]:ln,[Jn]:un,[Zn]:Ke},Er={[Pn]:Nn,[jn]:Bn.every(3),[In]:Bn,[Wn]:Mn,[Hn]:pn,[Yn]:pn,[Gn]:pn,[Vn]:hn,[Xn]:cn,[Jn]:un,[Zn]:Ke};function Dr(t){return Mr[t]}function Cr(t){return Er[t]}function Fr(t,e,n){return t?t.offset(e,n):void 0}function Sr(t,e,n){return Fr(Dr(t),e,n)}function $r(t,e,n){return Fr(Cr(t),e,n)}function Tr(t,e,n,r){return t?t.range(e,n,r):void 0}function Br(t,e,n,r){return Tr(Dr(t),e,n,r)}function zr(t,e,n,r){return Tr(Cr(t),e,n,r)}const Nr=1e3,Or=6e4,Rr=36e5,Lr=864e5,Ur=2592e6,qr=31536e6,Pr=[Pn,In,Hn,Vn,Xn,Jn,Zn],jr=Pr.slice(0,-1),Ir=jr.slice(0,-1),Wr=Ir.slice(0,-1),Hr=Wr.slice(0,-1),Yr=[Pn,In],Gr=[Pn],Vr=[[jr,1,Nr],[jr,5,5e3],[jr,15,15e3],[jr,30,3e4],[Ir,1,Or],[Ir,5,3e5],[Ir,15,9e5],[Ir,30,18e5],[Wr,1,Rr],[Wr,3,108e5],[Wr,6,216e5],[Wr,12,432e5],[Hr,1,Lr],[[Pn,Wn],1,6048e5],[Yr,1,Ur],[Yr,3,7776e6],[Gr,1,qr]];function Xr(t){const e=t.extent,n=t.maxbins||40,r=Math.abs(Et(e))/n;let i,o,a=te((t=>t[2])).right(Vr,r);return a===Vr.length?(i=Gr,o=xe(e[0]/qr,e[1]/qr,n)):a?(a=Vr[r/Vr[a-1][2]<Vr[a][2]/r?a-1:a],i=a[0],o=a[1]):(i=Pr,o=Math.max(xe(e[0],e[1],n),1)),{units:i,step:o}}function Jr(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function Zr(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function Qr(t,e,n){return{y:t,m:e,d:n,H:0,M:0,S:0,L:0}}function Kr(t){var e=t.dateTime,n=t.date,r=t.time,i=t.periods,o=t.days,a=t.shortDays,s=t.months,u=t.shortMonths,l=fi(i),c=hi(i),f=fi(o),h=hi(o),d=fi(a),p=hi(a),g=fi(s),m=hi(s),y=fi(u),v=hi(u),_={a:function(t){return a[t.getDay()]},A:function(t){return o[t.getDay()]},b:function(t){return u[t.getMonth()]},B:function(t){return s[t.getMonth()]},c:null,d:Bi,e:Bi,f:Li,g:Xi,G:Zi,H:zi,I:Ni,j:Oi,L:Ri,m:Ui,M:qi,p:function(t){return i[+(t.getHours()>=12)]},q:function(t){return 1+~~(t.getMonth()/3)},Q:bo,s:wo,S:Pi,u:ji,U:Ii,V:Hi,w:Yi,W:Gi,x:null,X:null,y:Vi,Y:Ji,Z:Qi,"%":xo},x={a:function(t){return a[t.getUTCDay()]},A:function(t){return o[t.getUTCDay()]},b:function(t){return u[t.getUTCMonth()]},B:function(t){return s[t.getUTCMonth()]},c:null,d:Ki,e:Ki,f:io,g:mo,G:vo,H:to,I:eo,j:no,L:ro,m:oo,M:ao,p:function(t){return i[+(t.getUTCHours()>=12)]},q:function(t){return 1+~~(t.getUTCMonth()/3)},Q:bo,s:wo,S:so,u:uo,U:lo,V:fo,w:ho,W:po,x:null,X:null,y:go,Y:yo,Z:_o,"%":xo},b={a:function(t,e,n){var r=d.exec(e.slice(n));return r?(t.w=p.get(r[0].toLowerCase()),n+r[0].length):-1},A:function(t,e,n){var r=f.exec(e.slice(n));return r?(t.w=h.get(r[0].toLowerCase()),n+r[0].length):-1},b:function(t,e,n){var r=y.exec(e.slice(n));return r?(t.m=v.get(r[0].toLowerCase()),n+r[0].length):-1},B:function(t,e,n){var r=g.exec(e.slice(n));return r?(t.m=m.get(r[0].toLowerCase()),n+r[0].length):-1},c:function(t,n,r){return A(t,e,n,r)},d:ki,e:ki,f:Fi,g:_i,G:vi,H:Mi,I:Mi,j:Ai,L:Ci,m:wi,M:Ei,p:function(t,e,n){var r=l.exec(e.slice(n));return r?(t.p=c.get(r[0].toLowerCase()),n+r[0].length):-1},q:bi,Q:$i,s:Ti,S:Di,u:pi,U:gi,V:mi,w:di,W:yi,x:function(t,e,r){return A(t,n,e,r)},X:function(t,e,n){return A(t,r,e,n)},y:_i,Y:vi,Z:xi,"%":Si};function w(t,e){return function(n){var r,i,o,a=[],s=-1,u=0,l=t.length;for(n instanceof Date||(n=new Date(+n));++s<l;)37===t.charCodeAt(s)&&(a.push(t.slice(u,s)),null!=(i=oi[r=t.charAt(++s)])?r=t.charAt(++s):i="e"===r?" ":"0",(o=e[r])&&(r=o(n,i)),a.push(r),u=s+1);return a.push(t.slice(u,s)),a.join("")}}function k(t,e){return function(n){var r,i,o=Qr(1900,void 0,1);if(A(o,t,n+="",0)!=n.length)return null;if("Q"in o)return new Date(o.Q);if("s"in o)return new Date(1e3*o.s+("L"in o?o.L:0));if(e&&!("Z"in o)&&(o.Z=0),"p"in o&&(o.H=o.H%12+12*o.p),void 0===o.m&&(o.m="q"in o?o.q:0),"V"in o){if(o.V<1||o.V>53)return null;"w"in o||(o.w=1),"Z"in o?(i=(r=Zr(Qr(o.y,0,1))).getUTCDay(),r=i>4||0===i?En.ceil(r):En(r),r=pn.offset(r,7*(o.V-1)),o.y=r.getUTCFullYear(),o.m=r.getUTCMonth(),o.d=r.getUTCDate()+(o.w+6)%7):(i=(r=Jr(Qr(o.y,0,1))).getDay(),r=i>4||0===i?vn.ceil(r):vn(r),r=dn.offset(r,7*(o.V-1)),o.y=r.getFullYear(),o.m=r.getMonth(),o.d=r.getDate()+(o.w+6)%7)}else("W"in o||"U"in o)&&("w"in o||(o.w="u"in o?o.u%7:"W"in o?1:0),i="Z"in o?Zr(Qr(o.y,0,1)).getUTCDay():Jr(Qr(o.y,0,1)).getDay(),o.m=0,o.d="W"in o?(o.w+6)%7+7*o.W-(i+5)%7:o.w+7*o.U-(i+6)%7);return"Z"in o?(o.H+=o.Z/100|0,o.M+=o.Z%100,Zr(o)):Jr(o)}}function A(t,e,n,r){for(var i,o,a=0,s=e.length,u=n.length;a<s;){if(r>=u)return-1;if(37===(i=e.charCodeAt(a++))){if(i=e.charAt(a++),!(o=b[i in oi?e.charAt(a++):i])||(r=o(t,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return _.x=w(n,_),_.X=w(r,_),_.c=w(e,_),x.x=w(n,x),x.X=w(r,x),x.c=w(e,x),{format:function(t){var e=w(t+="",_);return e.toString=function(){return t},e},parse:function(t){var e=k(t+="",!1);return e.toString=function(){return t},e},utcFormat:function(t){var e=w(t+="",x);return e.toString=function(){return t},e},utcParse:function(t){var e=k(t+="",!0);return e.toString=function(){return t},e}}}var ti,ei,ni,ri,ii,oi={"-":"",_:" ",0:"0"},ai=/^\s*\d+/,si=/^%/,ui=/[\\^$*+?|[\]().{}]/g;function li(t,e,n){var r=t<0?"-":"",i=(r?-t:t)+"",o=i.length;return r+(o<n?new Array(n-o+1).join(e)+i:i)}function ci(t){return t.replace(ui,"\\$&")}function fi(t){return new RegExp("^(?:"+t.map(ci).join("|")+")","i")}function hi(t){return new Map(t.map(((t,e)=>[t.toLowerCase(),e])))}function di(t,e,n){var r=ai.exec(e.slice(n,n+1));return r?(t.w=+r[0],n+r[0].length):-1}function pi(t,e,n){var r=ai.exec(e.slice(n,n+1));return r?(t.u=+r[0],n+r[0].length):-1}function gi(t,e,n){var r=ai.exec(e.slice(n,n+2));return r?(t.U=+r[0],n+r[0].length):-1}function mi(t,e,n){var r=ai.exec(e.slice(n,n+2));return r?(t.V=+r[0],n+r[0].length):-1}function yi(t,e,n){var r=ai.exec(e.slice(n,n+2));return r?(t.W=+r[0],n+r[0].length):-1}function vi(t,e,n){var r=ai.exec(e.slice(n,n+4));return r?(t.y=+r[0],n+r[0].length):-1}function _i(t,e,n){var r=ai.exec(e.slice(n,n+2));return r?(t.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function xi(t,e,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(n,n+6));return r?(t.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function bi(t,e,n){var r=ai.exec(e.slice(n,n+1));return r?(t.q=3*r[0]-3,n+r[0].length):-1}function wi(t,e,n){var r=ai.exec(e.slice(n,n+2));return r?(t.m=r[0]-1,n+r[0].length):-1}function ki(t,e,n){var r=ai.exec(e.slice(n,n+2));return r?(t.d=+r[0],n+r[0].length):-1}function Ai(t,e,n){var r=ai.exec(e.slice(n,n+3));return r?(t.m=0,t.d=+r[0],n+r[0].length):-1}function Mi(t,e,n){var r=ai.exec(e.slice(n,n+2));return r?(t.H=+r[0],n+r[0].length):-1}function Ei(t,e,n){var r=ai.exec(e.slice(n,n+2));return r?(t.M=+r[0],n+r[0].length):-1}function Di(t,e,n){var r=ai.exec(e.slice(n,n+2));return r?(t.S=+r[0],n+r[0].length):-1}function Ci(t,e,n){var r=ai.exec(e.slice(n,n+3));return r?(t.L=+r[0],n+r[0].length):-1}function Fi(t,e,n){var r=ai.exec(e.slice(n,n+6));return r?(t.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function Si(t,e,n){var r=si.exec(e.slice(n,n+1));return r?n+r[0].length:-1}function $i(t,e,n){var r=ai.exec(e.slice(n));return r?(t.Q=+r[0],n+r[0].length):-1}function Ti(t,e,n){var r=ai.exec(e.slice(n));return r?(t.s=+r[0],n+r[0].length):-1}function Bi(t,e){return li(t.getDate(),e,2)}function zi(t,e){return li(t.getHours(),e,2)}function Ni(t,e){return li(t.getHours()%12||12,e,2)}function Oi(t,e){return li(1+dn.count(zn(t),t),e,3)}function Ri(t,e){return li(t.getMilliseconds(),e,3)}function Li(t,e){return Ri(t,e)+"000"}function Ui(t,e){return li(t.getMonth()+1,e,2)}function qi(t,e){return li(t.getMinutes(),e,2)}function Pi(t,e){return li(t.getSeconds(),e,2)}function ji(t){var e=t.getDay();return 0===e?7:e}function Ii(t,e){return li(yn.count(zn(t)-1,t),e,2)}function Wi(t){var e=t.getDay();return e>=4||0===e?bn(t):bn.ceil(t)}function Hi(t,e){return t=Wi(t),li(bn.count(zn(t),t)+(4===zn(t).getDay()),e,2)}function Yi(t){return t.getDay()}function Gi(t,e){return li(vn.count(zn(t)-1,t),e,2)}function Vi(t,e){return li(t.getFullYear()%100,e,2)}function Xi(t,e){return li((t=Wi(t)).getFullYear()%100,e,2)}function Ji(t,e){return li(t.getFullYear()%1e4,e,4)}function Zi(t,e){var n=t.getDay();return li((t=n>=4||0===n?bn(t):bn.ceil(t)).getFullYear()%1e4,e,4)}function Qi(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+li(e/60|0,"0",2)+li(e%60,"0",2)}function Ki(t,e){return li(t.getUTCDate(),e,2)}function to(t,e){return li(t.getUTCHours(),e,2)}function eo(t,e){return li(t.getUTCHours()%12||12,e,2)}function no(t,e){return li(1+pn.count(Nn(t),t),e,3)}function ro(t,e){return li(t.getUTCMilliseconds(),e,3)}function io(t,e){return ro(t,e)+"000"}function oo(t,e){return li(t.getUTCMonth()+1,e,2)}function ao(t,e){return li(t.getUTCMinutes(),e,2)}function so(t,e){return li(t.getUTCSeconds(),e,2)}function uo(t){var e=t.getUTCDay();return 0===e?7:e}function lo(t,e){return li(Mn.count(Nn(t)-1,t),e,2)}function co(t){var e=t.getUTCDay();return e>=4||0===e?Fn(t):Fn.ceil(t)}function fo(t,e){return t=co(t),li(Fn.count(Nn(t),t)+(4===Nn(t).getUTCDay()),e,2)}function ho(t){return t.getUTCDay()}function po(t,e){return li(En.count(Nn(t)-1,t),e,2)}function go(t,e){return li(t.getUTCFullYear()%100,e,2)}function mo(t,e){return li((t=co(t)).getUTCFullYear()%100,e,2)}function yo(t,e){return li(t.getUTCFullYear()%1e4,e,4)}function vo(t,e){var n=t.getUTCDay();return li((t=n>=4||0===n?Fn(t):Fn.ceil(t)).getUTCFullYear()%1e4,e,4)}function _o(){return"+0000"}function xo(){return"%"}function bo(t){return+t}function wo(t){return Math.floor(+t/1e3)}function ko(t){const e={};return n=>e[n]||(e[n]=t(n))}function Ao(t){const e=ko(t.format),n=t.formatPrefix;return{format:e,formatPrefix:n,formatFloat(t){const n=Oe(t||",");if(null==n.precision){switch(n.precision=12,n.type){case"%":n.precision-=2;break;case"e":n.precision-=1}return r=e(n),i=e(".1f")(1)[1],t=>{const e=r(t),n=e.indexOf(i);if(n<0)return e;let o=function(t,e){let n,r=t.lastIndexOf("e");if(r>0)return r;for(r=t.length;--r>e;)if(n=t.charCodeAt(r),n>=48&&n<=57)return r+1}(e,n);const a=o<e.length?e.slice(o):"";for(;--o>n;)if("0"!==e[o]){++o;break}return e.slice(0,o)+a}}return e(n);var r,i},formatSpan(t,r,i,o){o=Oe(null==o?",f":o);const a=xe(t,r,i),s=Math.max(Math.abs(t),Math.abs(r));let u;if(null==o.precision)switch(o.type){case"s":return isNaN(u=Ve(a,s))||(o.precision=u),n(o,s);case"":case"e":case"g":case"p":case"r":isNaN(u=Xe(a,s))||(o.precision=u-("e"===o.type));break;case"f":case"%":isNaN(u=Ge(a))||(o.precision=u-2*("%"===o.type))}return e(o)}}}let Mo,Eo;function Do(){return Mo=Ao({format:je,formatPrefix:Ie})}function Co(t){return Ao(Ye(t))}function Fo(t){return arguments.length?Mo=Co(t):Mo}function So(t,e,n){A(n=n||{})||s(`Invalid time multi-format specifier: ${n}`);const r=e(Jn),i=e(Xn),o=e(Vn),a=e(Hn),u=e(Wn),l=e(In),c=e(jn),f=e(Pn),h=t(n[Zn]||".%L"),d=t(n[Jn]||":%S"),p=t(n[Xn]||"%I:%M"),g=t(n[Vn]||"%I %p"),m=t(n[Hn]||n[Yn]||"%a %d"),y=t(n[Wn]||"%b %d"),v=t(n[In]||"%B"),_=t(n[jn]||"%B"),x=t(n[Pn]||"%Y");return t=>(r(t)<t?h:i(t)<t?d:o(t)<t?p:a(t)<t?g:l(t)<t?u(t)<t?m:y:f(t)<t?c(t)<t?v:_:x)(t)}function $o(t){const e=ko(t.format),n=ko(t.utcFormat);return{timeFormat:t=>_t(t)?e(t):So(e,Dr,t),utcFormat:t=>_t(t)?n(t):So(n,Cr,t),timeParse:ko(t.parse),utcParse:ko(t.utcParse)}}function To(){return Eo=$o({format:ei,parse:ni,utcFormat:ri,utcParse:ii})}function Bo(t){return $o(Kr(t))}function zo(t){return arguments.length?Eo=Bo(t):Eo}!function(t){ti=Kr(t),ei=ti.format,ni=ti.parse,ri=ti.utcFormat,ii=ti.utcParse}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}),Do(),To();const No=(t,e)=>ot({},t,e);function Oo(t,e){const n=t?Co(t):Fo(),r=e?Bo(e):zo();return No(n,r)}function Ro(t,e){const n=arguments.length;return n&&2!==n&&s("defaultLocale expects either zero or two arguments."),n?No(Fo(t),zo(e)):No(Fo(),zo())}const Lo=/^(data:|([A-Za-z]+:)?\/\/)/,Uo=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,qo=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,Po="file://";async function jo(t,e){const n=await this.sanitize(t,e),r=n.href;return n.localFile?this.file(r):this.http(r,e)}async function Io(t,e){e=ot({},this.options,e);const n=this.fileAccess,r={href:null};let i,o,a;const u=Uo.test(t.replace(qo,""));null!=t&&"string"==typeof t&&u||s("Sanitize failure, invalid URI: "+Dt(t));const l=Lo.test(t);return(a=e.baseURL)&&!l&&(t.startsWith("/")||a.endsWith("/")||(t="/"+t),t=a+t),o=(i=t.startsWith(Po))||"file"===e.mode||"http"!==e.mode&&!l&&n,i?t=t.slice(Po.length):t.startsWith("//")&&("file"===e.defaultProtocol?(t=t.slice(2),o=!0):t=(e.defaultProtocol||"http")+":"+t),Object.defineProperty(r,"localFile",{value:!!o}),r.href=t,e.target&&(r.target=e.target+""),e.rel&&(r.rel=e.rel+""),"image"===e.context&&e.crossOrigin&&(r.crossOrigin=e.crossOrigin+""),r}function Wo(t){return t?e=>new Promise(((n,r)=>{t.readFile(e,((t,e)=>{t?r(t):n(e)}))})):Ho}async function Ho(){s("No file system access.")}function Yo(t){return t?async function(e,n){const r=ot({},this.options.http,n),i=n&&n.response,o=await t(e,r);return o.ok?J(o[i])?o[i]():o.text():s(o.status+""+o.statusText)}:Go}async function Go(){s("No HTTP fetch method available.")}const Vo=t=>null!=t&&t==t,Xo=t=>!(Number.isNaN(+t)||t instanceof Date),Jo={boolean:Ct,integer:S,number:S,date:St,string:$t,unknown:f},Zo=[t=>"true"===t||"false"===t||!0===t||!1===t,t=>Xo(t)&&Number.isInteger(+t),Xo,t=>!Number.isNaN(Date.parse(t))],Qo=["boolean","integer","number","date"];function Ko(t,e){if(!t||!t.length)return"unknown";const n=t.length,r=Zo.length,i=Zo.map(((t,e)=>e+1));for(let o,a,s=0,u=0;s<n;++s)for(a=e?t[s][e]:t[s],o=0;o<r;++o)if(i[o]&&Vo(a)&&!Zo[o](a)&&(i[o]=0,++u,u===Zo.length))return"string";return Qo[i.reduce(((t,e)=>0===t?e:t),0)-1]}function ta(t,e){return e.reduce(((e,n)=>(e[n]=Ko(t,n),e)),{})}function ea(t){const e=function(e,n){const r={delimiter:t};return na(e,n?ot(n,r):r)};return e.responseType="text",e}function na(t,e){return e.header&&(t=e.header.map(Dt).join(e.delimiter)+"\n"+t),Wt(e.delimiter).parse(t+"")}function ra(t,e){const n=e&&e.property?l(e.property):f;return!A(t)||(r=t,"function"==typeof Buffer&&J(Buffer.isBuffer)&&Buffer.isBuffer(r))?n(JSON.parse(t)):function(t,e){!k(t)&&mt(t)&&(t=[...t]);return e&&e.copy?JSON.parse(JSON.stringify(t)):t}(n(t),e);var r}na.responseType="text",ra.responseType="json";const ia={interior:(t,e)=>t!==e,exterior:(t,e)=>t===e};function oa(t,e){let n,r,i,o;return t=ra(t,e),e&&e.feature?(n=Yt,i=e.feature):e&&e.mesh?(n=Jt,i=e.mesh,o=ia[e.filter]):s("Missing TopoJSON feature or mesh parameter."),r=(r=t.objects[i])?n(t,r,o):s("Invalid TopoJSON object: "+i),r&&r.features||[r]}oa.responseType="json";const aa={dsv:na,csv:ea(","),tsv:ea("\t"),json:ra,topojson:oa};function sa(t,e){return arguments.length>1?(aa[t]=e,this):ut(aa,t)?aa[t]:null}function ua(t){const e=sa(t);return e&&e.responseType||"text"}function la(t,e,n,r){const i=sa((e=e||{}).type||"json");return i||s("Unknown data format type: "+e.type),t=i(t,e),e.parse&&function(t,e,n,r){if(!t.length)return;const i=zo();n=n||i.timeParse,r=r||i.utcParse;let o,a,s,u,l,c,f=t.columns||Object.keys(t[0]);"auto"===e&&(e=ta(t,f));f=Object.keys(e);const h=f.map((t=>{const i=e[t];let o,a;if(i&&(i.startsWith("date:")||i.startsWith("utc:"))){o=i.split(/:(.+)?/,2),a=o[1],("'"===a[0]&&"'"===a[a.length-1]||'"'===a[0]&&'"'===a[a.length-1])&&(a=a.slice(1,-1));return("utc"===o[0]?r:n)(a)}if(!Jo[i])throw Error("Illegal format pattern: "+t+":"+i);return Jo[i]}));for(s=0,l=t.length,c=f.length;s<l;++s)for(o=t[s],u=0;u<c;++u)a=f[u],o[a]=h[u](o[a])}(t,e.parse,n,r),ut(t,"columns")&&delete t.columns,t}const ca=function(t,e){return n=>({options:n||{},sanitize:Io,load:jo,fileAccess:!1,file:Wo(e),http:Yo(t)})}("undefined"!=typeof fetch&&fetch,null);function fa(t){const e=t||f,n=[],r={};return n.add=t=>{const i=e(t);return r[i]||(r[i]=1,n.push(t)),n},n.remove=t=>{const i=e(t);if(r[i]){r[i]=0;const e=n.indexOf(t);e>=0&&n.splice(e,1)}return n},n}async function ha(t,e){try{await e(t)}catch(e){t.error(e)}}const da=Symbol("vega_id");let pa=1;function ga(t){return!(!t||!ma(t))}function ma(t){return t[da]}function ya(t,e){return t[da]=e,t}function va(t){const e=t===Object(t)?t:{data:t};return ma(e)?e:ya(e,pa++)}function _a(t){return xa(t,va({}))}function xa(t,e){for(const n in t)e[n]=t[n];return e}function ba(t,e){return ya(e,ma(t))}function wa(t,e){return t?e?(n,r)=>t(n,r)||ma(e(n))-ma(e(r)):(e,n)=>t(e,n)||ma(e)-ma(n):null}function ka(t){return t&&t.constructor===Aa}function Aa(){const t=[],e=[],n=[],r=[],i=[];let o=null,a=!1;return{constructor:Aa,insert(e){const n=V(e),r=n.length;for(let e=0;e<r;++e)t.push(n[e]);return this},remove(t){const n=J(t)?r:e,i=V(t),o=i.length;for(let t=0;t<o;++t)n.push(i[t]);return this},modify(t,e,r){const o={field:e,value:rt(r)};return J(t)?(o.filter=t,i.push(o)):(o.tuple=t,n.push(o)),this},encode(t,e){return J(t)?i.push({filter:t,field:e}):n.push({tuple:t,field:e}),this},clean(t){return o=t,this},reflow(){return a=!0,this},pulse(s,u){const l={},c={};let f,h,d,p,g,m;for(f=0,h=u.length;f<h;++f)l[ma(u[f])]=1;for(f=0,h=e.length;f<h;++f)g=e[f],l[ma(g)]=-1;for(f=0,h=r.length;f<h;++f)p=r[f],u.forEach((t=>{p(t)&&(l[ma(t)]=-1)}));for(f=0,h=t.length;f<h;++f)g=t[f],m=ma(g),l[m]?l[m]=1:s.add.push(va(t[f]));for(f=0,h=u.length;f<h;++f)g=u[f],l[ma(g)]<0&&s.rem.push(g);function y(t,e,n){n?t[e]=n(t):s.encode=e,a||(c[ma(t)]=t)}for(f=0,h=n.length;f<h;++f)d=n[f],g=d.tuple,p=d.field,m=l[ma(g)],m>0&&(y(g,p,d.value),s.modifies(p));for(f=0,h=i.length;f<h;++f)d=i[f],p=d.filter,u.forEach((t=>{p(t)&&l[ma(t)]>0&&y(t,d.field,d.value)})),s.modifies(d.field);if(a)s.mod=e.length||r.length?u.filter((t=>l[ma(t)]>0)):u.slice();else for(m in c)s.mod.push(c[m]);return(o||null==o&&(e.length||r.length))&&s.clean(!0),s}}}const Ma="_:mod:_";function Ea(){Object.defineProperty(this,Ma,{writable:!0,value:{}})}Ea.prototype={set(t,e,n,r){const i=this,o=i[t],a=i[Ma];return null!=e&&e>=0?(o[e]!==n||r)&&(o[e]=n,a[e+":"+t]=-1,a[t]=-1):(o!==n||r)&&(i[t]=n,a[t]=k(n)?1+n.length:-1),i},modified(t,e){const n=this[Ma];if(!arguments.length){for(const t in n)if(n[t])return!0;return!1}if(k(t)){for(let e=0;e<t.length;++e)if(n[t[e]])return!0;return!1}return null!=e&&e>=0?e+1<n[t]||!!n[e+":"+t]:!!n[t]},clear(){return this[Ma]={},this}};let Da=0;const Ca=new Ea;function Fa(t,e,n,r){this.id=++Da,this.value=t,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,e&&(this._update=e),n&&this.parameters(n,r)}function Sa(t){return function(e){const n=this.flags;return 0===arguments.length?!!(n&t):(this.flags=e?n|t:n&~t,this)}}Fa.prototype={targets(){return this._targets||(this._targets=fa(c))},set(t){return this.value!==t?(this.value=t,1):0},skip:Sa(1),modified:Sa(2),parameters(t,e,n){e=!1!==e;const r=this._argval=this._argval||new Ea,i=this._argops=this._argops||[],o=[];let a,u,l,c;const f=(t,n,a)=>{a instanceof Fa?(a!==this&&(e&&a.targets().add(this),o.push(a)),i.push({op:a,name:t,index:n})):r.set(t,n,a)};for(a in t)if(u=t[a],"pulse"===a)V(u).forEach((t=>{t instanceof Fa?t!==this&&(t.targets().add(this),o.push(t)):s("Pulse parameters must be operator instances.")})),this.source=u;else if(k(u))for(r.set(a,-1,Array(l=u.length)),c=0;c<l;++c)f(a,c,u[c]);else f(a,-1,u);return this.marshall().clear(),n&&(i.initonly=!0),o},marshall(t){const e=this._argval||Ca,n=this._argops;let r,i,o,a;if(n){const s=n.length;for(i=0;i<s;++i)r=n[i],o=r.op,a=o.modified()&&o.stamp===t,e.set(r.name,r.index,o.value,a);if(n.initonly){for(i=0;i<s;++i)r=n[i],r.op.targets().remove(this);this._argops=null,this._update=null}}return e},detach(){const t=this._argops;let e,n,r,i;if(t)for(e=0,n=t.length;e<n;++e)r=t[e],i=r.op,i._targets&&i._targets.remove(this);this.pulse=null,this.source=null},evaluate(t){const e=this._update;if(e){const n=this.marshall(t.stamp),r=e.call(this,n,t);if(n.clear(),r!==this.value)this.value=r;else if(!this.modified())return t.StopPropagation}},run(t){if(t.stamp<this.stamp)return t.StopPropagation;let e;return this.skip()?(this.skip(!1),e=0):e=this.evaluate(t),this.pulse=e||t}};let $a=0;function Ta(t,e,n){this.id=++$a,this.value=null,n&&(this.receive=n),t&&(this._filter=t),e&&(this._apply=e)}function Ba(t,e,n){return new Ta(t,e,n)}Ta.prototype={_filter:p,_apply:f,targets(){return this._targets||(this._targets=fa(c))},consume(t){return arguments.length?(this._consume=!!t,this):!!this._consume},receive(t){if(this._filter(t)){const e=this.value=this._apply(t),n=this._targets,r=n?n.length:0;for(let t=0;t<r;++t)n[t].receive(e);this._consume&&(t.preventDefault(),t.stopPropagation())}},filter(t){const e=Ba(t);return this.targets().add(e),e},apply(t){const e=Ba(null,t);return this.targets().add(e),e},merge(){const t=Ba();this.targets().add(t);for(let e=0,n=arguments.length;e<n;++e)arguments[e].targets().add(t);return t},throttle(t){let e=-1;return this.filter((()=>{const n=Date.now();return n-e>t?(e=n,1):0}))},debounce(t){const e=Ba();return this.targets().add(Ba(null,null,it(t,(t=>{const n=t.dataflow;e.receive(t),n&&n.run&&n.run()})))),e},between(t,e){let n=!1;return t.targets().add(Ba(null,null,(()=>n=!0))),e.targets().add(Ba(null,null,(()=>n=!1))),this.filter((()=>n))},detach(){this._filter=p,this._targets=null}};const za={skip:!0};function Na(t,e,n,r,i,o){const a=ot({},o,za);let s,u;J(n)||(n=rt(n)),void 0===r?s=e=>t.touch(n(e)):J(r)?(u=new Fa(null,r,i,!1),s=e=>{u.evaluate(e);const r=n(e),i=u.value;ka(i)?t.pulse(r,i,o):t.update(r,i,a)}):s=e=>t.update(n(e),r,a),e.apply(s)}function Oa(t,e,n,r,i,o){if(void 0===r)e.targets().add(n);else{const a=o||{},s=new Fa(null,function(t,e){return e=J(e)?e:rt(e),t?function(n,r){const i=e(n,r);return t.skip()||(t.skip(i!==this.value).value=i),i}:e}(n,r),i,!1);s.modified(a.force),s.rank=e.rank,e.targets().add(s),n&&(s.skip(!0),s.value=n.value,s.targets().add(n),t.connect(n,[s]))}}const Ra={};function La(t,e,n){this.dataflow=t,this.stamp=null==e?-1:e,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}function Ua(t,e){const n=[];return zt(t,e,(t=>n.push(t))),n}function qa(t,e){const n={};return t.visit(e,(t=>{n[ma(t)]=1})),t=>n[ma(t)]?null:t}function Pa(t,e){return t?(n,r)=>t(n,r)&&e(n,r):e}function ja(t,e,n,r){const i=this;let o=0;this.dataflow=t,this.stamp=e,this.fields=null,this.encode=r||null,this.pulses=n;for(const t of n)if(t.stamp===e){if(t.fields){const e=i.fields||(i.fields={});for(const n in t.fields)e[n]=1}t.changed(i.ADD)&&(o|=i.ADD),t.changed(i.REM)&&(o|=i.REM),t.changed(i.MOD)&&(o|=i.MOD)}this.changes=o}function Ia(t){return t.error("Dataflow already running. Use runAsync() to chain invocations."),t}La.prototype={StopPropagation:Ra,ADD:1,REM:2,MOD:4,ADD_REM:3,ADD_MOD:5,ALL:7,REFLOW:8,SOURCE:16,NO_SOURCE:32,NO_FIELDS:64,fork(t){return new La(this.dataflow).init(this,t)},clone(){const t=this.fork(7);return t.add=t.add.slice(),t.rem=t.rem.slice(),t.mod=t.mod.slice(),t.source&&(t.source=t.source.slice()),t.materialize(23)},addAll(){let t=this;return!t.source||t.add===t.rem||!t.rem.length&&t.source.length===t.add.length||(t=new La(this.dataflow).init(this),t.add=t.source,t.rem=[]),t},init(t,e){const n=this;return n.stamp=t.stamp,n.encode=t.encode,!t.fields||64&e||(n.fields=t.fields),1&e?(n.addF=t.addF,n.add=t.add):(n.addF=null,n.add=[]),2&e?(n.remF=t.remF,n.rem=t.rem):(n.remF=null,n.rem=[]),4&e?(n.modF=t.modF,n.mod=t.mod):(n.modF=null,n.mod=[]),32&e?(n.srcF=null,n.source=null):(n.srcF=t.srcF,n.source=t.source,t.cleans&&(n.cleans=t.cleans)),n},runAfter(t){this.dataflow.runAfter(t)},changed(t){const e=t||7;return 1&e&&this.add.length||2&e&&this.rem.length||4&e&&this.mod.length},reflow(t){if(t)return this.fork(7).reflow();const e=this.add.length,n=this.source&&this.source.length;return n&&n!==e&&(this.mod=this.source,e&&this.filter(4,qa(this,1))),this},clean(t){return arguments.length?(this.cleans=!!t,this):this.cleans},modifies(t){const e=this.fields||(this.fields={});return k(t)?t.forEach((t=>e[t]=!0)):e[t]=!0,this},modified(t,e){const n=this.fields;return!(!e&&!this.mod.length||!n)&&(arguments.length?k(t)?t.some((t=>n[t])):n[t]:!!n)},filter(t,e){const n=this;return 1&t&&(n.addF=Pa(n.addF,e)),2&t&&(n.remF=Pa(n.remF,e)),4&t&&(n.modF=Pa(n.modF,e)),16&t&&(n.srcF=Pa(n.srcF,e)),n},materialize(t){const e=this;return 1&(t=t||7)&&e.addF&&(e.add=Ua(e.add,e.addF),e.addF=null),2&t&&e.remF&&(e.rem=Ua(e.rem,e.remF),e.remF=null),4&t&&e.modF&&(e.mod=Ua(e.mod,e.modF),e.modF=null),16&t&&e.srcF&&(e.source=e.source.filter(e.srcF),e.srcF=null),e},visit(t,e){const n=this,r=e;if(16&t)return zt(n.source,n.srcF,r),n;1&t&&zt(n.add,n.addF,r),2&t&&zt(n.rem,n.remF,r),4&t&&zt(n.mod,n.modF,r);const i=n.source;if(8&t&&i){const t=n.add.length+n.mod.length;t===i.length||zt(i,t?qa(n,5):n.srcF,r)}return n}},ht(ja,La,{fork(t){const e=new La(this.dataflow).init(this,t&this.NO_FIELDS);return void 0!==t&&(t&e.ADD&&this.visit(e.ADD,(t=>e.add.push(t))),t&e.REM&&this.visit(e.REM,(t=>e.rem.push(t))),t&e.MOD&&this.visit(e.MOD,(t=>e.mod.push(t)))),e},changed(t){return this.changes&t},modified(t){const e=this,n=e.fields;return n&&e.changes&e.MOD?k(t)?t.some((t=>n[t])):n[t]:0},filter(){s("MultiPulse does not support filtering.")},materialize(){s("MultiPulse does not support materialization.")},visit(t,e){const n=this,r=n.pulses,i=r.length;let o=0;if(t&n.SOURCE)for(;o<i;++o)r[o].visit(t,e);else for(;o<i;++o)r[o].stamp===n.stamp&&r[o].visit(t,e);return n}});const Wa={skip:!1,force:!1};function Ha(t){let e=[];return{clear:()=>e=[],size:()=>e.length,peek:()=>e[0],push:n=>(e.push(n),Ya(e,0,e.length-1,t)),pop:()=>{const n=e.pop();let r;return e.length?(r=e[0],e[0]=n,function(t,e,n){const r=e,i=t.length,o=t[e];let a,s=1+(e<<1);for(;s<i;)a=s+1,a<i&&n(t[s],t[a])>=0&&(s=a),t[e]=t[s],s=1+((e=s)<<1);t[e]=o,Ya(t,r,e,n)}(e,0,t)):r=n,r}}}function Ya(t,e,n,r){let i,o;const a=t[n];for(;n>e&&(o=n-1>>1,i=t[o],r(a,i)<0);)t[n]=i,n=o;return t[n]=a}function Ga(){this.logger(w()),this.logLevel(v),this._clock=0,this._rank=0,this._locale=Ro();try{this._loader=ca()}catch(t){}this._touched=fa(c),this._input={},this._pulse=null,this._heap=Ha(((t,e)=>t.qrank-e.qrank)),this._postrun=[]}function Va(t){return function(){return this._log[t].apply(this,arguments)}}function Xa(t,e){Fa.call(this,t,null,e)}Ga.prototype={stamp(){return this._clock},loader(t){return arguments.length?(this._loader=t,this):this._loader},locale(t){return arguments.length?(this._locale=t,this):this._locale},logger(t){return arguments.length?(this._log=t,this):this._log},error:Va("error"),warn:Va("warn"),info:Va("info"),debug:Va("debug"),logLevel:Va("level"),cleanThreshold:1e4,add:function(t,e,n,r){let i,o=1;return t instanceof Fa?i=t:t&&t.prototype instanceof Fa?i=new t:J(t)?i=new Fa(null,t):(o=0,i=new Fa(t,e)),this.rank(i),o&&(r=n,n=e),n&&this.connect(i,i.parameters(n,r)),this.touch(i),i},connect:function(t,e){const n=t.rank,r=e.length;for(let i=0;i<r;++i)if(n<e[i].rank)return void this.rerank(t)},rank:function(t){t.rank=++this._rank},rerank:function(t){const e=[t];let n,r,i;for(;e.length;)if(this.rank(n=e.pop()),r=n._targets)for(i=r.length;--i>=0;)e.push(n=r[i]),n===t&&s("Cycle detected in dataflow graph.")},pulse:function(t,e,n){this.touch(t,n||Wa);const r=new La(this,this._clock+(this._pulse?0:1)),i=t.pulse&&t.pulse.source||[];return r.target=t,this._input[t.id]=e.pulse(r,i),this},touch:function(t,e){const n=e||Wa;return this._pulse?this._enqueue(t):this._touched.add(t),n.skip&&t.skip(!0),this},update:function(t,e,n){const r=n||Wa;return(t.set(e)||r.force)&&this.touch(t,r),this},changeset:Aa,ingest:function(t,e,n){return e=this.parse(e,n),this.pulse(t,this.changeset().insert(e))},parse:function(t,e){const n=this.locale();return la(t,e,n.timeParse,n.utcParse)},preload:async function(t,e,n){const r=this,i=r._pending||function(t){let e;const n=new Promise((t=>e=t));return n.requests=0,n.done=()=>{0==--n.requests&&(t._pending=null,e(t))},t._pending=n}(r);i.requests+=1;const o=await r.request(e,n);return r.pulse(t,r.changeset().remove(p).insert(o.data||[])),i.done(),o},request:async function(t,e){const n=this;let r,i=0;try{r=await n.loader().load(t,{context:"dataflow",response:ua(e&&e.type)});try{r=n.parse(r,e)}catch(e){i=-2,n.warn("Data ingestion failed",t,e)}}catch(e){i=-1,n.warn("Loading failed",t,e)}return{data:r,status:i}},events:function(t,e,n,r){const i=this,o=Ba(n,r),a=function(t){t.dataflow=i;try{o.receive(t)}catch(t){i.error(t)}finally{i.run()}};let s;s="string"==typeof t&&"undefined"!=typeof document?document.querySelectorAll(t):V(t);const u=s.length;for(let t=0;t<u;++t)s[t].addEventListener(e,a);return o},on:function(t,e,n,r,i){return(t instanceof Fa?Oa:Na)(this,t,e,n,r,i),this},evaluate:async function(t,e,n){const r=this,i=[];if(r._pulse)return Ia(r);if(r._pending&&await r._pending,e&&await ha(r,e),!r._touched.length)return r.debug("Dataflow invoked, but nothing to do."),r;const o=++r._clock;r._pulse=new La(r,o,t),r._touched.forEach((t=>r._enqueue(t,!0))),r._touched=fa(c);let a,s,u,l=0;try{for(;r._heap.size()>0;)a=r._heap.pop(),a.rank===a.qrank?(s=a.run(r._getPulse(a,t)),s.then?s=await s:s.async&&(i.push(s.async),s=Ra),s!==Ra&&a._targets&&a._targets.forEach((t=>r._enqueue(t))),++l):r._enqueue(a,!0)}catch(t){r._heap.clear(),u=t}if(r._input={},r._pulse=null,r.debug(`Pulse ${o}: ${l} operators`),u&&(r._postrun=[],r.error(u)),r._postrun.length){const t=r._postrun.sort(((t,e)=>e.priority-t.priority));r._postrun=[];for(let e=0;e<t.length;++e)await ha(r,t[e].callback)}return n&&await ha(r,n),i.length&&Promise.all(i).then((t=>r.runAsync(null,(()=>{t.forEach((t=>{try{t(r)}catch(t){r.error(t)}}))})))),r},run:function(t,e,n){return this._pulse?Ia(this):(this.evaluate(t,e,n),this)},runAsync:async function(t,e,n){for(;this._running;)await this._running;const r=()=>this._running=null;return(this._running=this.evaluate(t,e,n)).then(r,r),this._running},runAfter:function(t,e,n){if(this._pulse||e)this._postrun.push({priority:n||0,callback:t});else try{t(this)}catch(t){this.error(t)}},_enqueue:function(t,e){const n=t.stamp<this._clock;n&&(t.stamp=this._clock),(n||e)&&(t.qrank=t.rank,this._heap.push(t))},_getPulse:function(t,e){const n=t.source,r=this._clock;return n&&k(n)?new ja(this,r,n.map((t=>t.pulse)),e):this._input[t.id]||function(t,e){if(e&&e.stamp===t.stamp)return e;t=t.fork(),e&&e!==Ra&&(t.source=e.source);return t}(this._pulse,n&&n.pulse)}},ht(Xa,Fa,{run(t){if(t.stamp<this.stamp)return t.StopPropagation;let e;return this.skip()?this.skip(!1):e=this.evaluate(t),e=e||t,e.then?e=e.then((t=>this.pulse=t)):e!==t.StopPropagation&&(this.pulse=e),e},evaluate(t){const e=this.marshall(t.stamp),n=this.transform(e,t);return e.clear(),n},transform(){}});const Ja={};function Za(t){const e=Qa(t);return e&&e.Definition||null}function Qa(t){return t=t&&t.toLowerCase(),ut(Ja,t)?Ja[t]:null}function*Ka(t,e){if(null==e)for(let e of t)null!=e&&""!==e&&(e=+e)>=e&&(yield e);else{let n=-1;for(let r of t)r=e(r,++n,t),null!=r&&""!==r&&(r=+r)>=r&&(yield r)}}function ts(t,e,n){const r=Float64Array.from(Ka(t,n));return r.sort(Qt),e.map((t=>Ee(r,t)))}function es(t,e){return ts(t,[.25,.5,.75],e)}function ns(t,e){const n=t.length,r=function(t,e){const n=function(t,e){let n,r=0,i=0,o=0;if(void 0===e)for(let e of t)null!=e&&(e=+e)>=e&&(n=e-i,i+=n/++r,o+=n*(e-i));else{let a=-1;for(let s of t)null!=(s=e(s,++a,t))&&(s=+s)>=s&&(n=s-i,i+=n/++r,o+=n*(s-i))}if(r>1)return o/(r-1)}(t,e);return n?Math.sqrt(n):n}(t,e),i=es(t,e),o=(i[2]-i[0])/1.34;return 1.06*(Math.min(r,o)||r||Math.abs(i[0])||1)*Math.pow(n,-.2)}function rs(t){const e=t.maxbins||20,n=t.base||10,r=Math.log(n),i=t.divide||[5,2];let o,a,s,u,l,c,f=t.extent[0],h=t.extent[1];const d=t.span||h-f||Math.abs(f)||1;if(t.step)o=t.step;else if(t.steps){for(u=d/e,l=0,c=t.steps.length;l<c&&t.steps[l]<u;++l);o=t.steps[Math.max(0,l-1)]}else{for(a=Math.ceil(Math.log(e)/r),s=t.minstep||0,o=Math.max(s,Math.pow(n,Math.round(Math.log(d)/r)-a));Math.ceil(d/o)>e;)o*=n;for(l=0,c=i.length;l<c;++l)u=o/i[l],u>=s&&d/u<=e&&(o=u)}u=Math.log(o);const p=u>=0?0:1+~~(-u/r),g=Math.pow(n,-p-1);return(t.nice||void 0===t.nice)&&(u=Math.floor(f/o+g)*o,f=f<u?u-o:u,h=Math.ceil(h/o)*o),{start:f,stop:h===f?f+o:h,step:o}}function is(e,n,r,i){if(!e.length)return[void 0,void 0];const o=Float64Array.from(Ka(e,i)),a=o.length,s=n;let u,l,c,f;for(c=0,f=Array(s);c<s;++c){for(u=0,l=0;l<a;++l)u+=o[~~(t.random()*a)];f[c]=u/a}return f.sort(Qt),[Me(f,r/2),Me(f,1-r/2)]}function os(t,e,n,r){r=r||(t=>t);const i=t.length,o=new Float64Array(i);let a,s=0,u=1,l=r(t[0]),c=l,f=l+e;for(;u<i;++u){if(a=r(t[u]),a>=f){for(c=(l+c)/2;s<u;++s)o[s]=c;f=a+e,l=a}c=a}for(c=(l+c)/2;s<u;++s)o[s]=c;return n?function(t,e){const n=t.length;let r,i,o=0,a=1;for(;t[o]===t[a];)++a;for(;a<n;){for(r=a+1;t[a]===t[r];)++r;if(t[a]-t[a-1]<e){for(i=a+(o+r-a-a>>1);i<a;)t[i++]=t[a];for(;i>a;)t[i--]=t[o]}o=a,a=r}return t}(o,e+e/4):o}t.random=Math.random;const as=Math.sqrt(2*Math.PI),ss=Math.SQRT2;let us=NaN;function ls(e,n){e=e||0,n=null==n?1:n;let r,i,o=0,a=0;if(us==us)o=us,us=NaN;else{do{o=2*t.random()-1,a=2*t.random()-1,r=o*o+a*a}while(0===r||r>1);i=Math.sqrt(-2*Math.log(r)/r),o*=i,us=a*i}return e+o*n}function cs(t,e,n){const r=(t-(e||0))/(n=null==n?1:n);return Math.exp(-.5*r*r)/(n*as)}function fs(t,e,n){const r=(t-(e=e||0))/(n=null==n?1:n),i=Math.abs(r);let o;if(i>37)o=0;else{const t=Math.exp(-i*i/2);let e;i<7.07106781186547?(e=.0352624965998911*i+.700383064443688,e=e*i+6.37396220353165,e=e*i+33.912866078383,e=e*i+112.079291497871,e=e*i+221.213596169931,e=e*i+220.206867912376,o=t*e,e=.0883883476483184*i+1.75566716318264,e=e*i+16.064177579207,e=e*i+86.7807322029461,e=e*i+296.564248779674,e=e*i+637.333633378831,e=e*i+793.826512519948,e=e*i+440.413735824752,o/=e):(e=i+.65,e=i+4/e,e=i+3/e,e=i+2/e,e=i+1/e,o=t/e/2.506628274631)}return r>0?1-o:o}function hs(t,e,n){return t<0||t>1?NaN:(e||0)+(null==n?1:n)*ss*function(t){let e,n=-Math.log((1-t)*(1+t));n<6.25?(n-=3.125,e=-364441206401782e-35,e=e*n-16850591381820166e-35,e=128584807152564e-32+e*n,e=11157877678025181e-33+e*n,e=e*n-1333171662854621e-31,e=20972767875968562e-33+e*n,e=6637638134358324e-30+e*n,e=e*n-4054566272975207e-29,e=e*n-8151934197605472e-29,e=26335093153082323e-28+e*n,e=e*n-12975133253453532e-27,e=e*n-5415412054294628e-26,e=1.0512122733215323e-9+e*n,e=e*n-4.112633980346984e-9,e=e*n-2.9070369957882005e-8,e=4.2347877827932404e-7+e*n,e=e*n-13654692000834679e-22,e=e*n-13882523362786469e-21,e=.00018673420803405714+e*n,e=e*n-.000740702534166267,e=e*n-.006033670871430149,e=.24015818242558962+e*n,e=1.6536545626831027+e*n):n<16?(n=Math.sqrt(n)-3.25,e=2.2137376921775787e-9,e=9.075656193888539e-8+e*n,e=e*n-2.7517406297064545e-7,e=1.8239629214389228e-8+e*n,e=15027403968909828e-22+e*n,e=e*n-4013867526981546e-21,e=29234449089955446e-22+e*n,e=12475304481671779e-21+e*n,e=e*n-47318229009055734e-21,e=6828485145957318e-20+e*n,e=24031110387097894e-21+e*n,e=e*n-.0003550375203628475,e=.0009532893797373805+e*n,e=e*n-.0016882755560235047,e=.002491442096107851+e*n,e=e*n-.003751208507569241,e=.005370914553590064+e*n,e=1.0052589676941592+e*n,e=3.0838856104922208+e*n):Number.isFinite(n)?(n=Math.sqrt(n)-5,e=-27109920616438573e-27,e=e*n-2.555641816996525e-10,e=1.5076572693500548e-9+e*n,e=e*n-3.789465440126737e-9,e=7.61570120807834e-9+e*n,e=e*n-1.496002662714924e-8,e=2.914795345090108e-8+e*n,e=e*n-6.771199775845234e-8,e=2.2900482228026655e-7+e*n,e=e*n-9.9298272942317e-7,e=4526062597223154e-21+e*n,e=e*n-1968177810553167e-20,e=7599527703001776e-20+e*n,e=e*n-.00021503011930044477,e=e*n-.00013871931833623122,e=1.0103004648645344+e*n,e=4.849906401408584+e*n):e=1/0;return e*t}(2*t-1)}function ds(t,e){let n,r;const i={mean(t){return arguments.length?(n=t||0,i):n},stdev(t){return arguments.length?(r=null==t?1:t,i):r},sample:()=>ls(n,r),pdf:t=>cs(t,n,r),cdf:t=>fs(t,n,r),icdf:t=>hs(t,n,r)};return i.mean(t).stdev(e)}function ps(e,n){const r=ds();let i=0;const o={data(t){return arguments.length?(e=t,i=t?t.length:0,o.bandwidth(n)):e},bandwidth(t){return arguments.length?(!(n=t)&&e&&(n=ns(e)),o):n},sample:()=>e[~~(t.random()*i)]+n*r.sample(),pdf(t){let o=0,a=0;for(;a<i;++a)o+=r.pdf((t-e[a])/n);return o/n/i},cdf(t){let o=0,a=0;for(;a<i;++a)o+=r.cdf((t-e[a])/n);return o/i},icdf(){throw Error("KDE icdf not supported.")}};return o.data(e)}function gs(t,e){return t=t||0,e=null==e?1:e,Math.exp(t+ls()*e)}function ms(t,e,n){if(t<=0)return 0;e=e||0,n=null==n?1:n;const r=(Math.log(t)-e)/n;return Math.exp(-.5*r*r)/(n*as*t)}function ys(t,e,n){return fs(Math.log(t),e,n)}function vs(t,e,n){return Math.exp(hs(t,e,n))}function _s(t,e){let n,r;const i={mean(t){return arguments.length?(n=t||0,i):n},stdev(t){return arguments.length?(r=null==t?1:t,i):r},sample:()=>gs(n,r),pdf:t=>ms(t,n,r),cdf:t=>ys(t,n,r),icdf:t=>vs(t,n,r)};return i.mean(t).stdev(e)}function xs(e,n){let r,i=0;const o={weights(t){return arguments.length?(r=function(t){const e=[];let n,r=0;for(n=0;n<i;++n)r+=e[n]=null==t[n]?1:+t[n];for(n=0;n<i;++n)e[n]/=r;return e}(n=t||[]),o):n},distributions(t){return arguments.length?(t?(i=t.length,e=t):(i=0,e=[]),o.weights(n)):e},sample(){const n=t.random();let o=e[i-1],a=r[0],s=0;for(;s<i-1;a+=r[++s])if(n<a){o=e[s];break}return o.sample()},pdf(t){let n=0,o=0;for(;o<i;++o)n+=r[o]*e[o].pdf(t);return n},cdf(t){let n=0,o=0;for(;o<i;++o)n+=r[o]*e[o].cdf(t);return n},icdf(){throw Error("Mixture icdf not supported.")}};return o.distributions(e).weights(n)}function bs(e,n){return null==n&&(n=null==e?1:e,e=0),e+(n-e)*t.random()}function ws(t,e,n){return null==n&&(n=null==e?1:e,e=0),t>=e&&t<=n?1/(n-e):0}function ks(t,e,n){return null==n&&(n=null==e?1:e,e=0),t<e?0:t>n?1:(t-e)/(n-e)}function As(t,e,n){return null==n&&(n=null==e?1:e,e=0),t>=0&&t<=1?e+t*(n-e):NaN}function Ms(t,e){let n,r;const i={min(t){return arguments.length?(n=t||0,i):n},max(t){return arguments.length?(r=null==t?1:t,i):r},sample:()=>bs(n,r),pdf:t=>ws(t,n,r),cdf:t=>ks(t,n,r),icdf:t=>As(t,n,r)};return null==e&&(e=null==t?1:t,t=0),i.min(t).max(e)}function Es(t,e,n){let r=0,i=0;for(const o of t){const t=n(o);null==e(o)||null==t||isNaN(t)||(r+=(t-r)/++i)}return{coef:[r],predict:()=>r,rSquared:0}}function Ds(t,e,n,r){const i=r-t*t,o=Math.abs(i)<1e-24?0:(n-t*e)/i;return[e-o*t,o]}function Cs(t,e,n,r){t=t.filter((t=>{let r=e(t),i=n(t);return null!=r&&(r=+r)>=r&&null!=i&&(i=+i)>=i})),r&&t.sort(((t,n)=>e(t)-e(n)));const i=t.length,o=new Float64Array(i),a=new Float64Array(i);let s,u,l,c=0,f=0,h=0;for(l of t)o[c]=s=+e(l),a[c]=u=+n(l),++c,f+=(s-f)/c,h+=(u-h)/c;for(c=0;c<i;++c)o[c]-=f,a[c]-=h;return[o,a,f,h]}function Fs(t,e,n,r){let i,o,a=-1;for(const s of t)i=e(s),o=n(s),null!=i&&(i=+i)>=i&&null!=o&&(o=+o)>=o&&r(i,o,++a)}function Ss(t,e,n,r,i){let o=0,a=0;return Fs(t,e,n,((t,e)=>{const n=e-i(t),s=e-r;o+=n*n,a+=s*s})),1-o/a}function $s(t,e,n){let r=0,i=0,o=0,a=0,s=0;Fs(t,e,n,((t,e)=>{++s,r+=(t-r)/s,i+=(e-i)/s,o+=(t*e-o)/s,a+=(t*t-a)/s}));const u=Ds(r,i,o,a),l=t=>u[0]+u[1]*t;return{coef:u,predict:l,rSquared:Ss(t,e,n,i,l)}}function Ts(t,e,n){let r=0,i=0,o=0,a=0,s=0;Fs(t,e,n,((t,e)=>{++s,t=Math.log(t),r+=(t-r)/s,i+=(e-i)/s,o+=(t*e-o)/s,a+=(t*t-a)/s}));const u=Ds(r,i,o,a),l=t=>u[0]+u[1]*Math.log(t);return{coef:u,predict:l,rSquared:Ss(t,e,n,i,l)}}function Bs(t,e,n){const[r,i,o,a]=Cs(t,e,n);let s,u,l,c=0,f=0,h=0,d=0,p=0;Fs(t,e,n,((t,e)=>{s=r[p++],u=Math.log(e),l=s*e,c+=(e*u-c)/p,f+=(l-f)/p,h+=(l*u-h)/p,d+=(s*l-d)/p}));const[g,m]=Ds(f/a,c/a,h/a,d/a),y=t=>Math.exp(g+m*(t-o));return{coef:[Math.exp(g-m*o),m],predict:y,rSquared:Ss(t,e,n,a,y)}}function zs(t,e,n){let r=0,i=0,o=0,a=0,s=0,u=0;Fs(t,e,n,((t,e)=>{const n=Math.log(t),l=Math.log(e);++u,r+=(n-r)/u,i+=(l-i)/u,o+=(n*l-o)/u,a+=(n*n-a)/u,s+=(e-s)/u}));const l=Ds(r,i,o,a),c=t=>l[0]*Math.pow(t,l[1]);return l[0]=Math.exp(l[0]),{coef:l,predict:c,rSquared:Ss(t,e,n,s,c)}}function Ns(t,e,n){const[r,i,o,a]=Cs(t,e,n),s=r.length;let u,l,c,f,h=0,d=0,p=0,g=0,m=0;for(u=0;u<s;)l=r[u],c=i[u++],f=l*l,h+=(f-h)/u,d+=(f*l-d)/u,p+=(f*f-p)/u,g+=(l*c-g)/u,m+=(f*c-m)/u;const y=p-h*h,v=h*y-d*d,_=(m*h-g*d)/v,x=(g*y-m*d)/v,b=-_*h,w=t=>_*(t-=o)*t+x*t+b+a;return{coef:[b-x*o+_*o*o+a,x-2*_*o,_],predict:w,rSquared:Ss(t,e,n,a,w)}}function Os(t,e,n,r){if(0===r)return Es(t,e,n);if(1===r)return $s(t,e,n);if(2===r)return Ns(t,e,n);const[i,o,a,s]=Cs(t,e,n),u=i.length,l=[],c=[],f=r+1;let h,d,p,g,m;for(h=0;h<f;++h){for(p=0,g=0;p<u;++p)g+=Math.pow(i[p],h)*o[p];for(l.push(g),m=new Float64Array(f),d=0;d<f;++d){for(p=0,g=0;p<u;++p)g+=Math.pow(i[p],h+d);m[d]=g}c.push(m)}c.push(l);const y=function(t){const e=t.length-1,n=[];let r,i,o,a,s;for(r=0;r<e;++r){for(a=r,i=r+1;i<e;++i)Math.abs(t[r][i])>Math.abs(t[r][a])&&(a=i);for(o=r;o<e+1;++o)s=t[o][r],t[o][r]=t[o][a],t[o][a]=s;for(i=r+1;i<e;++i)for(o=e;o>=r;o--)t[o][i]-=t[o][r]*t[r][i]/t[r][r]}for(i=e-1;i>=0;--i){for(s=0,o=i+1;o<e;++o)s+=t[o][i]*n[o];n[i]=(t[e][i]-s)/t[i][i]}return n}(c),v=t=>{t-=a;let e=s+y[0]+y[1]*t+y[2]*t*t;for(h=3;h<f;++h)e+=y[h]*Math.pow(t,h);return e};return{coef:Rs(f,y,-a,s),predict:v,rSquared:Ss(t,e,n,s,v)}}function Rs(t,e,n,r){const i=Array(t);let o,a,s,u;for(o=0;o<t;++o)i[o]=0;for(o=t-1;o>=0;--o)for(s=e[o],u=1,i[o]+=s,a=1;a<=o;++a)u*=(o+1-a)/a,i[o-a]+=s*Math.pow(n,a)*u;return i[0]+=r,i}function Ls(t,e,n,r){const[i,o,a,s]=Cs(t,e,n,!0),u=i.length,l=Math.max(2,~~(r*u)),c=new Float64Array(u),f=new Float64Array(u),h=new Float64Array(u).fill(1);for(let t=-1;++t<=2;){const e=[0,l-1];for(let t=0;t<u;++t){const n=i[t],r=e[0],a=e[1],s=n-i[r]>i[a]-n?r:a;let u=0,l=0,d=0,p=0,g=0;const m=1/Math.abs(i[s]-n||1);for(let t=r;t<=a;++t){const e=i[t],r=o[t],a=Us(Math.abs(n-e)*m)*h[t],s=e*a;u+=a,l+=s,d+=r*a,p+=r*s,g+=e*s}const[y,v]=Ds(l/u,d/u,p/u,g/u);c[t]=y+v*n,f[t]=Math.abs(o[t]-c[t]),qs(i,t+1,e)}if(2===t)break;const n=De(f);if(Math.abs(n)<1e-12)break;for(let t,e,r=0;r<u;++r)t=f[r]/(6*n),h[r]=t>=1?1e-12:(e=1-t*t)*e}return function(t,e,n,r){const i=t.length,o=[];let a,s=0,u=0,l=[];for(;s<i;++s)a=t[s]+n,l[0]===a?l[1]+=(e[s]-l[1])/++u:(u=0,l[1]+=r,l=[a,e[s]],o.push(l));return l[1]+=r,o}(i,c,a,s)}function Us(t){return(t=1-t*t*t)*t*t}function qs(t,e,n){const r=t[e];let i=n[0],o=n[1]+1;if(!(o>=t.length))for(;e>i&&t[o]-r<=r-t[i];)n[0]=++i,n[1]=o,++o}const Ps=.5*Math.PI/180;function js(t,e,n,r){n=n||25,r=Math.max(n,r||200);const i=e=>[e,t(e)],o=e[0],a=e[1],s=a-o,u=s/r,l=[i(o)],c=[];if(n===r){for(let t=1;t<r;++t)l.push(i(o+t/n*s));return l.push(i(a)),l}c.push(i(a));for(let t=n;--t>0;)c.push(i(o+t/n*s));let f=l[0],h=c[c.length-1];const d=1/s,p=function(t,e){let n=t,r=t;const i=e.length;for(let t=0;t<i;++t){const i=e[t][1];i<n&&(n=i),i>r&&(r=i)}return 1/(r-n)}(f[1],c);for(;h;){const t=i((f[0]+h[0])/2);t[0]-f[0]>=u&&Is(f,t,h,d,p)>Ps?c.push(t):(f=h,l.push(h),c.pop()),h=c[c.length-1]}return l}function Is(t,e,n,r,i){const o=Math.atan2(i*(n[1]-t[1]),r*(n[0]-t[0])),a=Math.atan2(i*(e[1]-t[1]),r*(e[0]-t[0]));return Math.abs(o-a)}function Ws(t){return t&&t.length?1===t.length?t[0]:(e=t,t=>{const n=e.length;let r=1,i=String(e[0](t));for(;r<n;++r)i+="|"+e[r](t);return i}):function(){return""};var e}function Hs(t,e,n){return n||t+(e?"_"+e:"")}const Ys=()=>{},Gs={init:Ys,add:Ys,rem:Ys,idx:0},Vs={values:{init:t=>t.cell.store=!0,value:t=>t.cell.data.values(),idx:-1},count:{value:t=>t.cell.num},__count__:{value:t=>t.missing+t.valid},missing:{value:t=>t.missing},valid:{value:t=>t.valid},sum:{init:t=>t.sum=0,value:t=>t.valid?t.sum:void 0,add:(t,e)=>t.sum+=+e,rem:(t,e)=>t.sum-=e},product:{init:t=>t.product=1,value:t=>t.valid?t.product:void 0,add:(t,e)=>t.product*=e,rem:(t,e)=>t.product/=e},mean:{init:t=>t.mean=0,value:t=>t.valid?t.mean:void 0,add:(t,e)=>(t.mean_d=e-t.mean,t.mean+=t.mean_d/t.valid),rem:(t,e)=>(t.mean_d=e-t.mean,t.mean-=t.valid?t.mean_d/t.valid:t.mean)},average:{value:t=>t.valid?t.mean:void 0,req:["mean"],idx:1},variance:{init:t=>t.dev=0,value:t=>t.valid>1?t.dev/(t.valid-1):void 0,add:(t,e)=>t.dev+=t.mean_d*(e-t.mean),rem:(t,e)=>t.dev-=t.mean_d*(e-t.mean),req:["mean"],idx:1},variancep:{value:t=>t.valid>1?t.dev/t.valid:void 0,req:["variance"],idx:2},stdev:{value:t=>t.valid>1?Math.sqrt(t.dev/(t.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:t=>t.valid>1?Math.sqrt(t.dev/t.valid):void 0,req:["variance"],idx:2},stderr:{value:t=>t.valid>1?Math.sqrt(t.dev/(t.valid*(t.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:t=>t.cell.data.distinct(t.get),req:["values"],idx:3},ci0:{value:t=>t.cell.data.ci0(t.get),req:["values"],idx:3},ci1:{value:t=>t.cell.data.ci1(t.get),req:["values"],idx:3},median:{value:t=>t.cell.data.q2(t.get),req:["values"],idx:3},q1:{value:t=>t.cell.data.q1(t.get),req:["values"],idx:3},q3:{value:t=>t.cell.data.q3(t.get),req:["values"],idx:3},min:{init:t=>t.min=void 0,value:t=>t.min=Number.isNaN(t.min)?t.cell.data.min(t.get):t.min,add:(t,e)=>{(e<t.min||void 0===t.min)&&(t.min=e)},rem:(t,e)=>{e<=t.min&&(t.min=NaN)},req:["values"],idx:4},max:{init:t=>t.max=void 0,value:t=>t.max=Number.isNaN(t.max)?t.cell.data.max(t.get):t.max,add:(t,e)=>{(e>t.max||void 0===t.max)&&(t.max=e)},rem:(t,e)=>{e>=t.max&&(t.max=NaN)},req:["values"],idx:4},argmin:{init:t=>t.argmin=void 0,value:t=>t.argmin||t.cell.data.argmin(t.get),add:(t,e,n)=>{e<t.min&&(t.argmin=n)},rem:(t,e)=>{e<=t.min&&(t.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:t=>t.argmax=void 0,value:t=>t.argmax||t.cell.data.argmax(t.get),add:(t,e,n)=>{e>t.max&&(t.argmax=n)},rem:(t,e)=>{e>=t.max&&(t.argmax=void 0)},req:["max","values"],idx:3},exponential:{init:(t,e)=>{t.exp=0,t.exp_r=e},value:t=>t.valid?t.exp*(1-t.exp_r)/(1-t.exp_r**t.valid):void 0,add:(t,e)=>t.exp=t.exp_r*t.exp+e,rem:(t,e)=>t.exp=(t.exp-e/t.exp_r**(t.valid-1))/t.exp_r},exponentialb:{value:t=>t.valid?t.exp*(1-t.exp_r):void 0,req:["exponential"],idx:1}},Xs=Object.keys(Vs).filter((t=>"__count__"!==t));function Js(t,e,n){return Vs[t](n,e)}function Zs(t,e){return t.idx-e.idx}function Qs(){this.valid=0,this.missing=0,this._ops.forEach((t=>null==t.aggregate_param?t.init(this):t.init(this,t.aggregate_param)))}function Ks(t,e){null!=t&&""!==t?t==t&&(++this.valid,this._ops.forEach((n=>n.add(this,t,e)))):++this.missing}function tu(t,e){null!=t&&""!==t?t==t&&(--this.valid,this._ops.forEach((n=>n.rem(this,t,e)))):--this.missing}function eu(t){return this._out.forEach((e=>t[e.out]=e.value(this))),t}function nu(t,e){const n=e||f,r=function(t){const e={};t.forEach((t=>e[t.name]=t));const n=t=>{t.req&&t.req.forEach((t=>{e[t]||n(e[t]=Vs[t]())}))};return t.forEach(n),Object.values(e).sort(Zs)}(t),i=t.slice().sort(Zs);function o(t){this._ops=r,this._out=i,this.cell=t,this.init()}return o.prototype.init=Qs,o.prototype.add=Ks,o.prototype.rem=tu,o.prototype.set=eu,o.prototype.get=n,o.fields=t.map((t=>t.out)),o}function ru(t){this._key=t?l(t):ma,this.reset()}[...Xs,"__count__"].forEach((t=>{Vs[t]=function(t,e){return(n,r)=>ot({name:t,aggregate_param:r,out:n||t},Gs,e)}(t,Vs[t])}));const iu=ru.prototype;function ou(t){Xa.call(this,null,t),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}iu.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null},iu.add=function(t){this._add.push(t)},iu.rem=function(t){this._rem.push(t)},iu.values=function(){if(this._get=null,0===this._rem.length)return this._add;const t=this._add,e=this._rem,n=this._key,r=t.length,i=e.length,o=Array(r-i),a={};let s,u,l;for(s=0;s<i;++s)a[n(e[s])]=1;for(s=0,u=0;s<r;++s)a[n(l=t[s])]?a[n(l)]=0:o[u++]=l;return this._rem=[],this._add=o},iu.distinct=function(t){const e=this.values(),n={};let r,i=e.length,o=0;for(;--i>=0;)r=t(e[i])+"",ut(n,r)||(n[r]=1,++o);return o},iu.extent=function(t){if(this._get!==t||!this._ext){const e=this.values(),n=st(e,t);this._ext=[e[n[0]],e[n[1]]],this._get=t}return this._ext},iu.argmin=function(t){return this.extent(t)[0]||{}},iu.argmax=function(t){return this.extent(t)[1]||{}},iu.min=function(t){const e=this.extent(t)[0];return null!=e?t(e):void 0},iu.max=function(t){const e=this.extent(t)[1];return null!=e?t(e):void 0},iu.quartile=function(t){return this._get===t&&this._q||(this._q=es(this.values(),t),this._get=t),this._q},iu.q1=function(t){return this.quartile(t)[0]},iu.q2=function(t){return this.quartile(t)[1]},iu.q3=function(t){return this.quartile(t)[2]},iu.ci=function(t){return this._get===t&&this._ci||(this._ci=is(this.values(),1e3,.05,t),this._get=t),this._ci},iu.ci0=function(t){return this.ci(t)[0]},iu.ci1=function(t){return this.ci(t)[1]},ou.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:Xs},{name:"aggregate_params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]},ht(ou,Xa,{transform(t,e){const n=this,r=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=t.modified();return n.stamp=r.stamp,n.value&&(i||e.modified(n._inputs,!0))?(n._prev=n.value,n.value=i?n.init(t):Object.create(null),e.visit(e.SOURCE,(t=>n.add(t)))):(n.value=n.value||n.init(t),e.visit(e.REM,(t=>n.rem(t))),e.visit(e.ADD,(t=>n.add(t)))),r.modifies(n._outputs),n._drop=!1!==t.drop,t.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),e.clean()&&n._drop&&r.clean(!0).runAfter((()=>this.clean())),n.changes(r)},cross(){const t=this,e=t.value,n=t._dnames,r=n.map((()=>({}))),i=n.length;function o(t){let e,o,a,s;for(e in t)for(a=t[e].tuple,o=0;o<i;++o)r[o][s=a[n[o]]]=s}o(t._prev),o(e),function o(a,s,u){const l=n[u],c=r[u++];for(const n in c){const r=a?a+"|"+n:n;s[l]=c[n],u<i?o(r,s,u):e[r]||t.cell(r,s)}}("",{},0)},init(t){const e=this._inputs=[],i=this._outputs=[],o={};function a(t){const n=V(r(t)),i=n.length;let a,s=0;for(;s<i;++s)o[a=n[s]]||(o[a]=1,e.push(a))}this._dims=V(t.groupby),this._dnames=this._dims.map((t=>{const e=n(t);return a(t),i.push(e),e})),this.cellkey=t.key?t.key:Ws(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];const u=t.fields||[null],l=t.ops||["count"],c=t.aggregate_params||[null],f=t.as||[],h=u.length,d={};let p,g,m,y,v,_,x;for(h!==l.length&&s("Unmatched number of fields and aggregate ops."),x=0;x<h;++x)p=u[x],g=l[x],m=c[x]||null,null==p&&"count"!==g&&s("Null aggregate field specified."),v=n(p),_=Hs(g,v,f[x]),i.push(_),"count"!==g?(y=d[v],y||(a(p),y=d[v]=[],y.field=p,this._measures.push(y)),"count"!==g&&(this._countOnly=!1),y.push(Js(g,m,_))):this._counts.push(_);return this._measures=this._measures.map((t=>nu(t,t.field))),Object.create(null)},cellkey:Ws(),cell(t,e){let n=this.value[t];return n?0===n.num&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[t]=this.newcell(t,e),this._adds[this._alen++]=n),n},newcell(t,e){const n={key:t,num:0,agg:null,tuple:this.newtuple(e,this._prev&&this._prev[t]),stamp:this.stamp,store:!1};if(!this._countOnly){const t=this._measures,e=t.length;n.agg=Array(e);for(let r=0;r<e;++r)n.agg[r]=new t[r](n)}return n.store&&(n.data=new ru),n},newtuple(t,e){const n=this._dnames,r=this._dims,i=r.length,o={};for(let e=0;e<i;++e)o[n[e]]=r[e](t);return e?ba(e.tuple,o):va(o)},clean(){const t=this.value;for(const e in t)0===t[e].num&&delete t[e]},add(t){const e=this.cellkey(t),n=this.cell(e,t);if(n.num+=1,this._countOnly)return;n.store&&n.data.add(t);const r=n.agg;for(let e=0,n=r.length;e<n;++e)r[e].add(r[e].get(t),t)},rem(t){const e=this.cellkey(t),n=this.cell(e,t);if(n.num-=1,this._countOnly)return;n.store&&n.data.rem(t);const r=n.agg;for(let e=0,n=r.length;e<n;++e)r[e].rem(r[e].get(t),t)},celltuple(t){const e=t.tuple,n=this._counts;t.store&&t.data.values();for(let r=0,i=n.length;r<i;++r)e[n[r]]=t.num;if(!this._countOnly){const n=t.agg;for(let t=0,r=n.length;t<r;++t)n[t].set(e)}return e},changes(t){const e=this._adds,n=this._mods,r=this._prev,i=this._drop,o=t.add,a=t.rem,s=t.mod;let u,l,c,f;if(r)for(l in r)u=r[l],i&&!u.num||a.push(u.tuple);for(c=0,f=this._alen;c<f;++c)o.push(this.celltuple(e[c])),e[c]=null;for(c=0,f=this._mlen;c<f;++c)u=n[c],(0===u.num&&i?a:s).push(this.celltuple(u)),n[c]=null;return this._alen=this._mlen=0,this._prev=null,t}});function au(t){Xa.call(this,null,t)}function su(t,e,n){const r=t;let i=e||[],o=n||[],a={},s=0;return{add:t=>o.push(t),remove:t=>a[r(t)]=++s,size:()=>i.length,data:(t,e)=>(s&&(i=i.filter((t=>!a[r(t)])),a={},s=0),e&&t&&i.sort(t),o.length&&(i=t?kt(t,i,o.sort(t)):i.concat(o),o=[]),i)}}function uu(t){Xa.call(this,[],t)}function lu(t){Fa.call(this,null,cu,t)}function cu(t){return this.value&&!t.modified()?this.value:Q(t.fields,t.orders)}function fu(t){Xa.call(this,null,t)}function hu(t){Xa.call(this,null,t)}au.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]},ht(au,Xa,{transform(t,e){const n=!1!==t.interval,i=this._bins(t),o=i.start,a=i.step,s=t.as||["bin0","bin1"],u=s[0],l=s[1];let c;return c=t.modified()?(e=e.reflow(!0)).SOURCE:e.modified(r(t.field))?e.ADD_MOD:e.ADD,e.visit(c,n?t=>{const e=i(t);t[u]=e,t[l]=null==e?null:o+a*(1+(e-o)/a)}:t=>t[u]=i(t)),e.modifies(n?s:u)},_bins(t){if(this.value&&!t.modified())return this.value;const i=t.field,o=rs(t),a=o.step;let s,u,l=o.start,c=l+Math.ceil((o.stop-l)/a)*a;null!=(s=t.anchor)&&(u=s-(l+a*Math.floor((s-l)/a)),l+=u,c+=u);const f=function(t){let e=S(i(t));return null==e?null:e<l?-1/0:e>c?1/0:(e=Math.max(l,Math.min(e,c-a)),l+a*Math.floor(1e-14+(e-l)/a))};return f.start=l,f.stop=o.stop,f.step=a,this.value=e(f,r(i),t.name||"bin_"+n(i))}}),uu.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]},ht(uu,Xa,{transform(t,e){const n=e.fork(e.ALL),r=su(ma,this.value,n.materialize(n.ADD).add),i=t.sort,o=e.changed()||i&&(t.modified("sort")||e.modified(i.fields));return n.visit(n.REM,r.remove),this.modified(o),this.value=n.source=r.data(wa(i),o),e.source&&e.source.root&&(this.value.root=e.source.root),n}}),ht(lu,Fa),fu.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]},ht(fu,Xa,{transform(t,e){const n=e=>n=>{for(var r,i=function(t,e,n){switch(e){case"upper":t=t.toUpperCase();break;case"lower":t=t.toLowerCase()}return t.match(n)}(s(n),t.case,o)||[],u=0,l=i.length;u<l;++u)a.test(r=i[u])||e(r)},r=this._parameterCheck(t,e),i=this._counts,o=this._match,a=this._stop,s=t.field,u=t.as||["text","count"],l=n((t=>i[t]=1+(i[t]||0))),c=n((t=>i[t]-=1));return r?e.visit(e.SOURCE,l):(e.visit(e.ADD,l),e.visit(e.REM,c)),this._finish(e,u)},_parameterCheck(t,e){let n=!1;return!t.modified("stopwords")&&this._stop||(this._stop=new RegExp("^"+(t.stopwords||"")+"$","i"),n=!0),!t.modified("pattern")&&this._match||(this._match=new RegExp(t.pattern||"[\\w']+","g"),n=!0),(t.modified("field")||e.modified(t.field.fields))&&(n=!0),n&&(this._counts={}),n},_finish(t,e){const n=this._counts,r=this._tuples||(this._tuples={}),i=e[0],o=e[1],a=t.fork(t.NO_SOURCE|t.NO_FIELDS);let s,u,l;for(s in n)u=r[s],l=n[s]||0,!u&&l?(r[s]=u=va({}),u[i]=s,u[o]=l,a.add.push(u)):0===l?(u&&a.rem.push(u),n[s]=null,r[s]=null):u[o]!==l&&(u[o]=l,a.mod.push(u));return a.modifies(e)}}),hu.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]},ht(hu,Xa,{transform(t,e){const n=e.fork(e.NO_SOURCE),r=t.as||["a","b"],i=r[0],o=r[1],a=!this.value||e.changed(e.ADD_REM)||t.modified("as")||t.modified("filter");let s=this.value;return a?(s&&(n.rem=s),s=e.materialize(e.SOURCE).source,n.add=this.value=function(t,e,n,r){for(var i,o,a=[],s={},u=t.length,l=0;l<u;++l)for(s[e]=o=t[l],i=0;i<u;++i)s[n]=t[i],r(s)&&(a.push(va(s)),(s={})[e]=o);return a}(s,i,o,t.filter||p)):n.mod=s,n.source=this.value,n.modifies(r)}});const du={kde:ps,mixture:xs,normal:ds,lognormal:_s,uniform:Ms},pu="function";function gu(t,e){const n=t[pu];ut(du,n)||s("Unknown distribution function: "+n);const r=du[n]();for(const n in t)"field"===n?r.data((t.from||e()).map(t[n])):"distributions"===n?r[n](t[n].map((t=>gu(t,e)))):typeof r[n]===pu&&r[n](t[n]);return r}function mu(t){Xa.call(this,null,t)}const yu=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],vu={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:yu},{name:"weights",type:"number",array:!0}]};function _u(t,e){return t?t.map(((t,r)=>e[r]||n(t))):null}function xu(t,e,n){const r=[],i=t=>t(u);let o,a,s,u,l,c;if(null==e)r.push(t.map(n));else for(o={},a=0,s=t.length;a<s;++a)u=t[a],l=e.map(i),c=o[l],c||(o[l]=c=[],c.dims=l,r.push(c)),c.push(n(u));return r}mu.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:yu.concat(vu)},{name:"as",type:"string",array:!0,default:["value","density"]}]},ht(mu,Xa,{transform(t,e){const n=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){const r=gu(t.distribution,function(t){return()=>t.materialize(t.SOURCE).source}(e)),i=t.steps||t.minsteps||25,o=t.steps||t.maxsteps||200;let a=t.method||"pdf";"pdf"!==a&&"cdf"!==a&&s("Invalid density method: "+a),t.extent||r.data||s("Missing density extent parameter."),a=r[a];const u=t.as||["value","density"],l=js(a,t.extent||at(r.data()),i,o).map((t=>{const e={};return e[u[0]]=t[0],e[u[1]]=t[1],va(e)}));this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n}});function bu(t){Xa.call(this,null,t)}bu.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:"bin"}]};function wu(t){Fa.call(this,null,ku,t),this.modified(!0)}function ku(t){const i=t.expr;return this.value&&!t.modified("expr")?this.value:e((e=>i(e,t)),r(i),n(i))}function Au(t){Xa.call(this,[void 0,void 0],t)}function Mu(t,e){Fa.call(this,t),this.parent=e,this.count=0}function Eu(t){Xa.call(this,{},t),this._keys=ct();const e=this._targets=[];e.active=0,e.forEach=t=>{for(let n=0,r=e.active;n<r;++n)t(e[n],n,e)}}function Du(t){Fa.call(this,null,Cu,t)}function Cu(t){return this.value&&!t.modified()?this.value:k(t.name)?V(t.name).map((t=>l(t))):l(t.name,t.as)}function Fu(t){Xa.call(this,ct(),t)}function Su(t){Xa.call(this,[],t)}function $u(t){Xa.call(this,[],t)}function Tu(t){Xa.call(this,null,t)}function Bu(t){Xa.call(this,[],t)}ht(bu,Xa,{transform(t,e){if(this.value&&!t.modified()&&!e.changed())return e;const n=e.materialize(e.SOURCE).source,r=xu(e.source,t.groupby,f),i=t.smooth||!1,o=t.field,a=t.step||((t,e)=>Et(at(t,e))/30)(n,o),s=wa(((t,e)=>o(t)-o(e))),u=t.as||"bin",l=r.length;let c,h=1/0,d=-1/0,p=0;for(;p<l;++p){const t=r[p].sort(s);c=-1;for(const e of os(t,a,i,o))e<h&&(h=e),e>d&&(d=e),t[++c][u]=e}return this.value={start:h,stop:d,step:a},e.reflow(!0).modifies(u)}}),ht(wu,Fa),Au.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]},ht(Au,Xa,{transform(t,e){const r=this.value,i=t.field,o=e.changed()||e.modified(i.fields)||t.modified("field");let a=r[0],s=r[1];if((o||null==a)&&(a=1/0,s=-1/0),e.visit(o?e.SOURCE:e.ADD,(t=>{const e=S(i(t));null!=e&&(e<a&&(a=e),e>s&&(s=e))})),!Number.isFinite(a)||!Number.isFinite(s)){let t=n(i);t&&(t=` for field "${t}"`),e.dataflow.warn(`Infinite extent${t}: [${a}, ${s}]`),a=s=void 0}this.value=[a,s]}}),ht(Mu,Fa,{connect(t){return this.detachSubflow=t.detachSubflow,this.targets().add(t),t.source=this},add(t){this.count+=1,this.value.add.push(t)},rem(t){this.count-=1,this.value.rem.push(t)},mod(t){this.value.mod.push(t)},init(t){this.value.init(t,t.NO_SOURCE)},evaluate(){return this.value}}),ht(Eu,Xa,{activate(t){this._targets[this._targets.active++]=t},subflow(t,e,n,r){const i=this.value;let o,a,s=ut(i,t)&&i[t];return s?s.value.stamp<n.stamp&&(s.init(n),this.activate(s)):(a=r||(a=this._group[t])&&a.tuple,o=n.dataflow,s=new Mu(n.fork(n.NO_SOURCE),this),o.add(s).connect(e(o,t,a)),i[t]=s,this.activate(s)),s},clean(){const t=this.value;let e=0;for(const n in t)if(0===t[n].count){const r=t[n].detachSubflow;r&&r(),delete t[n],++e}if(e){const t=this._targets.filter((t=>t&&t.count>0));this.initTargets(t)}},initTargets(t){const e=this._targets,n=e.length,r=t?t.length:0;let i=0;for(;i<r;++i)e[i]=t[i];for(;i<n&&null!=e[i];++i)e[i]=null;e.active=r},transform(t,e){const n=e.dataflow,r=t.key,i=t.subflow,o=this._keys,a=t.modified("key"),s=t=>this.subflow(t,i,e);return this._group=t.group||{},this.initTargets(),e.visit(e.REM,(t=>{const e=ma(t),n=o.get(e);void 0!==n&&(o.delete(e),s(n).rem(t))})),e.visit(e.ADD,(t=>{const e=r(t);o.set(ma(t),e),s(e).add(t)})),a||e.modified(r.fields)?e.visit(e.MOD,(t=>{const e=ma(t),n=o.get(e),i=r(t);n===i?s(i).mod(t):(o.set(e,i),s(n).rem(t),s(i).add(t))})):e.changed(e.MOD)&&e.visit(e.MOD,(t=>{s(o.get(ma(t))).mod(t)})),a&&e.visit(e.REFLOW,(t=>{const e=ma(t),n=o.get(e),i=r(t);n!==i&&(o.set(e,i),s(n).rem(t),s(i).add(t))})),e.clean()?n.runAfter((()=>{this.clean(),o.clean()})):o.empty>n.cleanThreshold&&n.runAfter(o.clean),e}}),ht(Du,Fa),Fu.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]},ht(Fu,Xa,{transform(t,e){const n=e.dataflow,r=this.value,i=e.fork(),o=i.add,a=i.rem,s=i.mod,u=t.expr;let l=!0;function c(e){const n=ma(e),i=u(e,t),c=r.get(n);i&&c?(r.delete(n),o.push(e)):i||c?l&&i&&!c&&s.push(e):(r.set(n,1),a.push(e))}return e.visit(e.REM,(t=>{const e=ma(t);r.has(e)?r.delete(e):a.push(t)})),e.visit(e.ADD,(e=>{u(e,t)?o.push(e):r.set(ma(e),1)})),e.visit(e.MOD,c),t.modified()&&(l=!1,e.visit(e.REFLOW,c)),r.empty>n.cleanThreshold&&n.runAfter(r.clean),i}}),Su.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]},ht(Su,Xa,{transform(t,e){const n=e.fork(e.NO_SOURCE),r=t.fields,i=_u(r,t.as||[]),o=t.index||null,a=i.length;return n.rem=this.value,e.visit(e.SOURCE,(t=>{const e=r.map((e=>e(t))),s=e.reduce(((t,e)=>Math.max(t,e.length)),0);let u,l,c,f=0;for(;f<s;++f){for(l=_a(t),u=0;u<a;++u)l[i[u]]=null==(c=e[u][f])?null:c;o&&(l[o]=f),n.add.push(l)}})),this.value=n.source=n.add,o&&n.modifies(o),n.modifies(i)}}),$u.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]},ht($u,Xa,{transform(t,e){const r=e.fork(e.NO_SOURCE),i=t.fields,o=i.map(n),a=t.as||["key","value"],s=a[0],u=a[1],l=i.length;return r.rem=this.value,e.visit(e.SOURCE,(t=>{for(let e,n=0;n<l;++n)e=_a(t),e[s]=o[n],e[u]=i[n](t),r.add.push(e)})),this.value=r.source=r.add,r.modifies(a)}}),Tu.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]},ht(Tu,Xa,{transform(t,e){const n=t.expr,r=t.as,i=t.modified(),o=t.initonly?e.ADD:i?e.SOURCE:e.modified(n.fields)||e.modified(r)?e.ADD_MOD:e.ADD;return i&&(e=e.materialize().reflow(!0)),t.initonly||e.modifies(r),e.visit(o,(e=>e[r]=n(e,t)))}}),ht(Bu,Xa,{transform(t,e){const n=e.fork(e.ALL),r=t.generator;let i,o,a,s=this.value,u=t.size-s.length;if(u>0){for(i=[];--u>=0;)i.push(a=va(r(t))),s.push(a);n.add=n.add.length?n.materialize(n.ADD).add.concat(i):i}else o=s.slice(0,-u),n.rem=n.rem.length?n.materialize(n.REM).rem.concat(o):o,s=s.slice(-u);return n.source=this.value=s,n}});const zu={value:"value",median:De,mean:function(t,e){let n=0,r=0;if(void 0===e)for(let e of t)null!=e&&(e=+e)>=e&&(++n,r+=e);else{let i=-1;for(let o of t)null!=(o=e(o,++i,t))&&(o=+o)>=o&&(++n,r+=o)}if(n)return r/n},min:we,max:be},Nu=[];function Ou(t){Xa.call(this,[],t)}function Ru(t){ou.call(this,t)}function Lu(t){Xa.call(this,null,t)}function Uu(t){Fa.call(this,null,qu,t)}function qu(t){return this.value&&!t.modified()?this.value:xt(t.fields,t.flat)}function Pu(t){Xa.call(this,[],t),this._pending=null}function ju(t,e,n){n.forEach(va);const r=e.fork(e.NO_FIELDS&e.NO_SOURCE);return r.rem=t.value,t.value=r.source=r.add=n,t._pending=null,r.rem.length&&r.clean(!0),r}function Iu(t){Xa.call(this,{},t)}function Wu(t){Fa.call(this,null,Hu,t)}function Hu(t){if(this.value&&!t.modified())return this.value;const e=t.extents,n=e.length;let r,i,o=1/0,a=-1/0;for(r=0;r<n;++r)i=e[r],i[0]<o&&(o=i[0]),i[1]>a&&(a=i[1]);return[o,a]}function Yu(t){Fa.call(this,null,Gu,t)}function Gu(t){return this.value&&!t.modified()?this.value:t.values.reduce(((t,e)=>t.concat(e)),[])}function Vu(t){Xa.call(this,null,t)}function Xu(t){ou.call(this,t)}function Ju(t){Eu.call(this,t)}function Zu(t){Xa.call(this,null,t)}function Qu(t){Xa.call(this,null,t)}function Ku(t){Xa.call(this,null,t)}Ou.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]},ht(Ou,Xa,{transform(t,e){var r,i,o,a,u,l,c,f,h,d,p=e.fork(e.ALL),g=function(t){var e,n=t.method||zu.value;if(null!=zu[n])return n===zu.value?(e=void 0!==t.value?t.value:0,()=>e):zu[n];s("Unrecognized imputation method: "+n)}(t),m=function(t){const e=t.field;return t=>t?e(t):NaN}(t),y=n(t.field),v=n(t.key),_=(t.groupby||[]).map(n),x=function(t,e,n,r){var i,o,a,s,u,l,c,f,h=t=>t(f),d=[],p=r?r.slice():[],g={},m={};for(p.forEach(((t,e)=>g[t]=e+1)),s=0,c=t.length;s<c;++s)l=n(f=t[s]),u=g[l]||(g[l]=p.push(l)),(a=m[o=(i=e?e.map(h):Nu)+""])||(a=m[o]=[],d.push(a),a.values=i),a[u-1]=f;return d.domain=p,d}(e.source,t.groupby,t.key,t.keyvals),b=[],w=this.value,k=x.domain.length;for(u=0,f=x.length;u<f;++u)for(o=(r=x[u]).values,i=NaN,c=0;c<k;++c)if(null==r[c]){for(a=x.domain[c],d={_impute:!0},l=0,h=o.length;l<h;++l)d[_[l]]=o[l];d[v]=a,d[y]=Number.isNaN(i)?i=g(r,m):i,b.push(va(d))}return b.length&&(p.add=p.materialize(p.ADD).add.concat(b)),w.length&&(p.rem=p.materialize(p.REM).rem.concat(w)),this.value=b,p}}),Ru.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:Xs},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]},ht(Ru,ou,{transform(t,e){const n=this,r=t.modified();let i;return n.value&&(r||e.modified(n._inputs,!0))?(i=n.value=r?n.init(t):{},e.visit(e.SOURCE,(t=>n.add(t)))):(i=n.value=n.value||this.init(t),e.visit(e.REM,(t=>n.rem(t))),e.visit(e.ADD,(t=>n.add(t)))),n.changes(),e.visit(e.SOURCE,(t=>{ot(t,i[n.cellkey(t)].tuple)})),e.reflow(r).modifies(this._outputs)},changes(){const t=this._adds,e=this._mods;let n,r;for(n=0,r=this._alen;n<r;++n)this.celltuple(t[n]),t[n]=null;for(n=0,r=this._mlen;n<r;++n)this.celltuple(e[n]),e[n]=null;this._alen=this._mlen=0}}),Lu.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]},ht(Lu,Xa,{transform(t,e){const r=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){const i=e.materialize(e.SOURCE).source,o=xu(i,t.groupby,t.field),a=(t.groupby||[]).map(n),u=t.bandwidth,l=t.cumulative?"cdf":"pdf",c=t.as||["value","density"],f=[];let h=t.extent,d=t.steps||t.minsteps||25,p=t.steps||t.maxsteps||200;"pdf"!==l&&"cdf"!==l&&s("Invalid density method: "+l),"shared"===t.resolve&&(h||(h=at(i,t.field)),d=p=t.steps||p),o.forEach((e=>{const n=ps(e,u)[l],r=t.counts?e.length:1;js(n,h||at(e),d,p).forEach((t=>{const n={};for(let t=0;t<a.length;++t)n[a[t]]=e.dims[t];n[c[0]]=t[0],n[c[1]]=t[1]*r,f.push(va(n))}))})),this.value&&(r.rem=this.value),this.value=r.add=r.source=f}return r}}),ht(Uu,Fa),ht(Pu,Xa,{transform(t,e){const n=e.dataflow;if(this._pending)return ju(this,e,this._pending);if(function(t){return t.modified("async")&&!(t.modified("values")||t.modified("url")||t.modified("format"))}(t))return e.StopPropagation;if(t.values)return ju(this,e,n.parse(t.values,t.format));if(t.async){const e=n.request(t.url,t.format).then((t=>(this._pending=V(t.data),t=>t.touch(this))));return{async:e}}return n.request(t.url,t.format).then((t=>ju(this,e,V(t.data))))}}),Iu.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]},ht(Iu,Xa,{transform(t,e){const r=t.fields,i=t.index,o=t.values,a=null==t.default?null:t.default,u=t.modified(),l=r.length;let c,f,h,d=u?e.SOURCE:e.ADD,p=e,g=t.as;return o?(f=o.length,l>1&&!g&&s('Multi-field lookup requires explicit "as" parameter.'),g&&g.length!==l*f&&s('The "as" parameter has too few output field names.'),g=g||o.map(n),c=function(t){for(var e,n,s=0,u=0;s<l;++s)if(null==(n=i.get(r[s](t))))for(e=0;e<f;++e,++u)t[g[u]]=a;else for(e=0;e<f;++e,++u)t[g[u]]=o[e](n)}):(g||s("Missing output field names."),c=function(t){for(var e,n=0;n<l;++n)e=i.get(r[n](t)),t[g[n]]=null==e?a:e}),u?p=e.reflow(!0):(h=r.some((t=>e.modified(t.fields))),d|=h?e.MOD:0),e.visit(d,c),p.modifies(g)}}),ht(Wu,Fa),ht(Yu,Fa),ht(Vu,Xa,{transform(t,e){return this.modified(t.modified()),this.value=t,e.fork(e.NO_SOURCE|e.NO_FIELDS)}}),Xu.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:Xs,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]},ht(Xu,ou,{_transform:ou.prototype.transform,transform(t,n){return this._transform(function(t,n){const i=t.field,o=t.value,a=("count"===t.op?"__count__":t.op)||"sum",s=r(i).concat(r(o)),u=function(t,e,n){const r={},i=[];return n.visit(n.SOURCE,(e=>{const n=t(e);r[n]||(r[n]=1,i.push(n))})),i.sort(K),e?i.slice(0,e):i}(i,t.limit||0,n);n.changed()&&t.set("__pivot__",null,null,!0);return{key:t.key,groupby:t.groupby,ops:u.map((()=>a)),fields:u.map((t=>function(t,n,r,i){return e((e=>n(e)===t?r(e):NaN),i,t+"")}(t,i,o,s))),as:u.map((t=>t+"")),modified:t.modified.bind(t)}}(t,n),n)}}),ht(Ju,Eu,{transform(t,e){const n=t.subflow,i=t.field,o=t=>this.subflow(ma(t),n,e,t);return(t.modified("field")||i&&e.modified(r(i)))&&s("PreFacet does not support field modification."),this.initTargets(),i?(e.visit(e.MOD,(t=>{const e=o(t);i(t).forEach((t=>e.mod(t)))})),e.visit(e.ADD,(t=>{const e=o(t);i(t).forEach((t=>e.add(va(t))))})),e.visit(e.REM,(t=>{const e=o(t);i(t).forEach((t=>e.rem(t)))}))):(e.visit(e.MOD,(t=>o(t).mod(t))),e.visit(e.ADD,(t=>o(t).add(t))),e.visit(e.REM,(t=>o(t).rem(t)))),e.clean()&&e.runAfter((()=>this.clean())),e}}),Zu.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]},ht(Zu,Xa,{transform(t,e){const n=e.fork(e.NO_SOURCE),r=t.fields,i=_u(t.fields,t.as||[]),o=r?(t,e)=>function(t,e,n,r){for(let i=0,o=n.length;i<o;++i)e[r[i]]=n[i](t);return e}(t,e,r,i):xa;let a;return this.value?a=this.value:(e=e.addAll(),a=this.value={}),e.visit(e.REM,(t=>{const e=ma(t);n.rem.push(a[e]),a[e]=null})),e.visit(e.ADD,(t=>{const e=o(t,va({}));a[ma(t)]=e,n.add.push(e)})),e.visit(e.MOD,(t=>{n.mod.push(o(t,a[ma(t)]))})),n}}),ht(Qu,Xa,{transform(t,e){return this.value=t.value,t.modified("value")?e.fork(e.NO_SOURCE|e.NO_FIELDS):e.StopPropagation}}),Ku.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]};function tl(t){Xa.call(this,null,t)}function el(t){Xa.call(this,[],t),this.count=0}function nl(t){Xa.call(this,null,t)}function rl(t){Xa.call(this,null,t),this.modified(!0)}function il(t){Xa.call(this,null,t)}ht(Ku,Xa,{transform(t,e){const r=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=t.as||["prob","value"];if(this.value&&!t.modified()&&!e.changed())return r.source=this.value,r;const o=xu(e.materialize(e.SOURCE).source,t.groupby,t.field),a=(t.groupby||[]).map(n),s=[],u=t.step||.01,l=t.probs||Fe(u/2,1-1e-14,u),c=l.length;return o.forEach((t=>{const e=ts(t,l);for(let n=0;n<c;++n){const r={};for(let e=0;e<a.length;++e)r[a[e]]=t.dims[e];r[i[0]]=l[n],r[i[1]]=e[n],s.push(va(r))}})),this.value&&(r.rem=this.value),this.value=r.add=r.source=s,r}}),ht(tl,Xa,{transform(t,e){let n,r;return this.value?r=this.value:(n=e=e.addAll(),r=this.value={}),t.derive&&(n=e.fork(e.NO_SOURCE),e.visit(e.REM,(t=>{const e=ma(t);n.rem.push(r[e]),r[e]=null})),e.visit(e.ADD,(t=>{const e=_a(t);r[ma(t)]=e,n.add.push(e)})),e.visit(e.MOD,(t=>{const e=r[ma(t)];for(const r in t)e[r]=t[r],n.modifies(r);n.mod.push(e)}))),n}}),el.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]},ht(el,Xa,{transform(e,n){const r=n.fork(n.NO_SOURCE),i=e.modified("size"),o=e.size,a=this.value.reduce(((t,e)=>(t[ma(e)]=1,t)),{});let s=this.value,u=this.count,l=0;function c(e){let n,i;s.length<o?s.push(e):(i=~~((u+1)*t.random()),i<s.length&&i>=l&&(n=s[i],a[ma(n)]&&r.rem.push(n),s[i]=e)),++u}if(n.rem.length&&(n.visit(n.REM,(t=>{const e=ma(t);a[e]&&(a[e]=-1,r.rem.push(t)),--u})),s=s.filter((t=>-1!==a[ma(t)]))),(n.rem.length||i)&&s.length<o&&n.source&&(l=u=s.length,n.visit(n.SOURCE,(t=>{a[ma(t)]||c(t)})),l=-1),i&&s.length>o){const t=s.length-o;for(let e=0;e<t;++e)a[ma(s[e])]=-1,r.rem.push(s[e]);s=s.slice(t)}return n.mod.length&&n.visit(n.MOD,(t=>{a[ma(t)]&&r.mod.push(t)})),n.add.length&&n.visit(n.ADD,c),(n.add.length||l<0)&&(r.add=s.filter((t=>!a[ma(t)]))),this.count=u,this.value=r.source=s,r}}),nl.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]},ht(nl,Xa,{transform(t,e){if(this.value&&!t.modified())return;const n=e.materialize().fork(e.MOD),r=t.as||"data";return n.rem=this.value?e.rem.concat(this.value):e.rem,this.value=Fe(t.start,t.stop,t.step||1).map((t=>{const e={};return e[r]=t,va(e)})),n.add=e.add.concat(this.value),n}}),ht(rl,Xa,{transform(t,e){return this.value=e.source,e.changed()?e.fork(e.NO_SOURCE|e.NO_FIELDS):e.StopPropagation}});const ol=["unit0","unit1"];function al(t){Xa.call(this,ct(),t)}function sl(t){Xa.call(this,null,t)}il.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:Qn,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:ol}]},ht(il,Xa,{transform(t,e){const n=t.field,i=!1!==t.interval,o="utc"===t.timezone,a=this._floor(t,e),s=(o?Cr:Dr)(a.unit).offset,u=t.as||ol,l=u[0],c=u[1],f=a.step;let h=a.start||1/0,d=a.stop||-1/0,p=e.ADD;return(t.modified()||e.changed(e.REM)||e.modified(r(n)))&&(p=(e=e.reflow(!0)).SOURCE,h=1/0,d=-1/0),e.visit(p,(t=>{const e=n(t);let r,o;null==e?(t[l]=null,i&&(t[c]=null)):(t[l]=r=o=a(e),i&&(t[c]=o=s(r,f)),r<h&&(h=r),o>d&&(d=o))})),a.start=h,a.stop=d,e.modifies(i?u:l)},_floor(t,e){const n="utc"===t.timezone,{units:r,step:i}=t.units?{units:t.units,step:t.step||1}:Xr({extent:t.extent||at(e.materialize(e.SOURCE).source,t.field),maxbins:t.maxbins}),o=tr(r),a=this.value||{},s=(n?Ar:br)(o,i);return s.unit=F(o),s.units=o,s.step=i,s.start=a.start,s.stop=a.stop,this.value=s}}),ht(al,Xa,{transform(t,e){const n=e.dataflow,r=t.field,i=this.value,o=t=>i.set(r(t),t);let a=!0;return t.modified("field")||e.modified(r.fields)?(i.clear(),e.visit(e.SOURCE,o)):e.changed()?(e.visit(e.REM,(t=>i.delete(r(t)))),e.visit(e.ADD,o)):a=!1,this.modified(a),i.empty>n.cleanThreshold&&n.runAfter(i.clean),e.fork()}}),ht(sl,Xa,{transform(t,e){(!this.value||t.modified("field")||t.modified("sort")||e.changed()||t.sort&&e.modified(t.sort.fields))&&(this.value=(t.sort?e.source.slice().sort(wa(t.sort)):e.source).map(t.field))}});const ul={row_number:function(){return{next:t=>t.index+1}},rank:function(){let t;return{init:()=>t=1,next:e=>{const n=e.index,r=e.data;return n&&e.compare(r[n-1],r[n])?t=n+1:t}}},dense_rank:function(){let t;return{init:()=>t=1,next:e=>{const n=e.index,r=e.data;return n&&e.compare(r[n-1],r[n])?++t:t}}},percent_rank:function(){const t=ul.rank(),e=t.next;return{init:t.init,next:t=>(e(t)-1)/(t.data.length-1)}},cume_dist:function(){let t;return{init:()=>t=0,next:e=>{const n=e.data,r=e.compare;let i=e.index;if(t<i){for(;i+1<n.length&&!r(n[i],n[i+1]);)++i;t=i}return(1+t)/n.length}}},ntile:function(t,e){(e=+e)>0||s("ntile num must be greater than zero.");const n=ul.cume_dist(),r=n.next;return{init:n.init,next:t=>Math.ceil(e*r(t))}},lag:function(t,e){return e=+e||1,{next:n=>{const r=n.index-e;return r>=0?t(n.data[r]):null}}},lead:function(t,e){return e=+e||1,{next:n=>{const r=n.index+e,i=n.data;return r<i.length?t(i[r]):null}}},first_value:function(t){return{next:e=>t(e.data[e.i0])}},last_value:function(t){return{next:e=>t(e.data[e.i1-1])}},nth_value:function(t,e){return(e=+e)>0||s("nth_value nth must be greater than zero."),{next:n=>{const r=n.i0+(e-1);return r<n.i1?t(n.data[r]):null}}},prev_value:function(t){let e;return{init:()=>e=null,next:n=>{const r=t(n.data[n.index]);return null!=r?e=r:e}}},next_value:function(t){let e,n;return{init:()=>(e=null,n=-1),next:r=>{const i=r.data;return r.index<=n?e:(n=function(t,e,n){for(let r=e.length;n<r;++n){if(null!=t(e[n]))return n}return-1}(t,i,r.index))<0?(n=i.length,e=null):e=t(i[n])}}}};const ll=Object.keys(ul);function cl(t){const e=V(t.ops),i=V(t.fields),o=V(t.params),a=V(t.aggregate_params),u=V(t.as),l=this.outputs=[],c=this.windows=[],f={},d={},p=[],g=[];let m=!0;function y(t){V(r(t)).forEach((t=>f[t]=1))}y(t.sort),e.forEach(((t,e)=>{const r=i[e],f=o[e],v=a[e]||null,_=n(r),x=Hs(t,_,u[e]);if(y(r),l.push(x),ut(ul,t))c.push(function(t,e,n,r){const i=ul[t](e,n);return{init:i.init||h,update:function(t,e){e[r]=i.next(t)}}}(t,r,f,x));else{if(null==r&&"count"!==t&&s("Null aggregate field specified."),"count"===t)return void p.push(x);m=!1;let e=d[_];e||(e=d[_]=[],e.field=r,g.push(e)),e.push(Js(t,v,x))}})),(p.length||g.length)&&(this.cell=function(t,e,n){t=t.map((t=>nu(t,t.field)));const r={num:0,agg:null,store:!1,count:e};if(!n)for(var i=t.length,o=r.agg=Array(i),a=0;a<i;++a)o[a]=new t[a](r);if(r.store)var s=r.data=new ru;return r.add=function(t){if(r.num+=1,!n){s&&s.add(t);for(let e=0;e<i;++e)o[e].add(o[e].get(t),t)}},r.rem=function(t){if(r.num-=1,!n){s&&s.rem(t);for(let e=0;e<i;++e)o[e].rem(o[e].get(t),t)}},r.set=function(t){let i,a;for(s&&s.values(),i=0,a=e.length;i<a;++i)t[e[i]]=r.num;if(!n)for(i=0,a=o.length;i<a;++i)o[i].set(t)},r.init=function(){r.num=0,s&&s.reset();for(let t=0;t<i;++t)o[t].init()},r}(g,p,m)),this.inputs=Object.keys(f)}const fl=cl.prototype;function hl(t){Xa.call(this,{},t),this._mlen=0,this._mods=[]}function dl(t,e,n,r){const i=r.sort,o=i&&!r.ignorePeers,a=r.frame||[null,0],s=t.data(n),u=s.length,l=o?te(i):null,c={i0:0,i1:0,p0:0,p1:0,index:0,data:s,compare:i||rt(-1)};e.init();for(let t=0;t<u;++t)pl(c,a,t,u),o&&gl(c,l),e.update(c,s[t])}function pl(t,e,n,r){t.p0=t.i0,t.p1=t.i1,t.i0=null==e[0]?0:Math.max(0,n-Math.abs(e[0])),t.i1=null==e[1]?r:Math.min(r,n+Math.abs(e[1])+1),t.index=n}function gl(t,e){const n=t.i0,r=t.i1-1,i=t.compare,o=t.data,a=o.length-1;n>0&&!i(o[n],o[n-1])&&(t.i0=e.left(o,o[n])),r<a&&!i(o[r],o[r+1])&&(t.i1=e.right(o,o[r]))}fl.init=function(){this.windows.forEach((t=>t.init())),this.cell&&this.cell.init()},fl.update=function(t,e){const n=this.cell,r=this.windows,i=t.data,o=r&&r.length;let a;if(n){for(a=t.p0;a<t.i0;++a)n.rem(i[a]);for(a=t.p1;a<t.i1;++a)n.add(i[a]);n.set(e)}for(a=0;a<o;++a)r[a].update(t,e)},hl.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:ll.concat(Xs)},{name:"params",type:"number",null:!0,array:!0},{name:"aggregate_params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]},ht(hl,Xa,{transform(t,e){this.stamp=e.stamp;const n=t.modified(),r=wa(t.sort),i=Ws(t.groupby),o=t=>this.group(i(t));let a=this.state;a&&!n||(a=this.state=new cl(t)),n||e.modified(a.inputs)?(this.value={},e.visit(e.SOURCE,(t=>o(t).add(t)))):(e.visit(e.REM,(t=>o(t).remove(t))),e.visit(e.ADD,(t=>o(t).add(t))));for(let e=0,n=this._mlen;e<n;++e)dl(this._mods[e],a,r,t);return this._mlen=0,this._mods=[],e.reflow(n).modifies(a.outputs)},group(t){let e=this.value[t];return e||(e=this.value[t]=su(ma),e.stamp=-1),e.stamp<this.stamp&&(e.stamp=this.stamp,this._mods[this._mlen++]=e),e}});var ml=Object.freeze({__proto__:null,aggregate:ou,bin:au,collect:uu,compare:lu,countpattern:fu,cross:hu,density:mu,dotbin:bu,expression:wu,extent:Au,facet:Eu,field:Du,filter:Fu,flatten:Su,fold:$u,formula:Tu,generate:Bu,impute:Ou,joinaggregate:Ru,kde:Lu,key:Uu,load:Pu,lookup:Iu,multiextent:Wu,multivalues:Yu,params:Vu,pivot:Xu,prefacet:Ju,project:Zu,proxy:Qu,quantile:Ku,relay:tl,sample:el,sequence:nl,sieve:rl,subflow:Mu,timeunit:il,tupleindex:al,values:sl,window:hl});function yl(t){return function(){return t}}const vl=Math.abs,_l=Math.atan2,xl=Math.cos,bl=Math.max,wl=Math.min,kl=Math.sin,Al=Math.sqrt,Ml=1e-12,El=Math.PI,Dl=El/2,Cl=2*El;function Fl(t){return t>=1?Dl:t<=-1?-Dl:Math.asin(t)}const Sl=Math.PI,$l=2*Sl,Tl=1e-6,Bl=$l-Tl;function zl(t){this._+=t[0];for(let e=1,n=t.length;e<n;++e)this._+=arguments[e]+t[e]}let Nl=class{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=null==t?zl:function(t){let e=Math.floor(t);if(!(e>=0))throw new Error(`invalid digits: ${t}`);if(e>15)return zl;const n=10**e;return function(t){this._+=t[0];for(let e=1,r=t.length;e<r;++e)this._+=Math.round(arguments[e]*n)/n+t[e]}}(t)}moveTo(t,e){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,e){this._append`L${this._x1=+t},${this._y1=+e}`}quadraticCurveTo(t,e,n,r){this._append`Q${+t},${+e},${this._x1=+n},${this._y1=+r}`}bezierCurveTo(t,e,n,r,i,o){this._append`C${+t},${+e},${+n},${+r},${this._x1=+i},${this._y1=+o}`}arcTo(t,e,n,r,i){if(t=+t,e=+e,n=+n,r=+r,(i=+i)<0)throw new Error(`negative radius: ${i}`);let o=this._x1,a=this._y1,s=n-t,u=r-e,l=o-t,c=a-e,f=l*l+c*c;if(null===this._x1)this._append`M${this._x1=t},${this._y1=e}`;else if(f>Tl)if(Math.abs(c*s-u*l)>Tl&&i){let h=n-o,d=r-a,p=s*s+u*u,g=h*h+d*d,m=Math.sqrt(p),y=Math.sqrt(f),v=i*Math.tan((Sl-Math.acos((p+f-g)/(2*m*y)))/2),_=v/y,x=v/m;Math.abs(_-1)>Tl&&this._append`L${t+_*l},${e+_*c}`,this._append`A${i},${i},0,0,${+(c*h>l*d)},${this._x1=t+x*s},${this._y1=e+x*u}`}else this._append`L${this._x1=t},${this._y1=e}`;else;}arc(t,e,n,r,i,o){if(t=+t,e=+e,o=!!o,(n=+n)<0)throw new Error(`negative radius: ${n}`);let a=n*Math.cos(r),s=n*Math.sin(r),u=t+a,l=e+s,c=1^o,f=o?r-i:i-r;null===this._x1?this._append`M${u},${l}`:(Math.abs(this._x1-u)>Tl||Math.abs(this._y1-l)>Tl)&&this._append`L${u},${l}`,n&&(f<0&&(f=f%$l+$l),f>Bl?this._append`A${n},${n},0,1,${c},${t-a},${e-s}A${n},${n},0,1,${c},${this._x1=u},${this._y1=l}`:f>Tl&&this._append`A${n},${n},0,${+(f>=Sl)},${c},${this._x1=t+n*Math.cos(i)},${this._y1=e+n*Math.sin(i)}`)}rect(t,e,n,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}h${n=+n}v${+r}h${-n}Z`}toString(){return this._}};function Ol(){return new Nl}function Rl(t){let e=3;return t.digits=function(n){if(!arguments.length)return e;if(null==n)e=null;else{const t=Math.floor(n);if(!(t>=0))throw new RangeError(`invalid digits: ${n}`);e=t}return t},()=>new Nl(e)}function Ll(t){return t.innerRadius}function Ul(t){return t.outerRadius}function ql(t){return t.startAngle}function Pl(t){return t.endAngle}function jl(t){return t&&t.padAngle}function Il(t,e,n,r,i,o,a){var s=t-n,u=e-r,l=(a?o:-o)/Al(s*s+u*u),c=l*u,f=-l*s,h=t+c,d=e+f,p=n+c,g=r+f,m=(h+p)/2,y=(d+g)/2,v=p-h,_=g-d,x=v*v+_*_,b=i-o,w=h*g-p*d,k=(_<0?-1:1)*Al(bl(0,b*b*x-w*w)),A=(w*_-v*k)/x,M=(-w*v-_*k)/x,E=(w*_+v*k)/x,D=(-w*v+_*k)/x,C=A-m,F=M-y,S=E-m,$=D-y;return C*C+F*F>S*S+$*$&&(A=E,M=D),{cx:A,cy:M,x01:-c,y01:-f,x11:A*(i/b-1),y11:M*(i/b-1)}}function Wl(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function Hl(t){this._context=t}function Yl(t){return new Hl(t)}function Gl(t){return t[0]}function Vl(t){return t[1]}function Xl(t,e){var n=yl(!0),r=null,i=Yl,o=null,a=Rl(s);function s(s){var u,l,c,f=(s=Wl(s)).length,h=!1;for(null==r&&(o=i(c=a())),u=0;u<=f;++u)!(u<f&&n(l=s[u],u,s))===h&&((h=!h)?o.lineStart():o.lineEnd()),h&&o.point(+t(l,u,s),+e(l,u,s));if(c)return o=null,c+""||null}return t="function"==typeof t?t:void 0===t?Gl:yl(t),e="function"==typeof e?e:void 0===e?Vl:yl(e),s.x=function(e){return arguments.length?(t="function"==typeof e?e:yl(+e),s):t},s.y=function(t){return arguments.length?(e="function"==typeof t?t:yl(+t),s):e},s.defined=function(t){return arguments.length?(n="function"==typeof t?t:yl(!!t),s):n},s.curve=function(t){return arguments.length?(i=t,null!=r&&(o=i(r)),s):i},s.context=function(t){return arguments.length?(null==t?r=o=null:o=i(r=t),s):r},s}function Jl(t,e,n){var r=null,i=yl(!0),o=null,a=Yl,s=null,u=Rl(l);function l(l){var c,f,h,d,p,g=(l=Wl(l)).length,m=!1,y=new Array(g),v=new Array(g);for(null==o&&(s=a(p=u())),c=0;c<=g;++c){if(!(c<g&&i(d=l[c],c,l))===m)if(m=!m)f=c,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),h=c-1;h>=f;--h)s.point(y[h],v[h]);s.lineEnd(),s.areaEnd()}m&&(y[c]=+t(d,c,l),v[c]=+e(d,c,l),s.point(r?+r(d,c,l):y[c],n?+n(d,c,l):v[c]))}if(p)return s=null,p+""||null}function c(){return Xl().defined(i).curve(a).context(o)}return t="function"==typeof t?t:void 0===t?Gl:yl(+t),e="function"==typeof e?e:yl(void 0===e?0:+e),n="function"==typeof n?n:void 0===n?Vl:yl(+n),l.x=function(e){return arguments.length?(t="function"==typeof e?e:yl(+e),r=null,l):t},l.x0=function(e){return arguments.length?(t="function"==typeof e?e:yl(+e),l):t},l.x1=function(t){return arguments.length?(r=null==t?null:"function"==typeof t?t:yl(+t),l):r},l.y=function(t){return arguments.length?(e="function"==typeof t?t:yl(+t),n=null,l):e},l.y0=function(t){return arguments.length?(e="function"==typeof t?t:yl(+t),l):e},l.y1=function(t){return arguments.length?(n=null==t?null:"function"==typeof t?t:yl(+t),l):n},l.lineX0=l.lineY0=function(){return c().x(t).y(e)},l.lineY1=function(){return c().x(t).y(n)},l.lineX1=function(){return c().x(r).y(e)},l.defined=function(t){return arguments.length?(i="function"==typeof t?t:yl(!!t),l):i},l.curve=function(t){return arguments.length?(a=t,null!=o&&(s=a(o)),l):a},l.context=function(t){return arguments.length?(null==t?o=s=null:s=a(o=t),l):o},l}Ol.prototype=Nl.prototype,Hl.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e)}}};var Zl={draw(t,e){const n=Al(e/El);t.moveTo(n,0),t.arc(0,0,n,0,Cl)}};function Ql(){}function Kl(t,e,n){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+n)/6)}function tc(t){this._context=t}function ec(t){this._context=t}function nc(t){this._context=t}function rc(t,e){this._basis=new tc(t),this._beta=e}tc.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:Kl(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:Kl(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}},ec.prototype={areaStart:Ql,areaEnd:Ql,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x2=t,this._y2=e;break;case 1:this._point=2,this._x3=t,this._y3=e;break;case 2:this._point=3,this._x4=t,this._y4=e,this._context.moveTo((this._x0+4*this._x1+t)/6,(this._y0+4*this._y1+e)/6);break;default:Kl(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}},nc.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+t)/6,r=(this._y0+4*this._y1+e)/6;this._line?this._context.lineTo(n,r):this._context.moveTo(n,r);break;case 3:this._point=4;default:Kl(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}},rc.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var t=this._x,e=this._y,n=t.length-1;if(n>0)for(var r,i=t[0],o=e[0],a=t[n]-i,s=e[n]-o,u=-1;++u<=n;)r=u/n,this._basis.point(this._beta*t[u]+(1-this._beta)*(i+r*a),this._beta*e[u]+(1-this._beta)*(o+r*s));this._x=this._y=null,this._basis.lineEnd()},point:function(t,e){this._x.push(+t),this._y.push(+e)}};var ic=function t(e){function n(t){return 1===e?new tc(t):new rc(t,e)}return n.beta=function(e){return t(+e)},n}(.85);function oc(t,e,n){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-e),t._y2+t._k*(t._y1-n),t._x2,t._y2)}function ac(t,e){this._context=t,this._k=(1-e)/6}ac.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:oc(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2,this._x1=t,this._y1=e;break;case 2:this._point=3;default:oc(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var sc=function t(e){function n(t){return new ac(t,e)}return n.tension=function(e){return t(+e)},n}(0);function uc(t,e){this._context=t,this._k=(1-e)/6}uc.prototype={areaStart:Ql,areaEnd:Ql,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:oc(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var lc=function t(e){function n(t){return new uc(t,e)}return n.tension=function(e){return t(+e)},n}(0);function cc(t,e){this._context=t,this._k=(1-e)/6}cc.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:oc(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var fc=function t(e){function n(t){return new cc(t,e)}return n.tension=function(e){return t(+e)},n}(0);function hc(t,e,n){var r=t._x1,i=t._y1,o=t._x2,a=t._y2;if(t._l01_a>Ml){var s=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,u=3*t._l01_a*(t._l01_a+t._l12_a);r=(r*s-t._x0*t._l12_2a+t._x2*t._l01_2a)/u,i=(i*s-t._y0*t._l12_2a+t._y2*t._l01_2a)/u}if(t._l23_a>Ml){var l=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,c=3*t._l23_a*(t._l23_a+t._l12_a);o=(o*l+t._x1*t._l23_2a-e*t._l12_2a)/c,a=(a*l+t._y1*t._l23_2a-n*t._l12_2a)/c}t._context.bezierCurveTo(r,i,o,a,t._x2,t._y2)}function dc(t,e){this._context=t,this._alpha=e}dc.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,r=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3;default:hc(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var pc=function t(e){function n(t){return e?new dc(t,e):new ac(t,0)}return n.alpha=function(e){return t(+e)},n}(.5);function gc(t,e){this._context=t,this._alpha=e}gc.prototype={areaStart:Ql,areaEnd:Ql,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,r=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:hc(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var mc=function t(e){function n(t){return e?new gc(t,e):new uc(t,0)}return n.alpha=function(e){return t(+e)},n}(.5);function yc(t,e){this._context=t,this._alpha=e}yc.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,r=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:hc(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var vc=function t(e){function n(t){return e?new yc(t,e):new cc(t,0)}return n.alpha=function(e){return t(+e)},n}(.5);function _c(t){this._context=t}function xc(t){return t<0?-1:1}function bc(t,e,n){var r=t._x1-t._x0,i=e-t._x1,o=(t._y1-t._y0)/(r||i<0&&-0),a=(n-t._y1)/(i||r<0&&-0),s=(o*i+a*r)/(r+i);return(xc(o)+xc(a))*Math.min(Math.abs(o),Math.abs(a),.5*Math.abs(s))||0}function wc(t,e){var n=t._x1-t._x0;return n?(3*(t._y1-t._y0)/n-e)/2:e}function kc(t,e,n){var r=t._x0,i=t._y0,o=t._x1,a=t._y1,s=(o-r)/3;t._context.bezierCurveTo(r+s,i+s*e,o-s,a-s*n,o,a)}function Ac(t){this._context=t}function Mc(t){this._context=new Ec(t)}function Ec(t){this._context=t}function Dc(t){this._context=t}function Cc(t){var e,n,r=t.length-1,i=new Array(r),o=new Array(r),a=new Array(r);for(i[0]=0,o[0]=2,a[0]=t[0]+2*t[1],e=1;e<r-1;++e)i[e]=1,o[e]=4,a[e]=4*t[e]+2*t[e+1];for(i[r-1]=2,o[r-1]=7,a[r-1]=8*t[r-1]+t[r],e=1;e<r;++e)n=i[e]/o[e-1],o[e]-=n,a[e]-=n*a[e-1];for(i[r-1]=a[r-1]/o[r-1],e=r-2;e>=0;--e)i[e]=(a[e]-i[e+1])/o[e];for(o[r-1]=(t[r]+i[r-1])/2,e=0;e<r-1;++e)o[e]=2*t[e+1]-i[e+1];return[i,o]}function Fc(t,e){this._context=t,this._t=e}function Sc(t,e){if("undefined"!=typeof document&&document.createElement){const n=document.createElement("canvas");if(n&&n.getContext)return n.width=t,n.height=e,n}return null}_c.prototype={areaStart:Ql,areaEnd:Ql,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(t,e){t=+t,e=+e,this._point?this._context.lineTo(t,e):(this._point=1,this._context.moveTo(t,e))}},Ac.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:kc(this,this._t0,wc(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){var n=NaN;if(e=+e,(t=+t)!==this._x1||e!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,kc(this,wc(this,n=bc(this,t,e)),n);break;default:kc(this,this._t0,n=bc(this,t,e))}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e,this._t0=n}}},(Mc.prototype=Object.create(Ac.prototype)).point=function(t,e){Ac.prototype.point.call(this,e,t)},Ec.prototype={moveTo:function(t,e){this._context.moveTo(e,t)},closePath:function(){this._context.closePath()},lineTo:function(t,e){this._context.lineTo(e,t)},bezierCurveTo:function(t,e,n,r,i,o){this._context.bezierCurveTo(e,t,r,n,o,i)}},Dc.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var t=this._x,e=this._y,n=t.length;if(n)if(this._line?this._context.lineTo(t[0],e[0]):this._context.moveTo(t[0],e[0]),2===n)this._context.lineTo(t[1],e[1]);else for(var r=Cc(t),i=Cc(e),o=0,a=1;a<n;++o,++a)this._context.bezierCurveTo(r[0][o],i[0][o],r[1][o],i[1][o],t[a],e[a]);(this._line||0!==this._line&&1===n)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(t,e){this._x.push(+t),this._y.push(+e)}},Fc.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,e),this._context.lineTo(t,e);else{var n=this._x*(1-this._t)+t*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,e)}}this._x=t,this._y=e}};const $c=()=>"undefined"!=typeof Image?Image:null;function Tc(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}function Bc(t,e){switch(arguments.length){case 0:break;case 1:"function"==typeof t?this.interpolator(t):this.range(t);break;default:this.domain(t),"function"==typeof e?this.interpolator(e):this.range(e)}return this}const zc=Symbol("implicit");function Nc(){var t=new se,e=[],n=[],r=zc;function i(i){let o=t.get(i);if(void 0===o){if(r!==zc)return r;t.set(i,o=e.push(i)-1)}return n[o%n.length]}return i.domain=function(n){if(!arguments.length)return e.slice();e=[],t=new se;for(const r of n)t.has(r)||t.set(r,e.push(r)-1);return i},i.range=function(t){return arguments.length?(n=Array.from(t),i):n.slice()},i.unknown=function(t){return arguments.length?(r=t,i):r},i.copy=function(){return Nc(e,n).unknown(r)},Tc.apply(i,arguments),i}function Oc(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Rc(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Lc(){}var Uc=.7,qc=1/Uc,Pc="\\s*([+-]?\\d+)\\s*",jc="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ic="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Wc=/^#([0-9a-f]{3,8})$/,Hc=new RegExp(`^rgb\\(${Pc},${Pc},${Pc}\\)$`),Yc=new RegExp(`^rgb\\(${Ic},${Ic},${Ic}\\)$`),Gc=new RegExp(`^rgba\\(${Pc},${Pc},${Pc},${jc}\\)$`),Vc=new RegExp(`^rgba\\(${Ic},${Ic},${Ic},${jc}\\)$`),Xc=new RegExp(`^hsl\\(${jc},${Ic},${Ic}\\)$`),Jc=new RegExp(`^hsla\\(${jc},${Ic},${Ic},${jc}\\)$`),Zc={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Qc(){return this.rgb().formatHex()}function Kc(){return this.rgb().formatRgb()}function tf(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Wc.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?ef(e):3===n?new af(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?nf(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?nf(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=Hc.exec(t))?new af(e[1],e[2],e[3],1):(e=Yc.exec(t))?new af(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=Gc.exec(t))?nf(e[1],e[2],e[3],e[4]):(e=Vc.exec(t))?nf(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=Xc.exec(t))?hf(e[1],e[2]/100,e[3]/100,1):(e=Jc.exec(t))?hf(e[1],e[2]/100,e[3]/100,e[4]):Zc.hasOwnProperty(t)?ef(Zc[t]):"transparent"===t?new af(NaN,NaN,NaN,0):null}function ef(t){return new af(t>>16&255,t>>8&255,255&t,1)}function nf(t,e,n,r){return r<=0&&(t=e=n=NaN),new af(t,e,n,r)}function rf(t){return t instanceof Lc||(t=tf(t)),t?new af((t=t.rgb()).r,t.g,t.b,t.opacity):new af}function of(t,e,n,r){return 1===arguments.length?rf(t):new af(t,e,n,null==r?1:r)}function af(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function sf(){return`#${ff(this.r)}${ff(this.g)}${ff(this.b)}`}function uf(){const t=lf(this.opacity);return`${1===t?"rgb(":"rgba("}${cf(this.r)}, ${cf(this.g)}, ${cf(this.b)}${1===t?")":`, ${t})`}`}function lf(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function cf(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function ff(t){return((t=cf(t))<16?"0":"")+t.toString(16)}function hf(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new gf(t,e,n,r)}function df(t){if(t instanceof gf)return new gf(t.h,t.s,t.l,t.opacity);if(t instanceof Lc||(t=tf(t)),!t)return new gf;if(t instanceof gf)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),o=Math.max(e,n,r),a=NaN,s=o-i,u=(o+i)/2;return s?(a=e===o?(n-r)/s+6*(n<r):n===o?(r-e)/s+2:(e-n)/s+4,s/=u<.5?o+i:2-o-i,a*=60):s=u>0&&u<1?0:a,new gf(a,s,u,t.opacity)}function pf(t,e,n,r){return 1===arguments.length?df(t):new gf(t,e,n,null==r?1:r)}function gf(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function mf(t){return(t=(t||0)%360)<0?t+360:t}function yf(t){return Math.max(0,Math.min(1,t||0))}function vf(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}Oc(Lc,tf,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Qc,formatHex:Qc,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return df(this).formatHsl()},formatRgb:Kc,toString:Kc}),Oc(af,of,Rc(Lc,{brighter(t){return t=null==t?qc:Math.pow(qc,t),new af(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=null==t?Uc:Math.pow(Uc,t),new af(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new af(cf(this.r),cf(this.g),cf(this.b),lf(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:sf,formatHex:sf,formatHex8:function(){return`#${ff(this.r)}${ff(this.g)}${ff(this.b)}${ff(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:uf,toString:uf})),Oc(gf,pf,Rc(Lc,{brighter(t){return t=null==t?qc:Math.pow(qc,t),new gf(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=null==t?Uc:Math.pow(Uc,t),new gf(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new af(vf(t>=240?t-240:t+120,i,r),vf(t,i,r),vf(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new gf(mf(this.h),yf(this.s),yf(this.l),lf(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=lf(this.opacity);return`${1===t?"hsl(":"hsla("}${mf(this.h)}, ${100*yf(this.s)}%, ${100*yf(this.l)}%${1===t?")":`, ${t})`}`}}));const _f=Math.PI/180,xf=180/Math.PI,bf=.96422,wf=1,kf=.82521,Af=4/29,Mf=6/29,Ef=3*Mf*Mf,Df=Mf*Mf*Mf;function Cf(t){if(t instanceof Sf)return new Sf(t.l,t.a,t.b,t.opacity);if(t instanceof Of)return Rf(t);t instanceof af||(t=rf(t));var e,n,r=zf(t.r),i=zf(t.g),o=zf(t.b),a=$f((.2225045*r+.7168786*i+.0606169*o)/wf);return r===i&&i===o?e=n=a:(e=$f((.4360747*r+.3850649*i+.1430804*o)/bf),n=$f((.0139322*r+.0971045*i+.7141733*o)/kf)),new Sf(116*a-16,500*(e-a),200*(a-n),t.opacity)}function Ff(t,e,n,r){return 1===arguments.length?Cf(t):new Sf(t,e,n,null==r?1:r)}function Sf(t,e,n,r){this.l=+t,this.a=+e,this.b=+n,this.opacity=+r}function $f(t){return t>Df?Math.pow(t,1/3):t/Ef+Af}function Tf(t){return t>Mf?t*t*t:Ef*(t-Af)}function Bf(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function zf(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Nf(t,e,n,r){return 1===arguments.length?function(t){if(t instanceof Of)return new Of(t.h,t.c,t.l,t.opacity);if(t instanceof Sf||(t=Cf(t)),0===t.a&&0===t.b)return new Of(NaN,0<t.l&&t.l<100?0:NaN,t.l,t.opacity);var e=Math.atan2(t.b,t.a)*xf;return new Of(e<0?e+360:e,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}(t):new Of(t,e,n,null==r?1:r)}function Of(t,e,n,r){this.h=+t,this.c=+e,this.l=+n,this.opacity=+r}function Rf(t){if(isNaN(t.h))return new Sf(t.l,0,0,t.opacity);var e=t.h*_f;return new Sf(t.l,Math.cos(e)*t.c,Math.sin(e)*t.c,t.opacity)}Oc(Sf,Ff,Rc(Lc,{brighter(t){return new Sf(this.l+18*(null==t?1:t),this.a,this.b,this.opacity)},darker(t){return new Sf(this.l-18*(null==t?1:t),this.a,this.b,this.opacity)},rgb(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,n=isNaN(this.b)?t:t-this.b/200;return new af(Bf(3.1338561*(e=bf*Tf(e))-1.6168667*(t=wf*Tf(t))-.4906146*(n=kf*Tf(n))),Bf(-.9787684*e+1.9161415*t+.033454*n),Bf(.0719453*e-.2289914*t+1.4052427*n),this.opacity)}})),Oc(Of,Nf,Rc(Lc,{brighter(t){return new Of(this.h,this.c,this.l+18*(null==t?1:t),this.opacity)},darker(t){return new Of(this.h,this.c,this.l-18*(null==t?1:t),this.opacity)},rgb(){return Rf(this).rgb()}}));var Lf=-.14861,Uf=1.78277,qf=-.29227,Pf=-.90649,jf=1.97294,If=jf*Pf,Wf=jf*Uf,Hf=Uf*qf-Pf*Lf;function Yf(t,e,n,r){return 1===arguments.length?function(t){if(t instanceof Gf)return new Gf(t.h,t.s,t.l,t.opacity);t instanceof af||(t=rf(t));var e=t.r/255,n=t.g/255,r=t.b/255,i=(Hf*r+If*e-Wf*n)/(Hf+If-Wf),o=r-i,a=(jf*(n-i)-qf*o)/Pf,s=Math.sqrt(a*a+o*o)/(jf*i*(1-i)),u=s?Math.atan2(a,o)*xf-120:NaN;return new Gf(u<0?u+360:u,s,i,t.opacity)}(t):new Gf(t,e,n,null==r?1:r)}function Gf(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function Vf(t,e,n,r,i){var o=t*t,a=o*t;return((1-3*t+3*o-a)*e+(4-6*o+3*a)*n+(1+3*t+3*o-3*a)*r+a*i)/6}function Xf(t){var e=t.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),i=t[r],o=t[r+1],a=r>0?t[r-1]:2*i-o,s=r<e-1?t[r+2]:2*o-i;return Vf((n-r/e)*e,a,i,o,s)}}function Jf(t){var e=t.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*e),i=t[(r+e-1)%e],o=t[r%e],a=t[(r+1)%e],s=t[(r+2)%e];return Vf((n-r/e)*e,i,o,a,s)}}Oc(Gf,Yf,Rc(Lc,{brighter(t){return t=null==t?qc:Math.pow(qc,t),new Gf(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=null==t?Uc:Math.pow(Uc,t),new Gf(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=isNaN(this.h)?0:(this.h+120)*_f,e=+this.l,n=isNaN(this.s)?0:this.s*e*(1-e),r=Math.cos(t),i=Math.sin(t);return new af(255*(e+n*(Lf*r+Uf*i)),255*(e+n*(qf*r+Pf*i)),255*(e+n*(jf*r)),this.opacity)}}));var Zf=t=>()=>t;function Qf(t,e){return function(n){return t+n*e}}function Kf(t,e){var n=e-t;return n?Qf(t,n>180||n<-180?n-360*Math.round(n/360):n):Zf(isNaN(t)?e:t)}function th(t){return 1==(t=+t)?eh:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}(e,n,t):Zf(isNaN(e)?n:e)}}function eh(t,e){var n=e-t;return n?Qf(t,n):Zf(isNaN(t)?e:t)}var nh=function t(e){var n=th(e);function r(t,e){var r=n((t=of(t)).r,(e=of(e)).r),i=n(t.g,e.g),o=n(t.b,e.b),a=eh(t.opacity,e.opacity);return function(e){return t.r=r(e),t.g=i(e),t.b=o(e),t.opacity=a(e),t+""}}return r.gamma=t,r}(1);function rh(t){return function(e){var n,r,i=e.length,o=new Array(i),a=new Array(i),s=new Array(i);for(n=0;n<i;++n)r=of(e[n]),o[n]=r.r||0,a[n]=r.g||0,s[n]=r.b||0;return o=t(o),a=t(a),s=t(s),r.opacity=1,function(t){return r.r=o(t),r.g=a(t),r.b=s(t),r+""}}}var ih=rh(Xf),oh=rh(Jf);function ah(t,e){e||(e=[]);var n,r=t?Math.min(e.length,t.length):0,i=e.slice();return function(o){for(n=0;n<r;++n)i[n]=t[n]*(1-o)+e[n]*o;return i}}function sh(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function uh(t,e){var n,r=e?e.length:0,i=t?Math.min(r,t.length):0,o=new Array(i),a=new Array(r);for(n=0;n<i;++n)o[n]=gh(t[n],e[n]);for(;n<r;++n)a[n]=e[n];return function(t){for(n=0;n<i;++n)a[n]=o[n](t);return a}}function lh(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function ch(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function fh(t,e){var n,r={},i={};for(n in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)n in t?r[n]=gh(t[n],e[n]):i[n]=e[n];return function(t){for(n in r)i[n]=r[n](t);return i}}var hh=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,dh=new RegExp(hh.source,"g");function ph(t,e){var n,r,i,o=hh.lastIndex=dh.lastIndex=0,a=-1,s=[],u=[];for(t+="",e+="";(n=hh.exec(t))&&(r=dh.exec(e));)(i=r.index)>o&&(i=e.slice(o,i),s[a]?s[a]+=i:s[++a]=i),(n=n[0])===(r=r[0])?s[a]?s[a]+=r:s[++a]=r:(s[++a]=null,u.push({i:a,x:ch(n,r)})),o=dh.lastIndex;return o<e.length&&(i=e.slice(o),s[a]?s[a]+=i:s[++a]=i),s.length<2?u[0]?function(t){return function(e){return t(e)+""}}(u[0].x):function(t){return function(){return t}}(e):(e=u.length,function(t){for(var n,r=0;r<e;++r)s[(n=u[r]).i]=n.x(t);return s.join("")})}function gh(t,e){var n,r=typeof e;return null==e||"boolean"===r?Zf(e):("number"===r?ch:"string"===r?(n=tf(e))?(e=n,nh):ph:e instanceof tf?nh:e instanceof Date?lh:sh(e)?ah:Array.isArray(e)?uh:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?fh:ch)(t,e)}function mh(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var yh,vh=180/Math.PI,_h={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function xh(t,e,n,r,i,o){var a,s,u;return(a=Math.sqrt(t*t+e*e))&&(t/=a,e/=a),(u=t*n+e*r)&&(n-=t*u,r-=e*u),(s=Math.sqrt(n*n+r*r))&&(n/=s,r/=s,u/=s),t*r<e*n&&(t=-t,e=-e,u=-u,a=-a),{translateX:i,translateY:o,rotate:Math.atan2(e,t)*vh,skewX:Math.atan(u)*vh,scaleX:a,scaleY:s}}function bh(t,e,n,r){function i(t){return t.length?t.pop()+" ":""}return function(o,a){var s=[],u=[];return o=t(o),a=t(a),function(t,r,i,o,a,s){if(t!==i||r!==o){var u=a.push("translate(",null,e,null,n);s.push({i:u-4,x:ch(t,i)},{i:u-2,x:ch(r,o)})}else(i||o)&&a.push("translate("+i+e+o+n)}(o.translateX,o.translateY,a.translateX,a.translateY,s,u),function(t,e,n,o){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),o.push({i:n.push(i(n)+"rotate(",null,r)-2,x:ch(t,e)})):e&&n.push(i(n)+"rotate("+e+r)}(o.rotate,a.rotate,s,u),function(t,e,n,o){t!==e?o.push({i:n.push(i(n)+"skewX(",null,r)-2,x:ch(t,e)}):e&&n.push(i(n)+"skewX("+e+r)}(o.skewX,a.skewX,s,u),function(t,e,n,r,o,a){if(t!==n||e!==r){var s=o.push(i(o)+"scale(",null,",",null,")");a.push({i:s-4,x:ch(t,n)},{i:s-2,x:ch(e,r)})}else 1===n&&1===r||o.push(i(o)+"scale("+n+","+r+")")}(o.scaleX,o.scaleY,a.scaleX,a.scaleY,s,u),o=a=null,function(t){for(var e,n=-1,r=u.length;++n<r;)s[(e=u[n]).i]=e.x(t);return s.join("")}}}var wh=bh((function(t){const e=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?_h:xh(e.a,e.b,e.c,e.d,e.e,e.f)}),"px, ","px)","deg)"),kh=bh((function(t){return null==t?_h:(yh||(yh=document.createElementNS("http://www.w3.org/2000/svg","g")),yh.setAttribute("transform",t),(t=yh.transform.baseVal.consolidate())?xh((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):_h)}),", ",")",")");function Ah(t){return((t=Math.exp(t))+1/t)/2}var Mh=function t(e,n,r){function i(t,i){var o,a,s=t[0],u=t[1],l=t[2],c=i[0],f=i[1],h=i[2],d=c-s,p=f-u,g=d*d+p*p;if(g<1e-12)a=Math.log(h/l)/e,o=function(t){return[s+t*d,u+t*p,l*Math.exp(e*t*a)]};else{var m=Math.sqrt(g),y=(h*h-l*l+r*g)/(2*l*n*m),v=(h*h-l*l-r*g)/(2*h*n*m),_=Math.log(Math.sqrt(y*y+1)-y),x=Math.log(Math.sqrt(v*v+1)-v);a=(x-_)/e,o=function(t){var r=t*a,i=Ah(_),o=l/(n*m)*(i*function(t){return((t=Math.exp(2*t))-1)/(t+1)}(e*r+_)-function(t){return((t=Math.exp(t))-1/t)/2}(_));return[s+o*d,u+o*p,l*i/Ah(e*r+_)]}}return o.duration=1e3*a*e/Math.SQRT2,o}return i.rho=function(e){var n=Math.max(.001,+e),r=n*n;return t(n,r,r*r)},i}(Math.SQRT2,2,4);function Eh(t){return function(e,n){var r=t((e=pf(e)).h,(n=pf(n)).h),i=eh(e.s,n.s),o=eh(e.l,n.l),a=eh(e.opacity,n.opacity);return function(t){return e.h=r(t),e.s=i(t),e.l=o(t),e.opacity=a(t),e+""}}}var Dh=Eh(Kf),Ch=Eh(eh);function Fh(t){return function(e,n){var r=t((e=Nf(e)).h,(n=Nf(n)).h),i=eh(e.c,n.c),o=eh(e.l,n.l),a=eh(e.opacity,n.opacity);return function(t){return e.h=r(t),e.c=i(t),e.l=o(t),e.opacity=a(t),e+""}}}var Sh=Fh(Kf),$h=Fh(eh);function Th(t){return function e(n){function r(e,r){var i=t((e=Yf(e)).h,(r=Yf(r)).h),o=eh(e.s,r.s),a=eh(e.l,r.l),s=eh(e.opacity,r.opacity);return function(t){return e.h=i(t),e.s=o(t),e.l=a(Math.pow(t,n)),e.opacity=s(t),e+""}}return n=+n,r.gamma=e,r}(1)}var Bh=Th(Kf),zh=Th(eh);function Nh(t,e){void 0===e&&(e=t,t=gh);for(var n=0,r=e.length-1,i=e[0],o=new Array(r<0?0:r);n<r;)o[n]=t(i,i=e[++n]);return function(t){var e=Math.max(0,Math.min(r-1,Math.floor(t*=r)));return o[e](t-e)}}var Oh=Object.freeze({__proto__:null,interpolate:gh,interpolateArray:function(t,e){return(sh(e)?ah:uh)(t,e)},interpolateBasis:Xf,interpolateBasisClosed:Jf,interpolateCubehelix:Bh,interpolateCubehelixLong:zh,interpolateDate:lh,interpolateDiscrete:function(t){var e=t.length;return function(n){return t[Math.max(0,Math.min(e-1,Math.floor(n*e)))]}},interpolateHcl:Sh,interpolateHclLong:$h,interpolateHsl:Dh,interpolateHslLong:Ch,interpolateHue:function(t,e){var n=Kf(+t,+e);return function(t){var e=n(t);return e-360*Math.floor(e/360)}},interpolateLab:function(t,e){var n=eh((t=Ff(t)).l,(e=Ff(e)).l),r=eh(t.a,e.a),i=eh(t.b,e.b),o=eh(t.opacity,e.opacity);return function(e){return t.l=n(e),t.a=r(e),t.b=i(e),t.opacity=o(e),t+""}},interpolateNumber:ch,interpolateNumberArray:ah,interpolateObject:fh,interpolateRgb:nh,interpolateRgbBasis:ih,interpolateRgbBasisClosed:oh,interpolateRound:mh,interpolateString:ph,interpolateTransformCss:wh,interpolateTransformSvg:kh,interpolateZoom:Mh,piecewise:Nh,quantize:function(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t(r/(e-1));return n}});function Rh(t){return+t}var Lh=[0,1];function Uh(t){return t}function qh(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:function(t){return function(){return t}}(isNaN(e)?NaN:.5)}function Ph(t,e,n){var r=t[0],i=t[1],o=e[0],a=e[1];return i<r?(r=qh(i,r),o=n(a,o)):(r=qh(r,i),o=n(o,a)),function(t){return o(r(t))}}function jh(t,e,n){var r=Math.min(t.length,e.length)-1,i=new Array(r),o=new Array(r),a=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++a<r;)i[a]=qh(t[a],t[a+1]),o[a]=n(e[a],e[a+1]);return function(e){var n=ie(t,e,1,r)-1;return o[n](i[n](e))}}function Ih(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Wh(){var t,e,n,r,i,o,a=Lh,s=Lh,u=gh,l=Uh;function c(){var t=Math.min(a.length,s.length);return l!==Uh&&(l=function(t,e){var n;return t>e&&(n=t,t=e,e=n),function(n){return Math.max(t,Math.min(e,n))}}(a[0],a[t-1])),r=t>2?jh:Ph,i=o=null,f}function f(e){return null==e||isNaN(e=+e)?n:(i||(i=r(a.map(t),s,u)))(t(l(e)))}return f.invert=function(n){return l(e((o||(o=r(s,a.map(t),ch)))(n)))},f.domain=function(t){return arguments.length?(a=Array.from(t,Rh),c()):a.slice()},f.range=function(t){return arguments.length?(s=Array.from(t),c()):s.slice()},f.rangeRound=function(t){return s=Array.from(t),u=mh,c()},f.clamp=function(t){return arguments.length?(l=!!t||Uh,c()):l!==Uh},f.interpolate=function(t){return arguments.length?(u=t,c()):u},f.unknown=function(t){return arguments.length?(n=t,f):n},function(n,r){return t=n,e=r,c()}}function Hh(){return Wh()(Uh,Uh)}function Yh(t,e,n,r){var i,o=xe(t,e,n);switch((r=Oe(null==r?",f":r)).type){case"s":var a=Math.max(Math.abs(t),Math.abs(e));return null!=r.precision||isNaN(i=Ve(o,a))||(r.precision=i),Ie(r,a);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=Xe(o,Math.max(Math.abs(t),Math.abs(e))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=Ge(o))||(r.precision=i-2*("%"===r.type))}return je(r)}function Gh(t){var e=t.domain;return t.ticks=function(t){var n=e();return ve(n[0],n[n.length-1],null==t?10:t)},t.tickFormat=function(t,n){var r=e();return Yh(r[0],r[r.length-1],null==t?10:t,n)},t.nice=function(n){null==n&&(n=10);var r,i,o=e(),a=0,s=o.length-1,u=o[a],l=o[s],c=10;for(l<u&&(i=u,u=l,l=i,i=a,a=s,s=i);c-- >0;){if((i=_e(u,l,n))===r)return o[a]=u,o[s]=l,e(o);if(i>0)u=Math.floor(u/i)*i,l=Math.ceil(l/i)*i;else{if(!(i<0))break;u=Math.ceil(u*i)/i,l=Math.floor(l*i)/i}r=i}return t},t}function Vh(t,e){var n,r=0,i=(t=t.slice()).length-1,o=t[r],a=t[i];return a<o&&(n=r,r=i,i=n,n=o,o=a,a=n),t[r]=e.floor(o),t[i]=e.ceil(a),t}function Xh(t){return Math.log(t)}function Jh(t){return Math.exp(t)}function Zh(t){return-Math.log(-t)}function Qh(t){return-Math.exp(-t)}function Kh(t){return isFinite(t)?+("1e"+t):t<0?0:t}function td(t){return(e,n)=>-t(-e,n)}function ed(t){const e=t(Xh,Jh),n=e.domain;let r,i,o=10;function a(){return r=function(t){return t===Math.E?Math.log:10===t&&Math.log10||2===t&&Math.log2||(t=Math.log(t),e=>Math.log(e)/t)}(o),i=function(t){return 10===t?Kh:t===Math.E?Math.exp:e=>Math.pow(t,e)}(o),n()[0]<0?(r=td(r),i=td(i),t(Zh,Qh)):t(Xh,Jh),e}return e.base=function(t){return arguments.length?(o=+t,a()):o},e.domain=function(t){return arguments.length?(n(t),a()):n()},e.ticks=t=>{const e=n();let a=e[0],s=e[e.length-1];const u=s<a;u&&([a,s]=[s,a]);let l,c,f=r(a),h=r(s);const d=null==t?10:+t;let p=[];if(!(o%1)&&h-f<d){if(f=Math.floor(f),h=Math.ceil(h),a>0){for(;f<=h;++f)for(l=1;l<o;++l)if(c=f<0?l/i(-f):l*i(f),!(c<a)){if(c>s)break;p.push(c)}}else for(;f<=h;++f)for(l=o-1;l>=1;--l)if(c=f>0?l/i(-f):l*i(f),!(c<a)){if(c>s)break;p.push(c)}2*p.length<d&&(p=ve(a,s,d))}else p=ve(f,h,Math.min(h-f,d)).map(i);return u?p.reverse():p},e.tickFormat=(t,n)=>{if(null==t&&(t=10),null==n&&(n=10===o?"s":","),"function"!=typeof n&&(o%1||null!=(n=Oe(n)).precision||(n.trim=!0),n=je(n)),t===1/0)return n;const a=Math.max(1,o*t/e.ticks().length);return t=>{let e=t/i(Math.round(r(t)));return e*o<o-.5&&(e*=o),e<=a?n(t):""}},e.nice=()=>n(Vh(n(),{floor:t=>i(Math.floor(r(t))),ceil:t=>i(Math.ceil(r(t)))})),e}function nd(t){return function(e){return Math.sign(e)*Math.log1p(Math.abs(e/t))}}function rd(t){return function(e){return Math.sign(e)*Math.expm1(Math.abs(e))*t}}function id(t){var e=1,n=t(nd(e),rd(e));return n.constant=function(n){return arguments.length?t(nd(e=+n),rd(e)):e},Gh(n)}function od(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function ad(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function sd(t){return t<0?-t*t:t*t}function ud(t){var e=t(Uh,Uh),n=1;return e.exponent=function(e){return arguments.length?1===(n=+e)?t(Uh,Uh):.5===n?t(ad,sd):t(od(n),od(1/n)):n},Gh(e)}function ld(){var t=ud(Wh());return t.copy=function(){return Ih(t,ld()).exponent(t.exponent())},Tc.apply(t,arguments),t}function cd(t){return new Date(t)}function fd(t){return t instanceof Date?+t:+new Date(+t)}function hd(t,e,n,r,i,o,a,s,u,l){var c=Hh(),f=c.invert,h=c.domain,d=l(".%L"),p=l(":%S"),g=l("%I:%M"),m=l("%I %p"),y=l("%a %d"),v=l("%b %d"),_=l("%B"),x=l("%Y");function b(t){return(u(t)<t?d:s(t)<t?p:a(t)<t?g:o(t)<t?m:r(t)<t?i(t)<t?y:v:n(t)<t?_:x)(t)}return c.invert=function(t){return new Date(f(t))},c.domain=function(t){return arguments.length?h(Array.from(t,fd)):h().map(cd)},c.ticks=function(e){var n=h();return t(n[0],n[n.length-1],null==e?10:e)},c.tickFormat=function(t,e){return null==e?b:l(e)},c.nice=function(t){var n=h();return t&&"function"==typeof t.range||(t=e(n[0],n[n.length-1],null==t?10:t)),t?h(Vh(n,t)):c},c.copy=function(){return Ih(c,hd(t,e,n,r,i,o,a,s,u,l))},c}function dd(){var t,e,n,r,i,o=0,a=1,s=Uh,u=!1;function l(e){return null==e||isNaN(e=+e)?i:s(0===n?.5:(e=(r(e)-t)*n,u?Math.max(0,Math.min(1,e)):e))}function c(t){return function(e){var n,r;return arguments.length?([n,r]=e,s=t(n,r),l):[s(0),s(1)]}}return l.domain=function(i){return arguments.length?([o,a]=i,t=r(o=+o),e=r(a=+a),n=t===e?0:1/(e-t),l):[o,a]},l.clamp=function(t){return arguments.length?(u=!!t,l):u},l.interpolator=function(t){return arguments.length?(s=t,l):s},l.range=c(gh),l.rangeRound=c(mh),l.unknown=function(t){return arguments.length?(i=t,l):i},function(i){return r=i,t=i(o),e=i(a),n=t===e?0:1/(e-t),l}}function pd(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function gd(){var t=Gh(dd()(Uh));return t.copy=function(){return pd(t,gd())},Bc.apply(t,arguments)}function md(){var t=ud(dd());return t.copy=function(){return pd(t,md()).exponent(t.exponent())},Bc.apply(t,arguments)}function yd(){var t,e,n,r,i,o,a,s=0,u=.5,l=1,c=1,f=Uh,h=!1;function d(t){return isNaN(t=+t)?a:(t=.5+((t=+o(t))-e)*(c*t<c*e?r:i),f(h?Math.max(0,Math.min(1,t)):t))}function p(t){return function(e){var n,r,i;return arguments.length?([n,r,i]=e,f=Nh(t,[n,r,i]),d):[f(0),f(.5),f(1)]}}return d.domain=function(a){return arguments.length?([s,u,l]=a,t=o(s=+s),e=o(u=+u),n=o(l=+l),r=t===e?0:.5/(e-t),i=e===n?0:.5/(n-e),c=e<t?-1:1,d):[s,u,l]},d.clamp=function(t){return arguments.length?(h=!!t,d):h},d.interpolator=function(t){return arguments.length?(f=t,d):f},d.range=p(gh),d.rangeRound=p(mh),d.unknown=function(t){return arguments.length?(a=t,d):a},function(a){return o=a,t=a(s),e=a(u),n=a(l),r=t===e?0:.5/(e-t),i=e===n?0:.5/(n-e),c=e<t?-1:1,d}}function vd(){var t=ud(yd());return t.copy=function(){return pd(t,vd()).exponent(t.exponent())},Bc.apply(t,arguments)}function _d(t){for(var e=t.length/6|0,n=new Array(e),r=0;r<e;)n[r]="#"+t.slice(6*r,6*++r);return n}var xd=_d("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),bd=_d("7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666"),wd=_d("1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666"),kd=_d("4269d0efb118ff725c6cc5b03ca951ff8ab7a463f297bbf59c6b4e9498a0"),Ad=_d("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928"),Md=_d("fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2"),Ed=_d("b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc"),Dd=_d("e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999"),Cd=_d("66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3"),Fd=_d("8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f");function Sd(t,e,n){const r=t-e+2*n;return t?r>0?r:1:0}const $d="linear",Td="log",Bd="pow",zd="sqrt",Nd="symlog",Od="time",Rd="utc",Ld="sequential",Ud="diverging",qd="quantile",Pd="quantize",jd="threshold",Id="ordinal",Wd="point",Hd="band",Yd="bin-ordinal",Gd="continuous",Vd="discrete",Xd="discretizing",Jd="interpolating",Zd="temporal";function Qd(){const t=Nc().unknown(void 0),e=t.domain,n=t.range;let r,i,o=[0,1],a=!1,s=0,u=0,l=.5;function c(){const t=e().length,c=o[1]<o[0],f=o[1-c],h=Sd(t,s,u);let d=o[c-0];r=(f-d)/(h||1),a&&(r=Math.floor(r)),d+=(f-d-r*(t-s))*l,i=r*(1-s),a&&(d=Math.round(d),i=Math.round(i));const p=Fe(t).map((t=>d+r*t));return n(c?p.reverse():p)}return delete t.unknown,t.domain=function(t){return arguments.length?(e(t),c()):e()},t.range=function(t){return arguments.length?(o=[+t[0],+t[1]],c()):o.slice()},t.rangeRound=function(t){return o=[+t[0],+t[1]],a=!0,c()},t.bandwidth=function(){return i},t.step=function(){return r},t.round=function(t){return arguments.length?(a=!!t,c()):a},t.padding=function(t){return arguments.length?(u=Math.max(0,Math.min(1,t)),s=u,c()):s},t.paddingInner=function(t){return arguments.length?(s=Math.max(0,Math.min(1,t)),c()):s},t.paddingOuter=function(t){return arguments.length?(u=Math.max(0,Math.min(1,t)),c()):u},t.align=function(t){return arguments.length?(l=Math.max(0,Math.min(1,t)),c()):l},t.invertRange=function(t){if(null==t[0]||null==t[1])return;const r=o[1]<o[0],a=r?n().reverse():n(),s=a.length-1;let u,l,c,f=+t[0],h=+t[1];return f!=f||h!=h||(h<f&&(c=f,f=h,h=c),h<a[0]||f>o[1-r])?void 0:(u=Math.max(0,ie(a,f)-1),l=f===h?u:ie(a,h)-1,f-a[u]>i+1e-10&&++u,r&&(c=u,u=s-l,l=s-c),u>l?void 0:e().slice(u,l+1))},t.invert=function(e){const n=t.invertRange([e,e]);return n?n[0]:n},t.copy=function(){return Qd().domain(e()).range(o).round(a).paddingInner(s).paddingOuter(u).align(l)},c()}function Kd(t){const e=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,t.copy=function(){return Kd(e())},t}var tp=Array.prototype.map;const ep=Array.prototype.slice;const np=new Map,rp=Symbol("vega_scale");function ip(t){return t[rp]=!0,t}function op(t,e,n){return arguments.length>1?(np.set(t,function(t,e,n){const r=function(){const n=e();return n.invertRange||(n.invertRange=n.invert?function(t){return function(e){let n,r=e[0],i=e[1];return i<r&&(n=r,r=i,i=n),[t.invert(r),t.invert(i)]}}(n):n.invertExtent?function(t){return function(e){const n=t.range();let r,i,o,a,s=e[0],u=e[1],l=-1;for(u<s&&(i=s,s=u,u=i),o=0,a=n.length;o<a;++o)n[o]>=s&&n[o]<=u&&(l<0&&(l=o),r=o);if(!(l<0))return s=t.invertExtent(n[l]),u=t.invertExtent(n[r]),[void 0===s[0]?s[1]:s[0],void 0===u[1]?u[0]:u[1]]}}(n):void 0),n.type=t,ip(n)};return r.metadata=Tt(V(n)),r}(t,e,n)),this):ap(t)?np.get(t):void 0}function ap(t){return np.has(t)}function sp(t,e){const n=np.get(t);return n&&n.metadata[e]}function up(t){return sp(t,Gd)}function lp(t){return sp(t,Vd)}function cp(t){return sp(t,Xd)}function fp(t){return sp(t,Td)}function hp(t){return sp(t,Jd)}function dp(t){return sp(t,qd)}op("identity",(function t(e){var n;function r(t){return null==t||isNaN(t=+t)?n:t}return r.invert=r,r.domain=r.range=function(t){return arguments.length?(e=Array.from(t,Rh),r):e.slice()},r.unknown=function(t){return arguments.length?(n=t,r):n},r.copy=function(){return t(e).unknown(n)},e=arguments.length?Array.from(e,Rh):[0,1],Gh(r)})),op($d,(function t(){var e=Hh();return e.copy=function(){return Ih(e,t())},Tc.apply(e,arguments),Gh(e)}),Gd),op(Td,(function t(){const e=ed(Wh()).domain([1,10]);return e.copy=()=>Ih(e,t()).base(e.base()),Tc.apply(e,arguments),e}),[Gd,Td]),op(Bd,ld,Gd),op(zd,(function(){return ld.apply(null,arguments).exponent(.5)}),Gd),op(Nd,(function t(){var e=id(Wh());return e.copy=function(){return Ih(e,t()).constant(e.constant())},Tc.apply(e,arguments)}),Gd),op(Od,(function(){return Tc.apply(hd(Un,qn,zn,Tn,yn,dn,fn,ln,un,ei).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}),[Gd,Zd]),op(Rd,(function(){return Tc.apply(hd(Rn,Ln,Nn,Bn,Mn,pn,hn,cn,un,ri).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}),[Gd,Zd]),op(Ld,gd,[Gd,Jd]),op(`${Ld}-${$d}`,gd,[Gd,Jd]),op(`${Ld}-${Td}`,(function t(){var e=ed(dd()).domain([1,10]);return e.copy=function(){return pd(e,t()).base(e.base())},Bc.apply(e,arguments)}),[Gd,Jd,Td]),op(`${Ld}-${Bd}`,md,[Gd,Jd]),op(`${Ld}-${zd}`,(function(){return md.apply(null,arguments).exponent(.5)}),[Gd,Jd]),op(`${Ld}-${Nd}`,(function t(){var e=id(dd());return e.copy=function(){return pd(e,t()).constant(e.constant())},Bc.apply(e,arguments)}),[Gd,Jd]),op(`${Ud}-${$d}`,(function t(){var e=Gh(yd()(Uh));return e.copy=function(){return pd(e,t())},Bc.apply(e,arguments)}),[Gd,Jd]),op(`${Ud}-${Td}`,(function t(){var e=ed(yd()).domain([.1,1,10]);return e.copy=function(){return pd(e,t()).base(e.base())},Bc.apply(e,arguments)}),[Gd,Jd,Td]),op(`${Ud}-${Bd}`,vd,[Gd,Jd]),op(`${Ud}-${zd}`,(function(){return vd.apply(null,arguments).exponent(.5)}),[Gd,Jd]),op(`${Ud}-${Nd}`,(function t(){var e=id(yd());return e.copy=function(){return pd(e,t()).constant(e.constant())},Bc.apply(e,arguments)}),[Gd,Jd]),op(qd,(function t(){var e,n=[],r=[],i=[];function o(){var t=0,e=Math.max(1,r.length);for(i=new Array(e-1);++t<e;)i[t-1]=Ee(n,t/e);return a}function a(t){return null==t||isNaN(t=+t)?e:r[ie(i,t)]}return a.invertExtent=function(t){var e=r.indexOf(t);return e<0?[NaN,NaN]:[e>0?i[e-1]:n[0],e<i.length?i[e]:n[n.length-1]]},a.domain=function(t){if(!arguments.length)return n.slice();n=[];for(let e of t)null==e||isNaN(e=+e)||n.push(e);return n.sort(Qt),o()},a.range=function(t){return arguments.length?(r=Array.from(t),o()):r.slice()},a.unknown=function(t){return arguments.length?(e=t,a):e},a.quantiles=function(){return i.slice()},a.copy=function(){return t().domain(n).range(r).unknown(e)},Tc.apply(a,arguments)}),[Xd,qd]),op(Pd,(function t(){var e,n=0,r=1,i=1,o=[.5],a=[0,1];function s(t){return null!=t&&t<=t?a[ie(o,t,0,i)]:e}function u(){var t=-1;for(o=new Array(i);++t<i;)o[t]=((t+1)*r-(t-i)*n)/(i+1);return s}return s.domain=function(t){return arguments.length?([n,r]=t,n=+n,r=+r,u()):[n,r]},s.range=function(t){return arguments.length?(i=(a=Array.from(t)).length-1,u()):a.slice()},s.invertExtent=function(t){var e=a.indexOf(t);return e<0?[NaN,NaN]:e<1?[n,o[0]]:e>=i?[o[i-1],r]:[o[e-1],o[e]]},s.unknown=function(t){return arguments.length?(e=t,s):s},s.thresholds=function(){return o.slice()},s.copy=function(){return t().domain([n,r]).range(a).unknown(e)},Tc.apply(Gh(s),arguments)}),Xd),op(jd,(function t(){var e,n=[.5],r=[0,1],i=1;function o(t){return null!=t&&t<=t?r[ie(n,t,0,i)]:e}return o.domain=function(t){return arguments.length?(n=Array.from(t),i=Math.min(n.length,r.length-1),o):n.slice()},o.range=function(t){return arguments.length?(r=Array.from(t),i=Math.min(n.length,r.length-1),o):r.slice()},o.invertExtent=function(t){var e=r.indexOf(t);return[n[e-1],n[e]]},o.unknown=function(t){return arguments.length?(e=t,o):e},o.copy=function(){return t().domain(n).range(r).unknown(e)},Tc.apply(o,arguments)}),Xd),op(Yd,(function t(){let e=[],n=[];function r(t){return null==t||t!=t?void 0:n[(ie(e,t)-1)%n.length]}return r.domain=function(t){return arguments.length?(e=function(t){return tp.call(t,S)}(t),r):e.slice()},r.range=function(t){return arguments.length?(n=ep.call(t),r):n.slice()},r.tickFormat=function(t,n){return Yh(e[0],F(e),null==t?10:t,n)},r.copy=function(){return t().domain(r.domain()).range(r.range())},r}),[Vd,Xd]),op(Id,Nc,Vd),op(Hd,Qd,Vd),op(Wd,(function(){return Kd(Qd().paddingInner(1))}),Vd);const pp=["clamp","base","constant","exponent"];function gp(t,e){const n=e[0],r=F(e)-n;return function(e){return t(n+e*r)}}function mp(t,e,n){return Nh(_p(e||"rgb",n),t)}function yp(t,e){const n=new Array(e),r=e+1;for(let i=0;i<e;)n[i]=t(++i/r);return n}function vp(t,e,n){const r=n-e;let i,o,a;return r&&Number.isFinite(r)?(i=(o=t.type).indexOf("-"),o=i<0?o:o.slice(i+1),a=op(o)().domain([e,n]).range([0,1]),pp.forEach((e=>t[e]?a[e](t[e]()):0)),a):rt(.5)}function _p(t,e){const n=Oh[function(t){return"interpolate"+t.toLowerCase().split("-").map((t=>t[0].toUpperCase()+t.slice(1))).join("")}(t)];return null!=e&&n&&n.gamma?n.gamma(e):n}function xp(t){if(k(t))return t;const e=t.length/6|0,n=new Array(e);for(let r=0;r<e;)n[r]="#"+t.slice(6*r,6*++r);return n}function bp(t,e){for(const n in t)kp(n,e(t[n]))}const wp={};function kp(t,e){return t=t&&t.toLowerCase(),arguments.length>1?(wp[t]=e,this):wp[t]}bp({accent:bd,category10:xd,category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",dark2:wd,observable10:kd,paired:Ad,pastel1:Md,pastel2:Ed,set1:Dd,set2:Cd,set3:Fd,tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5"},xp),bp({blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},(t=>mp(xp(t))));const Ap="symbol",Mp="discrete",Ep=t=>k(t)?t.map((t=>String(t))):String(t),Dp=(t,e)=>t[1]-e[1],Cp=(t,e)=>e[1]-t[1];function Fp(t,e,n){let r;return yt(e)&&(t.bins&&(e=Math.max(e,t.bins.length)),null!=n&&(e=Math.min(e,Math.floor(Et(t.domain())/n||1)+1))),A(e)&&(r=e.step,e=e.interval),_t(e)&&(e=t.type===Od?Dr(e):t.type==Rd?Cr(e):s("Only time and utc scales accept interval strings."),r&&(e=e.every(r))),e}function Sp(t,e,n){let r=t.range(),i=r[0],o=F(r),a=Dp;if(i>o&&(r=o,o=i,i=r,a=Cp),i=Math.floor(i),o=Math.ceil(o),e=e.map((e=>[e,t(e)])).filter((t=>i<=t[1]&&t[1]<=o)).sort(a).map((t=>t[0])),n>0&&e.length>1){const t=[e[0],F(e)];for(;e.length>n&&e.length>=3;)e=e.filter(((t,e)=>!(e%2)));e.length<3&&(e=t)}return e}function $p(t,e){return t.bins?Sp(t,t.bins,e):t.ticks?t.ticks(e):t.domain()}function Tp(t,e,n,r,i,o){const a=e.type;let s=Ep;if(a===Od||i===Od)s=t.timeFormat(r);else if(a===Rd||i===Rd)s=t.utcFormat(r);else if(fp(a)){const i=t.formatFloat(r);if(o||e.bins)s=i;else{const t=Bp(e,n,!1);s=e=>t(e)?i(e):""}}else if(e.tickFormat){const i=e.domain();s=t.formatSpan(i[0],i[i.length-1],n,r)}else r&&(s=t.format(r));return s}function Bp(t,e,n){const r=$p(t,e),i=t.base(),o=Math.log(i),a=Math.max(1,i*e/r.length),s=t=>{let e=t/Math.pow(i,Math.round(Math.log(t)/o));return e*i<i-.5&&(e*=i),e<=a};return n?r.filter(s):s}const zp={[qd]:"quantiles",[Pd]:"thresholds",[jd]:"domain"},Np={[qd]:"quantiles",[Pd]:"domain"};function Op(t,e){return t.bins?function(t){const e=t.slice(0,-1);return e.max=F(t),e}(t.bins):t.type===Td?Bp(t,e,!0):zp[t.type]?function(t){const e=[-1/0].concat(t);return e.max=1/0,e}(t[zp[t.type]]()):$p(t,e)}const Rp=t=>zp[t.type]||t.bins;function Lp(t,e,n,r,i,o,a){const s=Np[e.type]&&o!==Od&&o!==Rd?function(t,e,n){const r=e[Np[e.type]](),i=r.length;let o,a=i>1?r[1]-r[0]:r[0];for(o=1;o<i;++o)a=Math.min(a,r[o]-r[o-1]);return t.formatSpan(0,a,30,n)}(t,e,i):Tp(t,e,n,i,o,a);return r===Ap&&Rp(e)?Up(s):r===Mp?Pp(s):jp(s)}const Up=t=>(e,n,r)=>{const i=qp(r[n+1],qp(r.max,1/0)),o=Ip(e,t),a=Ip(i,t);return o&&a?o+" â€“ "+a:a?"< "+a:"â‰¥ "+o},qp=(t,e)=>null!=t?t:e,Pp=t=>(e,n)=>n?t(e):null,jp=t=>e=>t(e),Ip=(t,e)=>Number.isFinite(t)?e(t):null;function Wp(t,e,n,r){const i=r||e.type;return _t(n)&&function(t){return sp(t,Zd)}(i)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),n||i!==Od?n||i!==Rd?Lp(t,e,5,null,n,r,!0):t.utcFormat("%A, %d %B %Y, %X UTC"):t.timeFormat("%A, %d %B %Y, %X")}function Hp(t,e,n){n=n||{};const r=Math.max(3,n.maxlen||7),i=Wp(t,e,n.format,n.formatType);if(cp(e.type)){const t=Op(e).slice(1).map(i),n=t.length;return`${n} boundar${1===n?"y":"ies"}: ${t.join(", ")}`}if(lp(e.type)){const t=e.domain(),n=t.length;return`${n} value${1===n?"":"s"}: ${n>r?t.slice(0,r-2).map(i).join(", ")+", ending with "+t.slice(-1).map(i):t.map(i).join(", ")}`}{const t=e.domain();return`values from ${i(t[0])} to ${i(F(t))}`}}let Yp=0;const Gp="p_";function Vp(t){return t&&t.gradient}function Xp(t,e,n){const r=t.gradient;let i=t.id,o="radial"===r?Gp:"";return i||(i=t.id="gradient_"+Yp++,"radial"===r?(t.x1=Jp(t.x1,.5),t.y1=Jp(t.y1,.5),t.r1=Jp(t.r1,0),t.x2=Jp(t.x2,.5),t.y2=Jp(t.y2,.5),t.r2=Jp(t.r2,.5),o=Gp):(t.x1=Jp(t.x1,0),t.y1=Jp(t.y1,0),t.x2=Jp(t.x2,1),t.y2=Jp(t.y2,0))),e[i]=t,"url("+(n||"")+"#"+o+i+")"}function Jp(t,e){return null!=t?t:e}function Zp(t,e){var n,r=[];return n={gradient:"linear",x1:t?t[0]:0,y1:t?t[1]:0,x2:e?e[0]:1,y2:e?e[1]:0,stops:r,stop:function(t,e){return r.push({offset:t,color:e}),n}}}const Qp={basis:{curve:function(t){return new tc(t)}},"basis-closed":{curve:function(t){return new ec(t)}},"basis-open":{curve:function(t){return new nc(t)}},bundle:{curve:ic,tension:"beta",value:.85},cardinal:{curve:sc,tension:"tension",value:0},"cardinal-open":{curve:fc,tension:"tension",value:0},"cardinal-closed":{curve:lc,tension:"tension",value:0},"catmull-rom":{curve:pc,tension:"alpha",value:.5},"catmull-rom-closed":{curve:mc,tension:"alpha",value:.5},"catmull-rom-open":{curve:vc,tension:"alpha",value:.5},linear:{curve:Yl},"linear-closed":{curve:function(t){return new _c(t)}},monotone:{horizontal:function(t){return new Mc(t)},vertical:function(t){return new Ac(t)}},natural:{curve:function(t){return new Dc(t)}},step:{curve:function(t){return new Fc(t,.5)}},"step-after":{curve:function(t){return new Fc(t,1)}},"step-before":{curve:function(t){return new Fc(t,0)}}};function Kp(t,e,n){var r=ut(Qp,t)&&Qp[t],i=null;return r&&(i=r.curve||r[e||"vertical"],r.tension&&null!=n&&(i=i[r.tension](n))),i}const tg={m:2,l:2,h:1,v:1,z:0,c:6,s:4,q:4,t:2,a:7},eg=/[mlhvzcsqta]([^mlhvzcsqta]+|$)/gi,ng=/^[+-]?(([0-9]*\.[0-9]+)|([0-9]+\.)|([0-9]+))([eE][+-]?[0-9]+)?/,rg=/^((\s+,?\s*)|(,\s*))/,ig=/^[01]/;function og(t){const e=[];return(t.match(eg)||[]).forEach((t=>{let n=t[0];const r=n.toLowerCase(),i=tg[r],o=function(t,e,n){const r=[];for(let i=0;e&&i<n.length;)for(let o=0;o<e;++o){const e="a"!==t||3!==o&&4!==o?ng:ig,a=n.slice(i).match(e);if(null===a)throw Error("Invalid SVG path, incorrect parameter type");i+=a[0].length,r.push(+a[0]);const s=n.slice(i).match(rg);null!==s&&(i+=s[0].length)}return r}(r,i,t.slice(1).trim()),a=o.length;if(a<i||a&&a%i!=0)throw Error("Invalid SVG path, incorrect parameter count");if(e.push([n,...o.slice(0,i)]),a!==i){"m"===r&&(n="M"===n?"L":"l");for(let t=i;t<a;t+=i)e.push([n,...o.slice(t,t+i)])}})),e}const ag=Math.PI/180,sg=Math.PI/2,ug=2*Math.PI,lg=Math.sqrt(3)/2;var cg={},fg={},hg=[].join;function dg(t){const e=hg.call(t);if(fg[e])return fg[e];var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],l=t[7];const c=l*a,f=-u*s,h=u*a,d=l*s,p=Math.cos(i),g=Math.sin(i),m=Math.cos(o),y=Math.sin(o),v=.5*(o-i),_=Math.sin(.5*v),x=8/3*_*_/Math.sin(v),b=n+p-x*g,w=r+g+x*p,k=n+m,A=r+y,M=k+x*y,E=A-x*m;return fg[e]=[c*b+f*w,h*b+d*w,c*M+f*E,h*M+d*E,c*k+f*A,h*k+d*A]}const pg=["l",0,0,0,0,0,0,0];function gg(t,e,n){const r=pg[0]=t[0];if("a"===r||"A"===r)pg[1]=e*t[1],pg[2]=n*t[2],pg[3]=t[3],pg[4]=t[4],pg[5]=t[5],pg[6]=e*t[6],pg[7]=n*t[7];else if("h"===r||"H"===r)pg[1]=e*t[1];else if("v"===r||"V"===r)pg[1]=n*t[1];else for(var i=1,o=t.length;i<o;++i)pg[i]=(i%2==1?e:n)*t[i];return pg}function mg(t,e,n,r,i,o){var a,s,u,l,c,f=null,h=0,d=0,p=0,g=0,m=0,y=0;null==n&&(n=0),null==r&&(r=0),null==i&&(i=1),null==o&&(o=i),t.beginPath&&t.beginPath();for(var v=0,_=e.length;v<_;++v){switch(a=e[v],1===i&&1===o||(a=gg(a,i,o)),a[0]){case"l":h+=a[1],d+=a[2],t.lineTo(h+n,d+r);break;case"L":h=a[1],d=a[2],t.lineTo(h+n,d+r);break;case"h":h+=a[1],t.lineTo(h+n,d+r);break;case"H":h=a[1],t.lineTo(h+n,d+r);break;case"v":d+=a[1],t.lineTo(h+n,d+r);break;case"V":d=a[1],t.lineTo(h+n,d+r);break;case"m":m=h+=a[1],y=d+=a[2],t.moveTo(h+n,d+r);break;case"M":m=h=a[1],y=d=a[2],t.moveTo(h+n,d+r);break;case"c":s=h+a[5],u=d+a[6],p=h+a[3],g=d+a[4],t.bezierCurveTo(h+a[1]+n,d+a[2]+r,p+n,g+r,s+n,u+r),h=s,d=u;break;case"C":h=a[5],d=a[6],p=a[3],g=a[4],t.bezierCurveTo(a[1]+n,a[2]+r,p+n,g+r,h+n,d+r);break;case"s":s=h+a[3],u=d+a[4],p=2*h-p,g=2*d-g,t.bezierCurveTo(p+n,g+r,h+a[1]+n,d+a[2]+r,s+n,u+r),p=h+a[1],g=d+a[2],h=s,d=u;break;case"S":s=a[3],u=a[4],p=2*h-p,g=2*d-g,t.bezierCurveTo(p+n,g+r,a[1]+n,a[2]+r,s+n,u+r),h=s,d=u,p=a[1],g=a[2];break;case"q":s=h+a[3],u=d+a[4],p=h+a[1],g=d+a[2],t.quadraticCurveTo(p+n,g+r,s+n,u+r),h=s,d=u;break;case"Q":s=a[3],u=a[4],t.quadraticCurveTo(a[1]+n,a[2]+r,s+n,u+r),h=s,d=u,p=a[1],g=a[2];break;case"t":s=h+a[1],u=d+a[2],null===f[0].match(/[QqTt]/)?(p=h,g=d):"t"===f[0]?(p=2*h-l,g=2*d-c):"q"===f[0]&&(p=2*h-p,g=2*d-g),l=p,c=g,t.quadraticCurveTo(p+n,g+r,s+n,u+r),d=u,p=(h=s)+a[1],g=d+a[2];break;case"T":s=a[1],u=a[2],p=2*h-p,g=2*d-g,t.quadraticCurveTo(p+n,g+r,s+n,u+r),h=s,d=u;break;case"a":yg(t,h+n,d+r,[a[1],a[2],a[3],a[4],a[5],a[6]+h+n,a[7]+d+r]),h+=a[6],d+=a[7];break;case"A":yg(t,h+n,d+r,[a[1],a[2],a[3],a[4],a[5],a[6]+n,a[7]+r]),h=a[6],d=a[7];break;case"z":case"Z":h=m,d=y,t.closePath()}f=a}}function yg(t,e,n,r){const i=function(t,e,n,r,i,o,a,s,u){const l=hg.call(arguments);if(cg[l])return cg[l];const c=a*ag,f=Math.sin(c),h=Math.cos(c),d=h*(s-t)*.5+f*(u-e)*.5,p=h*(u-e)*.5-f*(s-t)*.5;let g=d*d/((n=Math.abs(n))*n)+p*p/((r=Math.abs(r))*r);g>1&&(g=Math.sqrt(g),n*=g,r*=g);const m=h/n,y=f/n,v=-f/r,_=h/r,x=m*s+y*u,b=v*s+_*u,w=m*t+y*e,k=v*t+_*e;let A=1/((w-x)*(w-x)+(k-b)*(k-b))-.25;A<0&&(A=0);let M=Math.sqrt(A);o==i&&(M=-M);const E=.5*(x+w)-M*(k-b),D=.5*(b+k)+M*(w-x),C=Math.atan2(b-D,x-E);let F=Math.atan2(k-D,w-E)-C;F<0&&1===o?F+=ug:F>0&&0===o&&(F-=ug);const S=Math.ceil(Math.abs(F/(sg+.001))),$=[];for(let t=0;t<S;++t){const e=C+t*F/S,i=C+(t+1)*F/S;$[t]=[E,D,e,i,n,r,f,h]}return cg[l]=$}(r[5],r[6],r[0],r[1],r[3],r[4],r[2],e,n);for(let e=0;e<i.length;++e){const n=dg(i[e]);t.bezierCurveTo(n[0],n[1],n[2],n[3],n[4],n[5])}}const vg=.5773502691896257,_g={circle:{draw:function(t,e){const n=Math.sqrt(e)/2;t.moveTo(n,0),t.arc(0,0,n,0,ug)}},cross:{draw:function(t,e){var n=Math.sqrt(e)/2,r=n/2.5;t.moveTo(-n,-r),t.lineTo(-n,r),t.lineTo(-r,r),t.lineTo(-r,n),t.lineTo(r,n),t.lineTo(r,r),t.lineTo(n,r),t.lineTo(n,-r),t.lineTo(r,-r),t.lineTo(r,-n),t.lineTo(-r,-n),t.lineTo(-r,-r),t.closePath()}},diamond:{draw:function(t,e){const n=Math.sqrt(e)/2;t.moveTo(-n,0),t.lineTo(0,-n),t.lineTo(n,0),t.lineTo(0,n),t.closePath()}},square:{draw:function(t,e){var n=Math.sqrt(e),r=-n/2;t.rect(r,r,n,n)}},arrow:{draw:function(t,e){var n=Math.sqrt(e)/2,r=n/7,i=n/2.5,o=n/8;t.moveTo(-r,n),t.lineTo(r,n),t.lineTo(r,-o),t.lineTo(i,-o),t.lineTo(0,-n),t.lineTo(-i,-o),t.lineTo(-r,-o),t.closePath()}},wedge:{draw:function(t,e){var n=Math.sqrt(e)/2,r=lg*n,i=r-n*vg,o=n/4;t.moveTo(0,-r-i),t.lineTo(-o,r-i),t.lineTo(o,r-i),t.closePath()}},triangle:{draw:function(t,e){var n=Math.sqrt(e)/2,r=lg*n,i=r-n*vg;t.moveTo(0,-r-i),t.lineTo(-n,r-i),t.lineTo(n,r-i),t.closePath()}},"triangle-up":{draw:function(t,e){var n=Math.sqrt(e)/2,r=lg*n;t.moveTo(0,-r),t.lineTo(-n,r),t.lineTo(n,r),t.closePath()}},"triangle-down":{draw:function(t,e){var n=Math.sqrt(e)/2,r=lg*n;t.moveTo(0,r),t.lineTo(-n,-r),t.lineTo(n,-r),t.closePath()}},"triangle-right":{draw:function(t,e){var n=Math.sqrt(e)/2,r=lg*n;t.moveTo(r,0),t.lineTo(-r,-n),t.lineTo(-r,n),t.closePath()}},"triangle-left":{draw:function(t,e){var n=Math.sqrt(e)/2,r=lg*n;t.moveTo(-r,0),t.lineTo(r,-n),t.lineTo(r,n),t.closePath()}},stroke:{draw:function(t,e){const n=Math.sqrt(e)/2;t.moveTo(-n,0),t.lineTo(n,0)}}};function xg(t){return ut(_g,t)?_g[t]:function(t){if(!ut(bg,t)){const e=og(t);bg[t]={draw:function(t,n){mg(t,e,0,0,Math.sqrt(n)/2)}}}return bg[t]}(t)}var bg={};const wg=.448084975506;function kg(t){return t.x}function Ag(t){return t.y}function Mg(t){return t.width}function Eg(t){return t.height}function Dg(t){return"function"==typeof t?t:()=>+t}function Cg(t,e,n){return Math.max(e,Math.min(t,n))}function Fg(){var t=kg,e=Ag,n=Mg,r=Eg,i=Dg(0),o=i,a=i,s=i,u=null;function l(l,c,f){var h,d=null!=c?c:+t.call(this,l),p=null!=f?f:+e.call(this,l),g=+n.call(this,l),m=+r.call(this,l),y=Math.min(g,m)/2,v=Cg(+i.call(this,l),0,y),_=Cg(+o.call(this,l),0,y),x=Cg(+a.call(this,l),0,y),b=Cg(+s.call(this,l),0,y);if(u||(u=h=Ol()),v<=0&&_<=0&&x<=0&&b<=0)u.rect(d,p,g,m);else{var w=d+g,k=p+m;u.moveTo(d+v,p),u.lineTo(w-_,p),u.bezierCurveTo(w-wg*_,p,w,p+wg*_,w,p+_),u.lineTo(w,k-b),u.bezierCurveTo(w,k-wg*b,w-wg*b,k,w-b,k),u.lineTo(d+x,k),u.bezierCurveTo(d+wg*x,k,d,k-wg*x,d,k-x),u.lineTo(d,p+v),u.bezierCurveTo(d,p+wg*v,d+wg*v,p,d+v,p),u.closePath()}if(h)return u=null,h+""||null}return l.x=function(e){return arguments.length?(t=Dg(e),l):t},l.y=function(t){return arguments.length?(e=Dg(t),l):e},l.width=function(t){return arguments.length?(n=Dg(t),l):n},l.height=function(t){return arguments.length?(r=Dg(t),l):r},l.cornerRadius=function(t,e,n,r){return arguments.length?(i=Dg(t),o=null!=e?Dg(e):i,s=null!=n?Dg(n):i,a=null!=r?Dg(r):o,l):i},l.context=function(t){return arguments.length?(u=null==t?null:t,l):u},l}function Sg(){var t,e,n,r,i,o,a,s,u=null;function l(t,e,n){const r=n/2;if(i){var l=a-e,c=t-o;if(l||c){var f=Math.hypot(l,c),h=(l/=f)*s,d=(c/=f)*s,p=Math.atan2(c,l);u.moveTo(o-h,a-d),u.lineTo(t-l*r,e-c*r),u.arc(t,e,r,p-Math.PI,p),u.lineTo(o+h,a+d),u.arc(o,a,s,p,p+Math.PI)}else u.arc(t,e,r,0,ug);u.closePath()}else i=1;o=t,a=e,s=r}function c(o){var a,s,c,f=o.length,h=!1;for(null==u&&(u=c=Ol()),a=0;a<=f;++a)!(a<f&&r(s=o[a],a,o))===h&&(h=!h)&&(i=0),h&&l(+t(s,a,o),+e(s,a,o),+n(s,a,o));if(c)return u=null,c+""||null}return c.x=function(e){return arguments.length?(t=e,c):t},c.y=function(t){return arguments.length?(e=t,c):e},c.size=function(t){return arguments.length?(n=t,c):n},c.defined=function(t){return arguments.length?(r=t,c):r},c.context=function(t){return arguments.length?(u=null==t?null:t,c):u},c}function $g(t,e){return null!=t?t:e}const Tg=t=>t.x||0,Bg=t=>t.y||0,zg=t=>!(!1===t.defined),Ng=function(){var t=Ll,e=Ul,n=yl(0),r=null,i=ql,o=Pl,a=jl,s=null,u=Rl(l);function l(){var l,c,f=+t.apply(this,arguments),h=+e.apply(this,arguments),d=i.apply(this,arguments)-Dl,p=o.apply(this,arguments)-Dl,g=vl(p-d),m=p>d;if(s||(s=l=u()),h<f&&(c=h,h=f,f=c),h>Ml)if(g>Cl-Ml)s.moveTo(h*xl(d),h*kl(d)),s.arc(0,0,h,d,p,!m),f>Ml&&(s.moveTo(f*xl(p),f*kl(p)),s.arc(0,0,f,p,d,m));else{var y,v,_=d,x=p,b=d,w=p,k=g,A=g,M=a.apply(this,arguments)/2,E=M>Ml&&(r?+r.apply(this,arguments):Al(f*f+h*h)),D=wl(vl(h-f)/2,+n.apply(this,arguments)),C=D,F=D;if(E>Ml){var S=Fl(E/f*kl(M)),$=Fl(E/h*kl(M));(k-=2*S)>Ml?(b+=S*=m?1:-1,w-=S):(k=0,b=w=(d+p)/2),(A-=2*$)>Ml?(_+=$*=m?1:-1,x-=$):(A=0,_=x=(d+p)/2)}var T=h*xl(_),B=h*kl(_),z=f*xl(w),N=f*kl(w);if(D>Ml){var O,R=h*xl(x),L=h*kl(x),U=f*xl(b),q=f*kl(b);if(g<El)if(O=function(t,e,n,r,i,o,a,s){var u=n-t,l=r-e,c=a-i,f=s-o,h=f*u-c*l;if(!(h*h<Ml))return[t+(h=(c*(e-o)-f*(t-i))/h)*u,e+h*l]}(T,B,U,q,R,L,z,N)){var P=T-O[0],j=B-O[1],I=R-O[0],W=L-O[1],H=1/kl(function(t){return t>1?0:t<-1?El:Math.acos(t)}((P*I+j*W)/(Al(P*P+j*j)*Al(I*I+W*W)))/2),Y=Al(O[0]*O[0]+O[1]*O[1]);C=wl(D,(f-Y)/(H-1)),F=wl(D,(h-Y)/(H+1))}else C=F=0}A>Ml?F>Ml?(y=Il(U,q,T,B,h,F,m),v=Il(R,L,z,N,h,F,m),s.moveTo(y.cx+y.x01,y.cy+y.y01),F<D?s.arc(y.cx,y.cy,F,_l(y.y01,y.x01),_l(v.y01,v.x01),!m):(s.arc(y.cx,y.cy,F,_l(y.y01,y.x01),_l(y.y11,y.x11),!m),s.arc(0,0,h,_l(y.cy+y.y11,y.cx+y.x11),_l(v.cy+v.y11,v.cx+v.x11),!m),s.arc(v.cx,v.cy,F,_l(v.y11,v.x11),_l(v.y01,v.x01),!m))):(s.moveTo(T,B),s.arc(0,0,h,_,x,!m)):s.moveTo(T,B),f>Ml&&k>Ml?C>Ml?(y=Il(z,N,R,L,f,-C,m),v=Il(T,B,U,q,f,-C,m),s.lineTo(y.cx+y.x01,y.cy+y.y01),C<D?s.arc(y.cx,y.cy,C,_l(y.y01,y.x01),_l(v.y01,v.x01),!m):(s.arc(y.cx,y.cy,C,_l(y.y01,y.x01),_l(y.y11,y.x11),!m),s.arc(0,0,f,_l(y.cy+y.y11,y.cx+y.x11),_l(v.cy+v.y11,v.cx+v.x11),m),s.arc(v.cx,v.cy,C,_l(v.y11,v.x11),_l(v.y01,v.x01),!m))):s.arc(0,0,f,w,b,m):s.lineTo(z,N)}else s.moveTo(0,0);if(s.closePath(),l)return s=null,l+""||null}return l.centroid=function(){var n=(+t.apply(this,arguments)+ +e.apply(this,arguments))/2,r=(+i.apply(this,arguments)+ +o.apply(this,arguments))/2-El/2;return[xl(r)*n,kl(r)*n]},l.innerRadius=function(e){return arguments.length?(t="function"==typeof e?e:yl(+e),l):t},l.outerRadius=function(t){return arguments.length?(e="function"==typeof t?t:yl(+t),l):e},l.cornerRadius=function(t){return arguments.length?(n="function"==typeof t?t:yl(+t),l):n},l.padRadius=function(t){return arguments.length?(r=null==t?null:"function"==typeof t?t:yl(+t),l):r},l.startAngle=function(t){return arguments.length?(i="function"==typeof t?t:yl(+t),l):i},l.endAngle=function(t){return arguments.length?(o="function"==typeof t?t:yl(+t),l):o},l.padAngle=function(t){return arguments.length?(a="function"==typeof t?t:yl(+t),l):a},l.context=function(t){return arguments.length?(s=null==t?null:t,l):s},l}().startAngle((t=>t.startAngle||0)).endAngle((t=>t.endAngle||0)).padAngle((t=>t.padAngle||0)).innerRadius((t=>t.innerRadius||0)).outerRadius((t=>t.outerRadius||0)).cornerRadius((t=>t.cornerRadius||0)),Og=Jl().x(Tg).y1(Bg).y0((t=>(t.y||0)+(t.height||0))).defined(zg),Rg=Jl().y(Bg).x1(Tg).x0((t=>(t.x||0)+(t.width||0))).defined(zg),Lg=Xl().x(Tg).y(Bg).defined(zg),Ug=Fg().x(Tg).y(Bg).width((t=>t.width||0)).height((t=>t.height||0)).cornerRadius((t=>$g(t.cornerRadiusTopLeft,t.cornerRadius)||0),(t=>$g(t.cornerRadiusTopRight,t.cornerRadius)||0),(t=>$g(t.cornerRadiusBottomRight,t.cornerRadius)||0),(t=>$g(t.cornerRadiusBottomLeft,t.cornerRadius)||0)),qg=function(t,e){let n=null,r=Rl(i);function i(){let i;if(n||(n=i=r()),t.apply(this,arguments).draw(n,+e.apply(this,arguments)),i)return n=null,i+""||null}return t="function"==typeof t?t:yl(t||Zl),e="function"==typeof e?e:yl(void 0===e?64:+e),i.type=function(e){return arguments.length?(t="function"==typeof e?e:yl(e),i):t},i.size=function(t){return arguments.length?(e="function"==typeof t?t:yl(+t),i):e},i.context=function(t){return arguments.length?(n=null==t?null:t,i):n},i}().type((t=>xg(t.shape||"circle"))).size((t=>$g(t.size,64))),Pg=Sg().x(Tg).y(Bg).defined(zg).size((t=>t.size||1));function jg(t){return t.cornerRadius||t.cornerRadiusTopLeft||t.cornerRadiusTopRight||t.cornerRadiusBottomRight||t.cornerRadiusBottomLeft}function Ig(t,e,n,r){return Ug.context(t)(e,n,r)}var Wg=1;function Hg(){Wg=1}function Yg(t,e,n){var r=e.clip,i=t._defs,o=e.clip_id||(e.clip_id="clip"+Wg++),a=i.clipping[o]||(i.clipping[o]={id:o});return J(r)?a.path=r(null):jg(n)?a.path=Ig(null,n,0,0):(a.width=n.width||0,a.height=n.height||0),"url(#"+o+")"}function Gg(t){this.clear(),t&&this.union(t)}function Vg(t){this.mark=t,this.bounds=this.bounds||new Gg}function Xg(t){Vg.call(this,t),this.items=this.items||[]}Gg.prototype={clone(){return new Gg(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(t){return this.x1===t.x1&&this.y1===t.y1&&this.x2===t.x2&&this.y2===t.y2},set(t,e,n,r){return n<t?(this.x2=t,this.x1=n):(this.x1=t,this.x2=n),r<e?(this.y2=e,this.y1=r):(this.y1=e,this.y2=r),this},add(t,e){return t<this.x1&&(this.x1=t),e<this.y1&&(this.y1=e),t>this.x2&&(this.x2=t),e>this.y2&&(this.y2=e),this},expand(t){return this.x1-=t,this.y1-=t,this.x2+=t,this.y2+=t,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(t){return this.x1*=t,this.y1*=t,this.x2*=t,this.y2*=t,this},translate(t,e){return this.x1+=t,this.x2+=t,this.y1+=e,this.y2+=e,this},rotate(t,e,n){const r=this.rotatedPoints(t,e,n);return this.clear().add(r[0],r[1]).add(r[2],r[3]).add(r[4],r[5]).add(r[6],r[7])},rotatedPoints(t,e,n){var{x1:r,y1:i,x2:o,y2:a}=this,s=Math.cos(t),u=Math.sin(t),l=e-e*s+n*u,c=n-e*u-n*s;return[s*r-u*i+l,u*r+s*i+c,s*r-u*a+l,u*r+s*a+c,s*o-u*i+l,u*o+s*i+c,s*o-u*a+l,u*o+s*a+c]},union(t){return t.x1<this.x1&&(this.x1=t.x1),t.y1<this.y1&&(this.y1=t.y1),t.x2>this.x2&&(this.x2=t.x2),t.y2>this.y2&&(this.y2=t.y2),this},intersect(t){return t.x1>this.x1&&(this.x1=t.x1),t.y1>this.y1&&(this.y1=t.y1),t.x2<this.x2&&(this.x2=t.x2),t.y2<this.y2&&(this.y2=t.y2),this},encloses(t){return t&&this.x1<=t.x1&&this.x2>=t.x2&&this.y1<=t.y1&&this.y2>=t.y2},alignsWith(t){return t&&(this.x1==t.x1||this.x2==t.x2||this.y1==t.y1||this.y2==t.y2)},intersects(t){return t&&!(this.x2<t.x1||this.x1>t.x2||this.y2<t.y1||this.y1>t.y2)},contains(t,e){return!(t<this.x1||t>this.x2||e<this.y1||e>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}},ht(Xg,Vg);class Jg{constructor(t){this._pending=0,this._loader=t||ca()}pending(){return this._pending}sanitizeURL(t){const e=this;return Zg(e),e._loader.sanitize(t,{context:"href"}).then((t=>(Qg(e),t))).catch((()=>(Qg(e),null)))}loadImage(t){const e=this,n=$c();return Zg(e),e._loader.sanitize(t,{context:"image"}).then((t=>{const r=t.href;if(!r||!n)throw{url:r};const i=new n,o=ut(t,"crossOrigin")?t.crossOrigin:"anonymous";return null!=o&&(i.crossOrigin=o),i.onload=()=>Qg(e),i.onerror=()=>Qg(e),i.src=r,i})).catch((t=>(Qg(e),{complete:!1,width:0,height:0,src:t&&t.url||""})))}ready(){const t=this;return new Promise((e=>{!function n(r){t.pending()?setTimeout((()=>{n(!0)}),10):e(r)}(!1)}))}}function Zg(t){t._pending+=1}function Qg(t){t._pending-=1}function Kg(t,e,n){if(e.stroke&&0!==e.opacity&&0!==e.strokeOpacity){const r=null!=e.strokeWidth?+e.strokeWidth:1;t.expand(r+(n?function(t,e){return t.strokeJoin&&"miter"!==t.strokeJoin?0:e}(e,r):0))}return t}const tm=ug-1e-8;let em,nm,rm,im,om,am,sm,um;const lm=(t,e)=>em.add(t,e),cm=(t,e)=>lm(nm=t,rm=e),fm=t=>lm(t,em.y1),hm=t=>lm(em.x1,t),dm=(t,e)=>om*t+sm*e,pm=(t,e)=>am*t+um*e,gm=(t,e)=>lm(dm(t,e),pm(t,e)),mm=(t,e)=>cm(dm(t,e),pm(t,e));function ym(t,e){return em=t,e?(im=e*ag,om=um=Math.cos(im),am=Math.sin(im),sm=-am):(om=um=1,im=am=sm=0),vm}const vm={beginPath(){},closePath(){},moveTo:mm,lineTo:mm,rect(t,e,n,r){im?(gm(t+n,e),gm(t+n,e+r),gm(t,e+r),mm(t,e)):(lm(t+n,e+r),cm(t,e))},quadraticCurveTo(t,e,n,r){const i=dm(t,e),o=pm(t,e),a=dm(n,r),s=pm(n,r);_m(nm,i,a,fm),_m(rm,o,s,hm),cm(a,s)},bezierCurveTo(t,e,n,r,i,o){const a=dm(t,e),s=pm(t,e),u=dm(n,r),l=pm(n,r),c=dm(i,o),f=pm(i,o);xm(nm,a,u,c,fm),xm(rm,s,l,f,hm),cm(c,f)},arc(t,e,n,r,i,o){if(r+=im,i+=im,nm=n*Math.cos(i)+t,rm=n*Math.sin(i)+e,Math.abs(i-r)>tm)lm(t-n,e-n),lm(t+n,e+n);else{const a=r=>lm(n*Math.cos(r)+t,n*Math.sin(r)+e);let s,u;if(a(r),a(i),i!==r)if((r%=ug)<0&&(r+=ug),(i%=ug)<0&&(i+=ug),i<r&&(o=!o,s=r,r=i,i=s),o)for(i-=ug,s=r-r%sg,u=0;u<4&&s>i;++u,s-=sg)a(s);else for(s=r-r%sg+sg,u=0;u<4&&s<i;++u,s+=sg)a(s)}}};function _m(t,e,n,r){const i=(t-e)/(t+n-2*e);0<i&&i<1&&r(t+(e-t)*i)}function xm(t,e,n,r,i){const o=r-t+3*e-3*n,a=t+n-2*e,s=t-e;let u,l=0,c=0;Math.abs(o)>1e-14?(u=a*a+s*o,u>=0&&(u=Math.sqrt(u),l=(-a+u)/o,c=(-a-u)/o)):l=.5*s/a,0<l&&l<1&&i(bm(l,t,e,n,r)),0<c&&c<1&&i(bm(c,t,e,n,r))}function bm(t,e,n,r,i){const o=1-t,a=o*o,s=t*t;return a*o*e+3*a*t*n+3*o*s*r+s*t*i}var wm=(wm=Sc(1,1))?wm.getContext("2d"):null;const km=new Gg;function Am(t){return function(e,n){if(!wm)return!0;t(wm,e),km.clear().union(e.bounds).intersect(n).round();const{x1:r,y1:i,x2:o,y2:a}=km;for(let t=i;t<=a;++t)for(let e=r;e<=o;++e)if(wm.isPointInPath(e,t))return!0;return!1}}function Mm(t,e){return e.contains(t.x||0,t.y||0)}function Em(t,e){const n=t.x||0,r=t.y||0,i=t.width||0,o=t.height||0;return e.intersects(km.set(n,r,n+i,r+o))}function Dm(t,e){const n=t.x||0,r=t.y||0;return Cm(e,n,r,null!=t.x2?t.x2:n,null!=t.y2?t.y2:r)}function Cm(t,e,n,r,i){const{x1:o,y1:a,x2:s,y2:u}=t,l=r-e,c=i-n;let f,h,d,p,g=0,m=1;for(p=0;p<4;++p){if(0===p&&(f=-l,h=-(o-e)),1===p&&(f=l,h=s-e),2===p&&(f=-c,h=-(a-n)),3===p&&(f=c,h=u-n),Math.abs(f)<1e-10&&h<0)return!1;if(d=h/f,f<0){if(d>m)return!1;d>g&&(g=d)}else if(f>0){if(d<g)return!1;d<m&&(m=d)}}return!0}function Fm(t,e){t.globalCompositeOperation=e.blend||"source-over"}function Sm(t,e){return null==t?e:t}function $m(t,e){const n=e.length;for(let r=0;r<n;++r)t.addColorStop(e[r].offset,e[r].color);return t}function Tm(t,e,n){return Vp(n)?function(t,e,n){const r=n.width(),i=n.height();let o;if("radial"===e.gradient)o=t.createRadialGradient(n.x1+Sm(e.x1,.5)*r,n.y1+Sm(e.y1,.5)*i,Math.max(r,i)*Sm(e.r1,0),n.x1+Sm(e.x2,.5)*r,n.y1+Sm(e.y2,.5)*i,Math.max(r,i)*Sm(e.r2,.5));else{const a=Sm(e.x1,0),s=Sm(e.y1,0),u=Sm(e.x2,1),l=Sm(e.y2,0);if(a!==u&&s!==l&&r!==i){const n=Sc(Math.ceil(r),Math.ceil(i)),o=n.getContext("2d");return o.scale(r,i),o.fillStyle=$m(o.createLinearGradient(a,s,u,l),e.stops),o.fillRect(0,0,r,i),t.createPattern(n,"no-repeat")}o=t.createLinearGradient(n.x1+a*r,n.y1+s*i,n.x1+u*r,n.y1+l*i)}return $m(o,e.stops)}(t,n,e.bounds):n}function Bm(t,e,n){return(n*=null==e.fillOpacity?1:e.fillOpacity)>0&&(t.globalAlpha=n,t.fillStyle=Tm(t,e,e.fill),!0)}var zm=[];function Nm(t,e,n){var r=null!=(r=e.strokeWidth)?r:1;return!(r<=0)&&((n*=null==e.strokeOpacity?1:e.strokeOpacity)>0&&(t.globalAlpha=n,t.strokeStyle=Tm(t,e,e.stroke),t.lineWidth=r,t.lineCap=e.strokeCap||"butt",t.lineJoin=e.strokeJoin||"miter",t.miterLimit=e.strokeMiterLimit||10,t.setLineDash&&(t.setLineDash(e.strokeDash||zm),t.lineDashOffset=e.strokeDashOffset||0),!0))}function Om(t,e){return t.zindex-e.zindex||t.index-e.index}function Rm(t){if(!t.zdirty)return t.zitems;var e,n,r,i=t.items,o=[];for(n=0,r=i.length;n<r;++n)(e=i[n]).index=n,e.zindex&&o.push(e);return t.zdirty=!1,t.zitems=o.sort(Om)}function Lm(t,e){var n,r,i=t.items;if(!i||!i.length)return;const o=Rm(t);if(o&&o.length){for(n=0,r=i.length;n<r;++n)i[n].zindex||e(i[n]);i=o}for(n=0,r=i.length;n<r;++n)e(i[n])}function Um(t,e){var n,r,i=t.items;if(!i||!i.length)return null;const o=Rm(t);for(o&&o.length&&(i=o),r=i.length;--r>=0;)if(n=e(i[r]))return n;if(i===o)for(r=(i=t.items).length;--r>=0;)if(!i[r].zindex&&(n=e(i[r])))return n;return null}function qm(t){return function(e,n,r){Lm(n,(n=>{r&&!r.intersects(n.bounds)||jm(t,e,n,n)}))}}function Pm(t){return function(e,n,r){!n.items.length||r&&!r.intersects(n.bounds)||jm(t,e,n.items[0],n.items)}}function jm(t,e,n,r){var i=null==n.opacity?1:n.opacity;0!==i&&(t(e,r)||(Fm(e,n),n.fill&&Bm(e,n,i)&&e.fill(),n.stroke&&Nm(e,n,i)&&e.stroke()))}function Im(t){return t=t||p,function(e,n,r,i,o,a){return r*=e.pixelRatio,i*=e.pixelRatio,Um(n,(n=>{const s=n.bounds;if((!s||s.contains(o,a))&&s)return t(e,n,r,i,o,a)?n:void 0}))}}function Wm(t,e){return function(n,r,i,o){var a,s,u=Array.isArray(r)?r[0]:r,l=null==e?u.fill:e,c=u.stroke&&n.isPointInStroke;return c&&(a=u.strokeWidth,s=u.strokeCap,n.lineWidth=null!=a?a:1,n.lineCap=null!=s?s:"butt"),!t(n,r)&&(l&&n.isPointInPath(i,o)||c&&n.isPointInStroke(i,o))}}function Hm(t){return Im(Wm(t))}function Ym(t,e){return"translate("+t+","+e+")"}function Gm(t){return"rotate("+t+")"}function Vm(t){return Ym(t.x||0,t.y||0)}function Xm(t,e,n){function r(t,n){var r=n.x||0,i=n.y||0,o=n.angle||0;t.translate(r,i),o&&t.rotate(o*=ag),t.beginPath(),e(t,n),o&&t.rotate(-o),t.translate(-r,-i)}return{type:t,tag:"path",nested:!1,attr:function(t,n){t("transform",function(t){return Ym(t.x||0,t.y||0)+(t.angle?" "+Gm(t.angle):"")}(n)),t("d",e(null,n))},bound:function(t,n){return e(ym(t,n.angle),n),Kg(t,n).translate(n.x||0,n.y||0)},draw:qm(r),pick:Hm(r),isect:n||Am(r)}}var Jm=Xm("arc",(function(t,e){return Ng.context(t)(e)}));function Zm(t,e,n){function r(t,n){t.beginPath(),e(t,n)}const i=Wm(r);return{type:t,tag:"path",nested:!0,attr:function(t,n){var r=n.mark.items;r.length&&t("d",e(null,r))},bound:function(t,n){var r=n.items;return 0===r.length?t:(e(ym(t),r),Kg(t,r[0]))},draw:Pm(r),pick:function(t,e,n,r,o,a){var s=e.items,u=e.bounds;return!s||!s.length||u&&!u.contains(o,a)?null:(n*=t.pixelRatio,r*=t.pixelRatio,i(t,s,n,r)?s[0]:null)},isect:Mm,tip:n}}var Qm=Zm("area",(function(t,e){const n=e[0],r=n.interpolate||"linear";return("horizontal"===n.orient?Rg:Og).curve(Kp(r,n.orient,n.tension)).context(t)(e)}),(function(t,e){for(var n,r,i="horizontal"===t[0].orient?e[1]:e[0],o="horizontal"===t[0].orient?"y":"x",a=t.length,s=1/0;--a>=0;)!1!==t[a].defined&&(r=Math.abs(t[a][o]-i))<s&&(s=r,n=t[a]);return n}));function Km(t,e){t.beginPath(),jg(e)?Ig(t,e,0,0):t.rect(0,0,e.width||0,e.height||0),t.clip()}function ty(t){const e=Sm(t.strokeWidth,1);return null!=t.strokeOffset?t.strokeOffset:t.stroke&&e>.5&&e<1.5?.5-Math.abs(e-1):0}function ey(t,e){const n=ty(e);t("d",Ig(null,e,n,n))}function ny(t,e,n,r){const i=ty(e);t.beginPath(),Ig(t,e,(n||0)+i,(r||0)+i)}const ry=Wm(ny),iy=Wm(ny,!1),oy=Wm(ny,!0);var ay={type:"group",tag:"g",nested:!1,attr:function(t,e){t("transform",Vm(e))},bound:function(t,e){if(!e.clip&&e.items){const n=e.items,r=n.length;for(let e=0;e<r;++e)t.union(n[e].bounds)}return(e.clip||e.width||e.height)&&!e.noBound&&t.add(0,0).add(e.width||0,e.height||0),Kg(t,e),t.translate(e.x||0,e.y||0)},draw:function(t,e,n,r){Lm(e,(e=>{const i=e.x||0,o=e.y||0,a=e.strokeForeground,s=null==e.opacity?1:e.opacity;(e.stroke||e.fill)&&s&&(ny(t,e,i,o),Fm(t,e),e.fill&&Bm(t,e,s)&&t.fill(),e.stroke&&!a&&Nm(t,e,s)&&t.stroke()),t.save(),t.translate(i,o),e.clip&&Km(t,e),n&&n.translate(-i,-o),Lm(e,(e=>{("group"===e.marktype||null==r||r.includes(e.marktype))&&this.draw(t,e,n,r)})),n&&n.translate(i,o),t.restore(),a&&e.stroke&&s&&(ny(t,e,i,o),Fm(t,e),Nm(t,e,s)&&t.stroke())}))},pick:function(t,e,n,r,i,o){if(e.bounds&&!e.bounds.contains(i,o)||!e.items)return null;const a=n*t.pixelRatio,s=r*t.pixelRatio;return Um(e,(u=>{let l,c,f;const h=u.bounds;if(h&&!h.contains(i,o))return;c=u.x||0,f=u.y||0;const d=c+(u.width||0),p=f+(u.height||0),g=u.clip;if(g&&(i<c||i>d||o<f||o>p))return;if(t.save(),t.translate(c,f),c=i-c,f=o-f,g&&jg(u)&&!oy(t,u,a,s))return t.restore(),null;const m=u.strokeForeground,y=!1!==e.interactive;return y&&m&&u.stroke&&iy(t,u,a,s)?(t.restore(),u):(l=Um(u,(t=>function(t,e,n){return(!1!==t.interactive||"group"===t.marktype)&&t.bounds&&t.bounds.contains(e,n)}(t,c,f)?this.pick(t,n,r,c,f):null)),!l&&y&&(u.fill||!m&&u.stroke)&&ry(t,u,a,s)&&(l=u),t.restore(),l||null)}))},isect:Em,content:function(t,e,n){t("clip-path",e.clip?Yg(n,e,e):null)},background:function(t,e){t("class","background"),t("aria-hidden",!0),ey(t,e)},foreground:function(t,e){t("class","foreground"),t("aria-hidden",!0),e.strokeForeground?ey(t,e):t("d","")}},sy={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function uy(t,e){var n=t.image;return(!n||t.url&&t.url!==n.url)&&(n={complete:!1,width:0,height:0},e.loadImage(t.url).then((e=>{t.image=e,t.image.url=t.url}))),n}function ly(t,e){return null!=t.width?t.width:e&&e.width?!1!==t.aspect&&t.height?t.height*e.width/e.height:e.width:0}function cy(t,e){return null!=t.height?t.height:e&&e.height?!1!==t.aspect&&t.width?t.width*e.height/e.width:e.height:0}function fy(t,e){return"center"===t?e/2:"right"===t?e:0}function hy(t,e){return"middle"===t?e/2:"bottom"===t?e:0}var dy={type:"image",tag:"image",nested:!1,attr:function(t,e,n){const r=uy(e,n),i=ly(e,r),o=cy(e,r),a=(e.x||0)-fy(e.align,i),s=(e.y||0)-hy(e.baseline,o);t("href",!r.src&&r.toDataURL?r.toDataURL():r.src||"",sy["xmlns:xlink"],"xlink:href"),t("transform",Ym(a,s)),t("width",i),t("height",o),t("preserveAspectRatio",!1===e.aspect?"none":"xMidYMid")},bound:function(t,e){const n=e.image,r=ly(e,n),i=cy(e,n),o=(e.x||0)-fy(e.align,r),a=(e.y||0)-hy(e.baseline,i);return t.set(o,a,o+r,a+i)},draw:function(t,e,n){Lm(e,(e=>{if(n&&!n.intersects(e.bounds))return;const r=uy(e,this);let i=ly(e,r),o=cy(e,r);if(0===i||0===o)return;let a,s,u,l,c=(e.x||0)-fy(e.align,i),f=(e.y||0)-hy(e.baseline,o);!1!==e.aspect&&(s=r.width/r.height,u=e.width/e.height,s==s&&u==u&&s!==u&&(u<s?(l=i/s,f+=(o-l)/2,o=l):(l=o*s,c+=(i-l)/2,i=l))),(r.complete||r.toDataURL)&&(Fm(t,e),t.globalAlpha=null!=(a=e.opacity)?a:1,t.imageSmoothingEnabled=!1!==e.smooth,t.drawImage(r,c,f,i,o))}))},pick:Im(),isect:p,get:uy,xOffset:fy,yOffset:hy},py=Zm("line",(function(t,e){const n=e[0],r=n.interpolate||"linear";return Lg.curve(Kp(r,n.orient,n.tension)).context(t)(e)}),(function(t,e){for(var n,r,i=Math.pow(t[0].strokeWidth||1,2),o=t.length;--o>=0;)if(!1!==t[o].defined&&(n=t[o].x-e[0])*n+(r=t[o].y-e[1])*r<i)return t[o];return null}));function gy(t,e){var n=e.path;if(null==n)return!0;var r=e.x||0,i=e.y||0,o=e.scaleX||1,a=e.scaleY||1,s=(e.angle||0)*ag,u=e.pathCache;u&&u.path===n||((e.pathCache=u=og(n)).path=n),s&&t.rotate&&t.translate?(t.translate(r,i),t.rotate(s),mg(t,u,0,0,o,a),t.rotate(-s),t.translate(-r,-i)):mg(t,u,r,i,o,a)}var my={type:"path",tag:"path",nested:!1,attr:function(t,e){var n=e.scaleX||1,r=e.scaleY||1;1===n&&1===r||t("vector-effect","non-scaling-stroke"),t("transform",function(t){return Ym(t.x||0,t.y||0)+(t.angle?" "+Gm(t.angle):"")+(t.scaleX||t.scaleY?" "+function(t,e){return"scale("+t+","+e+")"}(t.scaleX||1,t.scaleY||1):"")}(e)),t("d",e.path)},bound:function(t,e){return gy(ym(t,e.angle),e)?t.set(0,0,0,0):Kg(t,e,!0)},draw:qm(gy),pick:Hm(gy),isect:Am(gy)};function yy(t,e){t.beginPath(),Ig(t,e)}var vy={type:"rect",tag:"path",nested:!1,attr:function(t,e){t("d",Ig(null,e))},bound:function(t,e){var n,r;return Kg(t.set(n=e.x||0,r=e.y||0,n+e.width||0,r+e.height||0),e)},draw:qm(yy),pick:Hm(yy),isect:Em};function _y(t,e,n){var r,i,o,a;return!(!e.stroke||!Nm(t,e,n))&&(r=e.x||0,i=e.y||0,o=null!=e.x2?e.x2:r,a=null!=e.y2?e.y2:i,t.beginPath(),t.moveTo(r,i),t.lineTo(o,a),!0)}var xy={type:"rule",tag:"line",nested:!1,attr:function(t,e){t("transform",Vm(e)),t("x2",null!=e.x2?e.x2-(e.x||0):0),t("y2",null!=e.y2?e.y2-(e.y||0):0)},bound:function(t,e){var n,r;return Kg(t.set(n=e.x||0,r=e.y||0,null!=e.x2?e.x2:n,null!=e.y2?e.y2:r),e)},draw:function(t,e,n){Lm(e,(e=>{if(!n||n.intersects(e.bounds)){var r=null==e.opacity?1:e.opacity;r&&_y(t,e,r)&&(Fm(t,e),t.stroke())}}))},pick:Im((function(t,e,n,r){return!!t.isPointInStroke&&(_y(t,e,1)&&t.isPointInStroke(n,r))})),isect:Dm},by=Xm("shape",(function(t,e){return(e.mark.shape||e.shape).context(t)(e)})),wy=Xm("symbol",(function(t,e){return qg.context(t)(e)}),Mm);const ky=wt();var Ay={height:Sy,measureWidth:Cy,estimateWidth:Ey,width:Ey,canvas:My};function My(t){Ay.width=t&&wm?Cy:Ey}function Ey(t,e){return Dy(zy(t,e),Sy(t))}function Dy(t,e){return~~(.8*t.length*e)}function Cy(t,e){return Sy(t)<=0||!(e=zy(t,e))?0:Fy(e,Oy(t))}function Fy(t,e){const n=`(${e}) ${t}`;let r=ky.get(n);return void 0===r&&(wm.font=e,r=wm.measureText(t).width,ky.set(n,r)),r}function Sy(t){return null!=t.fontSize?+t.fontSize||0:11}function $y(t){return null!=t.lineHeight?t.lineHeight:Sy(t)+2}function Ty(t){return e=t.lineBreak&&t.text&&!k(t.text)?t.text.split(t.lineBreak):t.text,k(e)?e.length>1?e:e[0]:e;var e}function By(t){const e=Ty(t);return(k(e)?e.length-1:0)*$y(t)}function zy(t,e){const n=null==e?"":(e+"").trim();return t.limit>0&&n.length?function(t,e){var n=+t.limit,r=function(t){if(Ay.width===Cy){const e=Oy(t);return t=>Fy(t,e)}if(Ay.width===Ey){const e=Sy(t);return t=>Dy(t,e)}return e=>Ay.width(t,e)}(t);if(r(e)<n)return e;var i,o=t.ellipsis||"â€¦",a="rtl"===t.dir,s=0,u=e.length;if(n-=r(o),a){for(;s<u;)i=s+u>>>1,r(e.slice(i))>n?s=i+1:u=i;return o+e.slice(s)}for(;s<u;)i=1+(s+u>>>1),r(e.slice(0,i))<n?s=i:u=i-1;return e.slice(0,s)+o}(t,n):n}function Ny(t,e){var n=t.font;return(e&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function Oy(t,e){return(t.fontStyle?t.fontStyle+" ":"")+(t.fontVariant?t.fontVariant+" ":"")+(t.fontWeight?t.fontWeight+" ":"")+Sy(t)+"px "+Ny(t,e)}function Ry(t){var e=t.baseline,n=Sy(t);return Math.round("top"===e?.79*n:"middle"===e?.3*n:"bottom"===e?-.21*n:"line-top"===e?.29*n+.5*$y(t):"line-bottom"===e?.29*n-.5*$y(t):0)}My(!0);const Ly={left:"start",center:"middle",right:"end"},Uy=new Gg;function qy(t){var e,n=t.x||0,r=t.y||0,i=t.radius||0;return i&&(e=(t.theta||0)-sg,n+=i*Math.cos(e),r+=i*Math.sin(e)),Uy.x1=n,Uy.y1=r,Uy}function Py(t,e,n){var r,i=Ay.height(e),o=e.align,a=qy(e),s=a.x1,u=a.y1,l=e.dx||0,c=(e.dy||0)+Ry(e)-Math.round(.8*i),f=Ty(e);if(k(f)?(i+=$y(e)*(f.length-1),r=f.reduce(((t,n)=>Math.max(t,Ay.width(e,n))),0)):r=Ay.width(e,f),"center"===o?l-=r/2:"right"===o&&(l-=r),t.set(l+=s,c+=u,l+r,c+i),e.angle&&!n)t.rotate(e.angle*ag,s,u);else if(2===n)return t.rotatedPoints(e.angle*ag,s,u);return t}var jy={type:"text",tag:"text",nested:!1,attr:function(t,e){var n,r=e.dx||0,i=(e.dy||0)+Ry(e),o=qy(e),a=o.x1,s=o.y1,u=e.angle||0;t("text-anchor",Ly[e.align]||"start"),u?(n=Ym(a,s)+" "+Gm(u),(r||i)&&(n+=" "+Ym(r,i))):n=Ym(a+r,s+i),t("transform",n)},bound:Py,draw:function(t,e,n){Lm(e,(e=>{var r,i,o,a,s,u,l,c=null==e.opacity?1:e.opacity;if(!(n&&!n.intersects(e.bounds)||0===c||e.fontSize<=0||null==e.text||0===e.text.length)){if(t.font=Oy(e),t.textAlign=e.align||"left",i=(r=qy(e)).x1,o=r.y1,e.angle&&(t.save(),t.translate(i,o),t.rotate(e.angle*ag),i=o=0),i+=e.dx||0,o+=(e.dy||0)+Ry(e),u=Ty(e),Fm(t,e),k(u))for(s=$y(e),a=0;a<u.length;++a)l=zy(e,u[a]),e.fill&&Bm(t,e,c)&&t.fillText(l,i,o),e.stroke&&Nm(t,e,c)&&t.strokeText(l,i,o),o+=s;else l=zy(e,u),e.fill&&Bm(t,e,c)&&t.fillText(l,i,o),e.stroke&&Nm(t,e,c)&&t.strokeText(l,i,o);e.angle&&t.restore()}}))},pick:Im((function(t,e,n,r,i,o){if(e.fontSize<=0)return!1;if(!e.angle)return!0;var a=qy(e),s=a.x1,u=a.y1,l=Py(Uy,e,1),c=-e.angle*ag,f=Math.cos(c),h=Math.sin(c),d=f*i-h*o+(s-f*s+h*u),p=h*i+f*o+(u-h*s-f*u);return l.contains(d,p)})),isect:function(t,e){const n=Py(Uy,t,2);return Cm(e,n[0],n[1],n[2],n[3])||Cm(e,n[0],n[1],n[4],n[5])||Cm(e,n[4],n[5],n[6],n[7])||Cm(e,n[2],n[3],n[6],n[7])}},Iy=Zm("trail",(function(t,e){return Pg.context(t)(e)}),(function(t,e){for(var n,r,i=t.length;--i>=0;)if(!1!==t[i].defined&&(n=t[i].x-e[0])*n+(r=t[i].y-e[1])*r<(n=t[i].size||1)*n)return t[i];return null})),Wy={arc:Jm,area:Qm,group:ay,image:dy,line:py,path:my,rect:vy,rule:xy,shape:by,symbol:wy,text:jy,trail:Iy};function Hy(t,e,n){var r=Wy[t.mark.marktype],i=e||r.bound;return r.nested&&(t=t.mark),i(t.bounds||(t.bounds=new Gg),t,n)}var Yy={mark:null};function Gy(t,e,n){var r,i,o,a,s=Wy[t.marktype],u=s.bound,l=t.items,c=l&&l.length;if(s.nested)return c?o=l[0]:(Yy.mark=t,o=Yy),a=Hy(o,u,n),e=e&&e.union(a)||a;if(e=e||t.bounds&&t.bounds.clear()||new Gg,c)for(r=0,i=l.length;r<i;++r)e.union(Hy(l[r],u,n));return t.bounds=e}const Vy=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function Xy(t,e){return JSON.stringify(t,Vy,e)}function Jy(t){return Zy("string"==typeof t?JSON.parse(t):t)}function Zy(t){var e,n,r,i=t.marktype,o=t.items;if(o)for(n=0,r=o.length;n<r;++n)e=i?"mark":"group",o[n][e]=t,o[n].zindex&&(o[n][e].zdirty=!0),"group"===(i||e)&&Zy(o[n]);return i&&Gy(t),t}class Qy{constructor(t){arguments.length?this.root=Jy(t):(this.root=Ky({marktype:"group",name:"root",role:"frame"}),this.root.items=[new Xg(this.root)])}toJSON(t){return Xy(this.root,t||0)}mark(t,e,n){const r=Ky(t,e=e||this.root.items[0]);return e.items[n]=r,r.zindex&&(r.group.zdirty=!0),r}}function Ky(t,e){const n={bounds:new Gg,clip:!!t.clip,group:e,interactive:!1!==t.interactive,items:[],marktype:t.marktype,name:t.name||void 0,role:t.role||void 0,zindex:t.zindex||0};return null!=t.aria&&(n.aria=t.aria),t.description&&(n.description=t.description),n}function tv(t,e,n){return!t&&"undefined"!=typeof document&&document.createElement&&(t=document),t?n?t.createElementNS(n,e):t.createElement(e):null}function ev(t,e){e=e.toLowerCase();for(var n=t.childNodes,r=0,i=n.length;r<i;++r)if(n[r].tagName.toLowerCase()===e)return n[r]}function nv(t,e,n,r){var i,o=t.childNodes[e];return o&&o.tagName.toLowerCase()===n.toLowerCase()||(i=o||null,o=tv(t.ownerDocument,n,r),t.insertBefore(o,i)),o}function rv(t,e){for(var n=t.childNodes,r=n.length;r>e;)t.removeChild(n[--r]);return t}function iv(t){return"mark-"+t.marktype+(t.role?" role-"+t.role:"")+(t.name?" "+t.name:"")}function ov(t,e){const n=e.getBoundingClientRect();return[t.clientX-n.left-(e.clientLeft||0),t.clientY-n.top-(e.clientTop||0)]}class av{constructor(t,e){this._active=null,this._handlers={},this._loader=t||ca(),this._tooltip=e||sv}initialize(t,e,n){return this._el=t,this._obj=n||null,this.origin(e)}element(){return this._el}canvas(){return this._el&&this._el.firstChild}origin(t){return arguments.length?(this._origin=t||[0,0],this):this._origin.slice()}scene(t){return arguments.length?(this._scene=t,this):this._scene}on(){}off(){}_handlerIndex(t,e,n){for(let r=t?t.length:0;--r>=0;)if(t[r].type===e&&(!n||t[r].handler===n))return r;return-1}handlers(t){const e=this._handlers,n=[];if(t)n.push(...e[this.eventName(t)]);else for(const t in e)n.push(...e[t]);return n}eventName(t){const e=t.indexOf(".");return e<0?t:t.slice(0,e)}handleHref(t,e,n){this._loader.sanitize(n,{context:"href"}).then((e=>{const n=new MouseEvent(t.type,t),r=tv(null,"a");for(const t in e)r.setAttribute(t,e[t]);r.dispatchEvent(n)})).catch((()=>{}))}handleTooltip(t,e,n){if(e&&null!=e.tooltip){e=function(t,e,n,r){var i,o,a=t&&t.mark;if(a&&(i=Wy[a.marktype]).tip){for((o=ov(e,n))[0]-=r[0],o[1]-=r[1];t=t.mark.group;)o[0]-=t.x||0,o[1]-=t.y||0;t=i.tip(a.items,o)}return t}(e,t,this.canvas(),this._origin);const r=n&&e&&e.tooltip||null;this._tooltip.call(this._obj,this,t,e,r)}}getItemBoundingClientRect(t){const e=this.canvas();if(!e)return;const n=e.getBoundingClientRect(),r=this._origin,i=t.bounds,o=i.width(),a=i.height();let s=i.x1+r[0]+n.left,u=i.y1+r[1]+n.top;for(;t.mark&&(t=t.mark.group);)s+=t.x||0,u+=t.y||0;return{x:s,y:u,width:o,height:a,left:s,top:u,right:s+o,bottom:u+a}}}function sv(t,e,n,r){t.element().setAttribute("title",r||"")}class uv{constructor(t){this._el=null,this._bgcolor=null,this._loader=new Jg(t)}initialize(t,e,n,r,i){return this._el=t,this.resize(e,n,r,i)}element(){return this._el}canvas(){return this._el&&this._el.firstChild}background(t){return 0===arguments.length?this._bgcolor:(this._bgcolor=t,this)}resize(t,e,n,r){return this._width=t,this._height=e,this._origin=n||[0,0],this._scale=r||1,this}dirty(){}render(t,e){const n=this;return n._call=function(){n._render(t,e)},n._call(),n._call=null,n}_render(){}renderAsync(t,e){const n=this.render(t,e);return this._ready?this._ready.then((()=>n)):Promise.resolve(n)}_load(t,e){var n=this,r=n._loader[t](e);if(!n._ready){const t=n._call;n._ready=n._loader.ready().then((e=>{e&&t(),n._ready=null}))}return r}sanitizeURL(t){return this._load("sanitizeURL",t)}loadImage(t){return this._load("loadImage",t)}}const lv="dragenter",cv="dragleave",fv="dragover",hv="pointerdown",dv="pointermove",pv="pointerout",gv="pointerover",mv="mousedown",yv="mousemove",vv="mouseout",_v="mouseover",xv="click",bv="mousewheel",wv="touchstart",kv="touchmove",Av="touchend",Mv=["keydown","keypress","keyup",lv,cv,fv,hv,"pointerup",dv,pv,gv,mv,"mouseup",yv,vv,_v,xv,"dblclick","wheel",bv,wv,kv,Av],Ev=dv,Dv=vv,Cv=xv;class Fv extends av{constructor(t,e){super(t,e),this._down=null,this._touch=null,this._first=!0,this._events={},this.events=Mv,this.pointermove=Bv([dv,yv],[gv,_v],[pv,vv]),this.dragover=Bv([fv],[lv],[cv]),this.pointerout=zv([pv,vv]),this.dragleave=zv([cv])}initialize(t,e,n){return this._canvas=t&&ev(t,"canvas"),[xv,mv,hv,dv,pv,cv].forEach((t=>$v(this,t))),super.initialize(t,e,n)}canvas(){return this._canvas}context(){return this._canvas.getContext("2d")}DOMMouseScroll(t){this.fire(bv,t)}pointerdown(t){this._down=this._active,this.fire(hv,t)}mousedown(t){this._down=this._active,this.fire(mv,t)}click(t){this._down===this._active&&(this.fire(xv,t),this._down=null)}touchstart(t){this._touch=this.pickEvent(t.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire(wv,t,!0)}touchmove(t){this.fire(kv,t,!0)}touchend(t){this.fire(Av,t,!0),this._touch=null}fire(t,e,n){const r=n?this._touch:this._active,i=this._handlers[t];if(e.vegaType=t,t===Cv&&r&&r.href?this.handleHref(e,r,r.href):t!==Ev&&t!==Dv||this.handleTooltip(e,r,t!==Dv),i)for(let t=0,n=i.length;t<n;++t)i[t].handler.call(this._obj,e,r)}on(t,e){const n=this.eventName(t),r=this._handlers;return this._handlerIndex(r[n],t,e)<0&&($v(this,t),(r[n]||(r[n]=[])).push({type:t,handler:e})),this}off(t,e){const n=this.eventName(t),r=this._handlers[n],i=this._handlerIndex(r,t,e);return i>=0&&r.splice(i,1),this}pickEvent(t){const e=ov(t,this._canvas),n=this._origin;return this.pick(this._scene,e[0],e[1],e[0]-n[0],e[1]-n[1])}pick(t,e,n,r,i){const o=this.context();return Wy[t.marktype].pick.call(this,o,t,e,n,r,i)}}const Sv=t=>t===wv||t===kv||t===Av?[wv,kv,Av]:[t];function $v(t,e){Sv(e).forEach((e=>function(t,e){const n=t.canvas();n&&!t._events[e]&&(t._events[e]=1,n.addEventListener(e,t[e]?n=>t[e](n):n=>t.fire(e,n)))}(t,e)))}function Tv(t,e,n){e.forEach((e=>t.fire(e,n)))}function Bv(t,e,n){return function(r){const i=this._active,o=this.pickEvent(r);o===i||(i&&i.exit||Tv(this,n,r),this._active=o,Tv(this,e,r)),Tv(this,t,r)}}function zv(t){return function(e){Tv(this,t,e),this._active=null}}function Nv(t,e,n,r,i,o){const a="undefined"!=typeof HTMLElement&&t instanceof HTMLElement&&null!=t.parentNode,s=t.getContext("2d"),u=a?"undefined"!=typeof window&&window.devicePixelRatio||1:i;t.width=e*u,t.height=n*u;for(const t in o)s[t]=o[t];return a&&1!==u&&(t.style.width=e+"px",t.style.height=n+"px"),s.pixelRatio=u,s.setTransform(u,0,0,u,u*r[0],u*r[1]),t}class Ov extends uv{constructor(t){super(t),this._options={},this._redraw=!1,this._dirty=new Gg,this._tempb=new Gg}initialize(t,e,n,r,i,o){return this._options=o||{},this._canvas=this._options.externalContext?null:Sc(1,1,this._options.type),t&&this._canvas&&(rv(t,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),super.initialize(t,e,n,r,i)}resize(t,e,n,r){if(super.resize(t,e,n,r),this._canvas)Nv(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const t=this._options.externalContext;t||s("CanvasRenderer is missing a valid canvas or context"),t.scale(this._scale,this._scale),t.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this}canvas(){return this._canvas}context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)}dirty(t){const e=this._tempb.clear().union(t.bounds);let n=t.mark.group;for(;n;)e.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(e)}_render(t,e){const n=this.context(),r=this._origin,i=this._width,o=this._height,a=this._dirty,s=Rv(r,i,o);n.save();const u=this._redraw||a.empty()?(this._redraw=!1,s.expand(1)):function(t,e,n){e.expand(1).round(),t.pixelRatio%1&&e.scale(t.pixelRatio).round().scale(1/t.pixelRatio);return e.translate(-n[0]%1,-n[1]%1),t.beginPath(),t.rect(e.x1,e.y1,e.width(),e.height()),t.clip(),e}(n,s.intersect(a),r);return this.clear(-r[0],-r[1],i,o),this.draw(n,t,u,e),n.restore(),a.clear(),this}draw(t,e,n,r){if("group"!==e.marktype&&null!=r&&!r.includes(e.marktype))return;const i=Wy[e.marktype];e.clip&&function(t,e){var n=e.clip;t.save(),J(n)?(t.beginPath(),n(t),t.clip()):Km(t,e.group)}(t,e),i.draw.call(this,t,e,n,r),e.clip&&t.restore()}clear(t,e,n,r){const i=this._options,o=this.context();"pdf"===i.type||i.externalContext||o.clearRect(t,e,n,r),null!=this._bgcolor&&(o.fillStyle=this._bgcolor,o.fillRect(t,e,n,r))}}const Rv=(t,e,n)=>(new Gg).set(0,0,e,n).translate(-t[0],-t[1]);class Lv extends av{constructor(t,e){super(t,e);const n=this;n._hrefHandler=Uv(n,((t,e)=>{e&&e.href&&n.handleHref(t,e,e.href)})),n._tooltipHandler=Uv(n,((t,e)=>{n.handleTooltip(t,e,t.type!==Dv)}))}initialize(t,e,n){let r=this._svg;return r&&(r.removeEventListener(Cv,this._hrefHandler),r.removeEventListener(Ev,this._tooltipHandler),r.removeEventListener(Dv,this._tooltipHandler)),this._svg=r=t&&ev(t,"svg"),r&&(r.addEventListener(Cv,this._hrefHandler),r.addEventListener(Ev,this._tooltipHandler),r.addEventListener(Dv,this._tooltipHandler)),super.initialize(t,e,n)}canvas(){return this._svg}on(t,e){const n=this.eventName(t),r=this._handlers;if(this._handlerIndex(r[n],t,e)<0){const i={type:t,handler:e,listener:Uv(this,e)};(r[n]||(r[n]=[])).push(i),this._svg&&this._svg.addEventListener(n,i.listener)}return this}off(t,e){const n=this.eventName(t),r=this._handlers[n],i=this._handlerIndex(r,t,e);return i>=0&&(this._svg&&this._svg.removeEventListener(n,r[i].listener),r.splice(i,1)),this}}const Uv=(t,e)=>n=>{let r=n.target.__data__;r=Array.isArray(r)?r[0]:r,n.vegaType=n.type,e.call(t._obj,n,r)},qv="aria-hidden",Pv="aria-label",jv="role",Iv="aria-roledescription",Wv="graphics-object",Hv="graphics-symbol",Yv=(t,e,n)=>({[jv]:t,[Iv]:e,[Pv]:n||void 0}),Gv=Tt(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),Vv={axis:{desc:"axis",caption:function(t){const e=t.datum,n=t.orient,r=e.title?Kv(t):null,i=t.context,o=i.scales[e.scale].value,a=i.dataflow.locale(),s=o.type;return("left"===n||"right"===n?"Y":"X")+"-axis"+(r?` titled '${r}'`:"")+` for a ${lp(s)?"discrete":s} scale`+` with ${Hp(a,o,t)}`}},legend:{desc:"legend",caption:function(t){const e=t.datum,n=e.title?Kv(t):null,r=`${e.type||""} legend`.trim(),i=e.scales,o=Object.keys(i),a=t.context,s=a.scales[i[o[0]]].value,u=a.dataflow.locale();return l=r,(l.length?l[0].toUpperCase()+l.slice(1):l)+(n?` titled '${n}'`:"")+` for ${function(t){return t=t.map((t=>t+("fill"===t||"stroke"===t?" color":""))),t.length<2?t[0]:t.slice(0,-1).join(", ")+" and "+F(t)}(o)}`+` with ${Hp(u,s,t)}`;var l}},"title-text":{desc:"title",caption:t=>`Title text '${Qv(t)}'`},"title-subtitle":{desc:"subtitle",caption:t=>`Subtitle text '${Qv(t)}'`}},Xv={ariaRole:jv,ariaRoleDescription:Iv,description:Pv};function Jv(t,e){const n=!1===e.aria;if(t(qv,n||void 0),n||null==e.description)for(const e in Xv)t(Xv[e],void 0);else{const n=e.mark.marktype;t(Pv,e.description),t(jv,e.ariaRole||("group"===n?Wv:Hv)),t(Iv,e.ariaRoleDescription||`${n} mark`)}}function Zv(t){return!1===t.aria?{[qv]:!0}:Gv[t.role]?null:Vv[t.role]?function(t,e){try{const n=t.items[0],r=e.caption||(()=>"");return Yv(e.role||Hv,e.desc,n.description||r(n))}catch(t){return null}}(t,Vv[t.role]):function(t){const e=t.marktype,n="group"===e||"text"===e||t.items.some((t=>null!=t.description&&!1!==t.aria));return Yv(n?Wv:Hv,`${e} mark container`,t.description)}(t)}function Qv(t){return V(t.text).join(" ")}function Kv(t){try{return V(F(t.items).items[0].text).join(" ")}catch(t){return null}}const t_=t=>(t+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");function e_(){let t="",e="",n="";const r=[],i=()=>e=n="",o=(t,n)=>{var r;return null!=n&&(e+=` ${t}="${r=n,t_(r).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;")}"`),a},a={open(s){(o=>{e&&(t+=`${e}>${n}`,i()),r.push(o)})(s),e="<"+s;for(var u=arguments.length,l=new Array(u>1?u-1:0),c=1;c<u;c++)l[c-1]=arguments[c];for(const t of l)for(const e in t)o(e,t[e]);return a},close(){const o=r.pop();return t+=e?e+(n?`>${n}</${o}>`:"/>"):`</${o}>`,i(),a},attr:o,text:t=>(n+=t_(t),a),toString:()=>t};return a}const n_=t=>r_(e_(),t)+"";function r_(t,e){if(t.open(e.tagName),e.hasAttributes()){const n=e.attributes,r=n.length;for(let e=0;e<r;++e)t.attr(n[e].name,n[e].value)}if(e.hasChildNodes()){const n=e.childNodes;for(const e of n)3===e.nodeType?t.text(e.nodeValue):r_(t,e)}return t.close()}const i_={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity"},o_={blend:"mix-blend-mode"},a_={fill:"none","stroke-miterlimit":10},s_="http://www.w3.org/2000/xmlns/",u_=sy.xmlns;class l_ extends uv{constructor(t){super(t),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}initialize(t,e,n,r,i){return this._defs={},this._clearDefs(),t&&(this._svg=nv(t,0,"svg",u_),this._svg.setAttributeNS(s_,"xmlns",u_),this._svg.setAttributeNS(s_,"xmlns:xlink",sy["xmlns:xlink"]),this._svg.setAttribute("version",sy.version),this._svg.setAttribute("class","marks"),rv(t,1),this._root=nv(this._svg,0,"g",u_),__(this._root,a_),rv(this._svg,1)),this.background(this._bgcolor),super.initialize(t,e,n,r,i)}background(t){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",t),super.background(...arguments)}resize(t,e,n,r){return super.resize(t,e,n,r),this._svg&&(__(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}),this._root.setAttribute("transform",`translate(${this._origin})`)),this._dirty=[],this}canvas(){return this._svg}svg(){const t=this._svg,e=this._bgcolor;if(!t)return null;let n;e&&(t.removeAttribute("style"),n=nv(t,0,"rect",u_),__(n,{width:this._width,height:this._height,fill:e}));const r=n_(t);return e&&(t.removeChild(n),this._svg.style.setProperty("background-color",e)),r}_render(t,e){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,t,void 0,e),rv(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this}dirty(t){t.dirty!==this._dirtyID&&(t.dirty=this._dirtyID,this._dirty.push(t))}isDirty(t){return this._dirtyAll||!t._svg||!t._svg.ownerSVGElement||t.dirty===this._dirtyID}_dirtyCheck(){this._dirtyAll=!0;const t=this._dirty;if(!t.length||!this._dirtyID)return!0;const e=++this._dirtyID;let n,r,i,o,a,s,u;for(a=0,s=t.length;a<s;++a)n=t[a],r=n.mark,r.marktype!==i&&(i=r.marktype,o=Wy[i]),r.zdirty&&r.dirty!==e&&(this._dirtyAll=!1,c_(n,e),r.items.forEach((t=>{t.dirty=e}))),r.zdirty||(n.exit?(o.nested&&r.items.length?(u=r.items[0],u._svg&&this._update(o,u._svg,u)):n._svg&&(u=n._svg.parentNode,u&&u.removeChild(n._svg)),n._svg=null):(n=o.nested?r.items[0]:n,n._update!==e&&(n._svg&&n._svg.ownerSVGElement?this._update(o,n._svg,n):(this._dirtyAll=!1,c_(n,e)),n._update=e)));return!this._dirtyAll}mark(t,e,n,r){if(!this.isDirty(e))return e._svg;const i=this._svg,o=e.marktype,a=Wy[o],s=!1===e.interactive?"none":null,u="g"===a.tag,l=d_(e,t,n,"g",i);if("group"!==o&&null!=r&&!r.includes(o))return rv(l,0),e._svg;l.setAttribute("class",iv(e));const c=Zv(e);for(const t in c)x_(l,t,c[t]);u||x_(l,"pointer-events",s),x_(l,"clip-path",e.clip?Yg(this,e,e.group):null);let f=null,h=0;const d=t=>{const e=this.isDirty(t),n=d_(t,l,f,a.tag,i);e&&(this._update(a,n,t),u&&function(t,e,n,r){e=e.lastChild.previousSibling;let i,o=0;Lm(n,(n=>{i=t.mark(e,n,i,r),++o})),rv(e,1+o)}(this,n,t,r)),f=n,++h};return a.nested?e.items.length&&d(e.items[0]):Lm(e,d),rv(l,h),l}_update(t,e,n){p_=e,g_=e.__values__,Jv(y_,n),t.attr(y_,n,this);const r=m_[t.type];r&&r.call(this,t,e,n),p_&&this.style(p_,n)}style(t,e){if(null!=e){for(const n in i_){let r="font"===n?Ny(e):e[n];if(r===g_[n])continue;const i=i_[n];null==r?t.removeAttribute(i):(Vp(r)&&(r=Xp(r,this._defs.gradient,b_())),t.setAttribute(i,r+"")),g_[n]=r}for(const n in o_)v_(t,o_[n],e[n])}}defs(){const t=this._svg,e=this._defs;let n=e.el,r=0;for(const i in e.gradient)n||(e.el=n=nv(t,1,"defs",u_)),r=f_(n,e.gradient[i],r);for(const i in e.clipping)n||(e.el=n=nv(t,1,"defs",u_)),r=h_(n,e.clipping[i],r);n&&(0===r?(t.removeChild(n),e.el=null):rv(n,r))}_clearDefs(){const t=this._defs;t.gradient={},t.clipping={}}}function c_(t,e){for(;t&&t.dirty!==e;t=t.mark.group){if(t.dirty=e,!t.mark||t.mark.dirty===e)return;t.mark.dirty=e}}function f_(t,e,n){let r,i,o;if("radial"===e.gradient){let r=nv(t,n++,"pattern",u_);__(r,{id:Gp+e.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),r=nv(r,0,"rect",u_),__(r,{width:1,height:1,fill:`url(${b_()}#${e.id})`}),__(t=nv(t,n++,"radialGradient",u_),{id:e.id,fx:e.x1,fy:e.y1,fr:e.r1,cx:e.x2,cy:e.y2,r:e.r2})}else __(t=nv(t,n++,"linearGradient",u_),{id:e.id,x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2});for(r=0,i=e.stops.length;r<i;++r)o=nv(t,r,"stop",u_),o.setAttribute("offset",e.stops[r].offset),o.setAttribute("stop-color",e.stops[r].color);return rv(t,r),n}function h_(t,e,n){let r;return(t=nv(t,n,"clipPath",u_)).setAttribute("id",e.id),e.path?(r=nv(t,0,"path",u_),r.setAttribute("d",e.path)):(r=nv(t,0,"rect",u_),__(r,{x:0,y:0,width:e.width,height:e.height})),rv(t,1),n+1}function d_(t,e,n,r,i){let o,a=t._svg;if(!a&&(o=e.ownerDocument,a=tv(o,r,u_),t._svg=a,t.mark&&(a.__data__=t,a.__values__={fill:"default"},"g"===r))){const e=tv(o,"path",u_);a.appendChild(e),e.__data__=t;const n=tv(o,"g",u_);a.appendChild(n),n.__data__=t;const r=tv(o,"path",u_);a.appendChild(r),r.__data__=t,r.__values__={fill:"default"}}return(a.ownerSVGElement!==i||function(t,e){return t.parentNode&&t.parentNode.childNodes.length>1&&t.previousSibling!=e}(a,n))&&e.insertBefore(a,n?n.nextSibling:e.firstChild),a}let p_=null,g_=null;const m_={group(t,e,n){const r=p_=e.childNodes[2];g_=r.__values__,t.foreground(y_,n,this),g_=e.__values__,p_=e.childNodes[1],t.content(y_,n,this);const i=p_=e.childNodes[0];t.background(y_,n,this);const o=!1===n.mark.interactive?"none":null;if(o!==g_.events&&(x_(r,"pointer-events",o),x_(i,"pointer-events",o),g_.events=o),n.strokeForeground&&n.stroke){const t=n.fill;x_(r,"display",null),this.style(i,n),x_(i,"stroke",null),t&&(n.fill=null),g_=r.__values__,this.style(r,n),t&&(n.fill=t),p_=null}else x_(r,"display","none")},image(t,e,n){!1===n.smooth?(v_(e,"image-rendering","optimizeSpeed"),v_(e,"image-rendering","pixelated")):v_(e,"image-rendering",null)},text(t,e,n){const r=Ty(n);let i,o,a,s;k(r)?(o=r.map((t=>zy(n,t))),i=o.join("\n"),i!==g_.text&&(rv(e,0),a=e.ownerDocument,s=$y(n),o.forEach(((t,r)=>{const i=tv(a,"tspan",u_);i.__data__=n,i.textContent=t,r&&(i.setAttribute("x",0),i.setAttribute("dy",s)),e.appendChild(i)})),g_.text=i)):(o=zy(n,r),o!==g_.text&&(e.textContent=o,g_.text=o)),x_(e,"font-family",Ny(n)),x_(e,"font-size",Sy(n)+"px"),x_(e,"font-style",n.fontStyle),x_(e,"font-variant",n.fontVariant),x_(e,"font-weight",n.fontWeight)}};function y_(t,e,n){e!==g_[t]&&(n?function(t,e,n,r){null!=n?t.setAttributeNS(r,e,n):t.removeAttributeNS(r,e)}(p_,t,e,n):x_(p_,t,e),g_[t]=e)}function v_(t,e,n){n!==g_[e]&&(null==n?t.style.removeProperty(e):t.style.setProperty(e,n+""),g_[e]=n)}function __(t,e){for(const n in e)x_(t,n,e[n])}function x_(t,e,n){null!=n?t.setAttribute(e,n):t.removeAttribute(e)}function b_(){let t;return"undefined"==typeof window?"":(t=window.location).hash?t.href.slice(0,-t.hash.length):t.href}class w_ extends uv{constructor(t){super(t),this._text=null,this._defs={gradient:{},clipping:{}}}svg(){return this._text}_render(t){const e=e_();e.open("svg",ot({},sy,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}));const n=this._bgcolor;return n&&"transparent"!==n&&"none"!==n&&e.open("rect",{width:this._width,height:this._height,fill:n}).close(),e.open("g",a_,{transform:"translate("+this._origin+")"}),this.mark(e,t),e.close(),this.defs(e),this._text=e.close()+"",this}mark(t,e){const n=Wy[e.marktype],r=n.tag,i=[Jv,n.attr];t.open("g",{class:iv(e),"clip-path":e.clip?Yg(this,e,e.group):null},Zv(e),{"pointer-events":"g"!==r&&!1===e.interactive?"none":null});const o=o=>{const a=this.href(o);if(a&&t.open("a",a),t.open(r,this.attr(e,o,i,"g"!==r?r:null)),"text"===r){const e=Ty(o);if(k(e)){const n={x:0,dy:$y(o)};for(let r=0;r<e.length;++r)t.open("tspan",r?n:null).text(zy(o,e[r])).close()}else t.text(zy(o,e))}else if("g"===r){const r=o.strokeForeground,i=o.fill,a=o.stroke;r&&a&&(o.stroke=null),t.open("path",this.attr(e,o,n.background,"bgrect")).close(),t.open("g",this.attr(e,o,n.content)),Lm(o,(e=>this.mark(t,e))),t.close(),r&&a?(i&&(o.fill=null),o.stroke=a,t.open("path",this.attr(e,o,n.foreground,"bgrect")).close(),i&&(o.fill=i)):t.open("path",this.attr(e,o,n.foreground,"bgfore")).close()}t.close(),a&&t.close()};return n.nested?e.items&&e.items.length&&o(e.items[0]):Lm(e,o),t.close()}href(t){const e=t.href;let n;if(e){if(n=this._hrefs&&this._hrefs[e])return n;this.sanitizeURL(e).then((t=>{t["xlink:href"]=t.href,t.href=null,(this._hrefs||(this._hrefs={}))[e]=t}))}return null}attr(t,e,n,r){const i={},o=(t,e,n,r)=>{i[r||t]=e};return Array.isArray(n)?n.forEach((t=>t(o,e,this))):n(o,e,this),r&&function(t,e,n,r,i){let o;if(null==e)return t;"bgrect"===r&&!1===n.interactive&&(t["pointer-events"]="none");if("bgfore"===r&&(!1===n.interactive&&(t["pointer-events"]="none"),t.display="none",null!==e.fill))return t;"image"===r&&!1===e.smooth&&(o=["image-rendering: optimizeSpeed;","image-rendering: pixelated;"]);"text"===r&&(t["font-family"]=Ny(e),t["font-size"]=Sy(e)+"px",t["font-style"]=e.fontStyle,t["font-variant"]=e.fontVariant,t["font-weight"]=e.fontWeight);for(const n in i_){let r=e[n];const o=i_[n];("transparent"!==r||"fill"!==o&&"stroke"!==o)&&null!=r&&(Vp(r)&&(r=Xp(r,i.gradient,"")),t[o]=r)}for(const t in o_){const n=e[t];null!=n&&(o=o||[],o.push(`${o_[t]}: ${n};`))}o&&(t.style=o.join(" "))}(i,e,t,r,this._defs),i}defs(t){const e=this._defs.gradient,n=this._defs.clipping;if(0!==Object.keys(e).length+Object.keys(n).length){t.open("defs");for(const n in e){const r=e[n],i=r.stops;"radial"===r.gradient?(t.open("pattern",{id:Gp+n,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),t.open("rect",{width:"1",height:"1",fill:"url(#"+n+")"}).close(),t.close(),t.open("radialGradient",{id:n,fx:r.x1,fy:r.y1,fr:r.r1,cx:r.x2,cy:r.y2,r:r.r2})):t.open("linearGradient",{id:n,x1:r.x1,x2:r.x2,y1:r.y1,y2:r.y2});for(let e=0;e<i.length;++e)t.open("stop",{offset:i[e].offset,"stop-color":i[e].color}).close();t.close()}for(const e in n){const r=n[e];t.open("clipPath",{id:e}),r.path?t.open("path",{d:r.path}).close():t.open("rect",{x:0,y:0,width:r.width,height:r.height}).close(),t.close()}t.close()}}}const k_={svgMarkTypes:["text"],svgOnTop:!0,debug:!1};class A_ extends uv{constructor(t){super(t),this._svgRenderer=new l_(t),this._canvasRenderer=new Ov(t)}initialize(t,e,n,r,i){this._root_el=nv(t,0,"div");const o=nv(this._root_el,0,"div"),a=nv(this._root_el,1,"div");return this._root_el.style.position="relative",k_.debug||(o.style.height="100%",a.style.position="absolute",a.style.top="0",a.style.left="0",a.style.height="100%",a.style.width="100%"),this._svgEl=k_.svgOnTop?a:o,this._canvasEl=k_.svgOnTop?o:a,this._svgEl.style.pointerEvents="none",this._canvasRenderer.initialize(this._canvasEl,e,n,r,i),this._svgRenderer.initialize(this._svgEl,e,n,r,i),super.initialize(t,e,n,r,i)}dirty(t){return k_.svgMarkTypes.includes(t.mark.marktype)?this._svgRenderer.dirty(t):this._canvasRenderer.dirty(t),this}_render(t,e){const n=(e??["arc","area","image","line","path","rect","rule","shape","symbol","text","trail"]).filter((t=>!k_.svgMarkTypes.includes(t)));this._svgRenderer.render(t,k_.svgMarkTypes),this._canvasRenderer.render(t,n)}resize(t,e,n,r){return super.resize(t,e,n,r),this._svgRenderer.resize(t,e,n,r),this._canvasRenderer.resize(t,e,n,r),this}background(t){return k_.svgOnTop?this._canvasRenderer.background(t):this._svgRenderer.background(t),this}}class M_ extends Fv{constructor(t,e){super(t,e)}initialize(t,e,n){const r=nv(nv(t,0,"div"),k_.svgOnTop?0:1,"div");return super.initialize(r,e,n)}}const E_="canvas",D_="hybrid",C_="none",F_={Canvas:E_,PNG:"png",SVG:"svg",Hybrid:D_,None:C_},S_={};function $_(t,e){return t=String(t||"").toLowerCase(),arguments.length>1?(S_[t]=e,this):S_[t]}function T_(t,e,n){const r=[],i=(new Gg).union(e),o=t.marktype;return o?B_(t,i,n,r):"group"===o?z_(t,i,n,r):s("Intersect scene must be mark node or group item.")}function B_(t,e,n,r){if(function(t,e,n){return t.bounds&&e.intersects(t.bounds)&&("group"===t.marktype||!1!==t.interactive&&(!n||n(t)))}(t,e,n)){const i=t.items,o=t.marktype,a=i.length;let s=0;if("group"===o)for(;s<a;++s)z_(i[s],e,n,r);else for(const t=Wy[o].isect;s<a;++s){const n=i[s];N_(n,e,t)&&r.push(n)}}return r}function z_(t,e,n,r){n&&n(t.mark)&&N_(t,e,Wy.group.isect)&&r.push(t);const i=t.items,o=i&&i.length;if(o){const a=t.x||0,s=t.y||0;e.translate(-a,-s);for(let t=0;t<o;++t)B_(i[t],e,n,r);e.translate(a,s)}return r}function N_(t,e,n){const r=t.bounds;return e.encloses(r)||e.intersects(r)&&n(t,e)}S_[E_]=S_.png={renderer:Ov,headless:Ov,handler:Fv},S_.svg={renderer:l_,headless:w_,handler:Lv},S_[D_]={renderer:A_,headless:A_,handler:M_},S_[C_]={};const O_=new Gg;function R_(t){const e=t.clip;if(J(e))e(ym(O_.clear()));else{if(!e)return;O_.set(0,0,t.group.width,t.group.height)}t.bounds.intersect(O_)}const L_=1e-9;function U_(t,e,n){return t===e||("path"===n?q_(t,e):t instanceof Date&&e instanceof Date?+t==+e:yt(t)&&yt(e)?Math.abs(t-e)<=L_:t&&e&&(A(t)||A(e))?function(t,e){var n,r,i=Object.keys(t),o=Object.keys(e);if(i.length!==o.length)return!1;for(i.sort(),o.sort(),r=i.length-1;r>=0;r--)if(i[r]!=o[r])return!1;for(r=i.length-1;r>=0;r--)if(!U_(t[n=i[r]],e[n],n))return!1;return typeof t==typeof e}(t,e):t==e)}function q_(t,e){return U_(og(t),og(e))}const P_="top",j_="left",I_="right",W_="bottom",H_="top-left",Y_="top-right",G_="bottom-left",V_="bottom-right",X_="start",J_="middle",Z_="end",Q_="x",K_="y",tx="group",ex="axis",nx="title",rx="frame",ix="scope",ox="legend",ax="row-header",sx="row-footer",ux="row-title",lx="column-header",cx="column-footer",fx="column-title",hx="padding",dx="symbol",px="fit",gx="fit-x",mx="fit-y",yx="pad",vx="none",_x="all",xx="each",bx="flush",wx="column",kx="row";function Ax(t){Xa.call(this,null,t)}function Mx(t,e,n){return e(t.bounds.clear(),t,n)}ht(Ax,Xa,{transform(t,e){const n=e.dataflow,r=t.mark,i=r.marktype,o=Wy[i],a=o.bound;let s,u=r.bounds;if(o.nested)r.items.length&&n.dirty(r.items[0]),u=Mx(r,a),r.items.forEach((t=>{t.bounds.clear().union(u)}));else if(i===tx||t.modified())switch(e.visit(e.MOD,(t=>n.dirty(t))),u.clear(),r.items.forEach((t=>u.union(Mx(t,a)))),r.role){case ex:case ox:case nx:e.reflow()}else s=e.changed(e.REM),e.visit(e.ADD,(t=>{u.union(Mx(t,a))})),e.visit(e.MOD,(t=>{s=s||u.alignsWith(t.bounds),n.dirty(t),u.union(Mx(t,a))})),s&&(u.clear(),r.items.forEach((t=>u.union(t.bounds))));return R_(r),e.modifies("bounds")}});const Ex=":vega_identifier:";function Dx(t){Xa.call(this,0,t)}function Cx(t){Xa.call(this,null,t)}function Fx(t){Xa.call(this,null,t)}Dx.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]},ht(Dx,Xa,{transform(t,e){const n=(i=e.dataflow)._signals[Ex]||(i._signals[Ex]=i.add(0)),r=t.as;var i;let o=n.value;return e.visit(e.ADD,(t=>t[r]=t[r]||++o)),n.set(this.value=o),e}}),ht(Cx,Xa,{transform(t,e){let n=this.value;n||(n=e.dataflow.scenegraph().mark(t.markdef,function(t){const e=t.groups,n=t.parent;return e&&1===e.size?e.get(Object.keys(e.object)[0]):e&&n?e.lookup(n):null}(t),t.index),n.group.context=t.context,t.context.group||(t.context.group=n.group),n.source=this.source,n.clip=t.clip,n.interactive=t.interactive,this.value=n);const r=n.marktype===tx?Xg:Vg;return e.visit(e.ADD,(t=>r.call(t,n))),(t.modified("clip")||t.modified("interactive"))&&(n.clip=t.clip,n.interactive=!!t.interactive,n.zdirty=!0,e.reflow()),n.items=e.source,e}});const Sx={parity:t=>t.filter(((t,e)=>e%2?t.opacity=0:1)),greedy:(t,e)=>{let n;return t.filter(((t,r)=>r&&$x(n.bounds,t.bounds,e)?t.opacity=0:(n=t,1)))}},$x=(t,e,n)=>n>Math.max(e.x1-t.x2,t.x1-e.x2,e.y1-t.y2,t.y1-e.y2),Tx=(t,e)=>{for(var n,r=1,i=t.length,o=t[0].bounds;r<i;o=n,++r)if($x(o,n=t[r].bounds,e))return!0},Bx=t=>{const e=t.bounds;return e.width()>1&&e.height()>1},zx=t=>(t.forEach((t=>t.opacity=1)),t),Nx=(t,e)=>t.reflow(e.modified()).modifies("opacity");function Ox(t){Xa.call(this,null,t)}ht(Fx,Xa,{transform(t,e){const n=Sx[t.method]||Sx.parity,r=t.separation||0;let i,o,a=e.materialize(e.SOURCE).source;if(!a||!a.length)return;if(!t.method)return t.modified("method")&&(zx(a),e=Nx(e,t)),e;if(a=a.filter(Bx),!a.length)return;if(t.sort&&(a=a.slice().sort(t.sort)),i=zx(a),e=Nx(e,t),i.length>=3&&Tx(i,r)){do{i=n(i,r)}while(i.length>=3&&Tx(i,r));i.length<3&&!F(a).opacity&&(i.length>1&&(F(i).opacity=0),F(a).opacity=1)}t.boundScale&&t.boundTolerance>=0&&(o=((t,e,n)=>{var r=t.range(),i=new Gg;return e===P_||e===W_?i.set(r[0],-1/0,r[1],1/0):i.set(-1/0,r[0],1/0,r[1]),i.expand(n||1),t=>i.encloses(t.bounds)})(t.boundScale,t.boundOrient,+t.boundTolerance),a.forEach((t=>{o(t)||(t.opacity=0)})));const s=i[0].mark.bounds.clear();return a.forEach((t=>{t.opacity&&s.union(t.bounds)})),e}}),ht(Ox,Xa,{transform(t,e){const n=e.dataflow;if(e.visit(e.ALL,(t=>n.dirty(t))),e.fields&&e.fields.zindex){const t=e.source&&e.source[0];t&&(t.mark.zdirty=!0)}}});const Rx=new Gg;function Lx(t,e,n){return t[e]===n?0:(t[e]=n,1)}function Ux(t){var e=t.items[0].orient;return e===j_||e===I_}function qx(t,e,n,r){var i,o,a=e.items[0],s=a.datum,u=null!=a.translate?a.translate:.5,l=a.orient,c=function(t){let e=+t.grid;return[t.ticks?e++:-1,t.labels?e++:-1,e+ +t.domain]}(s),f=a.range,h=a.offset,d=a.position,p=a.minExtent,g=a.maxExtent,m=s.title&&a.items[c[2]].items[0],y=a.titlePadding,v=a.bounds,_=m&&By(m),x=0,b=0;switch(Rx.clear().union(v),v.clear(),(i=c[0])>-1&&v.union(a.items[i].bounds),(i=c[1])>-1&&v.union(a.items[i].bounds),l){case P_:x=d||0,b=-h,o=Math.max(p,Math.min(g,-v.y1)),v.add(0,-o).add(f,0),m&&Px(t,m,o,y,_,0,-1,v);break;case j_:x=-h,b=d||0,o=Math.max(p,Math.min(g,-v.x1)),v.add(-o,0).add(0,f),m&&Px(t,m,o,y,_,1,-1,v);break;case I_:x=n+h,b=d||0,o=Math.max(p,Math.min(g,v.x2)),v.add(0,0).add(o,f),m&&Px(t,m,o,y,_,1,1,v);break;case W_:x=d||0,b=r+h,o=Math.max(p,Math.min(g,v.y2)),v.add(0,0).add(f,o),m&&Px(t,m,o,y,0,0,1,v);break;default:x=a.x,b=a.y}return Kg(v.translate(x,b),a),Lx(a,"x",x+u)|Lx(a,"y",b+u)&&(a.bounds=Rx,t.dirty(a),a.bounds=v,t.dirty(a)),a.mark.bounds.clear().union(v)}function Px(t,e,n,r,i,o,a,s){const u=e.bounds;if(e.auto){const s=a*(n+i+r);let l=0,c=0;t.dirty(e),o?l=(e.x||0)-(e.x=s):c=(e.y||0)-(e.y=s),e.mark.bounds.clear().union(u.translate(-l,-c)),t.dirty(e)}s.union(u)}const jx=(t,e)=>Math.floor(Math.min(t,e)),Ix=(t,e)=>Math.ceil(Math.max(t,e));function Wx(t){return(new Gg).set(0,0,t.width||0,t.height||0)}function Hx(t){const e=t.bounds.clone();return e.empty()?e.set(0,0,0,0):e.translate(-(t.x||0),-(t.y||0))}function Yx(t,e,n){const r=A(t)?t[e]:t;return null!=r?r:void 0!==n?n:0}function Gx(t){return t<0?Math.ceil(-t):0}function Vx(t,e,n){var r,i,o,a,s,u,l,c,f,h,d,p=!n.nodirty,g=n.bounds===bx?Wx:Hx,m=Rx.set(0,0,0,0),y=Yx(n.align,wx),v=Yx(n.align,kx),_=Yx(n.padding,wx),x=Yx(n.padding,kx),b=n.columns||e.length,w=b<=0?1:Math.ceil(e.length/b),k=e.length,A=Array(k),M=Array(b),E=0,D=Array(k),C=Array(w),F=0,S=Array(k),$=Array(k),T=Array(k);for(i=0;i<b;++i)M[i]=0;for(i=0;i<w;++i)C[i]=0;for(i=0;i<k;++i)u=e[i],s=T[i]=g(u),u.x=u.x||0,S[i]=0,u.y=u.y||0,$[i]=0,o=i%b,a=~~(i/b),E=Math.max(E,l=Math.ceil(s.x2)),F=Math.max(F,c=Math.ceil(s.y2)),M[o]=Math.max(M[o],l),C[a]=Math.max(C[a],c),A[i]=_+Gx(s.x1),D[i]=x+Gx(s.y1),p&&t.dirty(e[i]);for(i=0;i<k;++i)i%b==0&&(A[i]=0),i<b&&(D[i]=0);if(y===xx)for(o=1;o<b;++o){for(d=0,i=o;i<k;i+=b)d<A[i]&&(d=A[i]);for(i=o;i<k;i+=b)A[i]=d+M[o-1]}else if(y===_x){for(d=0,i=0;i<k;++i)i%b&&d<A[i]&&(d=A[i]);for(i=0;i<k;++i)i%b&&(A[i]=d+E)}else for(y=!1,o=1;o<b;++o)for(i=o;i<k;i+=b)A[i]+=M[o-1];if(v===xx)for(a=1;a<w;++a){for(d=0,r=(i=a*b)+b;i<r;++i)d<D[i]&&(d=D[i]);for(i=a*b;i<r;++i)D[i]=d+C[a-1]}else if(v===_x){for(d=0,i=b;i<k;++i)d<D[i]&&(d=D[i]);for(i=b;i<k;++i)D[i]=d+F}else for(v=!1,a=1;a<w;++a)for(r=(i=a*b)+b;i<r;++i)D[i]+=C[a-1];for(f=0,i=0;i<k;++i)f=A[i]+(i%b?f:0),S[i]+=f-e[i].x;for(o=0;o<b;++o)for(h=0,i=o;i<k;i+=b)h+=D[i],$[i]+=h-e[i].y;if(y&&Yx(n.center,wx)&&w>1)for(i=0;i<k;++i)(f=(s=y===_x?E:M[i%b])-T[i].x2-e[i].x-S[i])>0&&(S[i]+=f/2);if(v&&Yx(n.center,kx)&&1!==b)for(i=0;i<k;++i)(h=(s=v===_x?F:C[~~(i/b)])-T[i].y2-e[i].y-$[i])>0&&($[i]+=h/2);for(i=0;i<k;++i)m.union(T[i].translate(S[i],$[i]));switch(f=Yx(n.anchor,Q_),h=Yx(n.anchor,K_),Yx(n.anchor,wx)){case Z_:f-=m.width();break;case J_:f-=m.width()/2}switch(Yx(n.anchor,kx)){case Z_:h-=m.height();break;case J_:h-=m.height()/2}for(f=Math.round(f),h=Math.round(h),m.clear(),i=0;i<k;++i)e[i].mark.bounds.clear();for(i=0;i<k;++i)(u=e[i]).x+=S[i]+=f,u.y+=$[i]+=h,m.union(u.mark.bounds.union(u.bounds.translate(S[i],$[i]))),p&&t.dirty(u);return m}function Xx(t,e,n){var r,i,o,a,s,u,l,c=function(t){var e,n,r=t.items,i=r.length,o=0;const a={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;o<i;++o)if(n=(e=r[o]).items,e.marktype===tx)switch(e.role){case ex:case ox:case nx:break;case ax:a.rowheaders.push(...n);break;case sx:a.rowfooters.push(...n);break;case lx:a.colheaders.push(...n);break;case cx:a.colfooters.push(...n);break;case ux:a.rowtitle=n[0];break;case fx:a.coltitle=n[0];break;default:a.marks.push(...n)}return a}(e),f=c.marks,h=n.bounds===bx?Jx:Zx,d=n.offset,p=n.columns||f.length,g=p<=0?1:Math.ceil(f.length/p),m=g*p;const y=Vx(t,f,n);y.empty()&&y.set(0,0,0,0),c.rowheaders&&(u=Yx(n.headerBand,kx,null),r=Qx(t,c.rowheaders,f,p,g,-Yx(d,"rowHeader"),jx,0,h,"x1",0,p,1,u)),c.colheaders&&(u=Yx(n.headerBand,wx,null),i=Qx(t,c.colheaders,f,p,p,-Yx(d,"columnHeader"),jx,1,h,"y1",0,1,p,u)),c.rowfooters&&(u=Yx(n.footerBand,kx,null),o=Qx(t,c.rowfooters,f,p,g,Yx(d,"rowFooter"),Ix,0,h,"x2",p-1,p,1,u)),c.colfooters&&(u=Yx(n.footerBand,wx,null),a=Qx(t,c.colfooters,f,p,p,Yx(d,"columnFooter"),Ix,1,h,"y2",m-p,1,p,u)),c.rowtitle&&(s=Yx(n.titleAnchor,kx),l=Yx(d,"rowTitle"),l=s===Z_?o+l:r-l,u=Yx(n.titleBand,kx,.5),Kx(t,c.rowtitle,l,0,y,u)),c.coltitle&&(s=Yx(n.titleAnchor,wx),l=Yx(d,"columnTitle"),l=s===Z_?a+l:i-l,u=Yx(n.titleBand,wx,.5),Kx(t,c.coltitle,l,1,y,u))}function Jx(t,e){return"x1"===e?t.x||0:"y1"===e?t.y||0:"x2"===e?(t.x||0)+(t.width||0):"y2"===e?(t.y||0)+(t.height||0):void 0}function Zx(t,e){return t.bounds[e]}function Qx(t,e,n,r,i,o,a,s,u,l,c,f,h,d){var p,g,m,y,v,_,x,b,w,k=n.length,A=0,M=0;if(!k)return A;for(p=c;p<k;p+=f)n[p]&&(A=a(A,u(n[p],l)));if(!e.length)return A;for(e.length>i&&(t.warn("Grid headers exceed limit: "+i),e=e.slice(0,i)),A+=o,g=0,y=e.length;g<y;++g)t.dirty(e[g]),e[g].mark.bounds.clear();for(p=c,g=0,y=e.length;g<y;++g,p+=f){for(v=(_=e[g]).mark.bounds,m=p;m>=0&&null==(x=n[m]);m-=h);s?(b=null==d?x.x:Math.round(x.bounds.x1+d*x.bounds.width()),w=A):(b=A,w=null==d?x.y:Math.round(x.bounds.y1+d*x.bounds.height())),v.union(_.bounds.translate(b-(_.x||0),w-(_.y||0))),_.x=b,_.y=w,t.dirty(_),M=a(M,v[l])}return M}function Kx(t,e,n,r,i,o){if(e){t.dirty(e);var a=n,s=n;r?a=Math.round(i.x1+o*i.width()):s=Math.round(i.y1+o*i.height()),e.bounds.translate(a-(e.x||0),s-(e.y||0)),e.mark.bounds.clear().union(e.bounds),e.x=a,e.y=s,t.dirty(e)}}function tb(t,e,n,r,i,o,a){const s=function(t,e){const n=t[e]||{};return(e,r)=>null!=n[e]?n[e]:null!=t[e]?t[e]:r}(n,e),u=function(t,e){let n=-1/0;return t.forEach((t=>{null!=t.offset&&(n=Math.max(n,t.offset))})),n>-1/0?n:e}(t,s("offset",0)),l=s("anchor",X_),c=l===Z_?1:l===J_?.5:0,f={align:xx,bounds:s("bounds",bx),columns:"vertical"===s("direction")?1:t.length,padding:s("margin",8),center:s("center"),nodirty:!0};switch(e){case j_:f.anchor={x:Math.floor(r.x1)-u,column:Z_,y:c*(a||r.height()+2*r.y1),row:l};break;case I_:f.anchor={x:Math.ceil(r.x2)+u,y:c*(a||r.height()+2*r.y1),row:l};break;case P_:f.anchor={y:Math.floor(i.y1)-u,row:Z_,x:c*(o||i.width()+2*i.x1),column:l};break;case W_:f.anchor={y:Math.ceil(i.y2)+u,x:c*(o||i.width()+2*i.x1),column:l};break;case H_:f.anchor={x:u,y:u};break;case Y_:f.anchor={x:o-u,y:u,column:Z_};break;case G_:f.anchor={x:u,y:a-u,row:Z_};break;case V_:f.anchor={x:o-u,y:a-u,column:Z_,row:Z_}}return f}function eb(t,e){var n,r,i=e.items[0],o=i.datum,a=i.orient,s=i.bounds,u=i.x,l=i.y;return i._bounds?i._bounds.clear().union(s):i._bounds=s.clone(),s.clear(),function(t,e,n){var r=e.padding,i=r-n.x,o=r-n.y;if(e.datum.title){var a=e.items[1].items[0],s=a.anchor,u=e.titlePadding||0,l=r-a.x,c=r-a.y;switch(a.orient){case j_:i+=Math.ceil(a.bounds.width())+u;break;case I_:case W_:break;default:o+=a.bounds.height()+u}switch((i||o)&&rb(t,n,i,o),a.orient){case j_:c+=nb(e,n,a,s,1,1);break;case I_:l+=nb(e,n,a,Z_,0,0)+u,c+=nb(e,n,a,s,1,1);break;case W_:l+=nb(e,n,a,s,0,0),c+=nb(e,n,a,Z_,-1,0,1)+u;break;default:l+=nb(e,n,a,s,0,0)}(l||c)&&rb(t,a,l,c),(l=Math.round(a.bounds.x1-r))<0&&(rb(t,n,-l,0),rb(t,a,-l,0))}else(i||o)&&rb(t,n,i,o)}(t,i,i.items[0].items[0]),s=function(t,e){return t.items.forEach((t=>e.union(t.bounds))),e.x1=t.padding,e.y1=t.padding,e}(i,s),n=2*i.padding,r=2*i.padding,s.empty()||(n=Math.ceil(s.width()+n),r=Math.ceil(s.height()+r)),o.type===dx&&function(t){const e=t.reduce(((t,e)=>(t[e.column]=Math.max(e.bounds.x2-e.x,t[e.column]||0),t)),{});t.forEach((t=>{t.width=e[t.column],t.height=t.bounds.y2-t.y}))}(i.items[0].items[0].items[0].items),a!==vx&&(i.x=u=0,i.y=l=0),i.width=n,i.height=r,Kg(s.set(u,l,u+n,l+r),i),i.mark.bounds.clear().union(s),i}function nb(t,e,n,r,i,o,a){const s="symbol"!==t.datum.type,u=n.datum.vgrad,l=(!s||!o&&u||a?e:e.items[0]).bounds[i?"y2":"x2"]-t.padding,c=u&&o?l:0,f=u&&o?0:l,h=i<=0?0:By(n);return Math.round(r===X_?c:r===Z_?f-h:.5*(l-h))}function rb(t,e,n,r){e.x+=n,e.y+=r,e.bounds.translate(n,r),e.mark.bounds.translate(n,r),t.dirty(e)}function ib(t){Xa.call(this,null,t)}ht(ib,Xa,{transform(t,e){const n=e.dataflow;return t.mark.items.forEach((e=>{t.layout&&Xx(n,e,t.layout),function(t,e,n){var r,i,o,a,s,u=e.items,l=Math.max(0,e.width||0),c=Math.max(0,e.height||0),f=(new Gg).set(0,0,l,c),h=f.clone(),d=f.clone(),p=[];for(a=0,s=u.length;a<s;++a)switch((i=u[a]).role){case ex:(Ux(i)?h:d).union(qx(t,i,l,c));break;case nx:r=i;break;case ox:p.push(eb(t,i));break;case rx:case ix:case ax:case sx:case ux:case lx:case cx:case fx:h.union(i.bounds),d.union(i.bounds);break;default:f.union(i.bounds)}if(p.length){const e={};p.forEach((t=>{(o=t.orient||I_)!==vx&&(e[o]||(e[o]=[])).push(t)}));for(const r in e){const i=e[r];Vx(t,i,tb(i,r,n.legends,h,d,l,c))}p.forEach((e=>{const r=e.bounds;if(r.equals(e._bounds)||(e.bounds=e._bounds,t.dirty(e),e.bounds=r,t.dirty(e)),!n.autosize||n.autosize.type!==px&&n.autosize.type!==gx&&n.autosize.type!==mx)f.union(r);else switch(e.orient){case j_:case I_:f.add(r.x1,0).add(r.x2,0);break;case P_:case W_:f.add(0,r.y1).add(0,r.y2)}}))}f.union(h).union(d),r&&f.union(function(t,e,n,r,i){var o,a=e.items[0],s=a.frame,u=a.orient,l=a.anchor,c=a.offset,f=a.padding,h=a.items[0].items[0],d=a.items[1]&&a.items[1].items[0],p=u===j_||u===I_?r:n,g=0,m=0,y=0,v=0,_=0;if(s!==tx?u===j_?(g=i.y2,p=i.y1):u===I_?(g=i.y1,p=i.y2):(g=i.x1,p=i.x2):u===j_&&(g=r,p=0),o=l===X_?g:l===Z_?p:(g+p)/2,d&&d.text){switch(u){case P_:case W_:_=h.bounds.height()+f;break;case j_:v=h.bounds.width()+f;break;case I_:v=-h.bounds.width()-f}Rx.clear().union(d.bounds),Rx.translate(v-(d.x||0),_-(d.y||0)),Lx(d,"x",v)|Lx(d,"y",_)&&(t.dirty(d),d.bounds.clear().union(Rx),d.mark.bounds.clear().union(Rx),t.dirty(d)),Rx.clear().union(d.bounds)}else Rx.clear();switch(Rx.union(h.bounds),u){case P_:m=o,y=i.y1-Rx.height()-c;break;case j_:m=i.x1-Rx.width()-c,y=o;break;case I_:m=i.x2+Rx.width()+c,y=o;break;case W_:m=o,y=i.y2+c;break;default:m=a.x,y=a.y}return Lx(a,"x",m)|Lx(a,"y",y)&&(Rx.translate(m,y),t.dirty(a),a.bounds.clear().union(Rx),e.bounds.clear().union(Rx),t.dirty(a)),a.bounds}(t,r,l,c,f));e.clip&&f.set(0,0,e.width||0,e.height||0);!function(t,e,n,r){const i=r.autosize||{},o=i.type;if(t._autosize<1||!o)return;let a=t._width,s=t._height,u=Math.max(0,e.width||0),l=Math.max(0,Math.ceil(-n.x1)),c=Math.max(0,e.height||0),f=Math.max(0,Math.ceil(-n.y1));const h=Math.max(0,Math.ceil(n.x2-u)),d=Math.max(0,Math.ceil(n.y2-c));if(i.contains===hx){const e=t.padding();a-=e.left+e.right,s-=e.top+e.bottom}o===vx?(l=0,f=0,u=a,c=s):o===px?(u=Math.max(0,a-l-h),c=Math.max(0,s-f-d)):o===gx?(u=Math.max(0,a-l-h),s=c+f+d):o===mx?(a=u+l+h,c=Math.max(0,s-f-d)):o===yx&&(a=u+l+h,s=c+f+d);t._resizeView(a,s,u,c,[l,f],i.resize)}(t,e,f,n)}(n,e,t)})),function(t){return t&&"legend-entry"!==t.mark.role}(t.mark.group)?e.reflow():e}});var ob=Object.freeze({__proto__:null,bound:Ax,identifier:Dx,mark:Cx,overlap:Fx,render:Ox,viewlayout:ib});function ab(t){Xa.call(this,null,t)}function sb(t){Xa.call(this,null,t)}function ub(){return va({})}function lb(t){Xa.call(this,null,t)}function cb(t){Xa.call(this,[],t)}ht(ab,Xa,{transform(t,e){if(this.value&&!t.modified())return e.StopPropagation;var n=e.dataflow.locale(),r=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=this.value,o=t.scale,a=Fp(o,null==t.count?t.values?t.values.length:10:t.count,t.minstep),s=t.format||Tp(n,o,a,t.formatSpecifier,t.formatType,!!t.values),u=t.values?Sp(o,t.values,a):$p(o,a);return i&&(r.rem=i),i=u.map(((t,e)=>va({index:e/(u.length-1||1),value:t,label:s(t)}))),t.extra&&i.length&&i.push(va({index:-1,extra:{value:i[0].value},label:""})),r.source=i,r.add=i,this.value=i,r}}),ht(sb,Xa,{transform(t,e){var n=e.dataflow,r=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=t.item||ub,o=t.key||ma,a=this.value;return k(r.encode)&&(r.encode=null),a&&(t.modified("key")||e.modified(o))&&s("DataJoin does not support modified key function or fields."),a||(e=e.addAll(),this.value=a=function(t){const e=ct().test((t=>t.exit));return e.lookup=n=>e.get(t(n)),e}(o)),e.visit(e.ADD,(t=>{const e=o(t);let n=a.get(e);n?n.exit?(a.empty--,r.add.push(n)):r.mod.push(n):(n=i(t),a.set(e,n),r.add.push(n)),n.datum=t,n.exit=!1})),e.visit(e.MOD,(t=>{const e=o(t),n=a.get(e);n&&(n.datum=t,r.mod.push(n))})),e.visit(e.REM,(t=>{const e=o(t),n=a.get(e);t!==n.datum||n.exit||(r.rem.push(n),n.exit=!0,++a.empty)})),e.changed(e.ADD_MOD)&&r.modifies("datum"),(e.clean()||t.clean&&a.empty>n.cleanThreshold)&&n.runAfter(a.clean),r}}),ht(lb,Xa,{transform(t,e){var n=e.fork(e.ADD_REM),r=t.mod||!1,i=t.encoders,o=e.encode;if(k(o)){if(!n.changed()&&!o.every((t=>i[t])))return e.StopPropagation;o=o[0],n.encode=null}var a="enter"===o,s=i.update||g,u=i.enter||g,l=i.exit||g,c=(o&&!a?i[o]:s)||g;if(e.changed(e.ADD)&&(e.visit(e.ADD,(e=>{u(e,t),s(e,t)})),n.modifies(u.output),n.modifies(s.output),c!==g&&c!==s&&(e.visit(e.ADD,(e=>{c(e,t)})),n.modifies(c.output))),e.changed(e.REM)&&l!==g&&(e.visit(e.REM,(e=>{l(e,t)})),n.modifies(l.output)),a||c!==g){const i=e.MOD|(t.modified()?e.REFLOW:0);a?(e.visit(i,(e=>{const i=u(e,t)||r;(c(e,t)||i)&&n.mod.push(e)})),n.mod.length&&n.modifies(u.output)):e.visit(i,(e=>{(c(e,t)||r)&&n.mod.push(e)})),n.mod.length&&n.modifies(c.output)}return n.changed()?n:e.StopPropagation}}),ht(cb,Xa,{transform(t,e){if(null!=this.value&&!t.modified())return e.StopPropagation;var n,r,i,o,a,s=e.dataflow.locale(),u=e.fork(e.NO_SOURCE|e.NO_FIELDS),l=this.value,c=t.type||Ap,f=t.scale,h=+t.limit,d=Fp(f,null==t.count?5:t.count,t.minstep),p=!!t.values||c===Ap,g=t.format||Lp(s,f,d,c,t.formatSpecifier,t.formatType,p),m=t.values||Op(f,d);return l&&(u.rem=l),c===Ap?(h&&m.length>h?(e.dataflow.warn("Symbol legend count exceeds limit, filtering items."),l=m.slice(0,h-1),a=!0):l=m,J(i=t.size)?(t.values||0!==f(l[0])||(l=l.slice(1)),o=l.reduce(((e,n)=>Math.max(e,i(n,t))),0)):i=rt(o=i||8),l=l.map(((e,n)=>va({index:n,label:g(e,n,l),value:e,offset:o,size:i(e,t)}))),a&&(a=m[l.length],l.push(va({index:l.length,label:`â€¦${m.length-l.length} entries`,value:a,offset:o,size:i(a,t)})))):"gradient"===c?(n=f.domain(),r=vp(f,n[0],F(n)),m.length<3&&!t.values&&n[0]!==F(n)&&(m=[n[0],F(n)]),l=m.map(((t,e)=>va({index:e,label:g(t,e,m),value:t,perc:r(t)})))):(i=m.length-1,r=function(t){const e=t.domain(),n=e.length-1;let r=+e[0],i=+F(e),o=i-r;if(t.type===jd){const t=n?o/n:.1;r-=t,i+=t,o=i-r}return t=>(t-r)/o}(f),l=m.map(((t,e)=>va({index:e,label:g(t,e,m),value:t,perc:e?r(t):0,perc2:e===i?1:r(m[e+1])})))),u.source=l,u.add=l,this.value=l,u}});const fb=t=>t.source.x,hb=t=>t.source.y,db=t=>t.target.x,pb=t=>t.target.y;function gb(t){Xa.call(this,{},t)}gb.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]},ht(gb,Xa,{transform(t,e){var n=t.sourceX||fb,r=t.sourceY||hb,i=t.targetX||db,o=t.targetY||pb,a=t.as||"path",u=t.orient||"vertical",l=t.shape||"line",c=_b.get(l+"-"+u)||_b.get(l);return c||s("LinkPath unsupported type: "+t.shape+(t.orient?"-"+t.orient:"")),e.visit(e.SOURCE,(t=>{t[a]=c(n(t),r(t),i(t),o(t))})),e.reflow(t.modified()).modifies(a)}});const mb=(t,e,n,r)=>"M"+t+","+e+"L"+n+","+r,yb=(t,e,n,r)=>{var i=n-t,o=r-e,a=Math.hypot(i,o)/2;return"M"+t+","+e+"A"+a+","+a+" "+180*Math.atan2(o,i)/Math.PI+" 0 1 "+n+","+r},vb=(t,e,n,r)=>{const i=n-t,o=r-e,a=.2*(i+o),s=.2*(o-i);return"M"+t+","+e+"C"+(t+a)+","+(e+s)+" "+(n+s)+","+(r-a)+" "+n+","+r},_b=ct({line:mb,"line-radial":(t,e,n,r)=>mb(e*Math.cos(t),e*Math.sin(t),r*Math.cos(n),r*Math.sin(n)),arc:yb,"arc-radial":(t,e,n,r)=>yb(e*Math.cos(t),e*Math.sin(t),r*Math.cos(n),r*Math.sin(n)),curve:vb,"curve-radial":(t,e,n,r)=>vb(e*Math.cos(t),e*Math.sin(t),r*Math.cos(n),r*Math.sin(n)),"orthogonal-horizontal":(t,e,n,r)=>"M"+t+","+e+"V"+r+"H"+n,"orthogonal-vertical":(t,e,n,r)=>"M"+t+","+e+"H"+n+"V"+r,"orthogonal-radial":(t,e,n,r)=>{const i=Math.cos(t),o=Math.sin(t),a=Math.cos(n),s=Math.sin(n);return"M"+e*i+","+e*o+"A"+e+","+e+" 0 0,"+((Math.abs(n-t)>Math.PI?n<=t:n>t)?1:0)+" "+e*a+","+e*s+"L"+r*a+","+r*s},"diagonal-horizontal":(t,e,n,r)=>{const i=(t+n)/2;return"M"+t+","+e+"C"+i+","+e+" "+i+","+r+" "+n+","+r},"diagonal-vertical":(t,e,n,r)=>{const i=(e+r)/2;return"M"+t+","+e+"C"+t+","+i+" "+n+","+i+" "+n+","+r},"diagonal-radial":(t,e,n,r)=>{const i=Math.cos(t),o=Math.sin(t),a=Math.cos(n),s=Math.sin(n),u=(e+r)/2;return"M"+e*i+","+e*o+"C"+u*i+","+u*o+" "+u*a+","+u*s+" "+r*a+","+r*s}});function xb(t){Xa.call(this,null,t)}xb.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]},ht(xb,Xa,{transform(t,e){var n,r,i,o=t.as||["startAngle","endAngle"],a=o[0],s=o[1],u=t.field||d,l=t.startAngle||0,c=null!=t.endAngle?t.endAngle:2*Math.PI,f=e.source,h=f.map(u),p=h.length,g=l,m=(c-l)/Se(h),y=Fe(p);for(t.sort&&y.sort(((t,e)=>h[t]-h[e])),n=0;n<p;++n)i=h[y[n]],(r=f[y[n]])[a]=g,r[s]=g+=i*m;return this.value=h,e.reflow(t.modified()).modifies(o)}});const bb=5;function wb(t){return up(t)&&t!==Ld}const kb=Tt(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function Ab(t){Xa.call(this,null,t),this.modified(!0)}function Mb(t,e,n){fp(t)&&(Math.abs(e.reduce(((t,e)=>t+(e<0?-1:e>0?1:0)),0))!==e.length&&n.warn("Log scale domain includes zero: "+Dt(e)));return e}function Eb(t,e,n){return J(t)&&(e||n)?gp(t,Db(e||[0,1],n)):t}function Db(t,e){return e?t.slice().reverse():t}function Cb(t){Xa.call(this,null,t)}ht(Ab,Xa,{transform(t,e){var n=e.dataflow,r=this.value,i=function(t){var e,n=t.type,r="";if(n===Ld)return Ld+"-"+$d;(function(t){const e=t.type;return up(e)&&e!==Od&&e!==Rd&&(t.scheme||t.range&&t.range.length&&t.range.every(_t))})(t)&&(r=2===(e=t.rawDomain?t.rawDomain.length:t.domain?t.domain.length+ +(null!=t.domainMid):0)?Ld+"-":3===e?Ud+"-":"");return(r+n||$d).toLowerCase()}(t);for(i in r&&i===r.type||(this.value=r=op(i)()),t)if(!kb[i]){if("padding"===i&&wb(r.type))continue;J(r[i])?r[i](t[i]):n.warn("Unsupported scale property: "+i)}return function(t,e,n){var r=t.type,i=e.round||!1,o=e.range;if(null!=e.rangeStep)o=function(t,e,n){t!==Hd&&t!==Wd&&s("Only band and point scales support rangeStep.");var r=(null!=e.paddingOuter?e.paddingOuter:e.padding)||0,i=t===Wd?1:(null!=e.paddingInner?e.paddingInner:e.padding)||0;return[0,e.rangeStep*Sd(n,i,r)]}(r,e,n);else if(e.scheme&&(o=function(t,e,n){var r,i=e.schemeExtent;k(e.scheme)?r=mp(e.scheme,e.interpolate,e.interpolateGamma):(r=kp(e.scheme.toLowerCase()))||s(`Unrecognized scheme name: ${e.scheme}`);return n=t===jd?n+1:t===Yd?n-1:t===qd||t===Pd?+e.schemeCount||bb:n,hp(t)?Eb(r,i,e.reverse):J(r)?yp(Eb(r,i),n):t===Id?r:r.slice(0,n)}(r,e,n),J(o))){if(t.interpolator)return t.interpolator(o);s(`Scale type ${r} does not support interpolating color schemes.`)}if(o&&hp(r))return t.interpolator(mp(Db(o,e.reverse),e.interpolate,e.interpolateGamma));o&&e.interpolate&&t.interpolate?t.interpolate(_p(e.interpolate,e.interpolateGamma)):J(t.round)?t.round(i):J(t.rangeRound)&&t.interpolate(i?mh:gh);o&&t.range(Db(o,e.reverse))}(r,t,function(t,e,n){let r=e.bins;if(r&&!k(r)){const e=t.domain(),n=e[0],i=F(e),o=r.step;let a=null==r.start?n:r.start,u=null==r.stop?i:r.stop;o||s("Scale bins parameter missing step property."),a<n&&(a=o*Math.ceil(n/o)),u>i&&(u=o*Math.floor(i/o)),r=Fe(a,u+o/2,o)}r?t.bins=r:t.bins&&delete t.bins;t.type===Yd&&(r?e.domain||e.domainRaw||(t.domain(r),n=r.length):t.bins=t.domain());return n}(r,t,function(t,e,n){const r=function(t,e,n){return e?(t.domain(Mb(t.type,e,n)),e.length):-1}(t,e.domainRaw,n);if(r>-1)return r;var i,o,a=e.domain,s=t.type,u=e.zero||void 0===e.zero&&function(t){const e=t.type;return!t.bins&&(e===$d||e===Bd||e===zd)}(t);if(!a)return 0;if((u||null!=e.domainMin||null!=e.domainMax||null!=e.domainMid)&&(i=(a=a.slice()).length-1||1,u&&(a[0]>0&&(a[0]=0),a[i]<0&&(a[i]=0)),null!=e.domainMin&&(a[0]=e.domainMin),null!=e.domainMax&&(a[i]=e.domainMax),null!=e.domainMid)){const t=(o=e.domainMid)>a[i]?i+1:o<a[0]?0:i;t!==i&&n.warn("Scale domainMid exceeds domain min or max.",o),a.splice(t,0,o)}wb(s)&&e.padding&&a[0]!==F(a)&&(a=function(t,e,n,r,i,o){var a=Math.abs(F(n)-n[0]),s=a/(a-2*r),u=t===Td?I(e,null,s):t===zd?W(e,null,s,.5):t===Bd?W(e,null,s,i||1):t===Nd?H(e,null,s,o||1):j(e,null,s);return e=e.slice(),e[0]=u[0],e[e.length-1]=u[1],e}(s,a,e.range,e.padding,e.exponent,e.constant));t.domain(Mb(s,a,n)),s===Id&&t.unknown(e.domainImplicit?zc:void 0);e.nice&&t.nice&&t.nice(!0!==e.nice&&Fp(t,e.nice)||null);return a.length}(r,t,n))),e.fork(e.NO_SOURCE|e.NO_FIELDS)}}),ht(Cb,Xa,{transform(t,e){const n=t.modified("sort")||e.changed(e.ADD)||e.modified(t.sort.fields)||e.modified("datum");return n&&e.source.sort(wa(t.sort)),this.modified(n),e}});const Fb="zero",Sb="center",$b="normalize",Tb=["y0","y1"];function Bb(t){Xa.call(this,null,t)}function zb(t,e,n,r,i){for(var o,a=(e-t.sum)/2,s=t.length,u=0;u<s;++u)(o=t[u])[r]=a,o[i]=a+=Math.abs(n(o))}function Nb(t,e,n,r,i){for(var o,a=1/t.sum,s=0,u=t.length,l=0,c=0;l<u;++l)(o=t[l])[r]=s,o[i]=s=a*(c+=Math.abs(n(o)))}function Ob(t,e,n,r,i){for(var o,a,s=0,u=0,l=t.length,c=0;c<l;++c)(o=+n(a=t[c]))<0?(a[r]=u,a[i]=u+=o):(a[r]=s,a[i]=s+=o)}Bb.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:Fb,values:[Fb,Sb,$b]},{name:"as",type:"string",array:!0,length:2,default:Tb}]},ht(Bb,Xa,{transform(t,e){var n,r,i,o,a=t.as||Tb,s=a[0],u=a[1],l=wa(t.sort),c=t.field||d,f=t.offset===Sb?zb:t.offset===$b?Nb:Ob;for(n=function(t,e,n,r){var i,o,a,s,u,l,c,f,h,d=[],p=t=>t(u);if(null==e)d.push(t.slice());else for(i={},o=0,a=t.length;o<a;++o)u=t[o],(c=i[l=e.map(p)])||(i[l]=c=[],d.push(c)),c.push(u);for(l=0,h=0,s=d.length;l<s;++l){for(o=0,f=0,a=(c=d[l]).length;o<a;++o)f+=Math.abs(r(c[o]));c.sum=f,f>h&&(h=f),n&&c.sort(n)}return d.max=h,d}(e.source,t.groupby,l,c),r=0,i=n.length,o=n.max;r<i;++r)f(n[r],o,c,s,u);return e.reflow(t.modified()).modifies(a)}});var Rb=Object.freeze({__proto__:null,axisticks:ab,datajoin:sb,encode:lb,legendentries:cb,linkpath:gb,pie:xb,scale:Ab,sortitems:Cb,stack:Bb}),Lb=1e-6,Ub=1e-12,qb=Math.PI,Pb=qb/2,jb=qb/4,Ib=2*qb,Wb=180/qb,Hb=qb/180,Yb=Math.abs,Gb=Math.atan,Vb=Math.atan2,Xb=Math.cos,Jb=Math.ceil,Zb=Math.exp,Qb=Math.hypot,Kb=Math.log,tw=Math.pow,ew=Math.sin,nw=Math.sign||function(t){return t>0?1:t<0?-1:0},rw=Math.sqrt,iw=Math.tan;function ow(t){return t>1?0:t<-1?qb:Math.acos(t)}function aw(t){return t>1?Pb:t<-1?-Pb:Math.asin(t)}function sw(){}function uw(t,e){t&&cw.hasOwnProperty(t.type)&&cw[t.type](t,e)}var lw={Feature:function(t,e){uw(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,r=-1,i=n.length;++r<i;)uw(n[r].geometry,e)}},cw={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)t=n[r],e.point(t[0],t[1],t[2])},LineString:function(t,e){fw(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)fw(n[r],e,0)},Polygon:function(t,e){hw(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)hw(n[r],e)},GeometryCollection:function(t,e){for(var n=t.geometries,r=-1,i=n.length;++r<i;)uw(n[r],e)}};function fw(t,e,n){var r,i=-1,o=t.length-n;for(e.lineStart();++i<o;)r=t[i],e.point(r[0],r[1],r[2]);e.lineEnd()}function hw(t,e){var n=-1,r=t.length;for(e.polygonStart();++n<r;)fw(t[n],e,1);e.polygonEnd()}function dw(t,e){t&&lw.hasOwnProperty(t.type)?lw[t.type](t,e):uw(t,e)}var pw,gw,mw,yw,vw,_w,xw,bw,ww,kw,Aw,Mw,Ew,Dw,Cw,Fw,Sw=new ae,$w=new ae,Tw={point:sw,lineStart:sw,lineEnd:sw,polygonStart:function(){Sw=new ae,Tw.lineStart=Bw,Tw.lineEnd=zw},polygonEnd:function(){var t=+Sw;$w.add(t<0?Ib+t:t),this.lineStart=this.lineEnd=this.point=sw},sphere:function(){$w.add(Ib)}};function Bw(){Tw.point=Nw}function zw(){Ow(pw,gw)}function Nw(t,e){Tw.point=Ow,pw=t,gw=e,mw=t*=Hb,yw=Xb(e=(e*=Hb)/2+jb),vw=ew(e)}function Ow(t,e){var n=(t*=Hb)-mw,r=n>=0?1:-1,i=r*n,o=Xb(e=(e*=Hb)/2+jb),a=ew(e),s=vw*a,u=yw*o+s*Xb(i),l=s*r*ew(i);Sw.add(Vb(l,u)),mw=t,yw=o,vw=a}function Rw(t){return[Vb(t[1],t[0]),aw(t[2])]}function Lw(t){var e=t[0],n=t[1],r=Xb(n);return[r*Xb(e),r*ew(e),ew(n)]}function Uw(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function qw(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function Pw(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function jw(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function Iw(t){var e=rw(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}var Ww,Hw,Yw,Gw,Vw,Xw,Jw,Zw,Qw,Kw,tk,ek,nk,rk,ik,ok,ak={point:sk,lineStart:lk,lineEnd:ck,polygonStart:function(){ak.point=fk,ak.lineStart=hk,ak.lineEnd=dk,Dw=new ae,Tw.polygonStart()},polygonEnd:function(){Tw.polygonEnd(),ak.point=sk,ak.lineStart=lk,ak.lineEnd=ck,Sw<0?(_w=-(bw=180),xw=-(ww=90)):Dw>Lb?ww=90:Dw<-1e-6&&(xw=-90),Fw[0]=_w,Fw[1]=bw},sphere:function(){_w=-(bw=180),xw=-(ww=90)}};function sk(t,e){Cw.push(Fw=[_w=t,bw=t]),e<xw&&(xw=e),e>ww&&(ww=e)}function uk(t,e){var n=Lw([t*Hb,e*Hb]);if(Ew){var r=qw(Ew,n),i=qw([r[1],-r[0],0],r);Iw(i),i=Rw(i);var o,a=t-kw,s=a>0?1:-1,u=i[0]*Wb*s,l=Yb(a)>180;l^(s*kw<u&&u<s*t)?(o=i[1]*Wb)>ww&&(ww=o):l^(s*kw<(u=(u+360)%360-180)&&u<s*t)?(o=-i[1]*Wb)<xw&&(xw=o):(e<xw&&(xw=e),e>ww&&(ww=e)),l?t<kw?pk(_w,t)>pk(_w,bw)&&(bw=t):pk(t,bw)>pk(_w,bw)&&(_w=t):bw>=_w?(t<_w&&(_w=t),t>bw&&(bw=t)):t>kw?pk(_w,t)>pk(_w,bw)&&(bw=t):pk(t,bw)>pk(_w,bw)&&(_w=t)}else Cw.push(Fw=[_w=t,bw=t]);e<xw&&(xw=e),e>ww&&(ww=e),Ew=n,kw=t}function lk(){ak.point=uk}function ck(){Fw[0]=_w,Fw[1]=bw,ak.point=sk,Ew=null}function fk(t,e){if(Ew){var n=t-kw;Dw.add(Yb(n)>180?n+(n>0?360:-360):n)}else Aw=t,Mw=e;Tw.point(t,e),uk(t,e)}function hk(){Tw.lineStart()}function dk(){fk(Aw,Mw),Tw.lineEnd(),Yb(Dw)>Lb&&(_w=-(bw=180)),Fw[0]=_w,Fw[1]=bw,Ew=null}function pk(t,e){return(e-=t)<0?e+360:e}function gk(t,e){return t[0]-e[0]}function mk(t,e){return t[0]<=t[1]?t[0]<=e&&e<=t[1]:e<t[0]||t[1]<e}var yk={sphere:sw,point:vk,lineStart:xk,lineEnd:kk,polygonStart:function(){yk.lineStart=Ak,yk.lineEnd=Mk},polygonEnd:function(){yk.lineStart=xk,yk.lineEnd=kk}};function vk(t,e){t*=Hb;var n=Xb(e*=Hb);_k(n*Xb(t),n*ew(t),ew(e))}function _k(t,e,n){++Ww,Yw+=(t-Yw)/Ww,Gw+=(e-Gw)/Ww,Vw+=(n-Vw)/Ww}function xk(){yk.point=bk}function bk(t,e){t*=Hb;var n=Xb(e*=Hb);rk=n*Xb(t),ik=n*ew(t),ok=ew(e),yk.point=wk,_k(rk,ik,ok)}function wk(t,e){t*=Hb;var n=Xb(e*=Hb),r=n*Xb(t),i=n*ew(t),o=ew(e),a=Vb(rw((a=ik*o-ok*i)*a+(a=ok*r-rk*o)*a+(a=rk*i-ik*r)*a),rk*r+ik*i+ok*o);Hw+=a,Xw+=a*(rk+(rk=r)),Jw+=a*(ik+(ik=i)),Zw+=a*(ok+(ok=o)),_k(rk,ik,ok)}function kk(){yk.point=vk}function Ak(){yk.point=Ek}function Mk(){Dk(ek,nk),yk.point=vk}function Ek(t,e){ek=t,nk=e,t*=Hb,e*=Hb,yk.point=Dk;var n=Xb(e);rk=n*Xb(t),ik=n*ew(t),ok=ew(e),_k(rk,ik,ok)}function Dk(t,e){t*=Hb;var n=Xb(e*=Hb),r=n*Xb(t),i=n*ew(t),o=ew(e),a=ik*o-ok*i,s=ok*r-rk*o,u=rk*i-ik*r,l=Qb(a,s,u),c=aw(l),f=l&&-c/l;Qw.add(f*a),Kw.add(f*s),tk.add(f*u),Hw+=c,Xw+=c*(rk+(rk=r)),Jw+=c*(ik+(ik=i)),Zw+=c*(ok+(ok=o)),_k(rk,ik,ok)}function Ck(t,e){function n(n,r){return n=t(n,r),e(n[0],n[1])}return t.invert&&e.invert&&(n.invert=function(n,r){return(n=e.invert(n,r))&&t.invert(n[0],n[1])}),n}function Fk(t,e){return Yb(t)>qb&&(t-=Math.round(t/Ib)*Ib),[t,e]}function Sk(t,e,n){return(t%=Ib)?e||n?Ck(Tk(t),Bk(e,n)):Tk(t):e||n?Bk(e,n):Fk}function $k(t){return function(e,n){return Yb(e+=t)>qb&&(e-=Math.round(e/Ib)*Ib),[e,n]}}function Tk(t){var e=$k(t);return e.invert=$k(-t),e}function Bk(t,e){var n=Xb(t),r=ew(t),i=Xb(e),o=ew(e);function a(t,e){var a=Xb(e),s=Xb(t)*a,u=ew(t)*a,l=ew(e),c=l*n+s*r;return[Vb(u*i-c*o,s*n-l*r),aw(c*i+u*o)]}return a.invert=function(t,e){var a=Xb(e),s=Xb(t)*a,u=ew(t)*a,l=ew(e),c=l*i-u*o;return[Vb(u*i+l*o,s*n+c*r),aw(c*n-s*r)]},a}function zk(t,e){(e=Lw(e))[0]-=t,Iw(e);var n=ow(-e[1]);return((-e[2]<0?-n:n)+Ib-Lb)%Ib}function Nk(){var t,e=[];return{point:function(e,n,r){t.push([e,n,r])},lineStart:function(){e.push(t=[])},lineEnd:sw,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function Ok(t,e){return Yb(t[0]-e[0])<Lb&&Yb(t[1]-e[1])<Lb}function Rk(t,e,n,r){this.x=t,this.z=e,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function Lk(t,e,n,r,i){var o,a,s=[],u=[];if(t.forEach((function(t){if(!((e=t.length-1)<=0)){var e,n,r=t[0],a=t[e];if(Ok(r,a)){if(!r[2]&&!a[2]){for(i.lineStart(),o=0;o<e;++o)i.point((r=t[o])[0],r[1]);return void i.lineEnd()}a[0]+=2*Lb}s.push(n=new Rk(r,t,null,!0)),u.push(n.o=new Rk(r,null,n,!1)),s.push(n=new Rk(a,t,null,!1)),u.push(n.o=new Rk(a,null,n,!0))}})),s.length){for(u.sort(e),Uk(s),Uk(u),o=0,a=u.length;o<a;++o)u[o].e=n=!n;for(var l,c,f=s[0];;){for(var h=f,d=!0;h.v;)if((h=h.n)===f)return;l=h.z,i.lineStart();do{if(h.v=h.o.v=!0,h.e){if(d)for(o=0,a=l.length;o<a;++o)i.point((c=l[o])[0],c[1]);else r(h.x,h.n.x,1,i);h=h.n}else{if(d)for(l=h.p.z,o=l.length-1;o>=0;--o)i.point((c=l[o])[0],c[1]);else r(h.x,h.p.x,-1,i);h=h.p}l=(h=h.o).z,d=!d}while(!h.v);i.lineEnd()}}}function Uk(t){if(e=t.length){for(var e,n,r=0,i=t[0];++r<e;)i.n=n=t[r],n.p=i,i=n;i.n=n=t[0],n.p=i}}function qk(t){return Yb(t[0])<=qb?t[0]:nw(t[0])*((Yb(t[0])+qb)%Ib-qb)}function Pk(t,e,n,r){return function(i){var o,a,s,u=e(i),l=Nk(),c=e(l),f=!1,h={point:d,lineStart:g,lineEnd:m,polygonStart:function(){h.point=y,h.lineStart=v,h.lineEnd=_,a=[],o=[]},polygonEnd:function(){h.point=d,h.lineStart=g,h.lineEnd=m,a=Ce(a);var t=function(t,e){var n=qk(e),r=e[1],i=ew(r),o=[ew(n),-Xb(n),0],a=0,s=0,u=new ae;1===i?r=Pb+Lb:-1===i&&(r=-Pb-Lb);for(var l=0,c=t.length;l<c;++l)if(h=(f=t[l]).length)for(var f,h,d=f[h-1],p=qk(d),g=d[1]/2+jb,m=ew(g),y=Xb(g),v=0;v<h;++v,p=x,m=w,y=k,d=_){var _=f[v],x=qk(_),b=_[1]/2+jb,w=ew(b),k=Xb(b),A=x-p,M=A>=0?1:-1,E=M*A,D=E>qb,C=m*w;if(u.add(Vb(C*M*ew(E),y*k+C*Xb(E))),a+=D?A+M*Ib:A,D^p>=n^x>=n){var F=qw(Lw(d),Lw(_));Iw(F);var S=qw(o,F);Iw(S);var $=(D^A>=0?-1:1)*aw(S[2]);(r>$||r===$&&(F[0]||F[1]))&&(s+=D^A>=0?1:-1)}}return(a<-1e-6||a<Lb&&u<-1e-12)^1&s}(o,r);a.length?(f||(i.polygonStart(),f=!0),Lk(a,Ik,t,n,i)):t&&(f||(i.polygonStart(),f=!0),i.lineStart(),n(null,null,1,i),i.lineEnd()),f&&(i.polygonEnd(),f=!1),a=o=null},sphere:function(){i.polygonStart(),i.lineStart(),n(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function d(e,n){t(e,n)&&i.point(e,n)}function p(t,e){u.point(t,e)}function g(){h.point=p,u.lineStart()}function m(){h.point=d,u.lineEnd()}function y(t,e){s.push([t,e]),c.point(t,e)}function v(){c.lineStart(),s=[]}function _(){y(s[0][0],s[0][1]),c.lineEnd();var t,e,n,r,u=c.clean(),h=l.result(),d=h.length;if(s.pop(),o.push(s),s=null,d)if(1&u){if((e=(n=h[0]).length-1)>0){for(f||(i.polygonStart(),f=!0),i.lineStart(),t=0;t<e;++t)i.point((r=n[t])[0],r[1]);i.lineEnd()}}else d>1&&2&u&&h.push(h.pop().concat(h.shift())),a.push(h.filter(jk))}return h}}function jk(t){return t.length>1}function Ik(t,e){return((t=t.x)[0]<0?t[1]-Pb-Lb:Pb-t[1])-((e=e.x)[0]<0?e[1]-Pb-Lb:Pb-e[1])}Fk.invert=Fk;var Wk=Pk((function(){return!0}),(function(t){var e,n=NaN,r=NaN,i=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(o,a){var s=o>0?qb:-qb,u=Yb(o-n);Yb(u-qb)<Lb?(t.point(n,r=(r+a)/2>0?Pb:-Pb),t.point(i,r),t.lineEnd(),t.lineStart(),t.point(s,r),t.point(o,r),e=0):i!==s&&u>=qb&&(Yb(n-i)<Lb&&(n-=i*Lb),Yb(o-s)<Lb&&(o-=s*Lb),r=function(t,e,n,r){var i,o,a=ew(t-n);return Yb(a)>Lb?Gb((ew(e)*(o=Xb(r))*ew(n)-ew(r)*(i=Xb(e))*ew(t))/(i*o*a)):(e+r)/2}(n,r,o,a),t.point(i,r),t.lineEnd(),t.lineStart(),t.point(s,r),e=0),t.point(n=o,r=a),i=s},lineEnd:function(){t.lineEnd(),n=r=NaN},clean:function(){return 2-e}}}),(function(t,e,n,r){var i;if(null==t)i=n*Pb,r.point(-qb,i),r.point(0,i),r.point(qb,i),r.point(qb,0),r.point(qb,-i),r.point(0,-i),r.point(-qb,-i),r.point(-qb,0),r.point(-qb,i);else if(Yb(t[0]-e[0])>Lb){var o=t[0]<e[0]?qb:-qb;i=n*o/2,r.point(-o,i),r.point(0,i),r.point(o,i)}else r.point(e[0],e[1])}),[-qb,-Pb]);function Hk(t){var e=Xb(t),n=6*Hb,r=e>0,i=Yb(e)>Lb;function o(t,n){return Xb(t)*Xb(n)>e}function a(t,n,r){var i=[1,0,0],o=qw(Lw(t),Lw(n)),a=Uw(o,o),s=o[0],u=a-s*s;if(!u)return!r&&t;var l=e*a/u,c=-e*s/u,f=qw(i,o),h=jw(i,l);Pw(h,jw(o,c));var d=f,p=Uw(h,d),g=Uw(d,d),m=p*p-g*(Uw(h,h)-1);if(!(m<0)){var y=rw(m),v=jw(d,(-p-y)/g);if(Pw(v,h),v=Rw(v),!r)return v;var _,x=t[0],b=n[0],w=t[1],k=n[1];b<x&&(_=x,x=b,b=_);var A=b-x,M=Yb(A-qb)<Lb;if(!M&&k<w&&(_=w,w=k,k=_),M||A<Lb?M?w+k>0^v[1]<(Yb(v[0]-x)<Lb?w:k):w<=v[1]&&v[1]<=k:A>qb^(x<=v[0]&&v[0]<=b)){var E=jw(d,(-p+y)/g);return Pw(E,h),[v,Rw(E)]}}}function s(e,n){var i=r?t:qb-t,o=0;return e<-i?o|=1:e>i&&(o|=2),n<-i?o|=4:n>i&&(o|=8),o}return Pk(o,(function(t){var e,n,u,l,c;return{lineStart:function(){l=u=!1,c=1},point:function(f,h){var d,p=[f,h],g=o(f,h),m=r?g?0:s(f,h):g?s(f+(f<0?qb:-qb),h):0;if(!e&&(l=u=g)&&t.lineStart(),g!==u&&(!(d=a(e,p))||Ok(e,d)||Ok(p,d))&&(p[2]=1),g!==u)c=0,g?(t.lineStart(),d=a(p,e),t.point(d[0],d[1])):(d=a(e,p),t.point(d[0],d[1],2),t.lineEnd()),e=d;else if(i&&e&&r^g){var y;m&n||!(y=a(p,e,!0))||(c=0,r?(t.lineStart(),t.point(y[0][0],y[0][1]),t.point(y[1][0],y[1][1]),t.lineEnd()):(t.point(y[1][0],y[1][1]),t.lineEnd(),t.lineStart(),t.point(y[0][0],y[0][1],3)))}!g||e&&Ok(e,p)||t.point(p[0],p[1]),e=p,u=g,n=m},lineEnd:function(){u&&t.lineEnd(),e=null},clean:function(){return c|(l&&u)<<1}}}),(function(e,r,i,o){!function(t,e,n,r,i,o){if(n){var a=Xb(e),s=ew(e),u=r*n;null==i?(i=e+r*Ib,o=e-u/2):(i=zk(a,i),o=zk(a,o),(r>0?i<o:i>o)&&(i+=r*Ib));for(var l,c=i;r>0?c>o:c<o;c-=u)l=Rw([a,-s*Xb(c),-s*ew(c)]),t.point(l[0],l[1])}}(o,t,n,i,e,r)}),r?[0,-t]:[-qb,t-qb])}var Yk=1e9,Gk=-1e9;function Vk(t,e,n,r){function i(i,o){return t<=i&&i<=n&&e<=o&&o<=r}function o(i,o,s,l){var c=0,f=0;if(null==i||(c=a(i,s))!==(f=a(o,s))||u(i,o)<0^s>0)do{l.point(0===c||3===c?t:n,c>1?r:e)}while((c=(c+s+4)%4)!==f);else l.point(o[0],o[1])}function a(r,i){return Yb(r[0]-t)<Lb?i>0?0:3:Yb(r[0]-n)<Lb?i>0?2:1:Yb(r[1]-e)<Lb?i>0?1:0:i>0?3:2}function s(t,e){return u(t.x,e.x)}function u(t,e){var n=a(t,1),r=a(e,1);return n!==r?n-r:0===n?e[1]-t[1]:1===n?t[0]-e[0]:2===n?t[1]-e[1]:e[0]-t[0]}return function(a){var u,l,c,f,h,d,p,g,m,y,v,_=a,x=Nk(),b={point:w,lineStart:function(){b.point=k,l&&l.push(c=[]);y=!0,m=!1,p=g=NaN},lineEnd:function(){u&&(k(f,h),d&&m&&x.rejoin(),u.push(x.result()));b.point=w,m&&_.lineEnd()},polygonStart:function(){_=x,u=[],l=[],v=!0},polygonEnd:function(){var e=function(){for(var e=0,n=0,i=l.length;n<i;++n)for(var o,a,s=l[n],u=1,c=s.length,f=s[0],h=f[0],d=f[1];u<c;++u)o=h,a=d,h=(f=s[u])[0],d=f[1],a<=r?d>r&&(h-o)*(r-a)>(d-a)*(t-o)&&++e:d<=r&&(h-o)*(r-a)<(d-a)*(t-o)&&--e;return e}(),n=v&&e,i=(u=Ce(u)).length;(n||i)&&(a.polygonStart(),n&&(a.lineStart(),o(null,null,1,a),a.lineEnd()),i&&Lk(u,s,e,o,a),a.polygonEnd());_=a,u=l=c=null}};function w(t,e){i(t,e)&&_.point(t,e)}function k(o,a){var s=i(o,a);if(l&&c.push([o,a]),y)f=o,h=a,d=s,y=!1,s&&(_.lineStart(),_.point(o,a));else if(s&&m)_.point(o,a);else{var u=[p=Math.max(Gk,Math.min(Yk,p)),g=Math.max(Gk,Math.min(Yk,g))],x=[o=Math.max(Gk,Math.min(Yk,o)),a=Math.max(Gk,Math.min(Yk,a))];!function(t,e,n,r,i,o){var a,s=t[0],u=t[1],l=0,c=1,f=e[0]-s,h=e[1]-u;if(a=n-s,f||!(a>0)){if(a/=f,f<0){if(a<l)return;a<c&&(c=a)}else if(f>0){if(a>c)return;a>l&&(l=a)}if(a=i-s,f||!(a<0)){if(a/=f,f<0){if(a>c)return;a>l&&(l=a)}else if(f>0){if(a<l)return;a<c&&(c=a)}if(a=r-u,h||!(a>0)){if(a/=h,h<0){if(a<l)return;a<c&&(c=a)}else if(h>0){if(a>c)return;a>l&&(l=a)}if(a=o-u,h||!(a<0)){if(a/=h,h<0){if(a>c)return;a>l&&(l=a)}else if(h>0){if(a<l)return;a<c&&(c=a)}return l>0&&(t[0]=s+l*f,t[1]=u+l*h),c<1&&(e[0]=s+c*f,e[1]=u+c*h),!0}}}}}(u,x,t,e,n,r)?s&&(_.lineStart(),_.point(o,a),v=!1):(m||(_.lineStart(),_.point(u[0],u[1])),_.point(x[0],x[1]),s||_.lineEnd(),v=!1)}p=o,g=a,m=s}return b}}function Xk(t,e,n){var r=Fe(t,e-Lb,n).concat(e);return function(t){return r.map((function(e){return[t,e]}))}}function Jk(t,e,n){var r=Fe(t,e-Lb,n).concat(e);return function(t){return r.map((function(e){return[e,t]}))}}var Zk,Qk,Kk,tA,eA=t=>t,nA=new ae,rA=new ae,iA={point:sw,lineStart:sw,lineEnd:sw,polygonStart:function(){iA.lineStart=oA,iA.lineEnd=uA},polygonEnd:function(){iA.lineStart=iA.lineEnd=iA.point=sw,nA.add(Yb(rA)),rA=new ae},result:function(){var t=nA/2;return nA=new ae,t}};function oA(){iA.point=aA}function aA(t,e){iA.point=sA,Zk=Kk=t,Qk=tA=e}function sA(t,e){rA.add(tA*t-Kk*e),Kk=t,tA=e}function uA(){sA(Zk,Qk)}var lA=1/0,cA=lA,fA=-lA,hA=fA,dA={point:function(t,e){t<lA&&(lA=t);t>fA&&(fA=t);e<cA&&(cA=e);e>hA&&(hA=e)},lineStart:sw,lineEnd:sw,polygonStart:sw,polygonEnd:sw,result:function(){var t=[[lA,cA],[fA,hA]];return fA=hA=-(cA=lA=1/0),t}};var pA,gA,mA,yA,vA=0,_A=0,xA=0,bA=0,wA=0,kA=0,AA=0,MA=0,EA=0,DA={point:CA,lineStart:FA,lineEnd:TA,polygonStart:function(){DA.lineStart=BA,DA.lineEnd=zA},polygonEnd:function(){DA.point=CA,DA.lineStart=FA,DA.lineEnd=TA},result:function(){var t=EA?[AA/EA,MA/EA]:kA?[bA/kA,wA/kA]:xA?[vA/xA,_A/xA]:[NaN,NaN];return vA=_A=xA=bA=wA=kA=AA=MA=EA=0,t}};function CA(t,e){vA+=t,_A+=e,++xA}function FA(){DA.point=SA}function SA(t,e){DA.point=$A,CA(mA=t,yA=e)}function $A(t,e){var n=t-mA,r=e-yA,i=rw(n*n+r*r);bA+=i*(mA+t)/2,wA+=i*(yA+e)/2,kA+=i,CA(mA=t,yA=e)}function TA(){DA.point=CA}function BA(){DA.point=NA}function zA(){OA(pA,gA)}function NA(t,e){DA.point=OA,CA(pA=mA=t,gA=yA=e)}function OA(t,e){var n=t-mA,r=e-yA,i=rw(n*n+r*r);bA+=i*(mA+t)/2,wA+=i*(yA+e)/2,kA+=i,AA+=(i=yA*t-mA*e)*(mA+t),MA+=i*(yA+e),EA+=3*i,CA(mA=t,yA=e)}function RA(t){this._context=t}RA.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._context.moveTo(t,e),this._point=1;break;case 1:this._context.lineTo(t,e);break;default:this._context.moveTo(t+this._radius,e),this._context.arc(t,e,this._radius,0,Ib)}},result:sw};var LA,UA,qA,PA,jA,IA=new ae,WA={point:sw,lineStart:function(){WA.point=HA},lineEnd:function(){LA&&YA(UA,qA),WA.point=sw},polygonStart:function(){LA=!0},polygonEnd:function(){LA=null},result:function(){var t=+IA;return IA=new ae,t}};function HA(t,e){WA.point=YA,UA=PA=t,qA=jA=e}function YA(t,e){PA-=t,jA-=e,IA.add(rw(PA*PA+jA*jA)),PA=t,jA=e}let GA,VA,XA,JA;class ZA{constructor(t){this._append=null==t?QA:function(t){const e=Math.floor(t);if(!(e>=0))throw new RangeError(`invalid digits: ${t}`);if(e>15)return QA;if(e!==GA){const t=10**e;GA=e,VA=function(e){let n=1;this._+=e[0];for(const r=e.length;n<r;++n)this._+=Math.round(arguments[n]*t)/t+e[n]}}return VA}(t),this._radius=4.5,this._=""}pointRadius(t){return this._radius=+t,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){0===this._line&&(this._+="Z"),this._point=NaN}point(t,e){switch(this._point){case 0:this._append`M${t},${e}`,this._point=1;break;case 1:this._append`L${t},${e}`;break;default:if(this._append`M${t},${e}`,this._radius!==XA||this._append!==VA){const t=this._radius,e=this._;this._="",this._append`m0,${t}a${t},${t} 0 1,1 0,${-2*t}a${t},${t} 0 1,1 0,${2*t}z`,XA=t,VA=this._append,JA=this._,this._=e}this._+=JA}}result(){const t=this._;return this._="",t.length?t:null}}function QA(t){let e=1;this._+=t[0];for(const n=t.length;e<n;++e)this._+=arguments[e]+t[e]}function KA(t,e){let n,r,i=3,o=4.5;function a(t){return t&&("function"==typeof o&&r.pointRadius(+o.apply(this,arguments)),dw(t,n(r))),r.result()}return a.area=function(t){return dw(t,n(iA)),iA.result()},a.measure=function(t){return dw(t,n(WA)),WA.result()},a.bounds=function(t){return dw(t,n(dA)),dA.result()},a.centroid=function(t){return dw(t,n(DA)),DA.result()},a.projection=function(e){return arguments.length?(n=null==e?(t=null,eA):(t=e).stream,a):t},a.context=function(t){return arguments.length?(r=null==t?(e=null,new ZA(i)):new RA(e=t),"function"!=typeof o&&r.pointRadius(o),a):e},a.pointRadius=function(t){return arguments.length?(o="function"==typeof t?t:(r.pointRadius(+t),+t),a):o},a.digits=function(t){if(!arguments.length)return i;if(null==t)i=null;else{const e=Math.floor(t);if(!(e>=0))throw new RangeError(`invalid digits: ${t}`);i=e}return null===e&&(r=new ZA(i)),a},a.projection(t).digits(i).context(e)}function tM(t){return function(e){var n=new eM;for(var r in t)n[r]=t[r];return n.stream=e,n}}function eM(){}function nM(t,e,n){var r=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),null!=r&&t.clipExtent(null),dw(n,t.stream(dA)),e(dA.result()),null!=r&&t.clipExtent(r),t}function rM(t,e,n){return nM(t,(function(n){var r=e[1][0]-e[0][0],i=e[1][1]-e[0][1],o=Math.min(r/(n[1][0]-n[0][0]),i/(n[1][1]-n[0][1])),a=+e[0][0]+(r-o*(n[1][0]+n[0][0]))/2,s=+e[0][1]+(i-o*(n[1][1]+n[0][1]))/2;t.scale(150*o).translate([a,s])}),n)}function iM(t,e,n){return rM(t,[[0,0],e],n)}function oM(t,e,n){return nM(t,(function(n){var r=+e,i=r/(n[1][0]-n[0][0]),o=(r-i*(n[1][0]+n[0][0]))/2,a=-i*n[0][1];t.scale(150*i).translate([o,a])}),n)}function aM(t,e,n){return nM(t,(function(n){var r=+e,i=r/(n[1][1]-n[0][1]),o=-i*n[0][0],a=(r-i*(n[1][1]+n[0][1]))/2;t.scale(150*i).translate([o,a])}),n)}eM.prototype={constructor:eM,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var sM=16,uM=Xb(30*Hb);function lM(t,e){return+e?function(t,e){function n(r,i,o,a,s,u,l,c,f,h,d,p,g,m){var y=l-r,v=c-i,_=y*y+v*v;if(_>4*e&&g--){var x=a+h,b=s+d,w=u+p,k=rw(x*x+b*b+w*w),A=aw(w/=k),M=Yb(Yb(w)-1)<Lb||Yb(o-f)<Lb?(o+f)/2:Vb(b,x),E=t(M,A),D=E[0],C=E[1],F=D-r,S=C-i,$=v*F-y*S;($*$/_>e||Yb((y*F+v*S)/_-.5)>.3||a*h+s*d+u*p<uM)&&(n(r,i,o,a,s,u,D,C,M,x/=k,b/=k,w,g,m),m.point(D,C),n(D,C,M,x,b,w,l,c,f,h,d,p,g,m))}}return function(e){var r,i,o,a,s,u,l,c,f,h,d,p,g={point:m,lineStart:y,lineEnd:_,polygonStart:function(){e.polygonStart(),g.lineStart=x},polygonEnd:function(){e.polygonEnd(),g.lineStart=y}};function m(n,r){n=t(n,r),e.point(n[0],n[1])}function y(){c=NaN,g.point=v,e.lineStart()}function v(r,i){var o=Lw([r,i]),a=t(r,i);n(c,f,l,h,d,p,c=a[0],f=a[1],l=r,h=o[0],d=o[1],p=o[2],sM,e),e.point(c,f)}function _(){g.point=m,e.lineEnd()}function x(){y(),g.point=b,g.lineEnd=w}function b(t,e){v(r=t,e),i=c,o=f,a=h,s=d,u=p,g.point=v}function w(){n(c,f,l,h,d,p,i,o,r,a,s,u,sM,e),g.lineEnd=_,_()}return g}}(t,e):function(t){return tM({point:function(e,n){e=t(e,n),this.stream.point(e[0],e[1])}})}(t)}var cM=tM({point:function(t,e){this.stream.point(t*Hb,e*Hb)}});function fM(t,e,n,r,i,o){if(!o)return function(t,e,n,r,i){function o(o,a){return[e+t*(o*=r),n-t*(a*=i)]}return o.invert=function(o,a){return[(o-e)/t*r,(n-a)/t*i]},o}(t,e,n,r,i);var a=Xb(o),s=ew(o),u=a*t,l=s*t,c=a/t,f=s/t,h=(s*n-a*e)/t,d=(s*e+a*n)/t;function p(t,o){return[u*(t*=r)-l*(o*=i)+e,n-l*t-u*o]}return p.invert=function(t,e){return[r*(c*t-f*e+h),i*(d-f*t-c*e)]},p}function hM(t){return dM((function(){return t}))()}function dM(t){var e,n,r,i,o,a,s,u,l,c,f=150,h=480,d=250,p=0,g=0,m=0,y=0,v=0,_=0,x=1,b=1,w=null,k=Wk,A=null,M=eA,E=.5;function D(t){return u(t[0]*Hb,t[1]*Hb)}function C(t){return(t=u.invert(t[0],t[1]))&&[t[0]*Wb,t[1]*Wb]}function F(){var t=fM(f,0,0,x,b,_).apply(null,e(p,g)),r=fM(f,h-t[0],d-t[1],x,b,_);return n=Sk(m,y,v),s=Ck(e,r),u=Ck(n,s),a=lM(s,E),S()}function S(){return l=c=null,D}return D.stream=function(t){return l&&c===t?l:l=cM(function(t){return tM({point:function(e,n){var r=t(e,n);return this.stream.point(r[0],r[1])}})}(n)(k(a(M(c=t)))))},D.preclip=function(t){return arguments.length?(k=t,w=void 0,S()):k},D.postclip=function(t){return arguments.length?(M=t,A=r=i=o=null,S()):M},D.clipAngle=function(t){return arguments.length?(k=+t?Hk(w=t*Hb):(w=null,Wk),S()):w*Wb},D.clipExtent=function(t){return arguments.length?(M=null==t?(A=r=i=o=null,eA):Vk(A=+t[0][0],r=+t[0][1],i=+t[1][0],o=+t[1][1]),S()):null==A?null:[[A,r],[i,o]]},D.scale=function(t){return arguments.length?(f=+t,F()):f},D.translate=function(t){return arguments.length?(h=+t[0],d=+t[1],F()):[h,d]},D.center=function(t){return arguments.length?(p=t[0]%360*Hb,g=t[1]%360*Hb,F()):[p*Wb,g*Wb]},D.rotate=function(t){return arguments.length?(m=t[0]%360*Hb,y=t[1]%360*Hb,v=t.length>2?t[2]%360*Hb:0,F()):[m*Wb,y*Wb,v*Wb]},D.angle=function(t){return arguments.length?(_=t%360*Hb,F()):_*Wb},D.reflectX=function(t){return arguments.length?(x=t?-1:1,F()):x<0},D.reflectY=function(t){return arguments.length?(b=t?-1:1,F()):b<0},D.precision=function(t){return arguments.length?(a=lM(s,E=t*t),S()):rw(E)},D.fitExtent=function(t,e){return rM(D,t,e)},D.fitSize=function(t,e){return iM(D,t,e)},D.fitWidth=function(t,e){return oM(D,t,e)},D.fitHeight=function(t,e){return aM(D,t,e)},function(){return e=t.apply(this,arguments),D.invert=e.invert&&C,F()}}function pM(t){var e=0,n=qb/3,r=dM(t),i=r(e,n);return i.parallels=function(t){return arguments.length?r(e=t[0]*Hb,n=t[1]*Hb):[e*Wb,n*Wb]},i}function gM(t,e){var n=ew(t),r=(n+ew(e))/2;if(Yb(r)<Lb)return function(t){var e=Xb(t);function n(t,n){return[t*e,ew(n)/e]}return n.invert=function(t,n){return[t/e,aw(n*e)]},n}(t);var i=1+n*(2*r-n),o=rw(i)/r;function a(t,e){var n=rw(i-2*r*ew(e))/r;return[n*ew(t*=r),o-n*Xb(t)]}return a.invert=function(t,e){var n=o-e,a=Vb(t,Yb(n))*nw(n);return n*r<0&&(a-=qb*nw(t)*nw(n)),[a/r,aw((i-(t*t+n*n)*r*r)/(2*r))]},a}function mM(){return pM(gM).scale(155.424).center([0,33.6442])}function yM(){return mM().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function vM(t){return function(e,n){var r=Xb(e),i=Xb(n),o=t(r*i);return o===1/0?[2,0]:[o*i*ew(e),o*ew(n)]}}function _M(t){return function(e,n){var r=rw(e*e+n*n),i=t(r),o=ew(i),a=Xb(i);return[Vb(e*o,r*a),aw(r&&n*o/r)]}}var xM=vM((function(t){return rw(2/(1+t))}));xM.invert=_M((function(t){return 2*aw(t/2)}));var bM=vM((function(t){return(t=ow(t))&&t/ew(t)}));function wM(t,e){return[t,Kb(iw((Pb+e)/2))]}function kM(t){var e,n,r,i=hM(t),o=i.center,a=i.scale,s=i.translate,u=i.clipExtent,l=null;function c(){var o=qb*a(),s=i(function(t){function e(e){return(e=t(e[0]*Hb,e[1]*Hb))[0]*=Wb,e[1]*=Wb,e}return t=Sk(t[0]*Hb,t[1]*Hb,t.length>2?t[2]*Hb:0),e.invert=function(e){return(e=t.invert(e[0]*Hb,e[1]*Hb))[0]*=Wb,e[1]*=Wb,e},e}(i.rotate()).invert([0,0]));return u(null==l?[[s[0]-o,s[1]-o],[s[0]+o,s[1]+o]]:t===wM?[[Math.max(s[0]-o,l),e],[Math.min(s[0]+o,n),r]]:[[l,Math.max(s[1]-o,e)],[n,Math.min(s[1]+o,r)]])}return i.scale=function(t){return arguments.length?(a(t),c()):a()},i.translate=function(t){return arguments.length?(s(t),c()):s()},i.center=function(t){return arguments.length?(o(t),c()):o()},i.clipExtent=function(t){return arguments.length?(null==t?l=e=n=r=null:(l=+t[0][0],e=+t[0][1],n=+t[1][0],r=+t[1][1]),c()):null==l?null:[[l,e],[n,r]]},c()}function AM(t){return iw((Pb+t)/2)}function MM(t,e){var n=Xb(t),r=t===e?ew(t):Kb(n/Xb(e))/Kb(AM(e)/AM(t)),i=n*tw(AM(t),r)/r;if(!r)return wM;function o(t,e){i>0?e<-Pb+Lb&&(e=-Pb+Lb):e>Pb-Lb&&(e=Pb-Lb);var n=i/tw(AM(e),r);return[n*ew(r*t),i-n*Xb(r*t)]}return o.invert=function(t,e){var n=i-e,o=nw(r)*rw(t*t+n*n),a=Vb(t,Yb(n))*nw(n);return n*r<0&&(a-=qb*nw(t)*nw(n)),[a/r,2*Gb(tw(i/o,1/r))-Pb]},o}function EM(t,e){return[t,e]}function DM(t,e){var n=Xb(t),r=t===e?ew(t):(n-Xb(e))/(e-t),i=n/r+t;if(Yb(r)<Lb)return EM;function o(t,e){var n=i-e,o=r*t;return[n*ew(o),i-n*Xb(o)]}return o.invert=function(t,e){var n=i-e,o=Vb(t,Yb(n))*nw(n);return n*r<0&&(o-=qb*nw(t)*nw(n)),[o/r,i-nw(r)*rw(t*t+n*n)]},o}bM.invert=_M((function(t){return t})),wM.invert=function(t,e){return[t,2*Gb(Zb(e))-Pb]},EM.invert=EM;var CM=1.340264,FM=-.081106,SM=893e-6,$M=.003796,TM=rw(3)/2;function BM(t,e){var n=aw(TM*ew(e)),r=n*n,i=r*r*r;return[t*Xb(n)/(TM*(CM+3*FM*r+i*(7*SM+9*$M*r))),n*(CM+FM*r+i*(SM+$M*r))]}function zM(t,e){var n=Xb(e),r=Xb(t)*n;return[n*ew(t)/r,ew(e)/r]}function NM(t,e){var n=e*e,r=n*n;return[t*(.8707-.131979*n+r*(r*(.003971*n-.001529*r)-.013791)),e*(1.007226+n*(.015085+r*(.028874*n-.044475-.005916*r)))]}function OM(t,e){return[Xb(e)*ew(t),ew(e)]}function RM(t,e){var n=Xb(e),r=1+Xb(t)*n;return[n*ew(t)/r,ew(e)/r]}function LM(t,e){return[Kb(iw((Pb+e)/2)),-t]}BM.invert=function(t,e){for(var n,r=e,i=r*r,o=i*i*i,a=0;a<12&&(o=(i=(r-=n=(r*(CM+FM*i+o*(SM+$M*i))-e)/(CM+3*FM*i+o*(7*SM+9*$M*i)))*r)*i*i,!(Yb(n)<Ub));++a);return[TM*t*(CM+3*FM*i+o*(7*SM+9*$M*i))/Xb(r),aw(ew(r)/TM)]},zM.invert=_M(Gb),NM.invert=function(t,e){var n,r=e,i=25;do{var o=r*r,a=o*o;r-=n=(r*(1.007226+o*(.015085+a*(.028874*o-.044475-.005916*a)))-e)/(1.007226+o*(.045255+a*(.259866*o-.311325-.005916*11*a)))}while(Yb(n)>Lb&&--i>0);return[t/(.8707+(o=r*r)*(o*(o*o*o*(.003971-.001529*o)-.013791)-.131979)),r]},OM.invert=_M(aw),RM.invert=_M((function(t){return 2*Gb(t)})),LM.invert=function(t,e){return[-e,2*Gb(Zb(t))-Pb]};var UM=Math.abs,qM=Math.cos,PM=Math.sin,jM=1e-6,IM=Math.PI,WM=IM/2,HM=function(t){return t>0?Math.sqrt(t):0}(2);function YM(t){return t>1?WM:t<-1?-WM:Math.asin(t)}function GM(t,e){var n,r=t*PM(e),i=30;do{e-=n=(e+PM(e)-r)/(1+qM(e))}while(UM(n)>jM&&--i>0);return e/2}var VM=function(t,e,n){function r(r,i){return[t*r*qM(i=GM(n,i)),e*PM(i)]}return r.invert=function(r,i){return i=YM(i/e),[r/(t*qM(i)),YM((2*i+PM(2*i))/n)]},r}(HM/WM,HM,IM);const XM=KA(),JM=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function ZM(t,e){if(!t||"string"!=typeof t)throw new Error("Projection type must be a name string.");return t=t.toLowerCase(),arguments.length>1?(KM[t]=function(t,e){return function n(){const r=e();return r.type=t,r.path=KA().projection(r),r.copy=r.copy||function(){const t=n();return JM.forEach((e=>{r[e]&&t[e](r[e]())})),t.path.pointRadius(r.path.pointRadius()),t},ip(r)}}(t,e),this):KM[t]||null}function QM(t){return t&&t.path||XM}const KM={albers:yM,albersusa:function(){var t,e,n,r,i,o,a=yM(),s=mM().rotate([154,0]).center([-2,58.5]).parallels([55,65]),u=mM().rotate([157,0]).center([-3,19.9]).parallels([8,18]),l={point:function(t,e){o=[t,e]}};function c(t){var e=t[0],a=t[1];return o=null,n.point(e,a),o||(r.point(e,a),o)||(i.point(e,a),o)}function f(){return t=e=null,c}return c.invert=function(t){var e=a.scale(),n=a.translate(),r=(t[0]-n[0])/e,i=(t[1]-n[1])/e;return(i>=.12&&i<.234&&r>=-.425&&r<-.214?s:i>=.166&&i<.234&&r>=-.214&&r<-.115?u:a).invert(t)},c.stream=function(n){return t&&e===n?t:(r=[a.stream(e=n),s.stream(n),u.stream(n)],i=r.length,t={point:function(t,e){for(var n=-1;++n<i;)r[n].point(t,e)},sphere:function(){for(var t=-1;++t<i;)r[t].sphere()},lineStart:function(){for(var t=-1;++t<i;)r[t].lineStart()},lineEnd:function(){for(var t=-1;++t<i;)r[t].lineEnd()},polygonStart:function(){for(var t=-1;++t<i;)r[t].polygonStart()},polygonEnd:function(){for(var t=-1;++t<i;)r[t].polygonEnd()}});var r,i},c.precision=function(t){return arguments.length?(a.precision(t),s.precision(t),u.precision(t),f()):a.precision()},c.scale=function(t){return arguments.length?(a.scale(t),s.scale(.35*t),u.scale(t),c.translate(a.translate())):a.scale()},c.translate=function(t){if(!arguments.length)return a.translate();var e=a.scale(),o=+t[0],c=+t[1];return n=a.translate(t).clipExtent([[o-.455*e,c-.238*e],[o+.455*e,c+.238*e]]).stream(l),r=s.translate([o-.307*e,c+.201*e]).clipExtent([[o-.425*e+Lb,c+.12*e+Lb],[o-.214*e-Lb,c+.234*e-Lb]]).stream(l),i=u.translate([o-.205*e,c+.212*e]).clipExtent([[o-.214*e+Lb,c+.166*e+Lb],[o-.115*e-Lb,c+.234*e-Lb]]).stream(l),f()},c.fitExtent=function(t,e){return rM(c,t,e)},c.fitSize=function(t,e){return iM(c,t,e)},c.fitWidth=function(t,e){return oM(c,t,e)},c.fitHeight=function(t,e){return aM(c,t,e)},c.scale(1070)},azimuthalequalarea:function(){return hM(xM).scale(124.75).clipAngle(179.999)},azimuthalequidistant:function(){return hM(bM).scale(79.4188).clipAngle(179.999)},conicconformal:function(){return pM(MM).scale(109.5).parallels([30,30])},conicequalarea:mM,conicequidistant:function(){return pM(DM).scale(131.154).center([0,13.9389])},equalEarth:function(){return hM(BM).scale(177.158)},equirectangular:function(){return hM(EM).scale(152.63)},gnomonic:function(){return hM(zM).scale(144.049).clipAngle(60)},identity:function(){var t,e,n,r,i,o,a,s=1,u=0,l=0,c=1,f=1,h=0,d=null,p=1,g=1,m=tM({point:function(t,e){var n=_([t,e]);this.stream.point(n[0],n[1])}}),y=eA;function v(){return p=s*c,g=s*f,o=a=null,_}function _(n){var r=n[0]*p,i=n[1]*g;if(h){var o=i*t-r*e;r=r*t+i*e,i=o}return[r+u,i+l]}return _.invert=function(n){var r=n[0]-u,i=n[1]-l;if(h){var o=i*t+r*e;r=r*t-i*e,i=o}return[r/p,i/g]},_.stream=function(t){return o&&a===t?o:o=m(y(a=t))},_.postclip=function(t){return arguments.length?(y=t,d=n=r=i=null,v()):y},_.clipExtent=function(t){return arguments.length?(y=null==t?(d=n=r=i=null,eA):Vk(d=+t[0][0],n=+t[0][1],r=+t[1][0],i=+t[1][1]),v()):null==d?null:[[d,n],[r,i]]},_.scale=function(t){return arguments.length?(s=+t,v()):s},_.translate=function(t){return arguments.length?(u=+t[0],l=+t[1],v()):[u,l]},_.angle=function(n){return arguments.length?(e=ew(h=n%360*Hb),t=Xb(h),v()):h*Wb},_.reflectX=function(t){return arguments.length?(c=t?-1:1,v()):c<0},_.reflectY=function(t){return arguments.length?(f=t?-1:1,v()):f<0},_.fitExtent=function(t,e){return rM(_,t,e)},_.fitSize=function(t,e){return iM(_,t,e)},_.fitWidth=function(t,e){return oM(_,t,e)},_.fitHeight=function(t,e){return aM(_,t,e)},_},mercator:function(){return kM(wM).scale(961/Ib)},mollweide:function(){return hM(VM).scale(169.529)},naturalEarth1:function(){return hM(NM).scale(175.295)},orthographic:function(){return hM(OM).scale(249.5).clipAngle(90+Lb)},stereographic:function(){return hM(RM).scale(250).clipAngle(142)},transversemercator:function(){var t=kM(LM),e=t.center,n=t.rotate;return t.center=function(t){return arguments.length?e([-t[1],t[0]]):[(t=e())[1],-t[0]]},t.rotate=function(t){return arguments.length?n([t[0],t[1],t.length>2?t[2]+90:90]):[(t=n())[0],t[1],t[2]-90]},n([0,0,90]).scale(159.155)}};for(const t in KM)ZM(t,KM[t]);function tE(){}const eE=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function nE(){var t=1,e=1,n=a;function r(t,e){return e.map((e=>i(t,e)))}function i(r,i){var a=[],s=[];return function(n,r,i){var a,s,u,l,c,f,h=[],d=[];a=s=-1,l=n[0]>=r,eE[l<<1].forEach(p);for(;++a<t-1;)u=l,l=n[a+1]>=r,eE[u|l<<1].forEach(p);eE[l<<0].forEach(p);for(;++s<e-1;){for(a=-1,l=n[s*t+t]>=r,c=n[s*t]>=r,eE[l<<1|c<<2].forEach(p);++a<t-1;)u=l,l=n[s*t+t+a+1]>=r,f=c,c=n[s*t+a+1]>=r,eE[u|l<<1|c<<2|f<<3].forEach(p);eE[l|c<<3].forEach(p)}a=-1,c=n[s*t]>=r,eE[c<<2].forEach(p);for(;++a<t-1;)f=c,c=n[s*t+a+1]>=r,eE[c<<2|f<<3].forEach(p);function p(t){var e,n,r=[t[0][0]+a,t[0][1]+s],u=[t[1][0]+a,t[1][1]+s],l=o(r),c=o(u);(e=d[l])?(n=h[c])?(delete d[e.end],delete h[n.start],e===n?(e.ring.push(u),i(e.ring)):h[e.start]=d[n.end]={start:e.start,end:n.end,ring:e.ring.concat(n.ring)}):(delete d[e.end],e.ring.push(u),d[e.end=c]=e):(e=h[c])?(n=d[l])?(delete h[e.start],delete d[n.end],e===n?(e.ring.push(u),i(e.ring)):h[n.start]=d[e.end]={start:n.start,end:e.end,ring:n.ring.concat(e.ring)}):(delete h[e.start],e.ring.unshift(r),h[e.start=l]=e):h[l]=d[c]={start:l,end:c,ring:[r,u]}}eE[c<<3].forEach(p)}(r,i,(t=>{n(t,r,i),function(t){var e=0,n=t.length,r=t[n-1][1]*t[0][0]-t[n-1][0]*t[0][1];for(;++e<n;)r+=t[e-1][1]*t[e][0]-t[e-1][0]*t[e][1];return r}(t)>0?a.push([t]):s.push(t)})),s.forEach((t=>{for(var e,n=0,r=a.length;n<r;++n)if(-1!==rE((e=a[n])[0],t))return void e.push(t)})),{type:"MultiPolygon",value:i,coordinates:a}}function o(e){return 2*e[0]+e[1]*(t+1)*4}function a(n,r,i){n.forEach((n=>{var o,a=n[0],s=n[1],u=0|a,l=0|s,c=r[l*t+u];a>0&&a<t&&u===a&&(o=r[l*t+u-1],n[0]=a+(i-o)/(c-o)-.5),s>0&&s<e&&l===s&&(o=r[(l-1)*t+u],n[1]=s+(i-o)/(c-o)-.5)}))}return r.contour=i,r.size=function(n){if(!arguments.length)return[t,e];var i=Math.floor(n[0]),o=Math.floor(n[1]);return i>=0&&o>=0||s("invalid size"),t=i,e=o,r},r.smooth=function(t){return arguments.length?(n=t?a:tE,r):n===a},r}function rE(t,e){for(var n,r=-1,i=e.length;++r<i;)if(n=iE(t,e[r]))return n;return 0}function iE(t,e){for(var n=e[0],r=e[1],i=-1,o=0,a=t.length,s=a-1;o<a;s=o++){var u=t[o],l=u[0],c=u[1],f=t[s],h=f[0],d=f[1];if(oE(u,f,e))return 0;c>r!=d>r&&n<(h-l)*(r-c)/(d-c)+l&&(i=-i)}return i}function oE(t,e,n){var r,i,o,a;return function(t,e,n){return(e[0]-t[0])*(n[1]-t[1])==(n[0]-t[0])*(e[1]-t[1])}(t,e,n)&&(i=t[r=+(t[0]===e[0])],o=n[r],a=e[r],i<=o&&o<=a||a<=o&&o<=i)}function aE(t,e,n){return function(r){var i=at(r),o=n?Math.min(i[0],0):i[0],a=i[1],s=a-o,u=e?xe(o,a,t):s/(t+1);return Fe(o+u,a,u)}}function sE(t){Xa.call(this,null,t)}function uE(t,e,n,r,i){const o=t.x1||0,a=t.y1||0,s=e*n<0;function u(t){t.forEach(l)}function l(t){s&&t.reverse(),t.forEach(c)}function c(t){t[0]=(t[0]-o)*e+r,t[1]=(t[1]-a)*n+i}return function(t){return t.coordinates.forEach(u),t}}function lE(t,e,n){const r=t>=0?t:ns(e,n);return Math.round((Math.sqrt(4*r*r+1)-1)/2)}function cE(t){return J(t)?t:rt(+t)}function fE(){var t=t=>t[0],e=t=>t[1],n=d,r=[-1,-1],i=960,o=500,a=2;function u(s,u){const l=lE(r[0],s,t)>>a,c=lE(r[1],s,e)>>a,f=l?l+2:0,h=c?c+2:0,d=2*f+(i>>a),p=2*h+(o>>a),g=new Float32Array(d*p),m=new Float32Array(d*p);let y=g;s.forEach((r=>{const i=f+(+t(r)>>a),o=h+(+e(r)>>a);i>=0&&i<d&&o>=0&&o<p&&(g[i+o*d]+=+n(r))})),l>0&&c>0?(hE(d,p,g,m,l),dE(d,p,m,g,c),hE(d,p,g,m,l),dE(d,p,m,g,c),hE(d,p,g,m,l),dE(d,p,m,g,c)):l>0?(hE(d,p,g,m,l),hE(d,p,m,g,l),hE(d,p,g,m,l),y=m):c>0&&(dE(d,p,g,m,c),dE(d,p,m,g,c),dE(d,p,g,m,c),y=m);const v=u?Math.pow(2,-2*a):1/Se(y);for(let t=0,e=d*p;t<e;++t)y[t]*=v;return{values:y,scale:1<<a,width:d,height:p,x1:f,y1:h,x2:f+(i>>a),y2:h+(o>>a)}}return u.x=function(e){return arguments.length?(t=cE(e),u):t},u.y=function(t){return arguments.length?(e=cE(t),u):e},u.weight=function(t){return arguments.length?(n=cE(t),u):n},u.size=function(t){if(!arguments.length)return[i,o];var e=+t[0],n=+t[1];return e>=0&&n>=0||s("invalid size"),i=e,o=n,u},u.cellSize=function(t){return arguments.length?((t=+t)>=1||s("invalid cell size"),a=Math.floor(Math.log(t)/Math.LN2),u):1<<a},u.bandwidth=function(t){return arguments.length?(1===(t=V(t)).length&&(t=[+t[0],+t[0]]),2!==t.length&&s("invalid bandwidth"),r=t,u):r},u}function hE(t,e,n,r,i){const o=1+(i<<1);for(let a=0;a<e;++a)for(let e=0,s=0;e<t+i;++e)e<t&&(s+=n[e+a*t]),e>=i&&(e>=o&&(s-=n[e-o+a*t]),r[e-i+a*t]=s/Math.min(e+1,t-1+o-e,o))}function dE(t,e,n,r,i){const o=1+(i<<1);for(let a=0;a<t;++a)for(let s=0,u=0;s<e+i;++s)s<e&&(u+=n[a+s*t]),s>=i&&(s>=o&&(u-=n[a+(s-o)*t]),r[a+(s-i)*t]=u/Math.min(s+1,e-1+o-s,o))}function pE(t){Xa.call(this,null,t)}sE.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]},ht(sE,Xa,{transform(t,e){if(this.value&&!e.changed()&&!t.modified())return e.StopPropagation;var n=e.fork(e.NO_SOURCE|e.NO_FIELDS),r=e.materialize(e.SOURCE).source,i=t.field||f,o=nE().smooth(!1!==t.smooth),a=t.thresholds||function(t,e,n){const r=aE(n.levels||10,n.nice,!1!==n.zero);return"shared"!==n.resolve?r:r(t.map((t=>be(e(t).values))))}(r,i,t),s=null===t.as?null:t.as||"contour",u=[];return r.forEach((e=>{const n=i(e),r=o.size([n.width,n.height])(n.values,k(a)?a:a(n.values));!function(t,e,n,r){let i=r.scale||e.scale,o=r.translate||e.translate;J(i)&&(i=i(n,r));J(o)&&(o=o(n,r));if((1===i||null==i)&&!o)return;const a=(yt(i)?i:i[0])||1,s=(yt(i)?i:i[1])||1,u=o&&o[0]||0,l=o&&o[1]||0;t.forEach(uE(e,a,s,u,l))}(r,n,e,t),r.forEach((t=>{u.push(xa(e,va(null!=s?{[s]:t}:t)))}))})),this.value&&(n.rem=this.value),this.value=n.source=n.add=u,n}}),pE.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};const gE=["x","y","weight","size","cellSize","bandwidth"];function mE(t,e){return gE.forEach((n=>null!=e[n]?t[n](e[n]):0)),t}function yE(t){Xa.call(this,null,t)}ht(pE,Xa,{transform(t,e){if(this.value&&!e.changed()&&!t.modified())return e.StopPropagation;var r,i=e.fork(e.NO_SOURCE|e.NO_FIELDS),o=function(t,e){var n,r,i,o,a,s,u=[],l=t=>t(o);if(null==e)u.push(t);else for(n={},r=0,i=t.length;r<i;++r)o=t[r],(s=n[a=e.map(l)])||(n[a]=s=[],s.dims=a,u.push(s)),s.push(o);return u}(e.materialize(e.SOURCE).source,t.groupby),a=(t.groupby||[]).map(n),s=mE(fE(),t),u=t.as||"grid";return r=o.map((e=>va(function(t,e){for(let n=0;n<a.length;++n)t[a[n]]=e[n];return t}({[u]:s(e,t.counts)},e.dims)))),this.value&&(i.rem=this.value),this.value=i.source=i.add=r,i}}),yE.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]},ht(yE,Xa,{transform(t,e){if(this.value&&!e.changed()&&!t.modified())return e.StopPropagation;var n,r,i=e.fork(e.NO_SOURCE|e.NO_FIELDS),o=nE().smooth(!1!==t.smooth),a=t.values,s=t.thresholds||aE(t.count||10,t.nice,!!a),u=t.size;return a||(a=e.materialize(e.SOURCE).source,r=uE(n=mE(fE(),t)(a,!0),n.scale||1,n.scale||1,0,0),u=[n.width,n.height],a=n.values),s=k(s)?s:s(a),a=o.size(u)(a,s),r&&a.forEach(r),this.value&&(i.rem=this.value),this.value=i.source=i.add=(a||[]).map(va),i}});const vE="Feature",_E="FeatureCollection";function xE(t){Xa.call(this,null,t)}function bE(t){Xa.call(this,null,t)}function wE(t){Xa.call(this,null,t)}function kE(t){Xa.call(this,null,t)}function AE(t){Xa.call(this,[],t),this.generator=function(){var t,e,n,r,i,o,a,s,u,l,c,f,h=10,d=h,p=90,g=360,m=2.5;function y(){return{type:"MultiLineString",coordinates:v()}}function v(){return Fe(Jb(r/p)*p,n,p).map(c).concat(Fe(Jb(s/g)*g,a,g).map(f)).concat(Fe(Jb(e/h)*h,t,h).filter((function(t){return Yb(t%p)>Lb})).map(u)).concat(Fe(Jb(o/d)*d,i,d).filter((function(t){return Yb(t%g)>Lb})).map(l))}return y.lines=function(){return v().map((function(t){return{type:"LineString",coordinates:t}}))},y.outline=function(){return{type:"Polygon",coordinates:[c(r).concat(f(a).slice(1),c(n).reverse().slice(1),f(s).reverse().slice(1))]}},y.extent=function(t){return arguments.length?y.extentMajor(t).extentMinor(t):y.extentMinor()},y.extentMajor=function(t){return arguments.length?(r=+t[0][0],n=+t[1][0],s=+t[0][1],a=+t[1][1],r>n&&(t=r,r=n,n=t),s>a&&(t=s,s=a,a=t),y.precision(m)):[[r,s],[n,a]]},y.extentMinor=function(n){return arguments.length?(e=+n[0][0],t=+n[1][0],o=+n[0][1],i=+n[1][1],e>t&&(n=e,e=t,t=n),o>i&&(n=o,o=i,i=n),y.precision(m)):[[e,o],[t,i]]},y.step=function(t){return arguments.length?y.stepMajor(t).stepMinor(t):y.stepMinor()},y.stepMajor=function(t){return arguments.length?(p=+t[0],g=+t[1],y):[p,g]},y.stepMinor=function(t){return arguments.length?(h=+t[0],d=+t[1],y):[h,d]},y.precision=function(h){return arguments.length?(m=+h,u=Xk(o,i,90),l=Jk(e,t,m),c=Xk(s,a,90),f=Jk(r,n,m),y):m},y.extentMajor([[-180,-90+Lb],[180,90-Lb]]).extentMinor([[-180,-80-Lb],[180,80+Lb]])}()}function ME(t){Xa.call(this,null,t)}function EE(t){if(!J(t))return!1;const e=Tt(r(t));return e.$x||e.$y||e.$value||e.$max}function DE(t){Xa.call(this,null,t),this.modified(!0)}function CE(t,e,n){J(t[e])&&t[e](n)}xE.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]},ht(xE,Xa,{transform(t,e){var n,i=this._features,o=this._points,a=t.fields,s=a&&a[0],u=a&&a[1],l=t.geojson||!a&&f,c=e.ADD;n=t.modified()||e.changed(e.REM)||e.modified(r(l))||s&&e.modified(r(s))||u&&e.modified(r(u)),this.value&&!n||(c=e.SOURCE,this._features=i=[],this._points=o=[]),l&&e.visit(c,(t=>i.push(l(t)))),s&&u&&(e.visit(c,(t=>{var e=s(t),n=u(t);null!=e&&null!=n&&(e=+e)===e&&(n=+n)===n&&o.push([e,n])})),i=i.concat({type:vE,geometry:{type:"MultiPoint",coordinates:o}})),this.value={type:_E,features:i}}}),bE.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]},ht(bE,Xa,{transform(t,e){var n=e.fork(e.ALL),r=this.value,i=t.field||f,o=t.as||"path",a=n.SOURCE;!r||t.modified()?(this.value=r=QM(t.projection),n.materialize().reflow()):a=i===f||e.modified(i.fields)?n.ADD_MOD:n.ADD;const s=function(t,e){const n=t.pointRadius();t.context(null),null!=e&&t.pointRadius(e);return n}(r,t.pointRadius);return n.visit(a,(t=>t[o]=r(i(t)))),r.pointRadius(s),n.modifies(o)}}),wE.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]},ht(wE,Xa,{transform(t,e){var n,r=t.projection,i=t.fields[0],o=t.fields[1],a=t.as||["x","y"],s=a[0],u=a[1];function l(t){const e=r([i(t),o(t)]);e?(t[s]=e[0],t[u]=e[1]):(t[s]=void 0,t[u]=void 0)}return t.modified()?e=e.materialize().reflow(!0).visit(e.SOURCE,l):(n=e.modified(i.fields)||e.modified(o.fields),e.visit(n?e.ADD_MOD:e.ADD,l)),e.modifies(a)}}),kE.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]},ht(kE,Xa,{transform(t,e){var n=e.fork(e.ALL),r=this.value,i=t.as||"shape",o=n.ADD;return r&&!t.modified()||(this.value=r=function(t,e,n){const r=null==n?n=>t(e(n)):r=>{var i=t.pointRadius(),o=t.pointRadius(n)(e(r));return t.pointRadius(i),o};return r.context=e=>(t.context(e),r),r}(QM(t.projection),t.field||l("datum"),t.pointRadius),n.materialize().reflow(),o=n.SOURCE),n.visit(o,(t=>t[i]=r)),n.modifies(i)}}),AE.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]},ht(AE,Xa,{transform(t,e){var n,r=this.value,i=this.generator;if(!r.length||t.modified())for(const e in t)J(i[e])&&i[e](t[e]);return n=i(),r.length?e.mod.push(ba(r[0],n)):e.add.push(va(n)),r[0]=n,e}}),ME.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]},ht(ME,Xa,{transform(t,e){if(!e.changed()&&!t.modified())return e.StopPropagation;var n=e.materialize(e.SOURCE).source,r="shared"===t.resolve,i=t.field||f,o=function(t,e){let n;J(t)?(n=n=>t(n,e),n.dep=EE(t)):t?n=rt(t):(n=t=>t.$value/t.$max||0,n.dep=!0);return n}(t.opacity,t),a=function(t,e){let n;J(t)?(n=n=>of(t(n,e)),n.dep=EE(t)):n=rt(of(t||"#888"));return n}(t.color,t),s=t.as||"image",u={$x:0,$y:0,$value:0,$max:r?be(n.map((t=>be(i(t).values)))):0};return n.forEach((t=>{const e=i(t),n=ot({},t,u);r||(n.$max=be(e.values||[])),t[s]=function(t,e,n,r){const i=t.width,o=t.height,a=t.x1||0,s=t.y1||0,u=t.x2||i,l=t.y2||o,c=t.values,f=c?t=>c[t]:h,d=Sc(u-a,l-s),p=d.getContext("2d"),g=p.getImageData(0,0,u-a,l-s),m=g.data;for(let t=s,o=0;t<l;++t){e.$y=t-s;for(let s=a,l=t*i;s<u;++s,o+=4){e.$x=s-a,e.$value=f(s+l);const t=n(e);m[o+0]=t.r,m[o+1]=t.g,m[o+2]=t.b,m[o+3]=~~(255*r(e))}}return p.putImageData(g,0,0),d}(e,n,a.dep?a:rt(a(n)),o.dep?o:rt(o(n)))})),e.reflow(!0).modifies(s)}}),ht(DE,Xa,{transform(t,e){let n=this.value;return!n||t.modified("type")?(this.value=n=function(t){const e=ZM((t||"mercator").toLowerCase());e||s("Unrecognized projection type: "+t);return e()}(t.type),JM.forEach((e=>{null!=t[e]&&CE(n,e,t[e])}))):JM.forEach((e=>{t.modified(e)&&CE(n,e,t[e])})),null!=t.pointRadius&&n.path.pointRadius(t.pointRadius),t.fit&&function(t,e){const n=function(t){return t=V(t),1===t.length?t[0]:{type:_E,features:t.reduce(((t,e)=>t.concat(function(t){return t.type===_E?t.features:V(t).filter((t=>null!=t)).map((t=>t.type===vE?t:{type:vE,geometry:t}))}(e))),[])}}(e.fit);e.extent?t.fitExtent(e.extent,n):e.size&&t.fitSize(e.size,n)}(n,t),e.fork(e.NO_SOURCE|e.NO_FIELDS)}});var FE=Object.freeze({__proto__:null,contour:yE,geojson:xE,geopath:bE,geopoint:wE,geoshape:kE,graticule:AE,heatmap:ME,isocontour:sE,kde2d:pE,projection:DE});function SE(t,e,n,r){if(isNaN(e)||isNaN(n))return t;var i,o,a,s,u,l,c,f,h,d=t._root,p={data:r},g=t._x0,m=t._y0,y=t._x1,v=t._y1;if(!d)return t._root=p,t;for(;d.length;)if((l=e>=(o=(g+y)/2))?g=o:y=o,(c=n>=(a=(m+v)/2))?m=a:v=a,i=d,!(d=d[f=c<<1|l]))return i[f]=p,t;if(s=+t._x.call(null,d.data),u=+t._y.call(null,d.data),e===s&&n===u)return p.next=d,i?i[f]=p:t._root=p,t;do{i=i?i[f]=new Array(4):t._root=new Array(4),(l=e>=(o=(g+y)/2))?g=o:y=o,(c=n>=(a=(m+v)/2))?m=a:v=a}while((f=c<<1|l)==(h=(u>=a)<<1|s>=o));return i[h]=d,i[f]=p,t}function $E(t,e,n,r,i){this.node=t,this.x0=e,this.y0=n,this.x1=r,this.y1=i}function TE(t){return t[0]}function BE(t){return t[1]}function zE(t,e,n){var r=new NE(null==e?TE:e,null==n?BE:n,NaN,NaN,NaN,NaN);return null==t?r:r.addAll(t)}function NE(t,e,n,r,i,o){this._x=t,this._y=e,this._x0=n,this._y0=r,this._x1=i,this._y1=o,this._root=void 0}function OE(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var RE=zE.prototype=NE.prototype;function LE(t){return function(){return t}}function UE(t){return 1e-6*(t()-.5)}function qE(t){return t.x+t.vx}function PE(t){return t.y+t.vy}function jE(t){return t.index}function IE(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}RE.copy=function(){var t,e,n=new NE(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=OE(r),n;for(t=[{source:r,target:n._root=new Array(4)}];r=t.pop();)for(var i=0;i<4;++i)(e=r.source[i])&&(e.length?t.push({source:e,target:r.target[i]=new Array(4)}):r.target[i]=OE(e));return n},RE.add=function(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return SE(this.cover(e,n),e,n,t)},RE.addAll=function(t){var e,n,r,i,o=t.length,a=new Array(o),s=new Array(o),u=1/0,l=1/0,c=-1/0,f=-1/0;for(n=0;n<o;++n)isNaN(r=+this._x.call(null,e=t[n]))||isNaN(i=+this._y.call(null,e))||(a[n]=r,s[n]=i,r<u&&(u=r),r>c&&(c=r),i<l&&(l=i),i>f&&(f=i));if(u>c||l>f)return this;for(this.cover(u,l).cover(c,f),n=0;n<o;++n)SE(this,a[n],s[n],t[n]);return this},RE.cover=function(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,r=this._y0,i=this._x1,o=this._y1;if(isNaN(n))i=(n=Math.floor(t))+1,o=(r=Math.floor(e))+1;else{for(var a,s,u=i-n||1,l=this._root;n>t||t>=i||r>e||e>=o;)switch(s=(e<r)<<1|t<n,(a=new Array(4))[s]=l,l=a,u*=2,s){case 0:i=n+u,o=r+u;break;case 1:n=i-u,o=r+u;break;case 2:i=n+u,r=o-u;break;case 3:n=i-u,r=o-u}this._root&&this._root.length&&(this._root=l)}return this._x0=n,this._y0=r,this._x1=i,this._y1=o,this},RE.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},RE.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},RE.find=function(t,e,n){var r,i,o,a,s,u,l,c=this._x0,f=this._y0,h=this._x1,d=this._y1,p=[],g=this._root;for(g&&p.push(new $E(g,c,f,h,d)),null==n?n=1/0:(c=t-n,f=e-n,h=t+n,d=e+n,n*=n);u=p.pop();)if(!(!(g=u.node)||(i=u.x0)>h||(o=u.y0)>d||(a=u.x1)<c||(s=u.y1)<f))if(g.length){var m=(i+a)/2,y=(o+s)/2;p.push(new $E(g[3],m,y,a,s),new $E(g[2],i,y,m,s),new $E(g[1],m,o,a,y),new $E(g[0],i,o,m,y)),(l=(e>=y)<<1|t>=m)&&(u=p[p.length-1],p[p.length-1]=p[p.length-1-l],p[p.length-1-l]=u)}else{var v=t-+this._x.call(null,g.data),_=e-+this._y.call(null,g.data),x=v*v+_*_;if(x<n){var b=Math.sqrt(n=x);c=t-b,f=e-b,h=t+b,d=e+b,r=g.data}}return r},RE.remove=function(t){if(isNaN(o=+this._x.call(null,t))||isNaN(a=+this._y.call(null,t)))return this;var e,n,r,i,o,a,s,u,l,c,f,h,d=this._root,p=this._x0,g=this._y0,m=this._x1,y=this._y1;if(!d)return this;if(d.length)for(;;){if((l=o>=(s=(p+m)/2))?p=s:m=s,(c=a>=(u=(g+y)/2))?g=u:y=u,e=d,!(d=d[f=c<<1|l]))return this;if(!d.length)break;(e[f+1&3]||e[f+2&3]||e[f+3&3])&&(n=e,h=f)}for(;d.data!==t;)if(r=d,!(d=d.next))return this;return(i=d.next)&&delete d.next,r?(i?r.next=i:delete r.next,this):e?(i?e[f]=i:delete e[f],(d=e[0]||e[1]||e[2]||e[3])&&d===(e[3]||e[2]||e[1]||e[0])&&!d.length&&(n?n[h]=d:this._root=d),this):(this._root=i,this)},RE.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},RE.root=function(){return this._root},RE.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},RE.visit=function(t){var e,n,r,i,o,a,s=[],u=this._root;for(u&&s.push(new $E(u,this._x0,this._y0,this._x1,this._y1));e=s.pop();)if(!t(u=e.node,r=e.x0,i=e.y0,o=e.x1,a=e.y1)&&u.length){var l=(r+o)/2,c=(i+a)/2;(n=u[3])&&s.push(new $E(n,l,c,o,a)),(n=u[2])&&s.push(new $E(n,r,c,l,a)),(n=u[1])&&s.push(new $E(n,l,i,o,c)),(n=u[0])&&s.push(new $E(n,r,i,l,c))}return this},RE.visitAfter=function(t){var e,n=[],r=[];for(this._root&&n.push(new $E(this._root,this._x0,this._y0,this._x1,this._y1));e=n.pop();){var i=e.node;if(i.length){var o,a=e.x0,s=e.y0,u=e.x1,l=e.y1,c=(a+u)/2,f=(s+l)/2;(o=i[0])&&n.push(new $E(o,a,s,c,f)),(o=i[1])&&n.push(new $E(o,c,s,u,f)),(o=i[2])&&n.push(new $E(o,a,f,c,l)),(o=i[3])&&n.push(new $E(o,c,f,u,l))}r.push(e)}for(;e=r.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this},RE.x=function(t){return arguments.length?(this._x=t,this):this._x},RE.y=function(t){return arguments.length?(this._y=t,this):this._y};var WE={value:()=>{}};function HE(){for(var t,e=0,n=arguments.length,r={};e<n;++e){if(!(t=arguments[e]+"")||t in r||/[\s.]/.test(t))throw new Error("illegal type: "+t);r[t]=[]}return new YE(r)}function YE(t){this._=t}function GE(t,e){for(var n,r=0,i=t.length;r<i;++r)if((n=t[r]).name===e)return n.value}function VE(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=WE,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}YE.prototype=HE.prototype={constructor:YE,on:function(t,e){var n,r,i=this._,o=(r=i,(t+"").trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");if(n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),t&&!r.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}}))),a=-1,s=o.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++a<s;)if(n=(t=o[a]).type)i[n]=VE(i[n],t.name,e);else if(null==e)for(n in i)i[n]=VE(i[n],t.name,null);return this}for(;++a<s;)if((n=(t=o[a]).type)&&(n=GE(i[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new YE(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),o=0;o<n;++o)i[o]=arguments[o+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=0,n=(r=this._[t]).length;o<n;++o)r[o].value.apply(e,i)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,o=r.length;i<o;++i)r[i].value.apply(e,n)}};var XE,JE,ZE=0,QE=0,KE=0,tD=1e3,eD=0,nD=0,rD=0,iD="object"==typeof performance&&performance.now?performance:Date,oD="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function aD(){return nD||(oD(sD),nD=iD.now()+rD)}function sD(){nD=0}function uD(){this._call=this._time=this._next=null}function lD(t,e,n){var r=new uD;return r.restart(t,e,n),r}function cD(){nD=(eD=iD.now())+rD,ZE=QE=0;try{!function(){aD(),++ZE;for(var t,e=XE;e;)(t=nD-e._time)>=0&&e._call.call(void 0,t),e=e._next;--ZE}()}finally{ZE=0,function(){var t,e,n=XE,r=1/0;for(;n;)n._call?(r>n._time&&(r=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:XE=e);JE=t,hD(r)}(),nD=0}}function fD(){var t=iD.now(),e=t-eD;e>tD&&(rD-=e,eD=t)}function hD(t){ZE||(QE&&(QE=clearTimeout(QE)),t-nD>24?(t<1/0&&(QE=setTimeout(cD,t-iD.now()-rD)),KE&&(KE=clearInterval(KE))):(KE||(eD=iD.now(),KE=setInterval(fD,tD)),ZE=1,oD(cD)))}uD.prototype=lD.prototype={constructor:uD,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?aD():+n)+(null==e?0:+e),this._next||JE===this||(JE?JE._next=this:XE=this,JE=this),this._call=t,this._time=n,hD()},stop:function(){this._call&&(this._call=null,this._time=1/0,hD())}};const dD=1664525,pD=1013904223,gD=4294967296;function mD(t){return t.x}function yD(t){return t.y}var vD=10,_D=Math.PI*(3-Math.sqrt(5));function xD(t){var e,n=1,r=.001,i=1-Math.pow(r,1/300),o=0,a=.6,s=new Map,u=lD(f),l=HE("tick","end"),c=function(){let t=1;return()=>(t=(dD*t+pD)%gD)/gD}();function f(){h(),l.call("tick",e),n<r&&(u.stop(),l.call("end",e))}function h(r){var u,l,c=t.length;void 0===r&&(r=1);for(var f=0;f<r;++f)for(n+=(o-n)*i,s.forEach((function(t){t(n)})),u=0;u<c;++u)null==(l=t[u]).fx?l.x+=l.vx*=a:(l.x=l.fx,l.vx=0),null==l.fy?l.y+=l.vy*=a:(l.y=l.fy,l.vy=0);return e}function d(){for(var e,n=0,r=t.length;n<r;++n){if((e=t[n]).index=n,null!=e.fx&&(e.x=e.fx),null!=e.fy&&(e.y=e.fy),isNaN(e.x)||isNaN(e.y)){var i=vD*Math.sqrt(.5+n),o=n*_D;e.x=i*Math.cos(o),e.y=i*Math.sin(o)}(isNaN(e.vx)||isNaN(e.vy))&&(e.vx=e.vy=0)}}function p(e){return e.initialize&&e.initialize(t,c),e}return null==t&&(t=[]),d(),e={tick:h,restart:function(){return u.restart(f),e},stop:function(){return u.stop(),e},nodes:function(n){return arguments.length?(t=n,d(),s.forEach(p),e):t},alpha:function(t){return arguments.length?(n=+t,e):n},alphaMin:function(t){return arguments.length?(r=+t,e):r},alphaDecay:function(t){return arguments.length?(i=+t,e):+i},alphaTarget:function(t){return arguments.length?(o=+t,e):o},velocityDecay:function(t){return arguments.length?(a=1-t,e):1-a},randomSource:function(t){return arguments.length?(c=t,s.forEach(p),e):c},force:function(t,n){return arguments.length>1?(null==n?s.delete(t):s.set(t,p(n)),e):s.get(t)},find:function(e,n,r){var i,o,a,s,u,l=0,c=t.length;for(null==r?r=1/0:r*=r,l=0;l<c;++l)(a=(i=e-(s=t[l]).x)*i+(o=n-s.y)*o)<r&&(u=s,r=a);return u},on:function(t,n){return arguments.length>1?(l.on(t,n),e):l.on(t)}}}const bD={center:function(t,e){var n,r=1;function i(){var i,o,a=n.length,s=0,u=0;for(i=0;i<a;++i)s+=(o=n[i]).x,u+=o.y;for(s=(s/a-t)*r,u=(u/a-e)*r,i=0;i<a;++i)(o=n[i]).x-=s,o.y-=u}return null==t&&(t=0),null==e&&(e=0),i.initialize=function(t){n=t},i.x=function(e){return arguments.length?(t=+e,i):t},i.y=function(t){return arguments.length?(e=+t,i):e},i.strength=function(t){return arguments.length?(r=+t,i):r},i},collide:function(t){var e,n,r,i=1,o=1;function a(){for(var t,a,u,l,c,f,h,d=e.length,p=0;p<o;++p)for(a=zE(e,qE,PE).visitAfter(s),t=0;t<d;++t)u=e[t],f=n[u.index],h=f*f,l=u.x+u.vx,c=u.y+u.vy,a.visit(g);function g(t,e,n,o,a){var s=t.data,d=t.r,p=f+d;if(!s)return e>l+p||o<l-p||n>c+p||a<c-p;if(s.index>u.index){var g=l-s.x-s.vx,m=c-s.y-s.vy,y=g*g+m*m;y<p*p&&(0===g&&(y+=(g=UE(r))*g),0===m&&(y+=(m=UE(r))*m),y=(p-(y=Math.sqrt(y)))/y*i,u.vx+=(g*=y)*(p=(d*=d)/(h+d)),u.vy+=(m*=y)*p,s.vx-=g*(p=1-p),s.vy-=m*p)}}}function s(t){if(t.data)return t.r=n[t.data.index];for(var e=t.r=0;e<4;++e)t[e]&&t[e].r>t.r&&(t.r=t[e].r)}function u(){if(e){var r,i,o=e.length;for(n=new Array(o),r=0;r<o;++r)i=e[r],n[i.index]=+t(i,r,e)}}return"function"!=typeof t&&(t=LE(null==t?1:+t)),a.initialize=function(t,n){e=t,r=n,u()},a.iterations=function(t){return arguments.length?(o=+t,a):o},a.strength=function(t){return arguments.length?(i=+t,a):i},a.radius=function(e){return arguments.length?(t="function"==typeof e?e:LE(+e),u(),a):t},a},nbody:function(){var t,e,n,r,i,o=LE(-30),a=1,s=1/0,u=.81;function l(n){var i,o=t.length,a=zE(t,mD,yD).visitAfter(f);for(r=n,i=0;i<o;++i)e=t[i],a.visit(h)}function c(){if(t){var e,n,r=t.length;for(i=new Array(r),e=0;e<r;++e)n=t[e],i[n.index]=+o(n,e,t)}}function f(t){var e,n,r,o,a,s=0,u=0;if(t.length){for(r=o=a=0;a<4;++a)(e=t[a])&&(n=Math.abs(e.value))&&(s+=e.value,u+=n,r+=n*e.x,o+=n*e.y);t.x=r/u,t.y=o/u}else{(e=t).x=e.data.x,e.y=e.data.y;do{s+=i[e.data.index]}while(e=e.next)}t.value=s}function h(t,o,l,c){if(!t.value)return!0;var f=t.x-e.x,h=t.y-e.y,d=c-o,p=f*f+h*h;if(d*d/u<p)return p<s&&(0===f&&(p+=(f=UE(n))*f),0===h&&(p+=(h=UE(n))*h),p<a&&(p=Math.sqrt(a*p)),e.vx+=f*t.value*r/p,e.vy+=h*t.value*r/p),!0;if(!(t.length||p>=s)){(t.data!==e||t.next)&&(0===f&&(p+=(f=UE(n))*f),0===h&&(p+=(h=UE(n))*h),p<a&&(p=Math.sqrt(a*p)));do{t.data!==e&&(d=i[t.data.index]*r/p,e.vx+=f*d,e.vy+=h*d)}while(t=t.next)}}return l.initialize=function(e,r){t=e,n=r,c()},l.strength=function(t){return arguments.length?(o="function"==typeof t?t:LE(+t),c(),l):o},l.distanceMin=function(t){return arguments.length?(a=t*t,l):Math.sqrt(a)},l.distanceMax=function(t){return arguments.length?(s=t*t,l):Math.sqrt(s)},l.theta=function(t){return arguments.length?(u=t*t,l):Math.sqrt(u)},l},link:function(t){var e,n,r,i,o,a,s=jE,u=function(t){return 1/Math.min(i[t.source.index],i[t.target.index])},l=LE(30),c=1;function f(r){for(var i=0,s=t.length;i<c;++i)for(var u,l,f,h,d,p,g,m=0;m<s;++m)l=(u=t[m]).source,h=(f=u.target).x+f.vx-l.x-l.vx||UE(a),d=f.y+f.vy-l.y-l.vy||UE(a),h*=p=((p=Math.sqrt(h*h+d*d))-n[m])/p*r*e[m],d*=p,f.vx-=h*(g=o[m]),f.vy-=d*g,l.vx+=h*(g=1-g),l.vy+=d*g}function h(){if(r){var a,u,l=r.length,c=t.length,f=new Map(r.map(((t,e)=>[s(t,e,r),t])));for(a=0,i=new Array(l);a<c;++a)(u=t[a]).index=a,"object"!=typeof u.source&&(u.source=IE(f,u.source)),"object"!=typeof u.target&&(u.target=IE(f,u.target)),i[u.source.index]=(i[u.source.index]||0)+1,i[u.target.index]=(i[u.target.index]||0)+1;for(a=0,o=new Array(c);a<c;++a)u=t[a],o[a]=i[u.source.index]/(i[u.source.index]+i[u.target.index]);e=new Array(c),d(),n=new Array(c),p()}}function d(){if(r)for(var n=0,i=t.length;n<i;++n)e[n]=+u(t[n],n,t)}function p(){if(r)for(var e=0,i=t.length;e<i;++e)n[e]=+l(t[e],e,t)}return null==t&&(t=[]),f.initialize=function(t,e){r=t,a=e,h()},f.links=function(e){return arguments.length?(t=e,h(),f):t},f.id=function(t){return arguments.length?(s=t,f):s},f.iterations=function(t){return arguments.length?(c=+t,f):c},f.strength=function(t){return arguments.length?(u="function"==typeof t?t:LE(+t),d(),f):u},f.distance=function(t){return arguments.length?(l="function"==typeof t?t:LE(+t),p(),f):l},f},x:function(t){var e,n,r,i=LE(.1);function o(t){for(var i,o=0,a=e.length;o<a;++o)(i=e[o]).vx+=(r[o]-i.x)*n[o]*t}function a(){if(e){var o,a=e.length;for(n=new Array(a),r=new Array(a),o=0;o<a;++o)n[o]=isNaN(r[o]=+t(e[o],o,e))?0:+i(e[o],o,e)}}return"function"!=typeof t&&(t=LE(null==t?0:+t)),o.initialize=function(t){e=t,a()},o.strength=function(t){return arguments.length?(i="function"==typeof t?t:LE(+t),a(),o):i},o.x=function(e){return arguments.length?(t="function"==typeof e?e:LE(+e),a(),o):t},o},y:function(t){var e,n,r,i=LE(.1);function o(t){for(var i,o=0,a=e.length;o<a;++o)(i=e[o]).vy+=(r[o]-i.y)*n[o]*t}function a(){if(e){var o,a=e.length;for(n=new Array(a),r=new Array(a),o=0;o<a;++o)n[o]=isNaN(r[o]=+t(e[o],o,e))?0:+i(e[o],o,e)}}return"function"!=typeof t&&(t=LE(null==t?0:+t)),o.initialize=function(t){e=t,a()},o.strength=function(t){return arguments.length?(i="function"==typeof t?t:LE(+t),a(),o):i},o.y=function(e){return arguments.length?(t="function"==typeof e?e:LE(+e),a(),o):t},o}},wD="forces",kD=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],AD=["static","iterations"],MD=["x","y","vx","vy"];function ED(t){Xa.call(this,null,t)}function DD(t,e,n,r){var i,o,a,s,u=V(e.forces);for(i=0,o=kD.length;i<o;++i)(a=kD[i])!==wD&&e.modified(a)&&t[a](e[a]);for(i=0,o=u.length;i<o;++i)s=wD+i,(a=n||e.modified(wD,i)?FD(u[i]):r&&CD(u[i],r)?t.force(s):null)&&t.force(s,a);for(o=t.numForces||0;i<o;++i)t.force(wD+i,null);return t.numForces=u.length,t}function CD(t,e){var n,i;for(n in t)if(J(i=t[n])&&e.modified(r(i)))return 1;return 0}function FD(t){var e,n;for(n in ut(bD,t.force)||s("Unrecognized force: "+t.force),e=bD[t.force](),t)J(e[n])&&SD(e[n],t[n],t);return e}function SD(t,e,n){t(J(e)?t=>e(t,n):e)}ED.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30,expr:!0},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:MD}]},ht(ED,Xa,{transform(t,e){var n,r,i=this.value,o=e.changed(e.ADD_REM),a=t.modified(kD),s=t.iterations||300;if(i?(o&&(e.modifies("index"),i.nodes(e.source)),(a||e.changed(e.MOD))&&DD(i,t,0,e)):(this.value=i=function(t,e){const n=xD(t),r=n.stop,i=n.restart;let o=!1;return n.stopped=()=>o,n.restart=()=>(o=!1,i()),n.stop=()=>(o=!0,r()),DD(n,e,!0).on("end",(()=>o=!0))}(e.source,t),i.on("tick",(n=e.dataflow,r=this,()=>n.touch(r).run())),t.static||(o=!0,i.tick()),e.modifies("index")),a||o||t.modified(AD)||e.changed()&&t.restart)if(i.alpha(Math.max(i.alpha(),t.alpha||1)).alphaDecay(1-Math.pow(i.alphaMin(),1/s)),t.static)for(i.stop();--s>=0;)i.tick();else if(i.stopped()&&i.restart(),!o)return e.StopPropagation;return this.finish(t,e)},finish(t,e){const n=e.dataflow;for(let t,e=this._argops,s=0,u=e.length;s<u;++s)if(t=e[s],t.name===wD&&"link"===t.op._argval.force)for(var r,i=t.op._argops,o=0,a=i.length;o<a;++o)if("links"===i[o].name&&(r=i[o].op.source)){n.pulse(r,n.changeset().reflow());break}return e.reflow(t.modified()).modifies(MD)}});var $D=Object.freeze({__proto__:null,force:ED});function TD(t,e){return t.parent===e.parent?1:2}function BD(t,e){return t+e.x}function zD(t,e){return Math.max(t,e.y)}function ND(t){var e=0,n=t.children,r=n&&n.length;if(r)for(;--r>=0;)e+=n[r].value;else e=1;t.value=e}function OD(t,e){t instanceof Map?(t=[void 0,t],void 0===e&&(e=LD)):void 0===e&&(e=RD);for(var n,r,i,o,a,s=new PD(t),u=[s];n=u.pop();)if((i=e(n.data))&&(a=(i=Array.from(i)).length))for(n.children=i,o=a-1;o>=0;--o)u.push(r=i[o]=new PD(i[o])),r.parent=n,r.depth=n.depth+1;return s.eachBefore(qD)}function RD(t){return t.children}function LD(t){return Array.isArray(t)?t[1]:null}function UD(t){void 0!==t.data.value&&(t.value=t.data.value),t.data=t.data.data}function qD(t){var e=0;do{t.height=e}while((t=t.parent)&&t.height<++e)}function PD(t){this.data=t,this.depth=this.height=0,this.parent=null}function jD(t){return null==t?null:ID(t)}function ID(t){if("function"!=typeof t)throw new Error;return t}function WD(){return 0}function HD(t){return function(){return t}}PD.prototype=OD.prototype={constructor:PD,count:function(){return this.eachAfter(ND)},each:function(t,e){let n=-1;for(const r of this)t.call(e,r,++n,this);return this},eachAfter:function(t,e){for(var n,r,i,o=this,a=[o],s=[],u=-1;o=a.pop();)if(s.push(o),n=o.children)for(r=0,i=n.length;r<i;++r)a.push(n[r]);for(;o=s.pop();)t.call(e,o,++u,this);return this},eachBefore:function(t,e){for(var n,r,i=this,o=[i],a=-1;i=o.pop();)if(t.call(e,i,++a,this),n=i.children)for(r=n.length-1;r>=0;--r)o.push(n[r]);return this},find:function(t,e){let n=-1;for(const r of this)if(t.call(e,r,++n,this))return r},sum:function(t){return this.eachAfter((function(e){for(var n=+t(e.data)||0,r=e.children,i=r&&r.length;--i>=0;)n+=r[i].value;e.value=n}))},sort:function(t){return this.eachBefore((function(e){e.children&&e.children.sort(t)}))},path:function(t){for(var e=this,n=function(t,e){if(t===e)return t;var n=t.ancestors(),r=e.ancestors(),i=null;t=n.pop(),e=r.pop();for(;t===e;)i=t,t=n.pop(),e=r.pop();return i}(e,t),r=[e];e!==n;)e=e.parent,r.push(e);for(var i=r.length;t!==n;)r.splice(i,0,t),t=t.parent;return r},ancestors:function(){for(var t=this,e=[t];t=t.parent;)e.push(t);return e},descendants:function(){return Array.from(this)},leaves:function(){var t=[];return this.eachBefore((function(e){e.children||t.push(e)})),t},links:function(){var t=this,e=[];return t.each((function(n){n!==t&&e.push({source:n.parent,target:n})})),e},copy:function(){return OD(this).eachBefore(UD)},[Symbol.iterator]:function*(){var t,e,n,r,i=this,o=[i];do{for(t=o.reverse(),o=[];i=t.pop();)if(yield i,e=i.children)for(n=0,r=e.length;n<r;++n)o.push(e[n])}while(o.length)}};const YD=1664525,GD=1013904223,VD=4294967296;function XD(t,e){var n,r;if(QD(e,t))return[e];for(n=0;n<t.length;++n)if(JD(e,t[n])&&QD(tC(t[n],e),t))return[t[n],e];for(n=0;n<t.length-1;++n)for(r=n+1;r<t.length;++r)if(JD(tC(t[n],t[r]),e)&&JD(tC(t[n],e),t[r])&&JD(tC(t[r],e),t[n])&&QD(eC(t[n],t[r],e),t))return[t[n],t[r],e];throw new Error}function JD(t,e){var n=t.r-e.r,r=e.x-t.x,i=e.y-t.y;return n<0||n*n<r*r+i*i}function ZD(t,e){var n=t.r-e.r+1e-9*Math.max(t.r,e.r,1),r=e.x-t.x,i=e.y-t.y;return n>0&&n*n>r*r+i*i}function QD(t,e){for(var n=0;n<e.length;++n)if(!ZD(t,e[n]))return!1;return!0}function KD(t){switch(t.length){case 1:return function(t){return{x:t.x,y:t.y,r:t.r}}(t[0]);case 2:return tC(t[0],t[1]);case 3:return eC(t[0],t[1],t[2])}}function tC(t,e){var n=t.x,r=t.y,i=t.r,o=e.x,a=e.y,s=e.r,u=o-n,l=a-r,c=s-i,f=Math.sqrt(u*u+l*l);return{x:(n+o+u/f*c)/2,y:(r+a+l/f*c)/2,r:(f+i+s)/2}}function eC(t,e,n){var r=t.x,i=t.y,o=t.r,a=e.x,s=e.y,u=e.r,l=n.x,c=n.y,f=n.r,h=r-a,d=r-l,p=i-s,g=i-c,m=u-o,y=f-o,v=r*r+i*i-o*o,_=v-a*a-s*s+u*u,x=v-l*l-c*c+f*f,b=d*p-h*g,w=(p*x-g*_)/(2*b)-r,k=(g*m-p*y)/b,A=(d*_-h*x)/(2*b)-i,M=(h*y-d*m)/b,E=k*k+M*M-1,D=2*(o+w*k+A*M),C=w*w+A*A-o*o,F=-(Math.abs(E)>1e-6?(D+Math.sqrt(D*D-4*E*C))/(2*E):C/D);return{x:r+w+k*F,y:i+A+M*F,r:F}}function nC(t,e,n){var r,i,o,a,s=t.x-e.x,u=t.y-e.y,l=s*s+u*u;l?(i=e.r+n.r,i*=i,a=t.r+n.r,i>(a*=a)?(r=(l+a-i)/(2*l),o=Math.sqrt(Math.max(0,a/l-r*r)),n.x=t.x-r*s-o*u,n.y=t.y-r*u+o*s):(r=(l+i-a)/(2*l),o=Math.sqrt(Math.max(0,i/l-r*r)),n.x=e.x+r*s-o*u,n.y=e.y+r*u+o*s)):(n.x=e.x+n.r,n.y=e.y)}function rC(t,e){var n=t.r+e.r-1e-6,r=e.x-t.x,i=e.y-t.y;return n>0&&n*n>r*r+i*i}function iC(t){var e=t._,n=t.next._,r=e.r+n.r,i=(e.x*n.r+n.x*e.r)/r,o=(e.y*n.r+n.y*e.r)/r;return i*i+o*o}function oC(t){this._=t,this.next=null,this.previous=null}function aC(t,e){if(!(o=(t=function(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}(t)).length))return 0;var n,r,i,o,a,s,u,l,c,f,h;if((n=t[0]).x=0,n.y=0,!(o>1))return n.r;if(r=t[1],n.x=-r.r,r.x=n.r,r.y=0,!(o>2))return n.r+r.r;nC(r,n,i=t[2]),n=new oC(n),r=new oC(r),i=new oC(i),n.next=i.previous=r,r.next=n.previous=i,i.next=r.previous=n;t:for(u=3;u<o;++u){nC(n._,r._,i=t[u]),i=new oC(i),l=r.next,c=n.previous,f=r._.r,h=n._.r;do{if(f<=h){if(rC(l._,i._)){r=l,n.next=r,r.previous=n,--u;continue t}f+=l._.r,l=l.next}else{if(rC(c._,i._)){(n=c).next=r,r.previous=n,--u;continue t}h+=c._.r,c=c.previous}}while(l!==c.next);for(i.previous=n,i.next=r,n.next=r.previous=r=i,a=iC(n);(i=i.next)!==r;)(s=iC(i))<a&&(n=i,a=s);r=n.next}for(n=[r._],i=r;(i=i.next)!==r;)n.push(i._);for(i=function(t,e){for(var n,r,i=0,o=(t=function(t,e){let n,r,i=t.length;for(;i;)r=e()*i--|0,n=t[i],t[i]=t[r],t[r]=n;return t}(Array.from(t),e)).length,a=[];i<o;)n=t[i],r&&ZD(r,n)?++i:(r=KD(a=XD(a,n)),i=0);return r}(n,e),u=0;u<o;++u)(n=t[u]).x-=i.x,n.y-=i.y;return i.r}function sC(t){return Math.sqrt(t.value)}function uC(t){return function(e){e.children||(e.r=Math.max(0,+t(e)||0))}}function lC(t,e,n){return function(r){if(i=r.children){var i,o,a,s=i.length,u=t(r)*e||0;if(u)for(o=0;o<s;++o)i[o].r+=u;if(a=aC(i,n),u)for(o=0;o<s;++o)i[o].r-=u;r.r=a+u}}}function cC(t){return function(e){var n=e.parent;e.r*=t,n&&(e.x=n.x+t*e.x,e.y=n.y+t*e.y)}}function fC(t){t.x0=Math.round(t.x0),t.y0=Math.round(t.y0),t.x1=Math.round(t.x1),t.y1=Math.round(t.y1)}function hC(t,e,n,r,i){for(var o,a=t.children,s=-1,u=a.length,l=t.value&&(r-e)/t.value;++s<u;)(o=a[s]).y0=n,o.y1=i,o.x0=e,o.x1=e+=o.value*l}var dC={depth:-1},pC={},gC={};function mC(t){return t.id}function yC(t){return t.parentId}function vC(){var t,e=mC,n=yC;function r(r){var i,o,a,s,u,l,c,f,h=Array.from(r),d=e,p=n,g=new Map;if(null!=t){const e=h.map(((e,n)=>function(t){t=`${t}`;let e=t.length;xC(t,e-1)&&!xC(t,e-2)&&(t=t.slice(0,-1));return"/"===t[0]?t:`/${t}`}(t(e,n,r)))),n=e.map(_C),i=new Set(e).add("");for(const t of n)i.has(t)||(i.add(t),e.push(t),n.push(_C(t)),h.push(gC));d=(t,n)=>e[n],p=(t,e)=>n[e]}for(a=0,i=h.length;a<i;++a)o=h[a],l=h[a]=new PD(o),null!=(c=d(o,a,r))&&(c+="")&&(f=l.id=c,g.set(f,g.has(f)?pC:l)),null!=(c=p(o,a,r))&&(c+="")&&(l.parent=c);for(a=0;a<i;++a)if(c=(l=h[a]).parent){if(!(u=g.get(c)))throw new Error("missing: "+c);if(u===pC)throw new Error("ambiguous: "+c);u.children?u.children.push(l):u.children=[l],l.parent=u}else{if(s)throw new Error("multiple roots");s=l}if(!s)throw new Error("no root");if(null!=t){for(;s.data===gC&&1===s.children.length;)s=s.children[0],--i;for(let t=h.length-1;t>=0&&(l=h[t]).data===gC;--t)l.data=null}if(s.parent=dC,s.eachBefore((function(t){t.depth=t.parent.depth+1,--i})).eachBefore(qD),s.parent=null,i>0)throw new Error("cycle");return s}return r.id=function(t){return arguments.length?(e=jD(t),r):e},r.parentId=function(t){return arguments.length?(n=jD(t),r):n},r.path=function(e){return arguments.length?(t=jD(e),r):t},r}function _C(t){let e=t.length;if(e<2)return"";for(;--e>1&&!xC(t,e););return t.slice(0,e)}function xC(t,e){if("/"===t[e]){let n=0;for(;e>0&&"\\"===t[--e];)++n;if(0==(1&n))return!0}return!1}function bC(t,e){return t.parent===e.parent?1:2}function wC(t){var e=t.children;return e?e[0]:t.t}function kC(t){var e=t.children;return e?e[e.length-1]:t.t}function AC(t,e,n){var r=n/(e.i-t.i);e.c-=r,e.s+=n,t.c+=r,e.z+=n,e.m+=n}function MC(t,e,n){return t.a.parent===e.parent?t.a:n}function EC(t,e){this._=t,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=e}function DC(t,e,n,r,i){for(var o,a=t.children,s=-1,u=a.length,l=t.value&&(i-n)/t.value;++s<u;)(o=a[s]).x0=e,o.x1=r,o.y0=n,o.y1=n+=o.value*l}EC.prototype=Object.create(PD.prototype);var CC=(1+Math.sqrt(5))/2;function FC(t,e,n,r,i,o){for(var a,s,u,l,c,f,h,d,p,g,m,y=[],v=e.children,_=0,x=0,b=v.length,w=e.value;_<b;){u=i-n,l=o-r;do{c=v[x++].value}while(!c&&x<b);for(f=h=c,m=c*c*(g=Math.max(l/u,u/l)/(w*t)),p=Math.max(h/m,m/f);x<b;++x){if(c+=s=v[x].value,s<f&&(f=s),s>h&&(h=s),m=c*c*g,(d=Math.max(h/m,m/f))>p){c-=s;break}p=d}y.push(a={value:c,dice:u<l,children:v.slice(_,x)}),a.dice?hC(a,n,r,i,w?r+=l*c/w:o):DC(a,n,r,w?n+=u*c/w:i,o),w-=c,_=x}return y}var SC=function t(e){function n(t,n,r,i,o){FC(e,t,n,r,i,o)}return n.ratio=function(e){return t((e=+e)>1?e:1)},n}(CC);var $C=function t(e){function n(t,n,r,i,o){if((a=t._squarify)&&a.ratio===e)for(var a,s,u,l,c,f=-1,h=a.length,d=t.value;++f<h;){for(u=(s=a[f]).children,l=s.value=0,c=u.length;l<c;++l)s.value+=u[l].value;s.dice?hC(s,n,r,i,d?r+=(o-r)*s.value/d:o):DC(s,n,r,d?n+=(i-n)*s.value/d:i,o),d-=s.value}else t._squarify=a=FC(e,t,n,r,i,o),a.ratio=e}return n.ratio=function(e){return t((e=+e)>1?e:1)},n}(CC);function TC(t,e,n){const r={};return t.each((t=>{const i=t.data;n(i)&&(r[e(i)]=t)})),t.lookup=r,t}function BC(t){Xa.call(this,null,t)}BC.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};const zC=t=>t.values;function NC(){const t=[],e={entries:t=>r(n(t,0),0),key:n=>(t.push(n),e)};function n(e,r){if(r>=t.length)return e;const i=e.length,o=t[r++],a={},s={};let u,l,c,f=-1;for(;++f<i;)u=o(l=e[f])+"",(c=a[u])?c.push(l):a[u]=[l];for(u in a)s[u]=n(a[u],r);return s}function r(e,n){if(++n>t.length)return e;const i=[];for(const t in e)i.push({key:t,values:r(e[t],n)});return i}return e}function OC(t){Xa.call(this,null,t)}ht(BC,Xa,{transform(t,e){e.source||s("Nest transform requires an upstream data source.");var n=t.generate,r=t.modified(),i=e.clone(),o=this.value;return(!o||r||e.changed())&&(o&&o.each((t=>{t.children&&ga(t.data)&&i.rem.push(t.data)})),this.value=o=OD({values:V(t.keys).reduce(((t,e)=>(t.key(e),t)),NC()).entries(i.source)},zC),n&&o.each((t=>{t.children&&(t=va(t.data),i.add.push(t),i.source.push(t))})),TC(o,ma,ma)),i.source.root=o,i}});const RC=(t,e)=>t.parent===e.parent?1:2;ht(OC,Xa,{transform(t,e){e.source&&e.source.root||s(this.constructor.name+" transform requires a backing tree data source.");const n=this.layout(t.method),r=this.fields,i=e.source.root,o=t.as||r;t.field?i.sum(t.field):i.count(),t.sort&&i.sort(wa(t.sort,(t=>t.data))),function(t,e,n){for(let r,i=0,o=e.length;i<o;++i)r=e[i],r in n&&t[r](n[r])}(n,this.params,t),n.separation&&n.separation(!1!==t.separation?RC:d);try{this.value=n(i)}catch(t){s(t)}return i.each((t=>function(t,e,n){const r=t.data,i=e.length-1;for(let o=0;o<i;++o)r[n[o]]=t[e[o]];r[n[i]]=t.children?t.children.length:0}(t,r,o))),e.reflow(t.modified()).modifies(o).modifies("leaf")}});const LC=["x","y","r","depth","children"];function UC(t){OC.call(this,t)}UC.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:LC.length,default:LC}]},ht(UC,OC,{layout:function(){var t=null,e=1,n=1,r=WD;function i(i){const o=function(){let t=1;return()=>(t=(YD*t+GD)%VD)/VD}();return i.x=e/2,i.y=n/2,t?i.eachBefore(uC(t)).eachAfter(lC(r,.5,o)).eachBefore(cC(1)):i.eachBefore(uC(sC)).eachAfter(lC(WD,1,o)).eachAfter(lC(r,i.r/Math.min(e,n),o)).eachBefore(cC(Math.min(e,n)/(2*i.r))),i}return i.radius=function(e){return arguments.length?(t=jD(e),i):t},i.size=function(t){return arguments.length?(e=+t[0],n=+t[1],i):[e,n]},i.padding=function(t){return arguments.length?(r="function"==typeof t?t:HD(+t),i):r},i},params:["radius","size","padding"],fields:LC});const qC=["x0","y0","x1","y1","depth","children"];function PC(t){OC.call(this,t)}function jC(t){Xa.call(this,null,t)}PC.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:qC.length,default:qC}]},ht(PC,OC,{layout:function(){var t=1,e=1,n=0,r=!1;function i(i){var o=i.height+1;return i.x0=i.y0=n,i.x1=t,i.y1=e/o,i.eachBefore(function(t,e){return function(r){r.children&&hC(r,r.x0,t*(r.depth+1)/e,r.x1,t*(r.depth+2)/e);var i=r.x0,o=r.y0,a=r.x1-n,s=r.y1-n;a<i&&(i=a=(i+a)/2),s<o&&(o=s=(o+s)/2),r.x0=i,r.y0=o,r.x1=a,r.y1=s}}(e,o)),r&&i.eachBefore(fC),i}return i.round=function(t){return arguments.length?(r=!!t,i):r},i.size=function(n){return arguments.length?(t=+n[0],e=+n[1],i):[t,e]},i.padding=function(t){return arguments.length?(n=+t,i):n},i},params:["size","round","padding"],fields:qC}),jC.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]},ht(jC,Xa,{transform(t,e){e.source||s("Stratify transform requires an upstream data source.");let n=this.value;const r=t.modified(),i=e.fork(e.ALL).materialize(e.SOURCE),o=!n||r||e.changed(e.ADD_REM)||e.modified(t.key.fields)||e.modified(t.parentKey.fields);return i.source=i.source.slice(),o&&(n=i.source.length?TC(vC().id(t.key).parentId(t.parentKey)(i.source),t.key,p):TC(vC()([{}]),t.key,t.key)),i.source.root=this.value=n,i}});const IC={tidy:function(){var t=bC,e=1,n=1,r=null;function i(i){var u=function(t){for(var e,n,r,i,o,a=new EC(t,0),s=[a];e=s.pop();)if(r=e._.children)for(e.children=new Array(o=r.length),i=o-1;i>=0;--i)s.push(n=e.children[i]=new EC(r[i],i)),n.parent=e;return(a.parent=new EC(null,0)).children=[a],a}(i);if(u.eachAfter(o),u.parent.m=-u.z,u.eachBefore(a),r)i.eachBefore(s);else{var l=i,c=i,f=i;i.eachBefore((function(t){t.x<l.x&&(l=t),t.x>c.x&&(c=t),t.depth>f.depth&&(f=t)}));var h=l===c?1:t(l,c)/2,d=h-l.x,p=e/(c.x+h+d),g=n/(f.depth||1);i.eachBefore((function(t){t.x=(t.x+d)*p,t.y=t.depth*g}))}return i}function o(e){var n=e.children,r=e.parent.children,i=e.i?r[e.i-1]:null;if(n){!function(t){for(var e,n=0,r=0,i=t.children,o=i.length;--o>=0;)(e=i[o]).z+=n,e.m+=n,n+=e.s+(r+=e.c)}(e);var o=(n[0].z+n[n.length-1].z)/2;i?(e.z=i.z+t(e._,i._),e.m=e.z-o):e.z=o}else i&&(e.z=i.z+t(e._,i._));e.parent.A=function(e,n,r){if(n){for(var i,o=e,a=e,s=n,u=o.parent.children[0],l=o.m,c=a.m,f=s.m,h=u.m;s=kC(s),o=wC(o),s&&o;)u=wC(u),(a=kC(a)).a=e,(i=s.z+f-o.z-l+t(s._,o._))>0&&(AC(MC(s,e,r),e,i),l+=i,c+=i),f+=s.m,l+=o.m,h+=u.m,c+=a.m;s&&!kC(a)&&(a.t=s,a.m+=f-c),o&&!wC(u)&&(u.t=o,u.m+=l-h,r=e)}return r}(e,i,e.parent.A||r[0])}function a(t){t._.x=t.z+t.parent.m,t.m+=t.parent.m}function s(t){t.x*=e,t.y=t.depth*n}return i.separation=function(e){return arguments.length?(t=e,i):t},i.size=function(t){return arguments.length?(r=!1,e=+t[0],n=+t[1],i):r?null:[e,n]},i.nodeSize=function(t){return arguments.length?(r=!0,e=+t[0],n=+t[1],i):r?[e,n]:null},i},cluster:function(){var t=TD,e=1,n=1,r=!1;function i(i){var o,a=0;i.eachAfter((function(e){var n=e.children;n?(e.x=function(t){return t.reduce(BD,0)/t.length}(n),e.y=function(t){return 1+t.reduce(zD,0)}(n)):(e.x=o?a+=t(e,o):0,e.y=0,o=e)}));var s=function(t){for(var e;e=t.children;)t=e[0];return t}(i),u=function(t){for(var e;e=t.children;)t=e[e.length-1];return t}(i),l=s.x-t(s,u)/2,c=u.x+t(u,s)/2;return i.eachAfter(r?function(t){t.x=(t.x-i.x)*e,t.y=(i.y-t.y)*n}:function(t){t.x=(t.x-l)/(c-l)*e,t.y=(1-(i.y?t.y/i.y:1))*n})}return i.separation=function(e){return arguments.length?(t=e,i):t},i.size=function(t){return arguments.length?(r=!1,e=+t[0],n=+t[1],i):r?null:[e,n]},i.nodeSize=function(t){return arguments.length?(r=!0,e=+t[0],n=+t[1],i):r?[e,n]:null},i}},WC=["x","y","depth","children"];function HC(t){OC.call(this,t)}function YC(t){Xa.call(this,[],t)}HC.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:WC.length,default:WC}]},ht(HC,OC,{layout(t){const e=t||"tidy";if(ut(IC,e))return IC[e]();s("Unrecognized Tree layout method: "+e)},params:["size","nodeSize"],fields:WC}),YC.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]},ht(YC,Xa,{transform(t,e){const n=this.value,r=e.source&&e.source.root,i=e.fork(e.NO_SOURCE),o={};return r||s("TreeLinks transform requires a tree data source."),e.changed(e.ADD_REM)?(i.rem=n,e.visit(e.SOURCE,(t=>o[ma(t)]=1)),r.each((t=>{const e=t.data,n=t.parent&&t.parent.data;n&&o[ma(e)]&&o[ma(n)]&&i.add.push(va({source:n,target:e}))})),this.value=i.add):e.changed(e.MOD)&&(e.visit(e.MOD,(t=>o[ma(t)]=1)),n.forEach((t=>{(o[ma(t.source)]||o[ma(t.target)])&&i.mod.push(t)}))),i}});const GC={binary:function(t,e,n,r,i){var o,a,s=t.children,u=s.length,l=new Array(u+1);for(l[0]=a=o=0;o<u;++o)l[o+1]=a+=s[o].value;!function t(e,n,r,i,o,a,u){if(e>=n-1){var c=s[e];return c.x0=i,c.y0=o,c.x1=a,void(c.y1=u)}var f=l[e],h=r/2+f,d=e+1,p=n-1;for(;d<p;){var g=d+p>>>1;l[g]<h?d=g+1:p=g}h-l[d-1]<l[d]-h&&e+1<d&&--d;var m=l[d]-f,y=r-m;if(a-i>u-o){var v=r?(i*y+a*m)/r:a;t(e,d,m,i,o,v,u),t(d,n,y,v,o,a,u)}else{var _=r?(o*y+u*m)/r:u;t(e,d,m,i,o,a,_),t(d,n,y,i,_,a,u)}}(0,u,t.value,e,n,r,i)},dice:hC,slice:DC,slicedice:function(t,e,n,r,i){(1&t.depth?DC:hC)(t,e,n,r,i)},squarify:SC,resquarify:$C},VC=["x0","y0","x1","y1","depth","children"];function XC(t){OC.call(this,t)}XC.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:VC.length,default:VC}]},ht(XC,OC,{layout(){const t=function(){var t=SC,e=!1,n=1,r=1,i=[0],o=WD,a=WD,s=WD,u=WD,l=WD;function c(t){return t.x0=t.y0=0,t.x1=n,t.y1=r,t.eachBefore(f),i=[0],e&&t.eachBefore(fC),t}function f(e){var n=i[e.depth],r=e.x0+n,c=e.y0+n,f=e.x1-n,h=e.y1-n;f<r&&(r=f=(r+f)/2),h<c&&(c=h=(c+h)/2),e.x0=r,e.y0=c,e.x1=f,e.y1=h,e.children&&(n=i[e.depth+1]=o(e)/2,r+=l(e)-n,c+=a(e)-n,(f-=s(e)-n)<r&&(r=f=(r+f)/2),(h-=u(e)-n)<c&&(c=h=(c+h)/2),t(e,r,c,f,h))}return c.round=function(t){return arguments.length?(e=!!t,c):e},c.size=function(t){return arguments.length?(n=+t[0],r=+t[1],c):[n,r]},c.tile=function(e){return arguments.length?(t=ID(e),c):t},c.padding=function(t){return arguments.length?c.paddingInner(t).paddingOuter(t):c.paddingInner()},c.paddingInner=function(t){return arguments.length?(o="function"==typeof t?t:HD(+t),c):o},c.paddingOuter=function(t){return arguments.length?c.paddingTop(t).paddingRight(t).paddingBottom(t).paddingLeft(t):c.paddingTop()},c.paddingTop=function(t){return arguments.length?(a="function"==typeof t?t:HD(+t),c):a},c.paddingRight=function(t){return arguments.length?(s="function"==typeof t?t:HD(+t),c):s},c.paddingBottom=function(t){return arguments.length?(u="function"==typeof t?t:HD(+t),c):u},c.paddingLeft=function(t){return arguments.length?(l="function"==typeof t?t:HD(+t),c):l},c}();return t.ratio=e=>{const n=t.tile();n.ratio&&t.tile(n.ratio(e))},t.method=e=>{ut(GC,e)?t.tile(GC[e]):s("Unrecognized Treemap layout method: "+e)},t},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:VC});var JC=Object.freeze({__proto__:null,nest:BC,pack:UC,partition:PC,stratify:jC,tree:HC,treelinks:YC,treemap:XC});const ZC=4278190080;function QC(t,e,n){return new Uint32Array(t.getImageData(0,0,e,n).data.buffer)}function KC(t,e,n){if(!e.length)return;const r=e[0].mark.marktype;"group"===r?e.forEach((e=>{e.items.forEach((e=>KC(t,e.items,n)))})):Wy[r].draw(t,{items:n?e.map(tF):e})}function tF(t){const e=xa(t,{});return e.stroke&&0!==e.strokeOpacity||e.fill&&0!==e.fillOpacity?{...e,strokeOpacity:1,stroke:"#000",fillOpacity:0}:e}const eF=5,nF=31,rF=32,iF=new Uint32Array(rF+1),oF=new Uint32Array(rF+1);oF[0]=0,iF[0]=~oF[0];for(let t=1;t<=rF;++t)oF[t]=oF[t-1]<<1|1,iF[t]=~oF[t];function aF(t,e,n){const r=Math.max(1,Math.sqrt(t*e/1e6)),i=~~((t+2*n+r)/r),o=~~((e+2*n+r)/r),a=t=>~~((t+n)/r);return a.invert=t=>t*r-n,a.bitmap=()=>function(t,e){const n=new Uint32Array(~~((t*e+rF)/rF));function r(t,e){n[t]|=e}function i(t,e){n[t]&=e}return{array:n,get:(e,r)=>{const i=r*t+e;return n[i>>>eF]&1<<(i&nF)},set:(e,n)=>{const i=n*t+e;r(i>>>eF,1<<(i&nF))},clear:(e,n)=>{const r=n*t+e;i(r>>>eF,~(1<<(r&nF)))},getRange:(e,r,i,o)=>{let a,s,u,l,c=o;for(;c>=r;--c)if(a=c*t+e,s=c*t+i,u=a>>>eF,l=s>>>eF,u===l){if(n[u]&iF[a&nF]&oF[1+(s&nF)])return!0}else{if(n[u]&iF[a&nF])return!0;if(n[l]&oF[1+(s&nF)])return!0;for(let t=u+1;t<l;++t)if(n[t])return!0}return!1},setRange:(e,n,i,o)=>{let a,s,u,l,c;for(;n<=o;++n)if(a=n*t+e,s=n*t+i,u=a>>>eF,l=s>>>eF,u===l)r(u,iF[a&nF]&oF[1+(s&nF)]);else for(r(u,iF[a&nF]),r(l,oF[1+(s&nF)]),c=u+1;c<l;++c)r(c,4294967295)},clearRange:(e,n,r,o)=>{let a,s,u,l,c;for(;n<=o;++n)if(a=n*t+e,s=n*t+r,u=a>>>eF,l=s>>>eF,u===l)i(u,oF[a&nF]|iF[1+(s&nF)]);else for(i(u,oF[a&nF]),i(l,iF[1+(s&nF)]),c=u+1;c<l;++c)i(c,0)},outOfBounds:(n,r,i,o)=>n<0||r<0||o>=e||i>=t}}(i,o),a.ratio=r,a.padding=n,a.width=t,a.height=e,a}function sF(t,e,n,r,i,o){let a=n/2;return t-a<0||t+a>i||e-(a=r/2)<0||e+a>o}function uF(t,e,n,r,i,o,a,s){const u=i*o/(2*r),l=t(e-u),c=t(e+u),f=t(n-(o/=2)),h=t(n+o);return a.outOfBounds(l,f,c,h)||a.getRange(l,f,c,h)||s&&s.getRange(l,f,c,h)}const lF=[-1,-1,1,1],cF=[-1,1,-1,1];const fF=["right","center","left"],hF=["bottom","middle","top"];function dF(t,e,n,r,i,o,a,s,u,l,c,f){return!(i.outOfBounds(t,n,e,r)||(f&&o||i).getRange(t,n,e,r))}const pF={"top-left":0,top:1,"top-right":2,left:4,middle:5,right:6,"bottom-left":8,bottom:9,"bottom-right":10},gF={naive:function(t,e,n,r){const i=t.width,o=t.height;return function(t){const e=t.datum.datum.items[r].items,n=e.length,a=t.datum.fontSize,s=Ay.width(t.datum,t.datum.text);let u,l,c,f,h,d,p,g=0;for(let r=0;r<n;++r)u=e[r].x,c=e[r].y,l=void 0===e[r].x2?u:e[r].x2,f=void 0===e[r].y2?c:e[r].y2,h=(u+l)/2,d=(c+f)/2,p=Math.abs(l-u+f-c),p>=g&&(g=p,t.x=h,t.y=d);return h=s/2,d=a/2,u=t.x-h,l=t.x+h,c=t.y-d,f=t.y+d,t.align="center",u<0&&l<=i?t.align="left":0<=u&&i<l&&(t.align="right"),t.baseline="middle",c<0&&f<=o?t.baseline="top":0<=c&&o<f&&(t.baseline="bottom"),!0}},"reduced-search":function(t,e,n,r){const i=t.width,o=t.height,a=e[0],s=e[1];function u(e,n,r,u,l){const c=t.invert(e),f=t.invert(n);let h,d=r,p=o;if(!sF(c,f,u,l,i,o)&&!uF(t,c,f,l,u,d,a,s)&&!uF(t,c,f,l,u,l,a,null)){for(;p-d>=1;)h=(d+p)/2,uF(t,c,f,l,u,h,a,s)?p=h:d=h;if(d>r)return[c,f,d,!0]}}return function(e){const s=e.datum.datum.items[r].items,l=s.length,c=e.datum.fontSize,f=Ay.width(e.datum,e.datum.text);let h,d,p,g,m,y,v,_,x,b,w,k,A,M,E,D,C,F=n?c:0,S=!1,$=!1,T=0;for(let r=0;r<l;++r){for(h=s[r].x,p=s[r].y,d=void 0===s[r].x2?h:s[r].x2,g=void 0===s[r].y2?p:s[r].y2,h>d&&(C=h,h=d,d=C),p>g&&(C=p,p=g,g=C),x=t(h),w=t(d),b=~~((x+w)/2),k=t(p),M=t(g),A=~~((k+M)/2),v=b;v>=x;--v)for(_=A;_>=k;--_)D=u(v,_,F,f,c),D&&([e.x,e.y,F,S]=D);for(v=b;v<=w;++v)for(_=A;_<=M;++_)D=u(v,_,F,f,c),D&&([e.x,e.y,F,S]=D);S||n||(E=Math.abs(d-h+g-p),m=(h+d)/2,y=(p+g)/2,E>=T&&!sF(m,y,f,c,i,o)&&!uF(t,m,y,c,f,c,a,null)&&(T=E,e.x=m,e.y=y,$=!0))}return!(!S&&!$)&&(m=f/2,y=c/2,a.setRange(t(e.x-m),t(e.y-y),t(e.x+m),t(e.y+y)),e.align="center",e.baseline="middle",!0)}},floodfill:function(t,e,n,r){const i=t.width,o=t.height,a=e[0],s=e[1],u=t.bitmap();return function(e){const l=e.datum.datum.items[r].items,c=l.length,f=e.datum.fontSize,h=Ay.width(e.datum,e.datum.text),d=[];let p,g,m,y,v,_,x,b,w,k,A,M,E=n?f:0,D=!1,C=!1,F=0;for(let r=0;r<c;++r){for(p=l[r].x,m=l[r].y,g=void 0===l[r].x2?p:l[r].x2,y=void 0===l[r].y2?m:l[r].y2,d.push([t((p+g)/2),t((m+y)/2)]);d.length;)if([x,b]=d.pop(),!(a.get(x,b)||s.get(x,b)||u.get(x,b))){u.set(x,b);for(let t=0;t<4;++t)v=x+lF[t],_=b+cF[t],u.outOfBounds(v,_,v,_)||d.push([v,_]);if(v=t.invert(x),_=t.invert(b),w=E,k=o,!sF(v,_,h,f,i,o)&&!uF(t,v,_,f,h,w,a,s)&&!uF(t,v,_,f,h,f,a,null)){for(;k-w>=1;)A=(w+k)/2,uF(t,v,_,f,h,A,a,s)?k=A:w=A;w>E&&(e.x=v,e.y=_,E=w,D=!0)}}D||n||(M=Math.abs(g-p+y-m),v=(p+g)/2,_=(m+y)/2,M>=F&&!sF(v,_,h,f,i,o)&&!uF(t,v,_,f,h,f,a,null)&&(F=M,e.x=v,e.y=_,C=!0))}return!(!D&&!C)&&(v=h/2,_=f/2,a.setRange(t(e.x-v),t(e.y-_),t(e.x+v),t(e.y+_)),e.align="center",e.baseline="middle",!0)}}};function mF(t,e,n,r,i,o,a,s,u,l,c){if(!t.length)return t;const f=Math.max(r.length,i.length),h=function(t,e){const n=new Float64Array(e),r=t.length;for(let e=0;e<r;++e)n[e]=t[e]||0;for(let t=r;t<e;++t)n[t]=n[r-1];return n}(r,f),d=function(t,e){const n=new Int8Array(e),r=t.length;for(let e=0;e<r;++e)n[e]|=pF[t[e]];for(let t=r;t<e;++t)n[t]=n[r-1];return n}(i,f),p=(x=t[0].datum)&&x.mark&&x.mark.marktype,g="group"===p&&t[0].datum.items[u].marktype,m="area"===g,y=function(t,e,n,r){const i=t=>[t.x,t.x,t.x,t.y,t.y,t.y];return t?"line"===t||"area"===t?t=>i(t.datum):"line"===e?t=>{const e=t.datum.items[r].items;return i(e.length?e["start"===n?0:e.length-1]:{x:NaN,y:NaN})}:t=>{const e=t.datum.bounds;return[e.x1,(e.x1+e.x2)/2,e.x2,e.y1,(e.y1+e.y2)/2,e.y2]}:i}(p,g,s,u),v=null===l||l===1/0,_=m&&"naive"===c;var x;let b=-1,w=-1;const k=t.map((t=>{const e=v?Ay.width(t,t.text):void 0;return b=Math.max(b,e),w=Math.max(w,t.fontSize),{datum:t,opacity:0,x:void 0,y:void 0,align:void 0,baseline:void 0,boundary:y(t),textWidth:e}}));l=null===l||l===1/0?Math.max(b,w)+Math.max(...r):l;const A=aF(e[0],e[1],l);let M;if(!_){n&&k.sort(((t,e)=>n(t.datum,e.datum)));let e=!1;for(let t=0;t<d.length&&!e;++t)e=5===d[t]||h[t]<0;const r=(p&&a||m)&&t.map((t=>t.datum));M=o.length||r?function(t,e,n,r,i){const o=t.width,a=t.height,s=r||i,u=Sc(o,a).getContext("2d"),l=Sc(o,a).getContext("2d"),c=s&&Sc(o,a).getContext("2d");n.forEach((t=>KC(u,t,!1))),KC(l,e,!1),s&&KC(c,e,!0);const f=QC(u,o,a),h=QC(l,o,a),d=s&&QC(c,o,a),p=t.bitmap(),g=s&&t.bitmap();let m,y,v,_,x,b,w,k;for(y=0;y<a;++y)for(m=0;m<o;++m)x=y*o+m,b=f[x]&ZC,k=h[x]&ZC,w=s&&d[x]&ZC,(b||w||k)&&(v=t(m),_=t(y),i||!b&&!k||p.set(v,_),s&&(b||w)&&g.set(v,_));return[p,g]}(A,r||[],o,e,m):function(t,e){const n=t.bitmap();return(e||[]).forEach((e=>n.set(t(e.boundary[0]),t(e.boundary[3])))),[n,void 0]}(A,a&&k)}const E=m?gF[c](A,M,a,u):function(t,e,n,r){const i=t.width,o=t.height,a=e[0],s=e[1],u=r.length;return function(e){const l=e.boundary,c=e.datum.fontSize;if(l[2]<0||l[5]<0||l[0]>i||l[3]>o)return!1;let f,h,d,p,g,m,y,v,_,x,b,w,k,A,M,E=e.textWidth??0;for(let i=0;i<u;++i){if(f=(3&n[i])-1,h=(n[i]>>>2&3)-1,d=0===f&&0===h||r[i]<0,p=f&&h?Math.SQRT1_2:1,g=r[i]<0?-1:1,m=l[1+f]+r[i]*f*p,b=l[4+h]+g*c*h/2+r[i]*h*p,v=b-c/2,_=b+c/2,w=t(m),A=t(v),M=t(_),!E){if(!dF(w,w,A,M,a,s,0,0,0,0,0,d))continue;E=Ay.width(e.datum,e.datum.text)}if(x=m+g*E*f/2,m=x-E/2,y=x+E/2,w=t(m),k=t(y),dF(w,k,A,M,a,s,0,0,0,0,0,d))return e.x=f?f*g<0?y:m:x,e.y=h?h*g<0?_:v:b,e.align=fF[f*g+1],e.baseline=hF[h*g+1],a.setRange(w,A,k,M),!0}return!1}}(A,M,d,h);return k.forEach((t=>t.opacity=+E(t))),k}const yF=["x","y","opacity","align","baseline"],vF=["top-left","left","bottom-left","top","bottom","top-right","right","bottom-right"];function _F(t){Xa.call(this,null,t)}_F.Definition={type:"Label",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:!0,default:vF},{name:"offset",type:"number",array:!0,default:[1]},{name:"padding",type:"number",default:0,null:!0},{name:"lineAnchor",type:"string",values:["start","end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:!0},{name:"avoidMarks",type:"data",array:!0},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:!0,length:yF.length,default:yF}]},ht(_F,Xa,{transform(t,e){const n=t.modified();if(!(n||e.changed(e.ADD_REM)||function(n){const r=t[n];return J(r)&&e.modified(r.fields)}("sort")))return;t.size&&2===t.size.length||s("Size parameter should be specified as a [width, height] array.");const r=t.as||yF;return mF(e.materialize(e.SOURCE).source||[],t.size,t.sort,V(null==t.offset?1:t.offset),V(t.anchor||vF),t.avoidMarks||[],!1!==t.avoidBaseMark,t.lineAnchor||"end",t.markIndex||0,void 0===t.padding?0:t.padding,t.method||"naive").forEach((t=>{const e=t.datum;e[r[0]]=t.x,e[r[1]]=t.y,e[r[2]]=t.opacity,e[r[3]]=t.align,e[r[4]]=t.baseline})),e.reflow(n).modifies(r)}});var xF=Object.freeze({__proto__:null,label:_F});function bF(t,e){var n,r,i,o,a,s,u=[],l=function(t){return t(o)};if(null==e)u.push(t);else for(n={},r=0,i=t.length;r<i;++r)o=t[r],(s=n[a=e.map(l)])||(n[a]=s=[],s.dims=a,u.push(s)),s.push(o);return u}function wF(t){Xa.call(this,null,t)}wF.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]},ht(wF,Xa,{transform(t,e){const r=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){const i=bF(e.materialize(e.SOURCE).source,t.groupby),o=(t.groupby||[]).map(n),a=o.length,s=t.as||[n(t.x),n(t.y)],u=[];i.forEach((e=>{Ls(e,t.x,t.y,t.bandwidth||.3).forEach((t=>{const n={};for(let t=0;t<a;++t)n[o[t]]=e.dims[t];n[s[0]]=t[0],n[s[1]]=t[1],u.push(va(n))}))})),this.value&&(r.rem=this.value),this.value=r.add=r.source=u}return r}});const kF={constant:Es,linear:$s,log:Ts,exp:Bs,pow:zs,quad:Ns,poly:Os};function AF(t){Xa.call(this,null,t)}AF.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(kF)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]},ht(AF,Xa,{transform(t,e){const r=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){const i=bF(e.materialize(e.SOURCE).source,t.groupby),o=(t.groupby||[]).map(n),a=t.method||"linear",u=null==t.order?3:t.order,l=((t,e)=>"poly"===t?e:"quad"===t?2:1)(a,u),c=t.as||[n(t.x),n(t.y)],f=kF[a],h=[];let d=t.extent;ut(kF,a)||s("Invalid regression method: "+a),null!=d&&"log"===a&&d[0]<=0&&(e.dataflow.warn("Ignoring extent with values <= 0 for log regression."),d=null),i.forEach((n=>{if(n.length<=l)return void e.dataflow.warn("Skipping regression with more parameters than data points.");const r=f(n,t.x,t.y,u);if(t.params)return void h.push(va({keys:n.dims,coef:r.coef,rSquared:r.rSquared}));const i=d||at(n,t.x),s=t=>{const e={};for(let t=0;t<o.length;++t)e[o[t]]=n.dims[t];e[c[0]]=t[0],e[c[1]]=t[1],h.push(va(e))};"linear"===a||"constant"===a?i.forEach((t=>s([t,r.predict(t)]))):js(r.predict,i,25,200).forEach(s)})),this.value&&(r.rem=this.value),this.value=r.add=r.source=h}return r}});var MF=Object.freeze({__proto__:null,loess:wF,regression:AF});const EF=134217729,DF=33306690738754706e-32;function CF(t,e,n,r,i){let o,a,s,u,l=e[0],c=r[0],f=0,h=0;c>l==c>-l?(o=l,l=e[++f]):(o=c,c=r[++h]);let d=0;if(f<t&&h<n)for(c>l==c>-l?(a=l+o,s=o-(a-l),l=e[++f]):(a=c+o,s=o-(a-c),c=r[++h]),o=a,0!==s&&(i[d++]=s);f<t&&h<n;)c>l==c>-l?(a=o+l,u=a-o,s=o-(a-u)+(l-u),l=e[++f]):(a=o+c,u=a-o,s=o-(a-u)+(c-u),c=r[++h]),o=a,0!==s&&(i[d++]=s);for(;f<t;)a=o+l,u=a-o,s=o-(a-u)+(l-u),l=e[++f],o=a,0!==s&&(i[d++]=s);for(;h<n;)a=o+c,u=a-o,s=o-(a-u)+(c-u),c=r[++h],o=a,0!==s&&(i[d++]=s);return 0===o&&0!==d||(i[d++]=o),d}function FF(t){return new Float64Array(t)}const SF=22204460492503146e-32,$F=11093356479670487e-47,TF=FF(4),BF=FF(8),zF=FF(12),NF=FF(16),OF=FF(4);function RF(t,e,n,r,i,o){const a=(e-o)*(n-i),s=(t-i)*(r-o),u=a-s;if(0===a||0===s||a>0!=s>0)return u;const l=Math.abs(a+s);return Math.abs(u)>=33306690738754716e-32*l?u:-function(t,e,n,r,i,o,a){let s,u,l,c,f,h,d,p,g,m,y,v,_,x,b,w,k,A;const M=t-i,E=n-i,D=e-o,C=r-o;x=M*C,h=EF*M,d=h-(h-M),p=M-d,h=EF*C,g=h-(h-C),m=C-g,b=p*m-(x-d*g-p*g-d*m),w=D*E,h=EF*D,d=h-(h-D),p=D-d,h=EF*E,g=h-(h-E),m=E-g,k=p*m-(w-d*g-p*g-d*m),y=b-k,f=b-y,TF[0]=b-(y+f)+(f-k),v=x+y,f=v-x,_=x-(v-f)+(y-f),y=_-w,f=_-y,TF[1]=_-(y+f)+(f-w),A=v+y,f=A-v,TF[2]=v-(A-f)+(y-f),TF[3]=A;let F=function(t,e){let n=e[0];for(let r=1;r<t;r++)n+=e[r];return n}(4,TF),S=SF*a;if(F>=S||-F>=S)return F;if(f=t-M,s=t-(M+f)+(f-i),f=n-E,l=n-(E+f)+(f-i),f=e-D,u=e-(D+f)+(f-o),f=r-C,c=r-(C+f)+(f-o),0===s&&0===u&&0===l&&0===c)return F;if(S=$F*a+DF*Math.abs(F),F+=M*c+C*s-(D*l+E*u),F>=S||-F>=S)return F;x=s*C,h=EF*s,d=h-(h-s),p=s-d,h=EF*C,g=h-(h-C),m=C-g,b=p*m-(x-d*g-p*g-d*m),w=u*E,h=EF*u,d=h-(h-u),p=u-d,h=EF*E,g=h-(h-E),m=E-g,k=p*m-(w-d*g-p*g-d*m),y=b-k,f=b-y,OF[0]=b-(y+f)+(f-k),v=x+y,f=v-x,_=x-(v-f)+(y-f),y=_-w,f=_-y,OF[1]=_-(y+f)+(f-w),A=v+y,f=A-v,OF[2]=v-(A-f)+(y-f),OF[3]=A;const $=CF(4,TF,4,OF,BF);x=M*c,h=EF*M,d=h-(h-M),p=M-d,h=EF*c,g=h-(h-c),m=c-g,b=p*m-(x-d*g-p*g-d*m),w=D*l,h=EF*D,d=h-(h-D),p=D-d,h=EF*l,g=h-(h-l),m=l-g,k=p*m-(w-d*g-p*g-d*m),y=b-k,f=b-y,OF[0]=b-(y+f)+(f-k),v=x+y,f=v-x,_=x-(v-f)+(y-f),y=_-w,f=_-y,OF[1]=_-(y+f)+(f-w),A=v+y,f=A-v,OF[2]=v-(A-f)+(y-f),OF[3]=A;const T=CF($,BF,4,OF,zF);x=s*c,h=EF*s,d=h-(h-s),p=s-d,h=EF*c,g=h-(h-c),m=c-g,b=p*m-(x-d*g-p*g-d*m),w=u*l,h=EF*u,d=h-(h-u),p=u-d,h=EF*l,g=h-(h-l),m=l-g,k=p*m-(w-d*g-p*g-d*m),y=b-k,f=b-y,OF[0]=b-(y+f)+(f-k),v=x+y,f=v-x,_=x-(v-f)+(y-f),y=_-w,f=_-y,OF[1]=_-(y+f)+(f-w),A=v+y,f=A-v,OF[2]=v-(A-f)+(y-f),OF[3]=A;const B=CF(T,zF,4,OF,NF);return NF[B-1]}(t,e,n,r,i,o,l)}const LF=Math.pow(2,-52),UF=new Uint32Array(512);class qF{static from(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:YF,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:GF;const r=t.length,i=new Float64Array(2*r);for(let o=0;o<r;o++){const r=t[o];i[2*o]=e(r),i[2*o+1]=n(r)}return new qF(i)}constructor(t){const e=t.length>>1;if(e>0&&"number"!=typeof t[0])throw new Error("Expected coords to contain numbers.");this.coords=t;const n=Math.max(2*e-5,0);this._triangles=new Uint32Array(3*n),this._halfedges=new Int32Array(3*n),this._hashSize=Math.ceil(Math.sqrt(e)),this._hullPrev=new Uint32Array(e),this._hullNext=new Uint32Array(e),this._hullTri=new Uint32Array(e),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(e),this._dists=new Float64Array(e),this.update()}update(){const{coords:t,_hullPrev:e,_hullNext:n,_hullTri:r,_hullHash:i}=this,o=t.length>>1;let a=1/0,s=1/0,u=-1/0,l=-1/0;for(let e=0;e<o;e++){const n=t[2*e],r=t[2*e+1];n<a&&(a=n),r<s&&(s=r),n>u&&(u=n),r>l&&(l=r),this._ids[e]=e}const c=(a+u)/2,f=(s+l)/2;let h,d,p,g=1/0;for(let e=0;e<o;e++){const n=PF(c,f,t[2*e],t[2*e+1]);n<g&&(h=e,g=n)}const m=t[2*h],y=t[2*h+1];g=1/0;for(let e=0;e<o;e++){if(e===h)continue;const n=PF(m,y,t[2*e],t[2*e+1]);n<g&&n>0&&(d=e,g=n)}let v=t[2*d],_=t[2*d+1],x=1/0;for(let e=0;e<o;e++){if(e===h||e===d)continue;const n=IF(m,y,v,_,t[2*e],t[2*e+1]);n<x&&(p=e,x=n)}let b=t[2*p],w=t[2*p+1];if(x===1/0){for(let e=0;e<o;e++)this._dists[e]=t[2*e]-t[0]||t[2*e+1]-t[1];WF(this._ids,this._dists,0,o-1);const e=new Uint32Array(o);let n=0;for(let t=0,r=-1/0;t<o;t++){const i=this._ids[t];this._dists[i]>r&&(e[n++]=i,r=this._dists[i])}return this.hull=e.subarray(0,n),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(RF(m,y,v,_,b,w)<0){const t=d,e=v,n=_;d=p,v=b,_=w,p=t,b=e,w=n}const k=function(t,e,n,r,i,o){const a=n-t,s=r-e,u=i-t,l=o-e,c=a*a+s*s,f=u*u+l*l,h=.5/(a*l-s*u),d=t+(l*c-s*f)*h,p=e+(a*f-u*c)*h;return{x:d,y:p}}(m,y,v,_,b,w);this._cx=k.x,this._cy=k.y;for(let e=0;e<o;e++)this._dists[e]=PF(t[2*e],t[2*e+1],k.x,k.y);WF(this._ids,this._dists,0,o-1),this._hullStart=h;let A=3;n[h]=e[p]=d,n[d]=e[h]=p,n[p]=e[d]=h,r[h]=0,r[d]=1,r[p]=2,i.fill(-1),i[this._hashKey(m,y)]=h,i[this._hashKey(v,_)]=d,i[this._hashKey(b,w)]=p,this.trianglesLen=0,this._addTriangle(h,d,p,-1,-1,-1);for(let o,a,s=0;s<this._ids.length;s++){const u=this._ids[s],l=t[2*u],c=t[2*u+1];if(s>0&&Math.abs(l-o)<=LF&&Math.abs(c-a)<=LF)continue;if(o=l,a=c,u===h||u===d||u===p)continue;let f=0;for(let t=0,e=this._hashKey(l,c);t<this._hashSize&&(f=i[(e+t)%this._hashSize],-1===f||f===n[f]);t++);f=e[f];let g,m=f;for(;g=n[m],RF(l,c,t[2*m],t[2*m+1],t[2*g],t[2*g+1])>=0;)if(m=g,m===f){m=-1;break}if(-1===m)continue;let y=this._addTriangle(m,u,n[m],-1,-1,r[m]);r[u]=this._legalize(y+2),r[m]=y,A++;let v=n[m];for(;g=n[v],RF(l,c,t[2*v],t[2*v+1],t[2*g],t[2*g+1])<0;)y=this._addTriangle(v,u,g,r[u],-1,r[v]),r[u]=this._legalize(y+2),n[v]=v,A--,v=g;if(m===f)for(;g=e[m],RF(l,c,t[2*g],t[2*g+1],t[2*m],t[2*m+1])<0;)y=this._addTriangle(g,u,m,-1,r[m],r[g]),this._legalize(y+2),r[g]=y,n[m]=m,A--,m=g;this._hullStart=e[u]=m,n[m]=e[v]=u,n[u]=v,i[this._hashKey(l,c)]=u,i[this._hashKey(t[2*m],t[2*m+1])]=m}this.hull=new Uint32Array(A);for(let t=0,e=this._hullStart;t<A;t++)this.hull[t]=e,e=n[e];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,e){return Math.floor(function(t,e){const n=t/(Math.abs(t)+Math.abs(e));return(e>0?3-n:1+n)/4}(t-this._cx,e-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:e,_halfedges:n,coords:r}=this;let i=0,o=0;for(;;){const a=n[t],s=t-t%3;if(o=s+(t+2)%3,-1===a){if(0===i)break;t=UF[--i];continue}const u=a-a%3,l=s+(t+1)%3,c=u+(a+2)%3,f=e[o],h=e[t],d=e[l],p=e[c];if(jF(r[2*f],r[2*f+1],r[2*h],r[2*h+1],r[2*d],r[2*d+1],r[2*p],r[2*p+1])){e[t]=p,e[a]=f;const r=n[c];if(-1===r){let e=this._hullStart;do{if(this._hullTri[e]===c){this._hullTri[e]=t;break}e=this._hullPrev[e]}while(e!==this._hullStart)}this._link(t,r),this._link(a,n[o]),this._link(o,c);const s=u+(a+1)%3;i<UF.length&&(UF[i++]=s)}else{if(0===i)break;t=UF[--i]}}return o}_link(t,e){this._halfedges[t]=e,-1!==e&&(this._halfedges[e]=t)}_addTriangle(t,e,n,r,i,o){const a=this.trianglesLen;return this._triangles[a]=t,this._triangles[a+1]=e,this._triangles[a+2]=n,this._link(a,r),this._link(a+1,i),this._link(a+2,o),this.trianglesLen+=3,a}}function PF(t,e,n,r){const i=t-n,o=e-r;return i*i+o*o}function jF(t,e,n,r,i,o,a,s){const u=t-a,l=e-s,c=n-a,f=r-s,h=i-a,d=o-s,p=c*c+f*f,g=h*h+d*d;return u*(f*g-p*d)-l*(c*g-p*h)+(u*u+l*l)*(c*d-f*h)<0}function IF(t,e,n,r,i,o){const a=n-t,s=r-e,u=i-t,l=o-e,c=a*a+s*s,f=u*u+l*l,h=.5/(a*l-s*u),d=(l*c-s*f)*h,p=(a*f-u*c)*h;return d*d+p*p}function WF(t,e,n,r){if(r-n<=20)for(let i=n+1;i<=r;i++){const r=t[i],o=e[r];let a=i-1;for(;a>=n&&e[t[a]]>o;)t[a+1]=t[a--];t[a+1]=r}else{let i=n+1,o=r;HF(t,n+r>>1,i),e[t[n]]>e[t[r]]&&HF(t,n,r),e[t[i]]>e[t[r]]&&HF(t,i,r),e[t[n]]>e[t[i]]&&HF(t,n,i);const a=t[i],s=e[a];for(;;){do{i++}while(e[t[i]]<s);do{o--}while(e[t[o]]>s);if(o<i)break;HF(t,i,o)}t[n+1]=t[o],t[o]=a,r-i+1>=o-n?(WF(t,e,i,r),WF(t,e,n,o-1)):(WF(t,e,n,o-1),WF(t,e,i,r))}}function HF(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function YF(t){return t[0]}function GF(t){return t[1]}const VF=1e-6;class XF{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,e){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,e){this._+=`L${this._x1=+t},${this._y1=+e}`}arc(t,e,n){const r=(t=+t)+(n=+n),i=e=+e;if(n<0)throw new Error("negative radius");null===this._x1?this._+=`M${r},${i}`:(Math.abs(this._x1-r)>VF||Math.abs(this._y1-i)>VF)&&(this._+="L"+r+","+i),n&&(this._+=`A${n},${n},0,1,1,${t-n},${e}A${n},${n},0,1,1,${this._x1=r},${this._y1=i}`)}rect(t,e,n,r){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}h${+n}v${+r}h${-n}Z`}value(){return this._||null}}class JF{constructor(){this._=[]}moveTo(t,e){this._.push([t,e])}closePath(){this._.push(this._[0].slice())}lineTo(t,e){this._.push([t,e])}value(){return this._.length?this._:null}}let ZF=class{constructor(t){let[e,n,r,i]=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,960,500];if(!((r=+r)>=(e=+e)&&(i=+i)>=(n=+n)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(2*t.points.length),this.vectors=new Float64Array(2*t.points.length),this.xmax=r,this.xmin=e,this.ymax=i,this.ymin=n,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:e,triangles:n},vectors:r}=this;let i,o;const a=this.circumcenters=this._circumcenters.subarray(0,n.length/3*2);for(let r,s,u=0,l=0,c=n.length;u<c;u+=3,l+=2){const c=2*n[u],f=2*n[u+1],h=2*n[u+2],d=t[c],p=t[c+1],g=t[f],m=t[f+1],y=t[h],v=t[h+1],_=g-d,x=m-p,b=y-d,w=v-p,k=2*(_*w-x*b);if(Math.abs(k)<1e-9){if(void 0===i){i=o=0;for(const n of e)i+=t[2*n],o+=t[2*n+1];i/=e.length,o/=e.length}const n=1e9*Math.sign((i-d)*w-(o-p)*b);r=(d+y)/2-n*w,s=(p+v)/2+n*b}else{const t=1/k,e=_*_+x*x,n=b*b+w*w;r=d+(w*e-x*n)*t,s=p+(_*n-b*e)*t}a[l]=r,a[l+1]=s}let s,u,l,c=e[e.length-1],f=4*c,h=t[2*c],d=t[2*c+1];r.fill(0);for(let n=0;n<e.length;++n)c=e[n],s=f,u=h,l=d,f=4*c,h=t[2*c],d=t[2*c+1],r[s+2]=r[f]=l-d,r[s+3]=r[f+1]=h-u}render(t){const e=null==t?t=new XF:void 0,{delaunay:{halfedges:n,inedges:r,hull:i},circumcenters:o,vectors:a}=this;if(i.length<=1)return null;for(let e=0,r=n.length;e<r;++e){const r=n[e];if(r<e)continue;const i=2*Math.floor(e/3),a=2*Math.floor(r/3),s=o[i],u=o[i+1],l=o[a],c=o[a+1];this._renderSegment(s,u,l,c,t)}let s,u=i[i.length-1];for(let e=0;e<i.length;++e){s=u,u=i[e];const n=2*Math.floor(r[u]/3),l=o[n],c=o[n+1],f=4*s,h=this._project(l,c,a[f+2],a[f+3]);h&&this._renderSegment(l,c,h[0],h[1],t)}return e&&e.value()}renderBounds(t){const e=null==t?t=new XF:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),e&&e.value()}renderCell(t,e){const n=null==e?e=new XF:void 0,r=this._clip(t);if(null===r||!r.length)return;e.moveTo(r[0],r[1]);let i=r.length;for(;r[0]===r[i-2]&&r[1]===r[i-1]&&i>1;)i-=2;for(let t=2;t<i;t+=2)r[t]===r[t-2]&&r[t+1]===r[t-1]||e.lineTo(r[t],r[t+1]);return e.closePath(),n&&n.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let e=0,n=t.length/2;e<n;++e){const t=this.cellPolygon(e);t&&(t.index=e,yield t)}}cellPolygon(t){const e=new JF;return this.renderCell(t,e),e.value()}_renderSegment(t,e,n,r,i){let o;const a=this._regioncode(t,e),s=this._regioncode(n,r);0===a&&0===s?(i.moveTo(t,e),i.lineTo(n,r)):(o=this._clipSegment(t,e,n,r,a,s))&&(i.moveTo(o[0],o[1]),i.lineTo(o[2],o[3]))}contains(t,e,n){return(e=+e)==e&&(n=+n)==n&&this.delaunay._step(t,e,n)===t}*neighbors(t){const e=this._clip(t);if(e)for(const n of this.delaunay.neighbors(t)){const t=this._clip(n);if(t)t:for(let r=0,i=e.length;r<i;r+=2)for(let o=0,a=t.length;o<a;o+=2)if(e[r]===t[o]&&e[r+1]===t[o+1]&&e[(r+2)%i]===t[(o+a-2)%a]&&e[(r+3)%i]===t[(o+a-1)%a]){yield n;break t}}}_cell(t){const{circumcenters:e,delaunay:{inedges:n,halfedges:r,triangles:i}}=this,o=n[t];if(-1===o)return null;const a=[];let s=o;do{const n=Math.floor(s/3);if(a.push(e[2*n],e[2*n+1]),s=s%3==2?s-2:s+1,i[s]!==t)break;s=r[s]}while(s!==o&&-1!==s);return a}_clip(t){if(0===t&&1===this.delaunay.hull.length)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const e=this._cell(t);if(null===e)return null;const{vectors:n}=this,r=4*t;return this._simplify(n[r]||n[r+1]?this._clipInfinite(t,e,n[r],n[r+1],n[r+2],n[r+3]):this._clipFinite(t,e))}_clipFinite(t,e){const n=e.length;let r,i,o,a,s=null,u=e[n-2],l=e[n-1],c=this._regioncode(u,l),f=0;for(let h=0;h<n;h+=2)if(r=u,i=l,u=e[h],l=e[h+1],o=c,c=this._regioncode(u,l),0===o&&0===c)a=f,f=0,s?s.push(u,l):s=[u,l];else{let e,n,h,d,p;if(0===o){if(null===(e=this._clipSegment(r,i,u,l,o,c)))continue;[n,h,d,p]=e}else{if(null===(e=this._clipSegment(u,l,r,i,c,o)))continue;[d,p,n,h]=e,a=f,f=this._edgecode(n,h),a&&f&&this._edge(t,a,f,s,s.length),s?s.push(n,h):s=[n,h]}a=f,f=this._edgecode(d,p),a&&f&&this._edge(t,a,f,s,s.length),s?s.push(d,p):s=[d,p]}if(s)a=f,f=this._edgecode(s[0],s[1]),a&&f&&this._edge(t,a,f,s,s.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return s}_clipSegment(t,e,n,r,i,o){const a=i<o;for(a&&([t,e,n,r,i,o]=[n,r,t,e,o,i]);;){if(0===i&&0===o)return a?[n,r,t,e]:[t,e,n,r];if(i&o)return null;let s,u,l=i||o;8&l?(s=t+(n-t)*(this.ymax-e)/(r-e),u=this.ymax):4&l?(s=t+(n-t)*(this.ymin-e)/(r-e),u=this.ymin):2&l?(u=e+(r-e)*(this.xmax-t)/(n-t),s=this.xmax):(u=e+(r-e)*(this.xmin-t)/(n-t),s=this.xmin),i?(t=s,e=u,i=this._regioncode(t,e)):(n=s,r=u,o=this._regioncode(n,r))}}_clipInfinite(t,e,n,r,i,o){let a,s=Array.from(e);if((a=this._project(s[0],s[1],n,r))&&s.unshift(a[0],a[1]),(a=this._project(s[s.length-2],s[s.length-1],i,o))&&s.push(a[0],a[1]),s=this._clipFinite(t,s))for(let e,n=0,r=s.length,i=this._edgecode(s[r-2],s[r-1]);n<r;n+=2)e=i,i=this._edgecode(s[n],s[n+1]),e&&i&&(n=this._edge(t,e,i,s,n),r=s.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(s=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return s}_edge(t,e,n,r,i){for(;e!==n;){let n,o;switch(e){case 5:e=4;continue;case 4:e=6,n=this.xmax,o=this.ymin;break;case 6:e=2;continue;case 2:e=10,n=this.xmax,o=this.ymax;break;case 10:e=8;continue;case 8:e=9,n=this.xmin,o=this.ymax;break;case 9:e=1;continue;case 1:e=5,n=this.xmin,o=this.ymin}r[i]===n&&r[i+1]===o||!this.contains(t,n,o)||(r.splice(i,0,n,o),i+=2)}return i}_project(t,e,n,r){let i,o,a,s=1/0;if(r<0){if(e<=this.ymin)return null;(i=(this.ymin-e)/r)<s&&(a=this.ymin,o=t+(s=i)*n)}else if(r>0){if(e>=this.ymax)return null;(i=(this.ymax-e)/r)<s&&(a=this.ymax,o=t+(s=i)*n)}if(n>0){if(t>=this.xmax)return null;(i=(this.xmax-t)/n)<s&&(o=this.xmax,a=e+(s=i)*r)}else if(n<0){if(t<=this.xmin)return null;(i=(this.xmin-t)/n)<s&&(o=this.xmin,a=e+(s=i)*r)}return[o,a]}_edgecode(t,e){return(t===this.xmin?1:t===this.xmax?2:0)|(e===this.ymin?4:e===this.ymax?8:0)}_regioncode(t,e){return(t<this.xmin?1:t>this.xmax?2:0)|(e<this.ymin?4:e>this.ymax?8:0)}_simplify(t){if(t&&t.length>4){for(let e=0;e<t.length;e+=2){const n=(e+2)%t.length,r=(e+4)%t.length;(t[e]===t[n]&&t[n]===t[r]||t[e+1]===t[n+1]&&t[n+1]===t[r+1])&&(t.splice(n,2),e-=2)}t.length||(t=null)}return t}};const QF=2*Math.PI,KF=Math.pow;function tS(t){return t[0]}function eS(t){return t[1]}function nS(t,e,n){return[t+Math.sin(t+e)*n,e+Math.cos(t-e)*n]}class rS{static from(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:tS,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:eS,r=arguments.length>3?arguments[3]:void 0;return new rS("length"in t?function(t,e,n,r){const i=t.length,o=new Float64Array(2*i);for(let a=0;a<i;++a){const i=t[a];o[2*a]=e.call(r,i,a,t),o[2*a+1]=n.call(r,i,a,t)}return o}(t,e,n,r):Float64Array.from(function*(t,e,n,r){let i=0;for(const o of t)yield e.call(r,o,i,t),yield n.call(r,o,i,t),++i}(t,e,n,r)))}constructor(t){this._delaunator=new qF(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,e=this.points;if(t.hull&&t.hull.length>2&&function(t){const{triangles:e,coords:n}=t;for(let t=0;t<e.length;t+=3){const r=2*e[t],i=2*e[t+1],o=2*e[t+2];if((n[o]-n[r])*(n[i+1]-n[r+1])-(n[i]-n[r])*(n[o+1]-n[r+1])>1e-10)return!1}return!0}(t)){this.collinear=Int32Array.from({length:e.length/2},((t,e)=>e)).sort(((t,n)=>e[2*t]-e[2*n]||e[2*t+1]-e[2*n+1]));const t=this.collinear[0],n=this.collinear[this.collinear.length-1],r=[e[2*t],e[2*t+1],e[2*n],e[2*n+1]],i=1e-8*Math.hypot(r[3]-r[1],r[2]-r[0]);for(let t=0,n=e.length/2;t<n;++t){const n=nS(e[2*t],e[2*t+1],i);e[2*t]=n[0],e[2*t+1]=n[1]}this._delaunator=new qF(e)}else delete this.collinear;const n=this.halfedges=this._delaunator.halfedges,r=this.hull=this._delaunator.hull,i=this.triangles=this._delaunator.triangles,o=this.inedges.fill(-1),a=this._hullIndex.fill(-1);for(let t=0,e=n.length;t<e;++t){const e=i[t%3==2?t-2:t+1];-1!==n[t]&&-1!==o[e]||(o[e]=t)}for(let t=0,e=r.length;t<e;++t)a[r[t]]=t;r.length<=2&&r.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=r[0],o[r[0]]=1,2===r.length&&(o[r[1]]=0,this.triangles[1]=r[1],this.triangles[2]=r[1]))}voronoi(t){return new ZF(this,t)}*neighbors(t){const{inedges:e,hull:n,_hullIndex:r,halfedges:i,triangles:o,collinear:a}=this;if(a){const e=a.indexOf(t);return e>0&&(yield a[e-1]),void(e<a.length-1&&(yield a[e+1]))}const s=e[t];if(-1===s)return;let u=s,l=-1;do{if(yield l=o[u],u=u%3==2?u-2:u+1,o[u]!==t)return;if(u=i[u],-1===u){const e=n[(r[t]+1)%n.length];return void(e!==l&&(yield e))}}while(u!==s)}find(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if((t=+t)!=t||(e=+e)!=e)return-1;const r=n;let i;for(;(i=this._step(n,t,e))>=0&&i!==n&&i!==r;)n=i;return i}_step(t,e,n){const{inedges:r,hull:i,_hullIndex:o,halfedges:a,triangles:s,points:u}=this;if(-1===r[t]||!u.length)return(t+1)%(u.length>>1);let l=t,c=KF(e-u[2*t],2)+KF(n-u[2*t+1],2);const f=r[t];let h=f;do{let r=s[h];const f=KF(e-u[2*r],2)+KF(n-u[2*r+1],2);if(f<c&&(c=f,l=r),h=h%3==2?h-2:h+1,s[h]!==t)break;if(h=a[h],-1===h){if(h=i[(o[t]+1)%i.length],h!==r&&KF(e-u[2*h],2)+KF(n-u[2*h+1],2)<c)return h;break}}while(h!==f);return l}render(t){const e=null==t?t=new XF:void 0,{points:n,halfedges:r,triangles:i}=this;for(let e=0,o=r.length;e<o;++e){const o=r[e];if(o<e)continue;const a=2*i[e],s=2*i[o];t.moveTo(n[a],n[a+1]),t.lineTo(n[s],n[s+1])}return this.renderHull(t),e&&e.value()}renderPoints(t,e){void 0!==e||t&&"function"==typeof t.moveTo||(e=t,t=null),e=null==e?2:+e;const n=null==t?t=new XF:void 0,{points:r}=this;for(let n=0,i=r.length;n<i;n+=2){const i=r[n],o=r[n+1];t.moveTo(i+e,o),t.arc(i,o,e,0,QF)}return n&&n.value()}renderHull(t){const e=null==t?t=new XF:void 0,{hull:n,points:r}=this,i=2*n[0],o=n.length;t.moveTo(r[i],r[i+1]);for(let e=1;e<o;++e){const i=2*n[e];t.lineTo(r[i],r[i+1])}return t.closePath(),e&&e.value()}hullPolygon(){const t=new JF;return this.renderHull(t),t.value()}renderTriangle(t,e){const n=null==e?e=new XF:void 0,{points:r,triangles:i}=this,o=2*i[t*=3],a=2*i[t+1],s=2*i[t+2];return e.moveTo(r[o],r[o+1]),e.lineTo(r[a],r[a+1]),e.lineTo(r[s],r[s+1]),e.closePath(),n&&n.value()}*trianglePolygons(){const{triangles:t}=this;for(let e=0,n=t.length/3;e<n;++e)yield this.trianglePolygon(e)}trianglePolygon(t){const e=new JF;return this.renderTriangle(t,e),e.value()}}function iS(t){Xa.call(this,null,t)}iS.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const oS=[-1e5,-1e5,1e5,1e5];function aS(t){const e=t[0][0],n=t[0][1];let r=t.length-1;for(;t[r][0]===e&&t[r][1]===n;--r);return"M"+t.slice(0,r+1).join("L")+"Z"}ht(iS,Xa,{transform(t,e){const n=t.as||"path",r=e.source;if(!r||!r.length)return e;let i=t.size;i=i?[0,0,i[0],i[1]]:(i=t.extent)?[i[0][0],i[0][1],i[1][0],i[1][1]]:oS;const o=this.value=rS.from(r,t.x,t.y).voronoi(i);for(let t=0,e=r.length;t<e;++t){const e=o.cellPolygon(t);r[t][n]=e&&(2!==(a=e).length||a[0][0]!==a[1][0]||a[0][1]!==a[1][1])?aS(e):null}var a;return e.reflow(t.modified()).modifies(n)}});var sS=Object.freeze({__proto__:null,voronoi:iS}),uS=Math.PI/180,lS=64,cS=2048;function fS(){var t,e,n,r,i,o,a,s=[256,256],u=mS,l=[],c=Math.random,f={};function h(t,e,n){for(var r,i,o,a=e.x,l=e.y,f=Math.hypot(s[0],s[1]),h=u(s),d=c()<.5?1:-1,p=-d;(r=h(p+=d))&&(i=~~r[0],o=~~r[1],!(Math.min(Math.abs(i),Math.abs(o))>=f));)if(e.x=a+i,e.y=l+o,!(e.x+e.x0<0||e.y+e.y0<0||e.x+e.x1>s[0]||e.y+e.y1>s[1])&&(!n||!dS(e,t,s[0]))&&(!n||gS(e,n))){for(var g,m=e.sprite,y=e.width>>5,v=s[0]>>5,_=e.x-(y<<4),x=127&_,b=32-x,w=e.y1-e.y0,k=(e.y+e.y0)*v+(_>>5),A=0;A<w;A++){g=0;for(var M=0;M<=y;M++)t[k+M]|=g<<b|(M<y?(g=m[A*y+M])>>>x:0);k+=v}return e.sprite=null,!0}return!1}return f.layout=function(){for(var u=function(t){t.width=t.height=1;var e=Math.sqrt(t.getContext("2d").getImageData(0,0,1,1).data.length>>2);t.width=(lS<<5)/e,t.height=cS/e;var n=t.getContext("2d");return n.fillStyle=n.strokeStyle="red",n.textAlign="center",{context:n,ratio:e}}(Sc()),f=function(t){var e=[],n=-1;for(;++n<t;)e[n]=0;return e}((s[0]>>5)*s[1]),d=null,p=l.length,g=-1,m=[],y=l.map((s=>({text:t(s),font:e(s),style:r(s),weight:i(s),rotate:o(s),size:~~(n(s)+1e-14),padding:a(s),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:s}))).sort(((t,e)=>e.size-t.size));++g<p;){var v=y[g];v.x=s[0]*(c()+.5)>>1,v.y=s[1]*(c()+.5)>>1,hS(u,v,y,g),v.hasText&&h(f,v,d)&&(m.push(v),d?pS(d,v):d=[{x:v.x+v.x0,y:v.y+v.y0},{x:v.x+v.x1,y:v.y+v.y1}],v.x-=s[0]>>1,v.y-=s[1]>>1)}return m},f.words=function(t){return arguments.length?(l=t,f):l},f.size=function(t){return arguments.length?(s=[+t[0],+t[1]],f):s},f.font=function(t){return arguments.length?(e=yS(t),f):e},f.fontStyle=function(t){return arguments.length?(r=yS(t),f):r},f.fontWeight=function(t){return arguments.length?(i=yS(t),f):i},f.rotate=function(t){return arguments.length?(o=yS(t),f):o},f.text=function(e){return arguments.length?(t=yS(e),f):t},f.spiral=function(t){return arguments.length?(u=vS[t]||t,f):u},f.fontSize=function(t){return arguments.length?(n=yS(t),f):n},f.padding=function(t){return arguments.length?(a=yS(t),f):a},f.random=function(t){return arguments.length?(c=t,f):c},f}function hS(t,e,n,r){if(!e.sprite){var i=t.context,o=t.ratio;i.clearRect(0,0,(lS<<5)/o,cS/o);var a,s,u,l,c,f=0,h=0,d=0,p=n.length;for(--r;++r<p;){if(e=n[r],i.save(),i.font=e.style+" "+e.weight+" "+~~((e.size+1)/o)+"px "+e.font,a=i.measureText(e.text+"m").width*o,u=e.size<<1,e.rotate){var g=Math.sin(e.rotate*uS),m=Math.cos(e.rotate*uS),y=a*m,v=a*g,_=u*m,x=u*g;a=Math.max(Math.abs(y+x),Math.abs(y-x))+31>>5<<5,u=~~Math.max(Math.abs(v+_),Math.abs(v-_))}else a=a+31>>5<<5;if(u>d&&(d=u),f+a>=lS<<5&&(f=0,h+=d,d=0),h+u>=cS)break;i.translate((f+(a>>1))/o,(h+(u>>1))/o),e.rotate&&i.rotate(e.rotate*uS),i.fillText(e.text,0,0),e.padding&&(i.lineWidth=2*e.padding,i.strokeText(e.text,0,0)),i.restore(),e.width=a,e.height=u,e.xoff=f,e.yoff=h,e.x1=a>>1,e.y1=u>>1,e.x0=-e.x1,e.y0=-e.y1,e.hasText=!0,f+=a}for(var b=i.getImageData(0,0,(lS<<5)/o,cS/o).data,w=[];--r>=0;)if((e=n[r]).hasText){for(s=(a=e.width)>>5,u=e.y1-e.y0,l=0;l<u*s;l++)w[l]=0;if(null==(f=e.xoff))return;h=e.yoff;var k=0,A=-1;for(c=0;c<u;c++){for(l=0;l<a;l++){var M=s*c+(l>>5),E=b[(h+c)*(lS<<5)+(f+l)<<2]?1<<31-l%32:0;w[M]|=E,k|=E}k?A=c:(e.y0++,u--,c--,h++)}e.y1=e.y0+A,e.sprite=w.slice(0,(e.y1-e.y0)*s)}}}function dS(t,e,n){n>>=5;for(var r,i=t.sprite,o=t.width>>5,a=t.x-(o<<4),s=127&a,u=32-s,l=t.y1-t.y0,c=(t.y+t.y0)*n+(a>>5),f=0;f<l;f++){r=0;for(var h=0;h<=o;h++)if((r<<u|(h<o?(r=i[f*o+h])>>>s:0))&e[c+h])return!0;c+=n}return!1}function pS(t,e){var n=t[0],r=t[1];e.x+e.x0<n.x&&(n.x=e.x+e.x0),e.y+e.y0<n.y&&(n.y=e.y+e.y0),e.x+e.x1>r.x&&(r.x=e.x+e.x1),e.y+e.y1>r.y&&(r.y=e.y+e.y1)}function gS(t,e){return t.x+t.x1>e[0].x&&t.x+t.x0<e[1].x&&t.y+t.y1>e[0].y&&t.y+t.y0<e[1].y}function mS(t){var e=t[0]/t[1];return function(t){return[e*(t*=.1)*Math.cos(t),t*Math.sin(t)]}}function yS(t){return"function"==typeof t?t:function(){return t}}var vS={archimedean:mS,rectangular:function(t){var e=4*t[0]/t[1],n=0,r=0;return function(t){var i=t<0?-1:1;switch(Math.sqrt(1+4*i*t)-i&3){case 0:n+=e;break;case 1:r+=4;break;case 2:n-=e;break;default:r-=4}return[n,r]}}};const _S=["x","y","font","fontSize","fontStyle","fontWeight","angle"],xS=["text","font","rotate","fontSize","fontStyle","fontWeight"];function bS(t){Xa.call(this,fS(),t)}bS.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:_S}]},ht(bS,Xa,{transform(e,n){!e.size||e.size[0]&&e.size[1]||s("Wordcloud size dimensions must be non-zero.");const r=e.modified();if(!(r||n.changed(n.ADD_REM)||xS.some((function(t){const r=e[t];return J(r)&&n.modified(r.fields)}))))return;const i=n.materialize(n.SOURCE).source,o=this.value,a=e.as||_S;let u,l=e.fontSize||14;if(J(l)?u=e.fontSizeRange:l=rt(l),u){const t=l,e=op("sqrt")().domain(at(i,t)).range(u);l=n=>e(t(n))}i.forEach((t=>{t[a[0]]=NaN,t[a[1]]=NaN,t[a[3]]=0}));const c=o.words(i).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(l).random(t.random).layout(),f=o.size(),h=f[0]>>1,d=f[1]>>1,p=c.length;for(let t,e,n=0;n<p;++n)t=c[n],e=t.datum,e[a[0]]=t.x+h,e[a[1]]=t.y+d,e[a[2]]=t.font,e[a[3]]=t.size,e[a[4]]=t.style,e[a[5]]=t.weight,e[a[6]]=t.rotate;return n.reflow(r).modifies(a)}});var wS=Object.freeze({__proto__:null,wordcloud:bS});const kS=t=>new Uint8Array(t),AS=t=>new Uint16Array(t),MS=t=>new Uint32Array(t);function ES(t,e,n){const r=(e<257?kS:e<65537?AS:MS)(t);return n&&r.set(n),r}function DS(t,e,n){const r=1<<e;return{one:r,zero:~r,range:n.slice(),bisect:t.bisect,index:t.index,size:t.size,onAdd(t,e){const n=this,i=n.bisect(n.range,t.value),o=t.index,a=i[0],s=i[1],u=o.length;let l;for(l=0;l<a;++l)e[o[l]]|=r;for(l=s;l<u;++l)e[o[l]]|=r;return n}}}function CS(){let t=MS(0),e=[],n=0;return{insert:function(r,i,o){if(!i.length)return[];const a=n,s=i.length,u=MS(s);let l,c,f,h=Array(s);for(f=0;f<s;++f)h[f]=r(i[f]),u[f]=f;if(h=function(t,e){return t.sort.call(e,((e,n)=>{const r=t[e],i=t[n];return r<i?-1:r>i?1:0})),function(t,e){return Array.from(e,(e=>t[e]))}(t,e)}(h,u),a)l=e,c=t,e=Array(a+s),t=MS(a+s),function(t,e,n,r,i,o,a,s,u){let l,c=0,f=0;for(l=0;c<r&&f<a;++l)e[c]<i[f]?(s[l]=e[c],u[l]=n[c++]):(s[l]=i[f],u[l]=o[f++]+t);for(;c<r;++c,++l)s[l]=e[c],u[l]=n[c];for(;f<a;++f,++l)s[l]=i[f],u[l]=o[f]+t}(o,l,c,a,h,u,s,e,t);else{if(o>0)for(f=0;f<s;++f)u[f]+=o;e=h,t=u}return n=a+s,{index:u,value:h}},remove:function(r,i){const o=n;let a,s,u;for(s=0;!i[t[s]]&&s<o;++s);for(u=s;s<o;++s)i[a=t[s]]||(t[u]=a,e[u]=e[s],++u);n=o-r},bisect:function(t,r){let i;return r?i=r.length:(r=e,i=n),[oe(r,t[0],0,i),ie(r,t[1],0,i)]},reindex:function(e){for(let r=0,i=n;r<i;++r)t[r]=e[t[r]]},index:()=>t,size:()=>n}}function FS(t){Xa.call(this,function(){let t=8,e=[],n=MS(0),r=ES(0,t),i=ES(0,t);return{data:()=>e,seen:()=>n=function(t,e,n){return t.length>=e?t:((n=n||new t.constructor(e)).set(t),n)}(n,e.length),add(t){for(let n,r=0,i=e.length,o=t.length;r<o;++r)n=t[r],n._index=i++,e.push(n)},remove(t,n){const o=e.length,a=Array(o-t),s=e;let u,l,c;for(l=0;!n[l]&&l<o;++l)a[l]=e[l],s[l]=l;for(c=l;l<o;++l)u=e[l],n[l]?s[l]=-1:(s[l]=c,r[c]=r[l],i[c]=i[l],a[c]=u,u._index=c++),r[l]=0;return e=a,s},size:()=>e.length,curr:()=>r,prev:()=>i,reset:t=>i[t]=r[t],all:()=>t<257?255:t<65537?65535:4294967295,set(t,e){r[t]|=e},clear(t,e){r[t]&=~e},resize(e,n){(e>r.length||n>t)&&(t=Math.max(n,t),r=ES(e,t,r),i=ES(e,t))}}}(),t),this._indices=null,this._dims=null}function SS(t){Xa.call(this,null,t)}FS.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]},ht(FS,Xa,{transform(t,e){return this._dims?t.modified("fields")||t.fields.some((t=>e.modified(t.fields)))?this.reinit(t,e):this.eval(t,e):this.init(t,e)},init(t,e){const n=t.fields,r=t.query,i=this._indices={},o=this._dims=[],a=r.length;let s,u,l=0;for(;l<a;++l)s=n[l].fname,u=i[s]||(i[s]=CS()),o.push(DS(u,l,r[l]));return this.eval(t,e)},reinit(t,e){const n=e.materialize().fork(),r=t.fields,i=t.query,o=this._indices,a=this._dims,s=this.value,u=s.curr(),l=s.prev(),c=s.all(),f=n.rem=n.add,h=n.mod,d=i.length,p={};let g,m,y,v,_,x,b,w,k;if(l.set(u),e.rem.length&&(_=this.remove(t,e,n)),e.add.length&&s.add(e.add),e.mod.length)for(x={},v=e.mod,b=0,w=v.length;b<w;++b)x[v[b]._index]=1;for(b=0;b<d;++b)k=r[b],(!a[b]||t.modified("fields",b)||e.modified(k.fields))&&(y=k.fname,(g=p[y])||(o[y]=m=CS(),p[y]=g=m.insert(k,e.source,0)),a[b]=DS(m,b,i[b]).onAdd(g,u));for(b=0,w=s.data().length;b<w;++b)_[b]||(l[b]!==u[b]?f.push(b):x[b]&&u[b]!==c&&h.push(b));return s.mask=(1<<d)-1,n},eval(t,e){const n=e.materialize().fork(),r=this._dims.length;let i=0;return e.rem.length&&(this.remove(t,e,n),i|=(1<<r)-1),t.modified("query")&&!t.modified("fields")&&(i|=this.update(t,e,n)),e.add.length&&(this.insert(t,e,n),i|=(1<<r)-1),e.mod.length&&(this.modify(e,n),i|=(1<<r)-1),this.value.mask=i,n},insert(t,e,n){const r=e.add,i=this.value,o=this._dims,a=this._indices,s=t.fields,u={},l=n.add,c=i.size()+r.length,f=o.length;let h,d,p,g=i.size();i.resize(c,f),i.add(r);const m=i.curr(),y=i.prev(),v=i.all();for(h=0;h<f;++h)d=s[h].fname,p=u[d]||(u[d]=a[d].insert(s[h],r,g)),o[h].onAdd(p,m);for(;g<c;++g)y[g]=v,m[g]!==v&&l.push(g)},modify(t,e){const n=e.mod,r=this.value,i=r.curr(),o=r.all(),a=t.mod;let s,u,l;for(s=0,u=a.length;s<u;++s)l=a[s]._index,i[l]!==o&&n.push(l)},remove(t,e,n){const r=this._indices,i=this.value,o=i.curr(),a=i.prev(),s=i.all(),u={},l=n.rem,c=e.rem;let f,h,d,p;for(f=0,h=c.length;f<h;++f)d=c[f]._index,u[d]=1,a[d]=p=o[d],o[d]=s,p!==s&&l.push(d);for(d in r)r[d].remove(h,u);return this.reindex(e,h,u),u},reindex(t,e,n){const r=this._indices,i=this.value;t.runAfter((()=>{const t=i.remove(e,n);for(const e in r)r[e].reindex(t)}))},update(t,e,n){const r=this._dims,i=t.query,o=e.stamp,a=r.length;let s,u,l=0;for(n.filters=0,u=0;u<a;++u)t.modified("query",u)&&(s=u,++l);if(1===l)l=r[s].one,this.incrementOne(r[s],i[s],n.add,n.rem);else for(u=0,l=0;u<a;++u)t.modified("query",u)&&(l|=r[u].one,this.incrementAll(r[u],i[u],o,n.add),n.rem=n.add);return l},incrementAll(t,e,n,r){const i=this.value,o=i.seen(),a=i.curr(),s=i.prev(),u=t.index(),l=t.bisect(t.range),c=t.bisect(e),f=c[0],h=c[1],d=l[0],p=l[1],g=t.one;let m,y,v;if(f<d)for(m=f,y=Math.min(d,h);m<y;++m)v=u[m],o[v]!==n&&(s[v]=a[v],o[v]=n,r.push(v)),a[v]^=g;else if(f>d)for(m=d,y=Math.min(f,p);m<y;++m)v=u[m],o[v]!==n&&(s[v]=a[v],o[v]=n,r.push(v)),a[v]^=g;if(h>p)for(m=Math.max(f,p),y=h;m<y;++m)v=u[m],o[v]!==n&&(s[v]=a[v],o[v]=n,r.push(v)),a[v]^=g;else if(h<p)for(m=Math.max(d,h),y=p;m<y;++m)v=u[m],o[v]!==n&&(s[v]=a[v],o[v]=n,r.push(v)),a[v]^=g;t.range=e.slice()},incrementOne(t,e,n,r){const i=this.value.curr(),o=t.index(),a=t.bisect(t.range),s=t.bisect(e),u=s[0],l=s[1],c=a[0],f=a[1],h=t.one;let d,p,g;if(u<c)for(d=u,p=Math.min(c,l);d<p;++d)g=o[d],i[g]^=h,n.push(g);else if(u>c)for(d=c,p=Math.min(u,f);d<p;++d)g=o[d],i[g]^=h,r.push(g);if(l>f)for(d=Math.max(u,f),p=l;d<p;++d)g=o[d],i[g]^=h,n.push(g);else if(l<f)for(d=Math.max(c,l),p=f;d<p;++d)g=o[d],i[g]^=h,r.push(g);t.range=e.slice()}}),SS.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]},ht(SS,Xa,{transform(t,e){const n=~(t.ignore||0),r=t.filter,i=r.mask;if(0==(i&n))return e.StopPropagation;const o=e.fork(e.ALL),a=r.data(),s=r.curr(),u=r.prev(),l=t=>s[t]&n?null:a[t];return o.filter(o.MOD,l),i&i-1?(o.filter(o.ADD,(t=>{const e=s[t]&n;return!e&&e^u[t]&n?a[t]:null})),o.filter(o.REM,(t=>{const e=s[t]&n;return e&&!(e^e^u[t]&n)?a[t]:null}))):(o.filter(o.ADD,l),o.filter(o.REM,(t=>(s[t]&n)===i?a[t]:null))),o.filter(o.SOURCE,(t=>l(t._index)))}});var $S=Object.freeze({__proto__:null,crossfilter:FS,resolvefilter:SS});const TS="Literal",BS="Property",zS="ArrayExpression",NS="BinaryExpression",OS="CallExpression",RS="ConditionalExpression",LS="LogicalExpression",US="MemberExpression",qS="ObjectExpression",PS="UnaryExpression";function jS(t){this.type=t}var IS,WS,HS,YS,GS;jS.prototype.visit=function(t){let e,n,r;if(t(this))return 1;for(e=function(t){switch(t.type){case zS:return t.elements;case NS:case LS:return[t.left,t.right];case OS:return[t.callee].concat(t.arguments);case RS:return[t.test,t.consequent,t.alternate];case US:return[t.object,t.property];case qS:return t.properties;case BS:return[t.key,t.value];case PS:return[t.argument];default:return[]}}(this),n=0,r=e.length;n<r;++n)if(e[n].visit(t))return 1};var VS=1,XS=2,JS=3,ZS=4,QS=5,KS=6,t$=7,e$=8;(IS={})[VS]="Boolean",IS[XS]="<end>",IS[JS]="Identifier",IS[ZS]="Keyword",IS[QS]="Null",IS[KS]="Numeric",IS[t$]="Punctuator",IS[e$]="String",IS[9]="RegularExpression";var n$="ArrayExpression",r$="BinaryExpression",i$="CallExpression",o$="ConditionalExpression",a$="Identifier",s$="Literal",u$="LogicalExpression",l$="MemberExpression",c$="ObjectExpression",f$="Property",h$="UnaryExpression",d$="Unexpected token %0",p$="Unexpected number",g$="Unexpected string",m$="Unexpected identifier",y$="Unexpected reserved word",v$="Unexpected end of input",_$="Invalid regular expression",x$="Invalid regular expression: missing /",b$="Octal literals are not allowed in strict mode.",w$="Duplicate data property in object literal not allowed in strict mode",k$="ILLEGAL",A$="Disabled.",M$=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),E$=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function D$(t,e){if(!t)throw new Error("ASSERT: "+e)}function C$(t){return t>=48&&t<=57}function F$(t){return"0123456789abcdefABCDEF".includes(t)}function S$(t){return"01234567".includes(t)}function $$(t){return 32===t||9===t||11===t||12===t||160===t||t>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].includes(t)}function T$(t){return 10===t||13===t||8232===t||8233===t}function B$(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||92===t||t>=128&&M$.test(String.fromCharCode(t))}function z$(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||92===t||t>=128&&E$.test(String.fromCharCode(t))}const N$={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function O$(){for(;HS<YS;){const t=WS.charCodeAt(HS);if(!$$(t)&&!T$(t))break;++HS}}function R$(t){var e,n,r,i=0;for(n="u"===t?4:2,e=0;e<n;++e)HS<YS&&F$(WS[HS])?(r=WS[HS++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())):K$({},d$,k$);return String.fromCharCode(i)}function L$(){var t,e,n,r;for(e=0,"}"===(t=WS[HS])&&K$({},d$,k$);HS<YS&&F$(t=WS[HS++]);)e=16*e+"0123456789abcdef".indexOf(t.toLowerCase());return(e>1114111||"}"!==t)&&K$({},d$,k$),e<=65535?String.fromCharCode(e):(n=55296+(e-65536>>10),r=56320+(e-65536&1023),String.fromCharCode(n,r))}function U$(){var t,e;for(t=WS.charCodeAt(HS++),e=String.fromCharCode(t),92===t&&(117!==WS.charCodeAt(HS)&&K$({},d$,k$),++HS,(t=R$("u"))&&"\\"!==t&&B$(t.charCodeAt(0))||K$({},d$,k$),e=t);HS<YS&&z$(t=WS.charCodeAt(HS));)++HS,e+=String.fromCharCode(t),92===t&&(e=e.substr(0,e.length-1),117!==WS.charCodeAt(HS)&&K$({},d$,k$),++HS,(t=R$("u"))&&"\\"!==t&&z$(t.charCodeAt(0))||K$({},d$,k$),e+=t);return e}function q$(){var t,e;return t=HS,e=92===WS.charCodeAt(HS)?U$():function(){var t,e;for(t=HS++;HS<YS;){if(92===(e=WS.charCodeAt(HS)))return HS=t,U$();if(!z$(e))break;++HS}return WS.slice(t,HS)}(),{type:1===e.length?JS:N$.hasOwnProperty(e)?ZS:"null"===e?QS:"true"===e||"false"===e?VS:JS,value:e,start:t,end:HS}}function P$(){var t,e,n,r,i=HS,o=WS.charCodeAt(HS),a=WS[HS];switch(o){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++HS,{type:t$,value:String.fromCharCode(o),start:i,end:HS};default:if(61===(t=WS.charCodeAt(HS+1)))switch(o){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return HS+=2,{type:t$,value:String.fromCharCode(o)+String.fromCharCode(t),start:i,end:HS};case 33:case 61:return HS+=2,61===WS.charCodeAt(HS)&&++HS,{type:t$,value:WS.slice(i,HS),start:i,end:HS}}}return">>>="===(r=WS.substr(HS,4))?{type:t$,value:r,start:i,end:HS+=4}:">>>"===(n=r.substr(0,3))||"<<="===n||">>="===n?{type:t$,value:n,start:i,end:HS+=3}:a===(e=n.substr(0,2))[1]&&"+-<>&|".includes(a)||"=>"===e?{type:t$,value:e,start:i,end:HS+=2}:("//"===e&&K$({},d$,k$),"<>=!+-*%&|^/".includes(a)?(++HS,{type:t$,value:a,start:i,end:HS}):void K$({},d$,k$))}function j$(){var t,e,n;if(D$(C$((n=WS[HS]).charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),e=HS,t="","."!==n){if(t=WS[HS++],n=WS[HS],"0"===t){if("x"===n||"X"===n)return++HS,function(t){let e="";for(;HS<YS&&F$(WS[HS]);)e+=WS[HS++];return 0===e.length&&K$({},d$,k$),B$(WS.charCodeAt(HS))&&K$({},d$,k$),{type:KS,value:parseInt("0x"+e,16),start:t,end:HS}}(e);if(S$(n))return function(t){let e="0"+WS[HS++];for(;HS<YS&&S$(WS[HS]);)e+=WS[HS++];return(B$(WS.charCodeAt(HS))||C$(WS.charCodeAt(HS)))&&K$({},d$,k$),{type:KS,value:parseInt(e,8),octal:!0,start:t,end:HS}}(e);n&&C$(n.charCodeAt(0))&&K$({},d$,k$)}for(;C$(WS.charCodeAt(HS));)t+=WS[HS++];n=WS[HS]}if("."===n){for(t+=WS[HS++];C$(WS.charCodeAt(HS));)t+=WS[HS++];n=WS[HS]}if("e"===n||"E"===n)if(t+=WS[HS++],"+"!==(n=WS[HS])&&"-"!==n||(t+=WS[HS++]),C$(WS.charCodeAt(HS)))for(;C$(WS.charCodeAt(HS));)t+=WS[HS++];else K$({},d$,k$);return B$(WS.charCodeAt(HS))&&K$({},d$,k$),{type:KS,value:parseFloat(t),start:e,end:HS}}function I$(){var t,e,n,r;return GS=null,O$(),t=HS,e=function(){var t,e,n,r;for(D$("/"===(t=WS[HS]),"Regular expression literal must start with a slash"),e=WS[HS++],n=!1,r=!1;HS<YS;)if(e+=t=WS[HS++],"\\"===t)T$((t=WS[HS++]).charCodeAt(0))&&K$({},x$),e+=t;else if(T$(t.charCodeAt(0)))K$({},x$);else if(n)"]"===t&&(n=!1);else{if("/"===t){r=!0;break}"["===t&&(n=!0)}return r||K$({},x$),{value:e.substr(1,e.length-2),literal:e}}(),n=function(){var t,e,n;for(e="",n="";HS<YS&&z$((t=WS[HS]).charCodeAt(0));)++HS,"\\"===t&&HS<YS?K$({},d$,k$):(n+=t,e+=t);return n.search(/[^gimuy]/g)>=0&&K$({},_$,n),{value:n,literal:e}}(),r=function(t,e){let n=t;e.includes("u")&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,((t,e)=>{if(parseInt(e,16)<=1114111)return"x";K$({},_$)})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(t){K$({},_$)}try{return new RegExp(t,e)}catch(t){return null}}(e.value,n.value),{literal:e.literal+n.literal,value:r,regex:{pattern:e.value,flags:n.value},start:t,end:HS}}function W$(){if(O$(),HS>=YS)return{type:XS,start:HS,end:HS};const t=WS.charCodeAt(HS);return B$(t)?q$():40===t||41===t||59===t?P$():39===t||34===t?function(){var t,e,n,r,i="",o=!1;for(D$("'"===(t=WS[HS])||'"'===t,"String literal must starts with a quote"),e=HS,++HS;HS<YS;){if((n=WS[HS++])===t){t="";break}if("\\"===n)if((n=WS[HS++])&&T$(n.charCodeAt(0)))"\r"===n&&"\n"===WS[HS]&&++HS;else switch(n){case"u":case"x":"{"===WS[HS]?(++HS,i+=L$()):i+=R$(n);break;case"n":i+="\n";break;case"r":i+="\r";break;case"t":i+="\t";break;case"b":i+="\b";break;case"f":i+="\f";break;case"v":i+="\v";break;default:S$(n)?(0!==(r="01234567".indexOf(n))&&(o=!0),HS<YS&&S$(WS[HS])&&(o=!0,r=8*r+"01234567".indexOf(WS[HS++]),"0123".includes(n)&&HS<YS&&S$(WS[HS])&&(r=8*r+"01234567".indexOf(WS[HS++]))),i+=String.fromCharCode(r)):i+=n}else{if(T$(n.charCodeAt(0)))break;i+=n}}return""!==t&&K$({},d$,k$),{type:e$,value:i,octal:o,start:e,end:HS}}():46===t?C$(WS.charCodeAt(HS+1))?j$():P$():C$(t)?j$():P$()}function H$(){const t=GS;return HS=t.end,GS=W$(),HS=t.end,t}function Y$(){const t=HS;GS=W$(),HS=t}function G$(t,e,n){const r=new jS("||"===t||"&&"===t?u$:r$);return r.operator=t,r.left=e,r.right=n,r}function V$(t,e){const n=new jS(i$);return n.callee=t,n.arguments=e,n}function X$(t){const e=new jS(a$);return e.name=t,e}function J$(t){const e=new jS(s$);return e.value=t.value,e.raw=WS.slice(t.start,t.end),t.regex&&("//"===e.raw&&(e.raw="/(?:)/"),e.regex=t.regex),e}function Z$(t,e,n){const r=new jS(l$);return r.computed="["===t,r.object=e,r.property=n,r.computed||(n.member=!0),r}function Q$(t,e,n){const r=new jS(f$);return r.key=e,r.value=n,r.kind=t,r}function K$(t,e){var n,r=Array.prototype.slice.call(arguments,2),i=e.replace(/%(\d)/g,((t,e)=>(D$(e<r.length,"Message reference must be in range"),r[e])));throw(n=new Error(i)).index=HS,n.description=i,n}function tT(t){t.type===XS&&K$(t,v$),t.type===KS&&K$(t,p$),t.type===e$&&K$(t,g$),t.type===JS&&K$(t,m$),t.type===ZS&&K$(t,y$),K$(t,d$,t.value)}function eT(t){const e=H$();e.type===t$&&e.value===t||tT(e)}function nT(t){return GS.type===t$&&GS.value===t}function rT(t){return GS.type===ZS&&GS.value===t}function iT(){const t=[];for(HS=GS.start,eT("[");!nT("]");)nT(",")?(H$(),t.push(null)):(t.push(mT()),nT("]")||eT(","));return H$(),function(t){const e=new jS(n$);return e.elements=t,e}(t)}function oT(){HS=GS.start;const t=H$();return t.type===e$||t.type===KS?(t.octal&&K$(t,b$),J$(t)):X$(t.value)}function aT(){var t,e,n;return HS=GS.start,(t=GS).type===JS?(n=oT(),eT(":"),Q$("init",n,mT())):t.type!==XS&&t.type!==t$?(e=oT(),eT(":"),Q$("init",e,mT())):void tT(t)}function sT(){var t,e,n=[],r={},i=String;for(HS=GS.start,eT("{");!nT("}");)e="$"+((t=aT()).key.type===a$?t.key.name:i(t.key.value)),Object.prototype.hasOwnProperty.call(r,e)?K$({},w$):r[e]=!0,n.push(t),nT("}")||eT(",");return eT("}"),function(t){const e=new jS(c$);return e.properties=t,e}(n)}const uT={if:1};function lT(){var t,e,n;if(nT("("))return function(){eT("(");const t=yT();return eT(")"),t}();if(nT("["))return iT();if(nT("{"))return sT();if(t=GS.type,HS=GS.start,t===JS||uT[GS.value])n=X$(H$().value);else if(t===e$||t===KS)GS.octal&&K$(GS,b$),n=J$(H$());else{if(t===ZS)throw new Error(A$);t===VS?((e=H$()).value="true"===e.value,n=J$(e)):t===QS?((e=H$()).value=null,n=J$(e)):nT("/")||nT("/=")?(n=J$(I$()),Y$()):tT(H$())}return n}function cT(){const t=[];if(eT("("),!nT(")"))for(;HS<YS&&(t.push(mT()),!nT(")"));)eT(",");return eT(")"),t}function fT(){HS=GS.start;const t=H$();return function(t){return t.type===JS||t.type===ZS||t.type===VS||t.type===QS}(t)||tT(t),X$(t.value)}function hT(){eT("[");const t=yT();return eT("]"),t}function dT(){const t=function(){var t;for(t=lT();;)if(nT("."))eT("."),t=Z$(".",t,fT());else if(nT("("))t=V$(t,cT());else{if(!nT("["))break;t=Z$("[",t,hT())}return t}();if(GS.type===t$&&(nT("++")||nT("--")))throw new Error(A$);return t}function pT(){var t,e;if(GS.type!==t$&&GS.type!==ZS)e=dT();else{if(nT("++")||nT("--"))throw new Error(A$);if(nT("+")||nT("-")||nT("~")||nT("!"))t=H$(),e=pT(),e=function(t,e){const n=new jS(h$);return n.operator=t,n.argument=e,n.prefix=!0,n}(t.value,e);else{if(rT("delete")||rT("void")||rT("typeof"))throw new Error(A$);e=dT()}}return e}function gT(t){let e=0;if(t.type!==t$&&t.type!==ZS)return 0;switch(t.value){case"||":e=1;break;case"&&":e=2;break;case"|":e=3;break;case"^":e=4;break;case"&":e=5;break;case"==":case"!=":case"===":case"!==":e=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":e=7;break;case"<<":case">>":case">>>":e=8;break;case"+":case"-":e=9;break;case"*":case"/":case"%":e=11}return e}function mT(){var t,e;return t=function(){var t,e,n,r,i,o,a,s,u,l;if(t=GS,u=pT(),0===(i=gT(r=GS)))return u;for(r.prec=i,H$(),e=[t,GS],o=[u,r,a=pT()];(i=gT(GS))>0;){for(;o.length>2&&i<=o[o.length-2].prec;)a=o.pop(),s=o.pop().value,u=o.pop(),e.pop(),n=G$(s,u,a),o.push(n);(r=H$()).prec=i,o.push(r),e.push(GS),n=pT(),o.push(n)}for(n=o[l=o.length-1],e.pop();l>1;)e.pop(),n=G$(o[l-1].value,o[l-2],n),l-=2;return n}(),nT("?")&&(H$(),e=mT(),eT(":"),t=function(t,e,n){const r=new jS(o$);return r.test=t,r.consequent=e,r.alternate=n,r}(t,e,mT())),t}function yT(){const t=mT();if(nT(","))throw new Error(A$);return t}function vT(t){HS=0,YS=(WS=t).length,GS=null,Y$();const e=yT();if(GS.type!==XS)throw new Error("Unexpect token after expression.");return e}var _T={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function xT(t){function e(e,n,r){return i=>function(e,n,r,i){let o=t(n[0]);return r&&(o=r+"("+o+")",0===r.lastIndexOf("new ",0)&&(o="("+o+")")),o+"."+e+(i<0?"":0===i?"()":"("+n.slice(1).map(t).join(",")+")")}(e,i,n,r)}const n="new Date",r="String",i="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",hypot:"Math.hypot",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(e){e.length<3&&s("Missing arguments to clamp function."),e.length>3&&s("Too many arguments to clamp function.");const n=e.map(t);return"Math.max("+n[1]+", Math.min("+n[2]+","+n[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:n,date:e("getDate",n,0),day:e("getDay",n,0),year:e("getFullYear",n,0),month:e("getMonth",n,0),hours:e("getHours",n,0),minutes:e("getMinutes",n,0),seconds:e("getSeconds",n,0),milliseconds:e("getMilliseconds",n,0),time:e("getTime",n,0),timezoneoffset:e("getTimezoneOffset",n,0),utcdate:e("getUTCDate",n,0),utcday:e("getUTCDay",n,0),utcyear:e("getUTCFullYear",n,0),utcmonth:e("getUTCMonth",n,0),utchours:e("getUTCHours",n,0),utcminutes:e("getUTCMinutes",n,0),utcseconds:e("getUTCSeconds",n,0),utcmilliseconds:e("getUTCMilliseconds",n,0),length:e("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:e("toUpperCase",r,0),lower:e("toLowerCase",r,0),substring:e("substring",r),split:e("split",r),trim:e("trim",r,0),regexp:i,test:e("test",i),if:function(e){e.length<3&&s("Missing arguments to if function."),e.length>3&&s("Too many arguments to if function.");const n=e.map(t);return"("+n[0]+"?"+n[1]+":"+n[2]+")"}}}function bT(t){const e=(t=t||{}).allowed?Tt(t.allowed):{},n=t.forbidden?Tt(t.forbidden):{},r=t.constants||_T,i=(t.functions||xT)(h),o=t.globalvar,a=t.fieldvar,u=J(o)?o:t=>`${o}["${t}"]`;let l={},c={},f=0;function h(t){if(_t(t))return t;const e=d[t.type];return null==e&&s("Unsupported type: "+t.type),e(t)}const d={Literal:t=>t.raw,Identifier:t=>{const i=t.name;return f>0?i:ut(n,i)?s("Illegal identifier: "+i):ut(r,i)?r[i]:ut(e,i)?i:(l[i]=1,u(i))},MemberExpression:t=>{const e=!t.computed,n=h(t.object);e&&(f+=1);const r=h(t.property);return n===a&&(c[function(t){const e=t&&t.length-1;return e&&('"'===t[0]&&'"'===t[e]||"'"===t[0]&&"'"===t[e])?t.slice(1,-1):t}(r)]=1),e&&(f-=1),n+(e?"."+r:"["+r+"]")},CallExpression:t=>{"Identifier"!==t.callee.type&&s("Illegal callee type: "+t.callee.type);const e=t.callee.name,n=t.arguments,r=ut(i,e)&&i[e];return r||s("Unrecognized function: "+e),J(r)?r(n):r+"("+n.map(h).join(",")+")"},ArrayExpression:t=>"["+t.elements.map(h).join(",")+"]",BinaryExpression:t=>"("+h(t.left)+" "+t.operator+" "+h(t.right)+")",UnaryExpression:t=>"("+t.operator+h(t.argument)+")",ConditionalExpression:t=>"("+h(t.test)+"?"+h(t.consequent)+":"+h(t.alternate)+")",LogicalExpression:t=>"("+h(t.left)+t.operator+h(t.right)+")",ObjectExpression:t=>"{"+t.properties.map(h).join(",")+"}",Property:t=>{f+=1;const e=h(t.key);return f-=1,e+":"+h(t.value)}};function p(t){const e={code:h(t),globals:Object.keys(l),fields:Object.keys(c)};return l={},c={},e}return p.functions=i,p.constants=r,p}const wT=Symbol("vega_selection_getter");function kT(t){return t.getter&&t.getter[wT]||(t.getter=l(t.field),t.getter[wT]=!0),t.getter}const AT="intersect",MT="union",ET="_vgsid_",DT=l(ET),CT="E",FT="R",ST="R-E",$T="R-LE",TT="R-RE",BT="E-LT",zT="E-LTE",NT="E-GT",OT="E-GTE",RT="E-VALID",LT="E-ONE",UT="index:unit";function qT(t,e){for(var n,r,i=e.fields,o=e.values,a=i.length,s=0;s<a;++s)if(gt(n=kT(r=i[s])(t))&&(n=S(n)),gt(o[s])&&(o[s]=S(o[s])),k(o[s])&&gt(o[s][0])&&(o[s]=o[s].map(S)),r.type===CT){if(k(o[s])?!o[s].includes(n):n!==o[s])return!1}else if(r.type===FT){if(!dt(n,o[s]))return!1}else if(r.type===TT){if(!dt(n,o[s],!0,!1))return!1}else if(r.type===ST){if(!dt(n,o[s],!1,!1))return!1}else if(r.type===$T){if(!dt(n,o[s],!1,!0))return!1}else if(r.type===BT){if(n>=o[s])return!1}else if(r.type===zT){if(n>o[s])return!1}else if(r.type===NT){if(n<=o[s])return!1}else if(r.type===OT){if(n<o[s])return!1}else if(r.type===RT){if(null===n||isNaN(n))return!1}else if(r.type===LT&&-1===o[s].indexOf(n))return!1;return!0}const PT=te(DT),jT=PT.left,IT=PT.right;var WT={[`${ET}_union`]:function(){const t=new ue;for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];for(const e of n)for(const n of e)t.add(n);return t},[`${ET}_intersect`]:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];t=new ue(t),n=n.map($e);t:for(const e of t)for(const r of n)if(!r.has(e)){t.delete(e);continue t}return t},E_union:function(t,e){if(!t.length)return e;for(var n=0,r=e.length;n<r;++n)t.includes(e[n])||t.push(e[n]);return t},E_intersect:function(t,e){return t.length?t.filter((t=>e.includes(t))):e},R_union:function(t,e){var n=S(e[0]),r=S(e[1]);return n>r&&(n=e[1],r=e[0]),t.length?(t[0]>n&&(t[0]=n),t[1]<r&&(t[1]=r),t):[n,r]},R_intersect:function(t,e){var n=S(e[0]),r=S(e[1]);return n>r&&(n=e[1],r=e[0]),t.length?r<t[0]||t[1]<n?[]:(t[0]<n&&(t[0]=n),t[1]>r&&(t[1]=r),t):[n,r]}};function HT(t,e,n,r){e[0].type!==TS&&s("First argument to selection functions must be a string literal.");const i=e[0].value,o="unit",a="@"+o,u=":"+i;(e.length>=2&&F(e).value)!==AT||ut(r,a)||(r[a]=n.getData(i).indataRef(n,o)),ut(r,u)||(r[u]=n.getData(i).tuplesRef())}function YT(t){const e=this.context.data[t];return e?e.values.value:[]}const GT=t=>function(e,n){const r=this.context.dataflow.locale();return null===e?"null":r[t](n)(e)},VT=GT("format"),XT=GT("timeFormat"),JT=GT("utcFormat"),ZT=GT("timeParse"),QT=GT("utcParse"),KT=new Date(2e3,0,1);function tB(t,e,n){return Number.isInteger(t)&&Number.isInteger(e)?(KT.setYear(2e3),KT.setMonth(t),KT.setDate(e),XT.call(this,KT,n)):""}const eB="%",nB="$";function rB(t,e,n,r){e[0].type!==TS&&s("First argument to data functions must be a string literal.");const i=e[0].value,o=":"+i;if(!ut(o,r))try{r[o]=n.getData(i).tuplesRef()}catch(t){}}function iB(t,e,n,r){if(e[0].type===TS)oB(n,r,e[0].value);else for(t in n.scales)oB(n,r,t)}function oB(t,e,n){const r=eB+n;if(!ut(e,r))try{e[r]=t.scaleRef(n)}catch(t){}}function aB(t,e){if(_t(t)){const n=e.scales[t];return n&&function(t){return t&&!0===t[rp]}(n.value)?n.value:void 0}}function sB(t,e,n){e.__bandwidth=t=>t&&t.bandwidth?t.bandwidth():0,n._bandwidth=iB,n._range=iB,n._scale=iB;const r=e=>"_["+(e.type===TS?Dt(eB+e.value):Dt(eB)+"+"+t(e))+"]";return{_bandwidth:t=>`this.__bandwidth(${r(t[0])})`,_range:t=>`${r(t[0])}.range()`,_scale:e=>`${r(e[0])}(${t(e[1])})`}}function uB(t,e){return function(n,r,i){if(n){const e=aB(n,(i||this).context);return e&&e.path[t](r)}return e(r)}}const lB=uB("area",(function(t){return $w=new ae,dw(t,Tw),2*$w})),cB=uB("bounds",(function(t){var e,n,r,i,o,a,s;if(ww=bw=-(_w=xw=1/0),Cw=[],dw(t,ak),n=Cw.length){for(Cw.sort(gk),e=1,o=[r=Cw[0]];e<n;++e)mk(r,(i=Cw[e])[0])||mk(r,i[1])?(pk(r[0],i[1])>pk(r[0],r[1])&&(r[1]=i[1]),pk(i[0],r[1])>pk(r[0],r[1])&&(r[0]=i[0])):o.push(r=i);for(a=-1/0,e=0,r=o[n=o.length-1];e<=n;r=i,++e)i=o[e],(s=pk(r[1],i[0]))>a&&(a=s,_w=i[0],bw=r[1])}return Cw=Fw=null,_w===1/0||xw===1/0?[[NaN,NaN],[NaN,NaN]]:[[_w,xw],[bw,ww]]})),fB=uB("centroid",(function(t){Ww=Hw=Yw=Gw=Vw=Xw=Jw=Zw=0,Qw=new ae,Kw=new ae,tk=new ae,dw(t,yk);var e=+Qw,n=+Kw,r=+tk,i=Qb(e,n,r);return i<Ub&&(e=Xw,n=Jw,r=Zw,Hw<Lb&&(e=Yw,n=Gw,r=Vw),(i=Qb(e,n,r))<Ub)?[NaN,NaN]:[Vb(n,e)*Wb,aw(r/i)*Wb]}));function hB(t,e,n){try{t[e].apply(t,["EXPRESSION"].concat([].slice.call(n)))}catch(e){t.warn(e)}return n[n.length-1]}function dB(t){const e=t/255;return e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)}function pB(t){const e=of(t);return.2126*dB(e.r)+.7152*dB(e.g)+.0722*dB(e.b)}function gB(t,e){return t===e||t!=t&&e!=e||(k(t)?!(!k(e)||t.length!==e.length)&&function(t,e){for(let n=0,r=t.length;n<r;++n)if(!gB(t[n],e[n]))return!1;return!0}(t,e):!(!A(t)||!A(e))&&mB(t,e))}function mB(t,e){for(const n in t)if(!gB(t[n],e[n]))return!1;return!0}function yB(t){return e=>mB(t,e)}const vB={};function _B(t){return k(t)||ArrayBuffer.isView(t)?t:null}function xB(t){return _B(t)||(_t(t)?t:null)}const bB=t=>t.data;function wB(t,e){const n=YT.call(e,t);return n.root&&n.root.lookup||{}}const kB=()=>"undefined"!=typeof window&&window||null;function AB(t,e,n){if(!t)return[];const[r,i]=t,o=(new Gg).set(r[0],r[1],i[0],i[1]);return T_(n||this.context.dataflow.scenegraph().root,o,function(t){let e=null;if(t){const n=V(t.marktype),r=V(t.markname);e=t=>(!n.length||n.some((e=>t.marktype===e)))&&(!r.length||r.some((e=>t.name===e)))}return e}(e))}const MB={random:()=>t.random(),cumulativeNormal:fs,cumulativeLogNormal:ys,cumulativeUniform:ks,densityNormal:cs,densityLogNormal:ms,densityUniform:ws,quantileNormal:hs,quantileLogNormal:vs,quantileUniform:As,sampleNormal:ls,sampleLogNormal:gs,sampleUniform:bs,isArray:k,isBoolean:pt,isDate:gt,isDefined:t=>void 0!==t,isNumber:yt,isObject:A,isRegExp:vt,isString:_t,isTuple:ga,isValid:t=>null!=t&&t==t,toBoolean:Ct,toDate:t=>St(t),toNumber:S,toString:$t,indexof:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return xB(t).indexOf(...n)},join:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return _B(t).join(...n)},lastindexof:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return xB(t).lastIndexOf(...n)},replace:function(t,e,n){return J(n)&&s("Function argument passed to replace."),String(t).replace(e,n)},reverse:function(t){return _B(t).slice().reverse()},sort:function(t){return _B(t).slice().sort(K)},slice:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return xB(t).slice(...n)},flush:ft,lerp:bt,merge:function(){const t=[].slice.call(arguments);return t.unshift({}),ot(...t)},pad:Mt,peek:F,pluck:function(t,e){const n=vB[e]||(vB[e]=l(e));return k(t)?t.map(n):n(t)},span:Et,inrange:dt,truncate:Bt,rgb:of,lab:Ff,hcl:Nf,hsl:pf,luminance:pB,contrast:function(t,e){const n=pB(t),r=pB(e);return(Math.max(n,r)+.05)/(Math.min(n,r)+.05)},sequence:Fe,format:VT,utcFormat:JT,utcParse:QT,utcOffset:$r,utcSequence:zr,timeFormat:XT,timeParse:ZT,timeOffset:Sr,timeSequence:Br,timeUnitSpecifier:nr,monthFormat:function(t){return tB.call(this,t,1,"%B")},monthAbbrevFormat:function(t){return tB.call(this,t,1,"%b")},dayFormat:function(t){return tB.call(this,0,2+t,"%A")},dayAbbrevFormat:function(t){return tB.call(this,0,2+t,"%a")},quarter:Y,utcquarter:G,week:ar,utcweek:hr,dayofyear:or,utcdayofyear:fr,warn:function(){return hB(this.context.dataflow,"warn",arguments)},info:function(){return hB(this.context.dataflow,"info",arguments)},debug:function(){return hB(this.context.dataflow,"debug",arguments)},extent:t=>at(t),inScope:function(t){const e=this.context.group;let n=!1;if(e)for(;t;){if(t===e){n=!0;break}t=t.mark.group}return n},intersect:AB,clampRange:X,pinchDistance:function(t){const e=t.touches,n=e[0].clientX-e[1].clientX,r=e[0].clientY-e[1].clientY;return Math.hypot(n,r)},pinchAngle:function(t){const e=t.touches;return Math.atan2(e[0].clientY-e[1].clientY,e[0].clientX-e[1].clientX)},screen:function(){const t=kB();return t?t.screen:{}},containerSize:function(){const t=this.context.dataflow,e=t.container&&t.container();return e?[e.clientWidth,e.clientHeight]:[void 0,void 0]},windowSize:function(){const t=kB();return t?[t.innerWidth,t.innerHeight]:[void 0,void 0]},bandspace:function(t,e,n){return Sd(t||0,e||0,n||0)},setdata:function(t,e){const n=this.context.dataflow,r=this.context.data[t].input;return n.pulse(r,n.changeset().remove(p).insert(e)),1},pathShape:function(t){let e=null;return function(n){return n?mg(n,e=e||og(t)):t}},panLinear:R,panLog:L,panPow:U,panSymlog:q,zoomLinear:j,zoomLog:I,zoomPow:W,zoomSymlog:H,encode:function(t,e,n){if(t){const n=this.context.dataflow,r=t.mark.source;n.pulse(r,n.changeset().encode(t,e))}return void 0!==n?n:t},modify:function(t,e,n,r,i,o){const a=this.context.dataflow,s=this.context.data[t],u=s.input,l=a.stamp();let c,f,h=s.changes;if(!1===a._trigger||!(u.value.length||e||r))return 0;if((!h||h.stamp<l)&&(s.changes=h=a.changeset(),h.stamp=l,a.runAfter((()=>{s.modified=!0,a.pulse(u,h).run()}),!0,1)),n&&(c=!0===n?p:k(n)||ga(n)?n:yB(n),h.remove(c)),e&&h.insert(e),r&&(c=yB(r),u.value.some(c)?h.remove(c):h.insert(r)),i)for(f in o)h.modify(i,f,o[f]);return 1},lassoAppend:function(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5;const i=(t=V(t))[t.length-1];return void 0===i||Math.hypot(i[0]-e,i[1]-n)>r?[...t,[e,n]]:t},lassoPath:function(t){return V(t).reduce(((e,n,r)=>{let[i,o]=n;return e+(0==r?`M ${i},${o} `:r===t.length-1?" Z":`L ${i},${o} `)}),"")},intersectLasso:function(t,e,n){const{x:r,y:i,mark:o}=n,a=(new Gg).set(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER);for(const[t,n]of e)t<a.x1&&(a.x1=t),t>a.x2&&(a.x2=t),n<a.y1&&(a.y1=n),n>a.y2&&(a.y2=n);return a.translate(r,i),AB([[a.x1,a.y1],[a.x2,a.y2]],t,o).filter((t=>function(t,e,n){let r=0;for(let i=0,o=n.length-1;i<n.length;o=i++){const[a,s]=n[o],[u,l]=n[i];l>e!=s>e&&t<(a-u)*(e-l)/(s-l)+u&&r++}return 1&r}(t.x,t.y,e)))}},EB=["view","item","group","xy","x","y"],DB="this.",CB={},FB={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:t=>`_[${Dt(nB+t)}]`,functions:function(t){const e=xT(t);EB.forEach((t=>e[t]="event.vega."+t));for(const t in MB)e[t]=DB+t;return ot(e,sB(t,MB,CB)),e},constants:_T,visitors:CB},SB=bT(FB);function $B(t,e,n){return 1===arguments.length?MB[t]:(MB[t]=e,n&&(CB[t]=n),SB.functions[t]=DB+t,this)}function TB(t,e){const n={};let r;try{r=vT(t=_t(t)?t:Dt(t)+"")}catch(e){s("Expression parse error: "+t)}r.visit((t=>{if(t.type!==OS)return;const r=t.callee.name,i=FB.visitors[r];i&&i(r,t.arguments,e,n)}));const i=SB(r);return i.globals.forEach((t=>{const r=nB+t;!ut(n,r)&&e.getSignal(t)&&(n[r]=e.signalRef(t))})),{$expr:ot({code:i.code},e.options.ast?{ast:r}:null),$fields:i.fields,$params:n}}$B("bandwidth",(function(t,e){const n=aB(t,(e||this).context);return n&&n.bandwidth?n.bandwidth():0}),iB),$B("copy",(function(t,e){const n=aB(t,(e||this).context);return n?n.copy():void 0}),iB),$B("domain",(function(t,e){const n=aB(t,(e||this).context);return n?n.domain():[]}),iB),$B("range",(function(t,e){const n=aB(t,(e||this).context);return n&&n.range?n.range():[]}),iB),$B("invert",(function(t,e,n){const r=aB(t,(n||this).context);return r?k(e)?(r.invertRange||r.invert)(e):(r.invert||r.invertExtent)(e):void 0}),iB),$B("scale",(function(t,e,n){const r=aB(t,(n||this).context);return r?r(e):void 0}),iB),$B("gradient",(function(t,e,n,r,i){let o="string"==typeof t?aB(t,(i||this).context):t;const a=Zp(e,n);let s=o.domain(),u=s[0],l=F(s),c=f;return l-u?c=vp(o,u,l):o=(o.interpolator?op("sequential")().interpolator(o.interpolator()):op("linear")().interpolate(o.interpolate()).range(o.range())).domain([u=0,l=1]),o.ticks&&(s=o.ticks(+r||15),u!==s[0]&&s.unshift(u),l!==F(s)&&s.push(l)),s.forEach((t=>a.stop(c(t),o(t)))),a}),iB),$B("geoArea",lB,iB),$B("geoBounds",cB,iB),$B("geoCentroid",fB,iB),$B("geoShape",(function(t,e,n){const r=aB(t,(n||this).context);return function(t){return r?r.path.context(t)(e):""}}),iB),$B("geoScale",(function(t,e){const n=aB(t,(e||this).context);return n&&n.scale()}),iB),$B("indata",(function(t,e,n){const r=this.context.data[t]["index:"+e],i=r?r.value.get(n):void 0;return i?i.count:i}),(function(t,e,n,r){e[0].type!==TS&&s("First argument to indata must be a string literal."),e[1].type!==TS&&s("Second argument to indata must be a string literal.");const i=e[0].value,o=e[1].value,a="@"+o;ut(a,r)||(r[a]=n.getData(i).indataRef(n,o))})),$B("data",YT,rB),$B("treePath",(function(t,e,n){const r=wB(t,this),i=r[e],o=r[n];return i&&o?i.path(o).map(bB):void 0}),rB),$B("treeAncestors",(function(t,e){const n=wB(t,this)[e];return n?n.ancestors().map(bB):void 0}),rB),$B("vlSelectionTest",(function(t,e,n){for(var r,i,o,a,s,u=this.context.data[t],l=u?u.values.value:[],c=u?u[UT]&&u[UT].value:void 0,f=n===AT,h=l.length,d=0;d<h;++d)if(r=l[d],c&&f){if(-1===(o=(i=i||{})[a=r.unit]||0))continue;if(s=qT(e,r),i[a]=s?-1:++o,s&&1===c.size)return!0;if(!s&&o===c.get(a).count)return!1}else if(f^(s=qT(e,r)))return s;return h&&f}),HT),$B("vlSelectionIdTest",(function(t,e,n){const r=this.context.data[t],i=r?r.values.value:[],o=r?r[UT]&&r[UT].value:void 0,a=n===AT,s=DT(e),u=jT(i,s);if(u===i.length)return!1;if(DT(i[u])!==s)return!1;if(o&&a){if(1===o.size)return!0;if(IT(i,s)-u<o.size)return!1}return!0}),HT),$B("vlSelectionResolve",(function(t,e,n,r){for(var i,o,a,s,u,l,c,f,h,d,p,g,m=this.context.data[t],y=m?m.values.value:[],v={},_={},x={},b=y.length,w=0;w<b;++w)if(s=(i=y[w]).unit,o=i.fields,a=i.values,o&&a){for(p=0,g=o.length;p<g;++p)u=o[p],f=(c=v[u.field]||(v[u.field]={}))[s]||(c[s]=[]),x[u.field]=h=u.type.charAt(0),d=WT[`${h}_union`],c[s]=d(f,V(a[p]));n&&(f=_[s]||(_[s]=[])).push(V(a).reduce(((t,e,n)=>(t[o[n].field]=e,t)),{}))}else u=ET,l=DT(i),(f=(c=v[u]||(v[u]={}))[s]||(c[s]=[])).push(l),n&&(f=_[s]||(_[s]=[])).push({[ET]:l});if(e=e||MT,v[ET]?v[ET]=WT[`${ET}_${e}`](...Object.values(v[ET])):Object.keys(v).forEach((t=>{v[t]=Object.keys(v[t]).map((e=>v[t][e])).reduce(((n,r)=>void 0===n?r:WT[`${x[t]}_${e}`](n,r)))})),y=Object.keys(_),n&&y.length){v[r?"vlPoint":"vlMulti"]=e===MT?{or:y.reduce(((t,e)=>(t.push(..._[e]),t)),[])}:{and:y.map((t=>({or:_[t]})))}}return v}),HT),$B("vlSelectionTuples",(function(t,e){return t.map((t=>ot(e.fields?{values:e.fields.map((e=>kT(e)(t.datum)))}:{[ET]:DT(t.datum)},e)))}));const BB=Tt(["rule"]),zB=Tt(["group","image","rect"]);function NB(t){return(t+"").toLowerCase()}function OB(t,e,n){n.endsWith(";")||(n="return("+n+");");const r=Function(...e.concat(n));return t&&t.functions?r.bind(t.functions):r}var RB={operator:(t,e)=>OB(t,["_"],e.code),parameter:(t,e)=>OB(t,["datum","_"],e.code),event:(t,e)=>OB(t,["event"],e.code),handler:(t,e)=>OB(t,["_","event"],`var datum=event.item&&event.item.datum;return ${e.code};`),encode:(t,e)=>{const{marktype:n,channels:r}=e;let i="var o=item,datum=o.datum,m=0,$;";for(const t in r){const e="o["+Dt(t)+"]";i+=`$=${r[t].code};if(${e}!==$)${e}=$,m=1;`}return i+=function(t,e){let n="";return BB[e]||(t.x2&&(t.x?(zB[e]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+="o.x=o.x2-(o.width||0);"),t.xc&&(n+="o.x=o.xc-(o.width||0)/2;"),t.y2&&(t.y?(zB[e]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+="o.y=o.y2-(o.height||0);"),t.yc&&(n+="o.y=o.yc-(o.height||0)/2;")),n}(r,n),i+="return m;",OB(t,["item","_"],i)},codegen:{get(t){const e=`[${t.map(Dt).join("][")}]`,n=Function("_",`return _${e};`);return n.path=e,n},comparator(t,e){let n;const r=Function("a","b","var u, v; return "+t.map(((t,r)=>{const i=e[r];let o,a;return t.path?(o=`a${t.path}`,a=`b${t.path}`):((n=n||{})["f"+r]=t,o=`this.f${r}(a)`,a=`this.f${r}(b)`),function(t,e,n,r){return`((u = ${t}) < (v = ${e}) || u == null) && v != null ? ${n}\n  : (u > v || v == null) && u != null ? ${r}\n  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ${n}\n  : v !== v && u === u ? ${r} : `}(o,a,-i,i)})).join("")+"0;");return n?r.bind(n):r}}};function LB(t,e,n){if(!t||!A(t))return t;for(let r,i=0,o=UB.length;i<o;++i)if(r=UB[i],ut(t,r.key))return r.parse(t,e,n);return t}var UB=[{key:"$ref",parse:function(t,e){return e.get(t.$ref)||s("Operator not defined: "+t.$ref)}},{key:"$key",parse:function(t,e){const n="k:"+t.$key+"_"+!!t.$flat;return e.fn[n]||(e.fn[n]=xt(t.$key,t.$flat,e.expr.codegen))}},{key:"$expr",parse:function(t,n,r){t.$params&&n.parseParameters(t.$params,r);const i="e:"+t.$expr.code;return n.fn[i]||(n.fn[i]=e(n.parameterExpression(t.$expr),t.$fields))}},{key:"$field",parse:function(t,e){if(!t.$field)return null;const n="f:"+t.$field+"_"+t.$name;return e.fn[n]||(e.fn[n]=l(t.$field,t.$name,e.expr.codegen))}},{key:"$encode",parse:function(t,n){const r=t.$encode,i={};for(const t in r){const o=r[t];i[t]=e(n.encodeExpression(o.$expr),o.$fields),i[t].output=o.$output}return i}},{key:"$compare",parse:function(t,e){const n="c:"+t.$compare+"_"+t.$order,r=V(t.$compare).map((t=>t&&t.$tupleid?ma:t));return e.fn[n]||(e.fn[n]=Q(r,t.$order,e.expr.codegen))}},{key:"$context",parse:function(t,e){return e}},{key:"$subflow",parse:function(t,e){const n=t.$subflow;return function(t,r,i){const o=e.fork().parse(n),a=o.get(n.operators[0].id),s=o.signals.parent;return s&&s.set(i),a.detachSubflow=()=>e.detach(o),a}}},{key:"$tupleid",parse:function(){return ma}}];const qB={skip:!0};function PB(t,e,n,r){return new jB(t,e,n,r)}function jB(t,e,n,r){this.dataflow=t,this.transforms=e,this.events=t.events.bind(t),this.expr=r||RB,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function IB(t){this.dataflow=t.dataflow,this.transforms=t.transforms,this.events=t.events,this.expr=t.expr,this.signals=Object.create(t.signals),this.scales=Object.create(t.scales),this.nodes=Object.create(t.nodes),this.data=Object.create(t.data),this.fn=Object.create(t.fn),t.functions&&(this.functions=Object.create(t.functions),this.functions.context=this)}function WB(t,e){t&&(null==e?t.removeAttribute("aria-label"):t.setAttribute("aria-label",e))}jB.prototype=IB.prototype={fork(){const t=new IB(this);return(this.subcontext||(this.subcontext=[])).push(t),t},detach(t){this.subcontext=this.subcontext.filter((e=>e!==t));const e=Object.keys(t.nodes);for(const n of e)t.nodes[n]._targets=null;for(const n of e)t.nodes[n].detach();t.nodes=null},get(t){return this.nodes[t]},set(t,e){return this.nodes[t]=e},add(t,e){const n=this,r=n.dataflow,i=t.value;if(n.set(t.id,e),function(t){return"collect"===NB(t)}(t.type)&&i&&(i.$ingest?r.ingest(e,i.$ingest,i.$format):i.$request?r.preload(e,i.$request,i.$format):r.pulse(e,r.changeset().insert(i))),t.root&&(n.root=e),t.parent){let i=n.get(t.parent.$ref);i?(r.connect(i,[e]),e.targets().add(i)):(n.unresolved=n.unresolved||[]).push((()=>{i=n.get(t.parent.$ref),r.connect(i,[e]),e.targets().add(i)}))}if(t.signal&&(n.signals[t.signal]=e),t.scale&&(n.scales[t.scale]=e),t.data)for(const r in t.data){const i=n.data[r]||(n.data[r]={});t.data[r].forEach((t=>i[t]=e))}},resolve(){return(this.unresolved||[]).forEach((t=>t())),delete this.unresolved,this},operator(t,e){this.add(t,this.dataflow.add(t.value,e))},transform(t,e){this.add(t,this.dataflow.add(this.transforms[NB(e)]))},stream(t,e){this.set(t.id,e)},update(t,e,n,r,i){this.dataflow.on(e,n,r,i,t.options)},operatorExpression(t){return this.expr.operator(this,t)},parameterExpression(t){return this.expr.parameter(this,t)},eventExpression(t){return this.expr.event(this,t)},handlerExpression(t){return this.expr.handler(this,t)},encodeExpression(t){return this.expr.encode(this,t)},parse:function(t){const e=this,n=t.operators||[];return t.background&&(e.background=t.background),t.eventConfig&&(e.eventConfig=t.eventConfig),t.locale&&(e.locale=t.locale),n.forEach((t=>e.parseOperator(t))),n.forEach((t=>e.parseOperatorParameters(t))),(t.streams||[]).forEach((t=>e.parseStream(t))),(t.updates||[]).forEach((t=>e.parseUpdate(t))),e.resolve()},parseOperator:function(t){const e=this;!function(t){return"operator"===NB(t)}(t.type)&&t.type?e.transform(t,t.type):e.operator(t,t.update?e.operatorExpression(t.update):null)},parseOperatorParameters:function(t){const e=this;if(t.params){const n=e.get(t.id);n||s("Invalid operator id: "+t.id),e.dataflow.connect(n,n.parameters(e.parseParameters(t.params),t.react,t.initonly))}},parseParameters:function(t,e){e=e||{};const n=this;for(const r in t){const i=t[r];e[r]=k(i)?i.map((t=>LB(t,n,e))):LB(i,n,e)}return e},parseStream:function(t){var e,n=this,r=null!=t.filter?n.eventExpression(t.filter):void 0,i=null!=t.stream?n.get(t.stream):void 0;t.source?i=n.events(t.source,t.type,r):t.merge&&(i=(e=t.merge.map((t=>n.get(t))))[0].merge.apply(e[0],e.slice(1))),t.between&&(e=t.between.map((t=>n.get(t))),i=i.between(e[0],e[1])),t.filter&&(i=i.filter(r)),null!=t.throttle&&(i=i.throttle(+t.throttle)),null!=t.debounce&&(i=i.debounce(+t.debounce)),null==i&&s("Invalid stream definition: "+JSON.stringify(t)),t.consume&&i.consume(!0),n.stream(t,i)},parseUpdate:function(t){var e,n=this,r=A(r=t.source)?r.$ref:r,i=n.get(r),o=t.update,a=void 0;i||s("Source not defined: "+t.source),e=t.target&&t.target.$expr?n.eventExpression(t.target.$expr):n.get(t.target),o&&o.$expr&&(o.$params&&(a=n.parseParameters(o.$params)),o=n.handlerExpression(o.$expr)),n.update(t,i,e,o,a)},getState:function(t){var e=this,n={};if(t.signals){var r=n.signals={};Object.keys(e.signals).forEach((n=>{const i=e.signals[n];t.signals(n,i)&&(r[n]=i.value)}))}if(t.data){var i=n.data={};Object.keys(e.data).forEach((n=>{const r=e.data[n];t.data(n,r)&&(i[n]=r.input.value)}))}return e.subcontext&&!1!==t.recurse&&(n.subcontext=e.subcontext.map((e=>e.getState(t)))),n},setState:function(t){var e=this,n=e.dataflow,r=t.data,i=t.signals;Object.keys(i||{}).forEach((t=>{n.update(e.signals[t],i[t],qB)})),Object.keys(r||{}).forEach((t=>{n.pulse(e.data[t].input,n.changeset().remove(p).insert(r[t]))})),(t.subcontext||[]).forEach(((t,n)=>{const r=e.subcontext[n];r&&r.setState(t)}))}};const HB="default";function YB(t,e){const n=t.globalCursor()?"undefined"!=typeof document&&document.body:t.container();if(n)return null==e?n.style.removeProperty("cursor"):n.style.cursor=e}function GB(t,e){var n=t._runtime.data;return ut(n,e)||s("Unrecognized data set: "+e),n[e]}function VB(t,e){ka(e)||s("Second argument to changes must be a changeset.");const n=GB(this,t);return n.modified=!0,this.pulse(n.input,e)}function XB(t){var e=t.padding();return Math.max(0,t._viewWidth+e.left+e.right)}function JB(t){var e=t.padding();return Math.max(0,t._viewHeight+e.top+e.bottom)}function ZB(t){var e=t.padding(),n=t._origin;return[e.left+n[0],e.top+n[1]]}function QB(t,e,n){var r,i,o=t._renderer,a=o&&o.canvas();return a&&(i=ZB(t),(r=ov(e.changedTouches?e.changedTouches[0]:e,a))[0]-=i[0],r[1]-=i[1]),e.dataflow=t,e.item=n,e.vega=function(t,e,n){const r=e?"group"===e.mark.marktype?e:e.mark.group:null;function i(t){var n,i=r;if(t)for(n=e;n;n=n.mark.group)if(n.mark.name===t){i=n;break}return i&&i.mark&&i.mark.interactive?i:{}}function o(t){if(!t)return n;_t(t)&&(t=i(t));const e=n.slice();for(;t;)e[0]-=t.x||0,e[1]-=t.y||0,t=t.mark&&t.mark.group;return e}return{view:rt(t),item:rt(e||{}),group:i,xy:o,x:t=>o(t)[0],y:t=>o(t)[1]}}(t,n,r),e}const KB="view",tz={trap:!1};function ez(t,e,n,r){t._eventListeners.push({type:n,sources:V(e),handler:r})}function nz(t,e,n){const r=t._eventConfig&&t._eventConfig[e];return!(!1===r||A(r)&&!r[n])||(t.warn(`Blocked ${e} ${n} event listener.`),!1)}function rz(t){return t.item}function iz(t){return t.item.mark.source}function oz(t){return function(e,n){return n.vega.view().changeset().encode(n.item,t)}}function az(t,e,n){const r=document.createElement(t);for(const t in e)r.setAttribute(t,e[t]);return null!=n&&(r.textContent=n),r}const sz="vega-bind",uz="vega-bind-name",lz="vega-bind-radio";function cz(t,e,n,r){const i=n.event||"input",o=()=>t.update(e.value);r.signal(n.signal,e.value),e.addEventListener(i,o),ez(r,e,i,o),t.set=t=>{e.value=t,e.dispatchEvent(function(t){return"undefined"!=typeof Event?new Event(t):{type:t}}(i))}}function fz(t,e,n,r){const i=r.signal(n.signal),o=az("div",{class:sz}),a="radio"===n.input?o:o.appendChild(az("label"));a.appendChild(az("span",{class:uz},n.name||n.signal)),e.appendChild(o);let s=hz;switch(n.input){case"checkbox":s=dz;break;case"select":s=pz;break;case"radio":s=gz;break;case"range":s=mz}s(t,a,n,i)}function hz(t,e,n,r){const i=az("input");for(const t in n)"signal"!==t&&"element"!==t&&i.setAttribute("input"===t?"type":t,n[t]);i.setAttribute("name",n.signal),i.value=r,e.appendChild(i),i.addEventListener("input",(()=>t.update(i.value))),t.elements=[i],t.set=t=>i.value=t}function dz(t,e,n,r){const i={type:"checkbox",name:n.signal};r&&(i.checked=!0);const o=az("input",i);e.appendChild(o),o.addEventListener("change",(()=>t.update(o.checked))),t.elements=[o],t.set=t=>o.checked=!!t||null}function pz(t,e,n,r){const i=az("select",{name:n.signal}),o=n.labels||[];n.options.forEach(((t,e)=>{const n={value:t};yz(t,r)&&(n.selected=!0),i.appendChild(az("option",n,(o[e]||t)+""))})),e.appendChild(i),i.addEventListener("change",(()=>{t.update(n.options[i.selectedIndex])})),t.elements=[i],t.set=t=>{for(let e=0,r=n.options.length;e<r;++e)if(yz(n.options[e],t))return void(i.selectedIndex=e)}}function gz(t,e,n,r){const i=az("span",{class:lz}),o=n.labels||[];e.appendChild(i),t.elements=n.options.map(((e,a)=>{const s={type:"radio",name:n.signal,value:e};yz(e,r)&&(s.checked=!0);const u=az("input",s);u.addEventListener("change",(()=>t.update(e)));const l=az("label",{},(o[a]||e)+"");return l.prepend(u),i.appendChild(l),u})),t.set=e=>{const n=t.elements,r=n.length;for(let t=0;t<r;++t)yz(n[t].value,e)&&(n[t].checked=!0)}}function mz(t,e,n,r){r=void 0!==r?r:(+n.max+ +n.min)/2;const i=null!=n.max?n.max:Math.max(100,+r)||100,o=n.min||Math.min(0,i,+r)||0,a=n.step||xe(o,i,100),s=az("input",{type:"range",name:n.signal,min:o,max:i,step:a});s.value=r;const u=az("span",{},+r);e.appendChild(s),e.appendChild(u);const l=()=>{u.textContent=s.value,t.update(+s.value)};s.addEventListener("input",l),s.addEventListener("change",l),t.elements=[s],t.set=t=>{s.value=t,u.textContent=t}}function yz(t,e){return t===e||t+""==e+""}function vz(t,e,n,r,i,o){return(e=e||new r(t.loader())).initialize(n,XB(t),JB(t),ZB(t),i,o).background(t.background())}function _z(t,e){return e?function(){try{e.apply(this,arguments)}catch(e){t.error(e)}}:null}function xz(t,e,n){if("string"==typeof e){if("undefined"==typeof document)return t.error("DOM document instance not found."),null;if(!(e=document.querySelector(e)))return t.error("Signal bind element not found: "+e),null}if(e&&n)try{e.textContent=""}catch(n){e=null,t.error(n)}return e}const bz=t=>+t||0;function wz(t){return A(t)?{top:bz(t.top),bottom:bz(t.bottom),left:bz(t.left),right:bz(t.right)}:(t=>({top:t,bottom:t,left:t,right:t}))(bz(t))}async function kz(t,e,n,r){const i=$_(e),o=i&&i.headless;return o||s("Unrecognized renderer type: "+e),await t.runAsync(),vz(t,null,null,o,n,r).renderAsync(t._scenegraph.root)}var Az="width",Mz="height",Ez="padding",Dz={skip:!0};function Cz(t,e){var n=t.autosize(),r=t.padding();return e-(n&&n.contains===Ez?r.left+r.right:0)}function Fz(t,e){var n=t.autosize(),r=t.padding();return e-(n&&n.contains===Ez?r.top+r.bottom:0)}function Sz(t,e){return e.modified&&k(e.input.value)&&!t.startsWith("_:vega:_")}function $z(t,e){return!("parent"===t||e instanceof Ja.proxy)}function Tz(t,e,n,r){const i=t.element();i&&i.setAttribute("title",function(t){return null==t?"":k(t)?Bz(t):A(t)&&!gt(t)?(e=t,Object.keys(e).map((t=>{const n=e[t];return t+": "+(k(n)?Bz(n):zz(n))})).join("\n")):t+"";var e}(r))}function Bz(t){return"["+t.map(zz).join(", ")+"]"}function zz(t){return k(t)?"[â€¦]":A(t)&&!gt(t)?"{â€¦}":t}function Nz(t,e){const n=this;if(e=e||{},Ga.call(n),e.loader&&n.loader(e.loader),e.logger&&n.logger(e.logger),null!=e.logLevel&&n.logLevel(e.logLevel),e.locale||t.locale){const r=ot({},t.locale,e.locale);n.locale(Oo(r.number,r.time))}n._el=null,n._elBind=null,n._renderType=e.renderer||F_.Canvas,n._scenegraph=new Qy;const r=n._scenegraph.root;n._renderer=null,n._tooltip=e.tooltip||Tz,n._redraw=!0,n._handler=(new Fv).scene(r),n._globalCursor=!1,n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=function(t){const e=ot({defaults:{}},t),n=(t,e)=>{e.forEach((e=>{k(t[e])&&(t[e]=Tt(t[e]))}))};return n(e.defaults,["prevent","allow"]),n(e,["view","window","selector"]),e}(t.eventConfig),n.globalCursor(n._eventConfig.globalCursor);const i=function(t,e,n){return PB(t,Ja,MB,n).parse(e)}(n,t,e.expr);n._runtime=i,n._signals=i.signals,n._bind=(t.bindings||[]).map((t=>({state:null,param:ot({},t)}))),i.root&&i.root.set(r),r.source=i.data.root.input,n.pulse(i.data.root.input,n.changeset().insert(r.items)),n._width=n.width(),n._height=n.height(),n._viewWidth=Cz(n,n._width),n._viewHeight=Fz(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,function(t){var e=t._signals,n=e[Az],r=e[Mz],i=e[Ez];function o(){t._autosize=t._resize=1}t._resizeWidth=t.add(null,(e=>{t._width=e.size,t._viewWidth=Cz(t,e.size),o()}),{size:n}),t._resizeHeight=t.add(null,(e=>{t._height=e.size,t._viewHeight=Fz(t,e.size),o()}),{size:r});const a=t.add(null,o,{pad:i});t._resizeWidth.rank=n.rank+1,t._resizeHeight.rank=r.rank+1,a.rank=i.rank+1}(n),function(t){t.add(null,(e=>(t._background=e.bg,t._resize=1,e.bg)),{bg:t._signals.background})}(n),function(t){const e=t._signals.cursor||(t._signals.cursor=t.add({user:HB,item:null}));t.on(t.events("view","pointermove"),e,((t,n)=>{const r=e.value,i=r?_t(r)?r:r.user:HB,o=n.item&&n.item.cursor||null;return r&&i===r.user&&o==r.item?r:{user:i,item:o}})),t.add(null,(function(e){let n=e.cursor,r=this.value;return _t(n)||(r=n.item,n=n.user),YB(t,n&&n!==HB?n:r||n),r}),{cursor:e})}(n),n.description(t.description),e.hover&&n.hover(),e.container&&n.initialize(e.container,e.bind),e.watchPixelRatio&&n._watchPixelRatio()}function Oz(t,e){return ut(t._signals,e)?t._signals[e]:s("Unrecognized signal name: "+Dt(e))}function Rz(t,e){const n=(t._targets||[]).filter((t=>t._update&&t._update.handler===e));return n.length?n[0]:null}function Lz(t,e,n,r){let i=Rz(n,r);return i||(i=_z(t,(()=>r(e,n.value))),i.handler=r,t.on(n,null,i)),t}function Uz(t,e,n){const r=Rz(e,n);return r&&e._targets.remove(r),t}ht(Nz,Ga,{async evaluate(t,e,n){if(await Ga.prototype.evaluate.call(this,t,e),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,function(t){var e=ZB(t),n=XB(t),r=JB(t);t._renderer.background(t.background()),t._renderer.resize(n,r,e),t._handler.origin(e),t._resizeListeners.forEach((e=>{try{e(n,r)}catch(e){t.error(e)}}))}(this)),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(t){this.error(t)}return n&&ha(this,n),this},dirty(t){this._redraw=!0,this._renderer&&this._renderer.dirty(t)},description(t){if(arguments.length){const e=null!=t?t+"":null;return e!==this._desc&&WB(this._el,this._desc=e),this}return this._desc},container(){return this._el},scenegraph(){return this._scenegraph},origin(){return this._origin.slice()},signal(t,e,n){const r=Oz(this,t);return 1===arguments.length?r.value:this.update(r,e,n)},width(t){return arguments.length?this.signal("width",t):this.signal("width")},height(t){return arguments.length?this.signal("height",t):this.signal("height")},padding(t){return arguments.length?this.signal("padding",wz(t)):wz(this.signal("padding"))},autosize(t){return arguments.length?this.signal("autosize",t):this.signal("autosize")},background(t){return arguments.length?this.signal("background",t):this.signal("background")},renderer(t){return arguments.length?($_(t)||s("Unrecognized renderer type: "+t),t!==this._renderType&&(this._renderType=t,this._resetRenderer()),this):this._renderType},tooltip(t){return arguments.length?(t!==this._tooltip&&(this._tooltip=t,this._resetRenderer()),this):this._tooltip},loader(t){return arguments.length?(t!==this._loader&&(Ga.prototype.loader.call(this,t),this._resetRenderer()),this):this._loader},resize(){return this._autosize=1,this.touch(Oz(this,"autosize"))},_resetRenderer(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},_resizeView:function(t,e,n,r,i,o){this.runAfter((a=>{let s=0;a._autosize=0,a.width()!==n&&(s=1,a.signal(Az,n,Dz),a._resizeWidth.skip(!0)),a.height()!==r&&(s=1,a.signal(Mz,r,Dz),a._resizeHeight.skip(!0)),a._viewWidth!==t&&(a._resize=1,a._viewWidth=t),a._viewHeight!==e&&(a._resize=1,a._viewHeight=e),a._origin[0]===i[0]&&a._origin[1]===i[1]||(a._resize=1,a._origin=i),s&&a.run("enter"),o&&a.runAfter((t=>t.resize()))}),!1,1)},addEventListener(t,e,n){let r=e;return n&&!1===n.trap||(r=_z(this,e),r.raw=e),this._handler.on(t,r),this},removeEventListener(t,e){for(var n,r,i=this._handler.handlers(t),o=i.length;--o>=0;)if(r=i[o].type,n=i[o].handler,t===r&&(e===n||e===n.raw)){this._handler.off(r,n);break}return this},addResizeListener(t){const e=this._resizeListeners;return e.includes(t)||e.push(t),this},removeResizeListener(t){var e=this._resizeListeners,n=e.indexOf(t);return n>=0&&e.splice(n,1),this},addSignalListener(t,e){return Lz(this,t,Oz(this,t),e)},removeSignalListener(t,e){return Uz(this,Oz(this,t),e)},addDataListener(t,e){return Lz(this,t,GB(this,t).values,e)},removeDataListener(t,e){return Uz(this,GB(this,t).values,e)},globalCursor(t){if(arguments.length){if(this._globalCursor!==!!t){const e=YB(this,null);this._globalCursor=!!t,e&&YB(this,e)}return this}return this._globalCursor},preventDefault(t){return arguments.length?(this._preventDefault=t,this):this._preventDefault},timer:function(t,e){this._timers.push(function(t,e,n){var r=new uD,i=e;return null==e?(r.restart(t,e,n),r):(r._restart=r.restart,r.restart=function(t,e,n){e=+e,n=null==n?aD():+n,r._restart((function o(a){a+=i,r._restart(o,i+=e,n),t(a)}),e,n)},r.restart(t,e,n),r)}((function(e){t({timestamp:Date.now(),elapsed:e})}),e))},events:function(t,e,n){var r,i=this,o=new Ta(n),a=function(n,r){i.runAsync(null,(()=>{t===KB&&function(t,e){var n=t._eventConfig.defaults,r=n.prevent,i=n.allow;return!1!==r&&!0!==i&&(!0===r||!1===i||(r?r[e]:i?!i[e]:t.preventDefault()))}(i,e)&&n.preventDefault(),o.receive(QB(i,n,r))}))};if("timer"===t)nz(i,"timer",e)&&i.timer(a,e);else if(t===KB)nz(i,"view",e)&&i.addEventListener(e,a,tz);else if("window"===t?nz(i,"window",e)&&"undefined"!=typeof window&&(r=[window]):"undefined"!=typeof document&&nz(i,"selector",e)&&(r=Array.from(document.querySelectorAll(t))),r){for(var s=0,u=r.length;s<u;++s)r[s].addEventListener(e,a);ez(i,r,e,a)}else i.warn("Can not resolve event source: "+t);return o},finalize:function(){var t,e,n,r,i,o=this._tooltip,a=this._timers,s=this._handler.handlers(),u=this._eventListeners;for(t=a.length;--t>=0;)a[t].stop();for(t=u.length;--t>=0;)for(e=(n=u[t]).sources.length;--e>=0;)n.sources[e].removeEventListener(n.type,n.handler);for(o&&o.call(this,this._handler,null,null,null),t=s.length;--t>=0;)i=s[t].type,r=s[t].handler,this._handler.off(i,r);return this},hover:function(t,e){return e=[e||"update",(t=[t||"hover"])[0]],this.on(this.events("view","pointerover",rz),iz,oz(t)),this.on(this.events("view","pointerout",rz),iz,oz(e)),this},data:function(t,e){return arguments.length<2?GB(this,t).values.value:VB.call(this,t,Aa().remove(p).insert(e))},change:VB,insert:function(t,e){return VB.call(this,t,Aa().insert(e))},remove:function(t,e){return VB.call(this,t,Aa().remove(e))},scale:function(t){var e=this._runtime.scales;return ut(e,t)||s("Unrecognized scale or projection: "+t),e[t].value},initialize:function(t,e){const n=this,r=n._renderType,i=n._eventConfig.bind,o=$_(r);t=n._el=t?xz(n,t,!0):null,function(t){const e=t.container();e&&(e.setAttribute("role","graphics-document"),e.setAttribute("aria-roleDescription","visualization"),WB(e,t.description()))}(n),o||n.error("Unrecognized renderer type: "+r);const a=o.handler||Fv,s=t?o.renderer:o.headless;return n._renderer=s?vz(n,n._renderer,t,s):null,n._handler=function(t,e,n,r){const i=new r(t.loader(),_z(t,t.tooltip())).scene(t.scenegraph().root).initialize(n,ZB(t),t);return e&&e.handlers().forEach((t=>{i.on(t.type,t.handler)})),i}(n,n._handler,t,a),n._redraw=!0,t&&"none"!==i&&(e=e?n._elBind=xz(n,e,!0):t.appendChild(az("form",{class:"vega-bindings"})),n._bind.forEach((t=>{t.param.element&&"container"!==i&&(t.element=xz(n,t.param.element,!!t.param.input))})),n._bind.forEach((t=>{!function(t,e,n){if(!e)return;const r=n.param;let i=n.state;i||(i=n.state={elements:null,active:!1,set:null,update:e=>{e!=t.signal(r.signal)&&t.runAsync(null,(()=>{i.source=!0,t.signal(r.signal,e)}))}},r.debounce&&(i.update=it(r.debounce,i.update))),(null==r.input&&r.element?cz:fz)(i,e,r,t),i.active||(t.on(t._signals[r.signal],null,(()=>{i.source?i.source=!1:i.set(t.signal(r.signal))})),i.active=!0)}(n,t.element||e,t)}))),n},toImageURL:async function(t,e){t!==F_.Canvas&&t!==F_.SVG&&t!==F_.PNG&&s("Unrecognized image type: "+t);const n=await kz(this,t,e);return t===F_.SVG?function(t,e){const n=new Blob([t],{type:e});return window.URL.createObjectURL(n)}(n.svg(),"image/svg+xml"):n.canvas().toDataURL("image/png")},toCanvas:async function(t,e){return(await kz(this,F_.Canvas,t,e)).canvas()},toSVG:async function(t){return(await kz(this,F_.SVG,t)).svg()},getState:function(t){return this._runtime.getState(t||{data:Sz,signals:$z,recurse:!0})},setState:function(t){return this.runAsync(null,(e=>{e._trigger=!1,e._runtime.setState(t)}),(t=>{t._trigger=!0})),this},_watchPixelRatio:function(){if("canvas"===this.renderer()&&this._renderer._canvas){let t=null;const e=()=>{null!=t&&t();const n=matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`);n.addEventListener("change",e),t=()=>{n.removeEventListener("change",e)},this._renderer._canvas.getContext("2d").pixelRatio=window.devicePixelRatio||1,this._redraw=!0,this._resize=1,this.resize().runAsync()};e()}}});const qz="view",Pz="[",jz="]",Iz="{",Wz="}",Hz=":",Yz=",",Gz="@",Vz=">",Xz=/[[\]{}]/,Jz={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let Zz,Qz;function Kz(t,e,n){return Zz=e||qz,Qz=n||Jz,eN(t.trim()).map(nN)}function tN(t,e,n,r,i){const o=t.length;let a,s=0;for(;e<o;++e){if(a=t[e],!s&&a===n)return e;i&&i.includes(a)?--s:r&&r.includes(a)&&++s}return e}function eN(t){const e=[],n=t.length;let r=0,i=0;for(;i<n;)i=tN(t,i,Yz,Pz+Iz,jz+Wz),e.push(t.substring(r,i).trim()),r=++i;if(0===e.length)throw"Empty event selector: "+t;return e}function nN(t){return"["===t[0]?function(t){const e=t.length;let n,r=1;if(r=tN(t,r,jz,Pz,jz),r===e)throw"Empty between selector: "+t;if(n=eN(t.substring(1,r)),2!==n.length)throw"Between selector must have two elements: "+t;if(t=t.slice(r+1).trim(),t[0]!==Vz)throw"Expected '>' after between selector: "+t;n=n.map(nN);const i=nN(t.slice(1).trim());if(i.between)return{between:n,stream:i};i.between=n;return i}(t):function(t){const e={source:Zz},n=[];let r,i,o=[0,0],a=0,s=0,u=t.length,l=0;if(t[u-1]===Wz){if(l=t.lastIndexOf(Iz),!(l>=0))throw"Unmatched right brace: "+t;try{o=function(t){const e=t.split(Yz);if(!t.length||e.length>2)throw t;return e.map((e=>{const n=+e;if(n!=n)throw t;return n}))}(t.substring(l+1,u-1))}catch(e){throw"Invalid throttle specification: "+t}u=(t=t.slice(0,l).trim()).length,l=0}if(!u)throw t;t[0]===Gz&&(a=++l);r=tN(t,l,Hz),r<u&&(n.push(t.substring(s,r).trim()),s=l=++r);if(l=tN(t,l,Pz),l===u)n.push(t.substring(s,u).trim());else if(n.push(t.substring(s,l).trim()),i=[],s=++l,s===u)throw"Unmatched left bracket: "+t;for(;l<u;){if(l=tN(t,l,jz),l===u)throw"Unmatched left bracket: "+t;if(i.push(t.substring(s,l).trim()),l<u-1&&t[++l]!==Pz)throw"Expected left bracket: "+t;s=++l}if(!(u=n.length)||Xz.test(n[u-1]))throw"Invalid event selector: "+t;u>1?(e.type=n[1],a?e.markname=n[0].slice(1):!function(t){return Qz[t]}(n[0])?e.source=n[0]:e.marktype=n[0]):e.type=n[0];"!"===e.type.slice(-1)&&(e.consume=!0,e.type=e.type.slice(0,-1));null!=i&&(e.filter=i);o[0]&&(e.throttle=o[0]);o[1]&&(e.debounce=o[1]);return e}(t)}function rN(t){return A(t)?t:{type:t||"pad"}}const iN=t=>+t||0,oN=t=>({top:t,bottom:t,left:t,right:t});function aN(t){return A(t)?t.signal?t:{top:iN(t.top),bottom:iN(t.bottom),left:iN(t.left),right:iN(t.right)}:oN(iN(t))}const sN=t=>A(t)&&!k(t)?ot({},t):{value:t};function uN(t,e,n,r){if(null!=n){return A(n)&&!k(n)||k(n)&&n.length&&A(n[0])?t.update[e]=n:t[r||"enter"][e]={value:n},1}return 0}function lN(t,e,n){for(const n in e)uN(t,n,e[n]);for(const e in n)uN(t,e,n[e],"update")}function cN(t,e,n){for(const r in e)n&&ut(n,r)||(t[r]=ot(t[r]||{},e[r]));return t}function fN(t,e){return e&&(e.enter&&e.enter[t]||e.update&&e.update[t])}const hN="mark",dN="frame",pN="scope",gN="axis",mN="axis-domain",yN="axis-grid",vN="axis-label",_N="axis-tick",xN="axis-title",bN="legend",wN="legend-band",kN="legend-entry",AN="legend-gradient",MN="legend-label",EN="legend-symbol",DN="legend-title",CN="title",FN="title-text",SN="title-subtitle";function $N(t,e,n){t[e]=n&&n.signal?{signal:n.signal}:{value:n}}const TN=t=>_t(t)?Dt(t):t.signal?`(${t.signal})`:ON(t);function BN(t){if(null!=t.gradient)return function(t){const e=[t.start,t.stop,t.count].map((t=>null==t?null:Dt(t)));for(;e.length&&null==F(e);)e.pop();return e.unshift(TN(t.gradient)),`gradient(${e.join(",")})`}(t);let e=t.signal?`(${t.signal})`:t.color?function(t){return t.c?zN("hcl",t.h,t.c,t.l):t.h||t.s?zN("hsl",t.h,t.s,t.l):t.l||t.a?zN("lab",t.l,t.a,t.b):t.r||t.g||t.b?zN("rgb",t.r,t.g,t.b):null}(t.color):null!=t.field?ON(t.field):void 0!==t.value?Dt(t.value):void 0;return null!=t.scale&&(e=function(t,e){const n=TN(t.scale);null!=t.range?e=`lerp(_range(${n}), ${+t.range})`:(void 0!==e&&(e=`_scale(${n}, ${e})`),t.band&&(e=(e?e+"+":"")+`_bandwidth(${n})`+(1==+t.band?"":"*"+NN(t.band)),t.extra&&(e=`(datum.extra ? _scale(${n}, datum.extra.value) : ${e})`)),null==e&&(e="0"));return e}(t,e)),void 0===e&&(e=null),null!=t.exponent&&(e=`pow(${e},${NN(t.exponent)})`),null!=t.mult&&(e+=`*${NN(t.mult)}`),null!=t.offset&&(e+=`+${NN(t.offset)}`),t.round&&(e=`round(${e})`),e}const zN=(t,e,n,r)=>`(${t}(${[e,n,r].map(BN).join(",")})+'')`;function NN(t){return A(t)?"("+BN(t)+")":t}function ON(t){return RN(A(t)?t:{datum:t})}function RN(t){let e,n,r;if(t.signal)e="datum",r=t.signal;else if(t.group||t.parent){for(n=Math.max(1,t.level||1),e="item";n-- >0;)e+=".mark.group";t.parent?(r=t.parent,e+=".datum"):r=t.group}else t.datum?(e="datum",r=t.datum):s("Invalid field reference: "+Dt(t));return t.signal||(r=_t(r)?u(r).map(Dt).join("]["):RN(r)),e+"["+r+"]"}function LN(t,e,n,r,i,o){const a={};(o=o||{}).encoders={$encode:a},t=function(t,e,n,r,i){const o={},a={};let s,u,l,c;for(u in u="lineBreak","text"!==e||null==i[u]||fN(u,t)||$N(o,u,i[u]),("legend"==n||String(n).startsWith("axis"))&&(n=null),c=n===dN?i.group:n===hN?ot({},i.mark,i[e]):null,c)l=fN(u,t)||("fill"===u||"stroke"===u)&&(fN("fill",t)||fN("stroke",t)),l||$N(o,u,c[u]);for(u in V(r).forEach((e=>{const n=i.style&&i.style[e];for(const e in n)fN(e,t)||$N(o,e,n[e])})),t=ot({},t),o)c=o[u],c.signal?(s=s||{})[u]=c:a[u]=c;return t.enter=ot(a,t.enter),s&&(t.update=ot(s,t.update)),t}(t,e,n,r,i.config);for(const n in t)a[n]=UN(t[n],e,o,i);return o}function UN(t,e,n,r){const i={},o={};for(const e in t)null!=t[e]&&(i[e]=qN((a=t[e],k(a)?function(t){let e="";return t.forEach((t=>{const n=BN(t);e+=t.test?`(${t.test})?${n}:`:n})),":"===F(e)&&(e+="null"),e}(a):BN(a)),r,n,o));var a;return{$expr:{marktype:e,channels:i},$fields:Object.keys(o),$output:Object.keys(t)}}function qN(t,e,n,r){const i=TB(t,e);return i.$fields.forEach((t=>r[t]=1)),ot(n,i.$params),i.$expr}const PN="outer",jN=["value","update","init","react","bind"];function IN(t,e){s(t+' for "outer" push: '+Dt(e))}function WN(t,e){const n=t.name;if(t.push===PN)e.signals[n]||IN("No prior signal definition",n),jN.forEach((e=>{void 0!==t[e]&&IN("Invalid property ",e)}));else{const r=e.addSignal(n,t.value);!1===t.react&&(r.react=!1),t.bind&&e.addBinding(n,t.bind)}}function HN(t,e,n,r){this.id=-1,this.type=t,this.value=e,this.params=n,r&&(this.parent=r)}function YN(t,e,n,r){return new HN(t,e,n,r)}function GN(t,e){return YN("operator",t,e)}function VN(t){const e={$ref:t.id};return t.id<0&&(t.refs=t.refs||[]).push(e),e}function XN(t,e){return e?{$field:t,$name:e}:{$field:t}}const JN=XN("key");function ZN(t,e){return{$compare:t,$order:e}}const QN="descending";function KN(t,e){return(t&&t.signal?"$"+t.signal:t||"")+(t&&e?"_":"")+(e&&e.signal?"$"+e.signal:e||"")}const tO="scope",eO="view";function nO(t){return t&&t.signal}function rO(t){if(nO(t))return!0;if(A(t))for(const e in t)if(rO(t[e]))return!0;return!1}function iO(t,e){return null!=t?t:e}function oO(t){return t&&t.signal||t}const aO="timer";function sO(t,e){return(t.merge?uO:t.stream?lO:t.type?cO:s("Invalid stream specification: "+Dt(t)))(t,e)}function uO(t,e){const n=fO({merge:t.merge.map((t=>sO(t,e)))},t,e);return e.addStream(n).id}function lO(t,e){const n=fO({stream:sO(t.stream,e)},t,e);return e.addStream(n).id}function cO(t,e){let n;t.type===aO?(n=e.event(aO,t.throttle),t={between:t.between,filter:t.filter}):n=e.event(function(t){return t===tO?eO:t||eO}(t.source),t.type);const r=fO({stream:n},t,e);return 1===Object.keys(r).length?n:e.addStream(r).id}function fO(t,e,n){let r=e.between;return r&&(2!==r.length&&s('Stream "between" parameter must have 2 entries: '+Dt(e)),t.between=[sO(r[0],n),sO(r[1],n)]),r=e.filter?[].concat(e.filter):[],(e.marktype||e.markname||e.markrole)&&r.push(function(t,e,n){const r="event.item";return r+(t&&"*"!==t?"&&"+r+".mark.marktype==='"+t+"'":"")+(n?"&&"+r+".mark.role==='"+n+"'":"")+(e?"&&"+r+".mark.name==='"+e+"'":"")}(e.marktype,e.markname,e.markrole)),e.source===tO&&r.push("inScope(event.item)"),r.length&&(t.filter=TB("("+r.join(")&&(")+")",n).$expr),null!=(r=e.throttle)&&(t.throttle=+r),null!=(r=e.debounce)&&(t.debounce=+r),e.consume&&(t.consume=!0),t}const hO={code:"_.$value",ast:{type:"Identifier",value:"value"}};function dO(t,e,n){const r=t.encode,i={target:n};let o=t.events,a=t.update,u=[];o||s("Signal update missing events specification."),_t(o)&&(o=Kz(o,e.isSubscope()?tO:eO)),o=V(o).filter((t=>t.signal||t.scale?(u.push(t),0):1)),u.length>1&&(u=[pO(u)]),o.length&&u.push(o.length>1?{merge:o}:o[0]),null!=r&&(a&&s("Signal encode and update are mutually exclusive."),a="encode(item(),"+Dt(r)+")"),i.update=_t(a)?TB(a,e):null!=a.expr?TB(a.expr,e):null!=a.value?a.value:null!=a.signal?{$expr:hO,$params:{$value:e.signalRef(a.signal)}}:s("Invalid signal update specification."),t.force&&(i.options={force:!0}),u.forEach((t=>e.addUpdate(ot(function(t,e){return{source:t.signal?e.signalRef(t.signal):t.scale?e.scaleRef(t.scale):sO(t,e)}}(t,e),i))))}function pO(t){return{signal:"["+t.map((t=>t.scale?'scale("'+t.scale+'")':t.signal))+"]"}}const gO=t=>(e,n,r)=>YN(t,n,e||void 0,r),mO=gO("aggregate"),yO=gO("axisticks"),vO=gO("bound"),_O=gO("collect"),xO=gO("compare"),bO=gO("datajoin"),wO=gO("encode"),kO=gO("expression"),AO=gO("facet"),MO=gO("field"),EO=gO("key"),DO=gO("legendentries"),CO=gO("load"),FO=gO("mark"),SO=gO("multiextent"),$O=gO("multivalues"),TO=gO("overlap"),BO=gO("params"),zO=gO("prefacet"),NO=gO("projection"),OO=gO("proxy"),RO=gO("relay"),LO=gO("render"),UO=gO("scale"),qO=gO("sieve"),PO=gO("sortitems"),jO=gO("viewlayout"),IO=gO("values");let WO=0;const HO={min:"min",max:"max",count:"sum"};function YO(t,e){const n=e.getScale(t.name).params;let r;for(r in n.domain=JO(t.domain,t,e),null!=t.range&&(n.range=iR(t,e,n)),null!=t.interpolate&&function(t,e){e.interpolate=GO(t.type||t),null!=t.gamma&&(e.interpolateGamma=GO(t.gamma))}(t.interpolate,n),null!=t.nice&&(n.nice=function(t,e){return t.signal?e.signalRef(t.signal):A(t)?{interval:GO(t.interval),step:GO(t.step)}:GO(t)}(t.nice,e)),null!=t.bins&&(n.bins=function(t,e){return t.signal||k(t)?VO(t,e):e.objectProperty(t)}(t.bins,e)),t)ut(n,r)||"name"===r||(n[r]=GO(t[r],e))}function GO(t,e){return A(t)?t.signal?e.signalRef(t.signal):s("Unsupported object: "+Dt(t)):t}function VO(t,e){return t.signal?e.signalRef(t.signal):t.map((t=>GO(t,e)))}function XO(t){s("Can not find data set: "+Dt(t))}function JO(t,e,n){if(t)return t.signal?n.signalRef(t.signal):(k(t)?ZO:t.fields?KO:QO)(t,e,n);null==e.domainMin&&null==e.domainMax||s("No scale domain defined for domainMin/domainMax to override.")}function ZO(t,e,n){return t.map((t=>GO(t,n)))}function QO(t,e,n){const r=n.getData(t.data);return r||XO(t.data),lp(e.type)?r.valuesRef(n,t.field,eR(t.sort,!1)):dp(e.type)?r.domainRef(n,t.field):r.extentRef(n,t.field)}function KO(t,e,n){const r=t.data,i=t.fields.reduce(((t,e)=>(e=_t(e)?{data:r,field:e}:k(e)||e.signal?function(t,e){const n="_:vega:_"+WO++,r=_O({});if(k(t))r.value={$ingest:t};else if(t.signal){const i="setdata("+Dt(n)+","+t.signal+")";r.params.input=e.signalRef(i)}return e.addDataPipeline(n,[r,qO({})]),{data:n,field:"data"}}(e,n):e,t.push(e),t)),[]);return(lp(e.type)?tR:dp(e.type)?nR:rR)(t,n,i)}function tR(t,e,n){const r=eR(t.sort,!0);let i,o;const a=n.map((t=>{const n=e.getData(t.data);return n||XO(t.data),n.countsRef(e,t.field,r)})),s={groupby:JN,pulse:a};r&&(i=r.op||"count",o=r.field?KN(i,r.field):"count",s.ops=[HO[i]],s.fields=[e.fieldRef(o)],s.as=[o]),i=e.add(mO(s));const u=e.add(_O({pulse:VN(i)}));return o=e.add(IO({field:JN,sort:e.sortRef(r),pulse:VN(u)})),VN(o)}function eR(t,e){return t&&(t.field||t.op?t.field||"count"===t.op?e&&t.field&&t.op&&!HO[t.op]&&s("Multiple domain scales can not be sorted using "+t.op):s("No field provided for sort aggregate op: "+t.op):A(t)?t.field="key":t={field:"key"}),t}function nR(t,e,n){const r=n.map((t=>{const n=e.getData(t.data);return n||XO(t.data),n.domainRef(e,t.field)}));return VN(e.add($O({values:r})))}function rR(t,e,n){const r=n.map((t=>{const n=e.getData(t.data);return n||XO(t.data),n.extentRef(e,t.field)}));return VN(e.add(SO({extents:r})))}function iR(t,e,n){const r=e.config.range;let i=t.range;if(i.signal)return e.signalRef(i.signal);if(_t(i)){if(r&&ut(r,i))return iR(t=ot({},t,{range:r[i]}),e,n);"width"===i?i=[0,{signal:"width"}]:"height"===i?i=lp(t.type)?[0,{signal:"height"}]:[{signal:"height"},0]:s("Unrecognized scale range value: "+Dt(i))}else{if(i.scheme)return n.scheme=k(i.scheme)?VO(i.scheme,e):GO(i.scheme,e),i.extent&&(n.schemeExtent=VO(i.extent,e)),void(i.count&&(n.schemeCount=GO(i.count,e)));if(i.step)return void(n.rangeStep=GO(i.step,e));if(lp(t.type)&&!k(i))return JO(i,t,e);k(i)||s("Unsupported range type: "+Dt(i))}return i.map((t=>(k(t)?VO:GO)(t,e)))}function oR(t,e,n){return k(t)?t.map((t=>oR(t,e,n))):A(t)?t.signal?n.signalRef(t.signal):"fit"===e?t:s("Unsupported parameter object: "+Dt(t)):t}const aR="top",sR="left",uR="right",lR="bottom",cR="center",fR="vertical",hR="start",dR="end",pR="index",gR="label",mR="offset",yR="perc",vR="perc2",_R="value",xR="guide-label",bR="guide-title",wR="group-title",kR="group-subtitle",AR="symbol",MR="gradient",ER="discrete",DR="size",CR=[DR,"shape","fill","stroke","strokeWidth","strokeDash","opacity"],FR={name:1,style:1,interactive:1},SR={value:0},$R={value:1},TR="group",BR="rect",zR="rule",NR="symbol",OR="text";function RR(t){return t.type=TR,t.interactive=t.interactive||!1,t}function LR(t,e){const n=(n,r)=>iO(t[n],iO(e[n],r));return n.isVertical=n=>fR===iO(t.direction,e.direction||(n?e.symbolDirection:e.gradientDirection)),n.gradientLength=()=>iO(t.gradientLength,e.gradientLength||e.gradientWidth),n.gradientThickness=()=>iO(t.gradientThickness,e.gradientThickness||e.gradientHeight),n.entryColumns=()=>iO(t.columns,iO(e.columns,+n.isVertical(!0))),n}function UR(t,e){const n=e&&(e.update&&e.update[t]||e.enter&&e.enter[t]);return n&&n.signal?n:n?n.value:null}function qR(t,e,n){return`item.anchor === '${hR}' ? ${t} : item.anchor === '${dR}' ? ${e} : ${n}`}const PR=qR(Dt(sR),Dt(uR),Dt(cR));function jR(t,e){return e?t?A(t)?Object.assign({},t,{offset:jR(t.offset,e)}):{value:t,offset:e}:e:t}function IR(t,e){return e?(t.name=e.name,t.style=e.style||t.style,t.interactive=!!e.interactive,t.encode=cN(t.encode,e,FR)):t.interactive=!1,t}function WR(t,e,n,r){const i=LR(t,n),o=i.isVertical(),a=i.gradientThickness(),s=i.gradientLength();let u,l,c,f,h;o?(l=[0,1],c=[0,0],f=a,h=s):(l=[0,0],c=[1,0],f=s,h=a);const d={enter:u={opacity:SR,x:SR,y:SR,width:sN(f),height:sN(h)},update:ot({},u,{opacity:$R,fill:{gradient:e,start:l,stop:c}}),exit:{opacity:SR}};return lN(d,{stroke:i("gradientStrokeColor"),strokeWidth:i("gradientStrokeWidth")},{opacity:i("gradientOpacity")}),IR({type:BR,role:AN,encode:d},r)}function HR(t,e,n,r,i){const o=LR(t,n),a=o.isVertical(),s=o.gradientThickness(),u=o.gradientLength();let l,c,f,h,d="";a?(l="y",f="y2",c="x",h="width",d="1-"):(l="x",f="x2",c="y",h="height");const p={opacity:SR,fill:{scale:e,field:_R}};p[l]={signal:d+"datum."+yR,mult:u},p[c]=SR,p[f]={signal:d+"datum."+vR,mult:u},p[h]=sN(s);const g={enter:p,update:ot({},p,{opacity:$R}),exit:{opacity:SR}};return lN(g,{stroke:o("gradientStrokeColor"),strokeWidth:o("gradientStrokeWidth")},{opacity:o("gradientOpacity")}),IR({type:BR,role:wN,key:_R,from:i,encode:g},r)}const YR=`datum.${yR}<=0?"${sR}":datum.${yR}>=1?"${uR}":"${cR}"`,GR=`datum.${yR}<=0?"${lR}":datum.${yR}>=1?"${aR}":"middle"`;function VR(t,e,n,r){const i=LR(t,e),o=i.isVertical(),a=sN(i.gradientThickness()),s=i.gradientLength();let u,l,c,f,h=i("labelOverlap"),d="";const p={enter:u={opacity:SR},update:l={opacity:$R,text:{field:gR}},exit:{opacity:SR}};return lN(p,{fill:i("labelColor"),fillOpacity:i("labelOpacity"),font:i("labelFont"),fontSize:i("labelFontSize"),fontStyle:i("labelFontStyle"),fontWeight:i("labelFontWeight"),limit:iO(t.labelLimit,e.gradientLabelLimit)}),o?(u.align={value:"left"},u.baseline=l.baseline={signal:GR},c="y",f="x",d="1-"):(u.align=l.align={signal:YR},u.baseline={value:"top"},c="x",f="y"),u[c]=l[c]={signal:d+"datum."+yR,mult:s},u[f]=l[f]=a,a.offset=iO(t.labelOffset,e.gradientLabelOffset)||0,h=h?{separation:i("labelSeparation"),method:h,order:"datum."+pR}:void 0,IR({type:OR,role:MN,style:xR,key:_R,from:r,encode:p,overlap:h},n)}function XR(t,e,n,r,i){const o=LR(t,e),a=n.entries,s=!(!a||!a.interactive),u=a?a.name:void 0,l=o("clipHeight"),c=o("symbolOffset"),f={data:"value"},h=`(${i}) ? datum.${mR} : datum.${DR}`,d=l?sN(l):{field:DR},p=`datum.${pR}`,g=`max(1, ${i})`;let m,y,v,_,x;d.mult=.5,m={enter:y={opacity:SR,x:{signal:h,mult:.5,offset:c},y:d},update:v={opacity:$R,x:y.x,y:y.y},exit:{opacity:SR}};let b=null,w=null;t.fill||(b=e.symbolBaseFillColor,w=e.symbolBaseStrokeColor),lN(m,{fill:o("symbolFillColor",b),shape:o("symbolType"),size:o("symbolSize"),stroke:o("symbolStrokeColor",w),strokeDash:o("symbolDash"),strokeDashOffset:o("symbolDashOffset"),strokeWidth:o("symbolStrokeWidth")},{opacity:o("symbolOpacity")}),CR.forEach((e=>{t[e]&&(v[e]=y[e]={scale:t[e],field:_R})}));const k=IR({type:NR,role:EN,key:_R,from:f,clip:!!l||void 0,encode:m},n.symbols),A=sN(c);A.offset=o("labelOffset"),m={enter:y={opacity:SR,x:{signal:h,offset:A},y:d},update:v={opacity:$R,text:{field:gR},x:y.x,y:y.y},exit:{opacity:SR}},lN(m,{align:o("labelAlign"),baseline:o("labelBaseline"),fill:o("labelColor"),fillOpacity:o("labelOpacity"),font:o("labelFont"),fontSize:o("labelFontSize"),fontStyle:o("labelFontStyle"),fontWeight:o("labelFontWeight"),limit:o("labelLimit")});const M=IR({type:OR,role:MN,style:xR,key:_R,from:f,encode:m},n.labels);return m={enter:{noBound:{value:!l},width:SR,height:l?sN(l):SR,opacity:SR},exit:{opacity:SR},update:v={opacity:$R,row:{signal:null},column:{signal:null}}},o.isVertical(!0)?(_=`ceil(item.mark.items.length / ${g})`,v.row.signal=`${p}%${_}`,v.column.signal=`floor(${p} / ${_})`,x={field:["row",p]}):(v.row.signal=`floor(${p} / ${g})`,v.column.signal=`${p} % ${g}`,x={field:p}),v.column.signal=`(${i})?${v.column.signal}:${p}`,RR({role:pN,from:r={facet:{data:r,name:"value",groupby:pR}},encode:cN(m,a,FR),marks:[k,M],name:u,interactive:s,sort:x})}const JR='item.orient === "left"',ZR='item.orient === "right"',QR=`(${JR} || ${ZR})`,KR=`datum.vgrad && ${QR}`,tL=qR('"top"','"bottom"','"middle"'),eL=`datum.vgrad && ${ZR} ? (${qR('"right"','"left"','"center"')}) : (${QR} && !(datum.vgrad && ${JR})) ? "left" : ${PR}`,nL=`item._anchor || (${QR} ? "middle" : "start")`,rL=`${KR} ? (${JR} ? -90 : 90) : 0`,iL=`${QR} ? (datum.vgrad ? (${ZR} ? "bottom" : "top") : ${tL}) : "top"`;function oL(t,e){let n;return A(t)&&(t.signal?n=t.signal:t.path?n="pathShape("+aL(t.path)+")":t.sphere&&(n="geoShape("+aL(t.sphere)+', {type: "Sphere"})')),n?e.signalRef(n):!!t}function aL(t){return A(t)&&t.signal?t.signal:Dt(t)}function sL(t){const e=t.role||"";return e.startsWith("axis")||e.startsWith("legend")||e.startsWith("title")?e:t.type===TR?pN:e||hN}function uL(t){return{marktype:t.type,name:t.name||void 0,role:t.role||sL(t),zindex:+t.zindex||void 0,aria:t.aria,description:t.description}}function lL(t,e){return t&&t.signal?e.signalRef(t.signal):!1!==t}function cL(t,e){const n=Za(t.type);n||s("Unrecognized transform type: "+Dt(t.type));const r=YN(n.type.toLowerCase(),null,fL(n,t,e));return t.signal&&e.addSignal(t.signal,e.proxy(r)),r.metadata=n.metadata||{},r}function fL(t,e,n){const r={},i=t.params.length;for(let o=0;o<i;++o){const i=t.params[o];r[i.name]=hL(i,e,n)}return r}function hL(t,e,n){const r=t.type,i=e[t.name];return"index"===r?function(t,e,n){_t(e.from)||s('Lookup "from" parameter must be a string literal.');return n.getData(e.from).lookupRef(n,e.key)}(0,e,n):void 0!==i?"param"===r?function(t,e,n){const r=e[t.name];return t.array?(k(r)||s("Expected an array of sub-parameters. Instead: "+Dt(r)),r.map((e=>pL(t,e,n)))):pL(t,r,n)}(t,e,n):"projection"===r?n.projectionRef(e[t.name]):t.array&&!nO(i)?i.map((e=>dL(t,e,n))):dL(t,i,n):void(t.required&&s("Missing required "+Dt(e.type)+" parameter: "+Dt(t.name)))}function dL(t,e,n){const r=t.type;if(nO(e))return vL(r)?s("Expression references can not be signals."):_L(r)?n.fieldRef(e):xL(r)?n.compareRef(e):n.signalRef(e.signal);{const i=t.expr||_L(r);return i&&gL(e)?n.exprRef(e.expr,e.as):i&&mL(e)?XN(e.field,e.as):vL(r)?TB(e,n):yL(r)?VN(n.getData(e).values):_L(r)?XN(e):xL(r)?n.compareRef(e):e}}function pL(t,e,n){const r=t.params.length;let i;for(let n=0;n<r;++n){i=t.params[n];for(const t in i.key)if(i.key[t]!==e[t]){i=null;break}if(i)break}i||s("Unsupported parameter: "+Dt(e));const o=ot(fL(i,e,n),i.key);return VN(n.add(BO(o)))}const gL=t=>t&&t.expr,mL=t=>t&&t.field,yL=t=>"data"===t,vL=t=>"expr"===t,_L=t=>"field"===t,xL=t=>"compare"===t;function bL(t,e){return t.$ref?t:t.data&&t.data.$ref?t.data:VN(e.getData(t.data).output)}function wL(t,e,n,r,i){this.scope=t,this.input=e,this.output=n,this.values=r,this.aggregate=i,this.index={}}function kL(t){return _t(t)?t:null}function AL(t,e,n){const r=KN(n.op,n.field);let i;if(e.ops){for(let t=0,n=e.as.length;t<n;++t)if(e.as[t]===r)return}else e.ops=["count"],e.fields=[null],e.as=["count"];n.op&&(e.ops.push((i=n.op.signal)?t.signalRef(i):n.op),e.fields.push(t.fieldRef(n.field)),e.as.push(r))}function ML(t,e,n,r,i,o,a){const s=e[n]||(e[n]={}),u=function(t){return A(t)?(t.order===QN?"-":"+")+KN(t.op,t.field):""}(o);let l,c,f=kL(i);if(null!=f&&(t=e.scope,f+=u?"|"+u:"",l=s[f]),!l){const n=o?{field:JN,pulse:e.countsRef(t,i,o)}:{field:t.fieldRef(i),pulse:VN(e.output)};u&&(n.sort=t.sortRef(o)),c=t.add(YN(r,void 0,n)),a&&(e.index[i]=c),l=VN(c),null!=f&&(s[f]=l)}return l}function EL(t,e,n){const r=t.remove,i=t.insert,o=t.toggle,a=t.modify,s=t.values,u=e.add(GN()),l=TB("if("+t.trigger+',modify("'+n+'",'+[i,r,o,a,s].map((t=>null==t?"null":t)).join(",")+"),0)",e);u.update=l.$expr,u.params=l.$params}function DL(t,e){const n=sL(t),r=t.type===TR,i=t.from&&t.from.facet,o=t.overlap;let a,u,l,c,f,h,d,p=t.layout||n===pN||n===dN;const g=n===hN||p||i,m=function(t,e,n){let r,i,o,a,u;return t?(r=t.facet)&&(e||s("Only group marks can be faceted."),null!=r.field?a=u=bL(r,n):(t.data?u=VN(n.getData(t.data).aggregate):(o=cL(ot({type:"aggregate",groupby:V(r.groupby)},r.aggregate),n),o.params.key=n.keyRef(r.groupby),o.params.pulse=bL(r,n),a=u=VN(n.add(o))),i=n.keyRef(r.groupby,!0))):a=VN(n.add(_O(null,[{}]))),a||(a=bL(t,n)),{key:i,pulse:a,parent:u}}(t.from,r,e);u=e.add(bO({key:m.key||(t.key?XN(t.key):void 0),pulse:m.pulse,clean:!r}));const y=VN(u);u=l=e.add(_O({pulse:y})),u=e.add(FO({markdef:uL(t),interactive:lL(t.interactive,e),clip:oL(t.clip,e),context:{$context:!0},groups:e.lookup(),parent:e.signals.parent?e.signalRef("parent"):null,index:e.markpath(),pulse:VN(u)}));const v=VN(u);u=c=e.add(wO(LN(t.encode,t.type,n,t.style,e,{mod:!1,pulse:v}))),u.params.parent=e.encode(),t.transform&&t.transform.forEach((t=>{const n=cL(t,e),r=n.metadata;(r.generates||r.changes)&&s("Mark transforms should not generate new data."),r.nomod||(c.params.mod=!0),n.params.pulse=VN(u),e.add(u=n)})),t.sort&&(u=e.add(PO({sort:e.compareRef(t.sort),pulse:VN(u)})));const _=VN(u);(i||p)&&(p=e.add(jO({layout:e.objectProperty(t.layout),legends:e.legends,mark:v,pulse:_})),h=VN(p));const x=e.add(vO({mark:v,pulse:h||_}));d=VN(x),r&&(g&&(a=e.operators,a.pop(),p&&a.pop()),e.pushState(_,h||d,y),i?function(t,e,n){const r=t.from.facet,i=r.name,o=bL(r,e);let a;r.name||s("Facet must have a name: "+Dt(r)),r.data||s("Facet must reference a data set: "+Dt(r)),r.field?a=e.add(zO({field:e.fieldRef(r.field),pulse:o})):r.groupby?a=e.add(AO({key:e.keyRef(r.groupby),group:VN(e.proxy(n.parent)),pulse:o})):s("Facet must specify groupby or field: "+Dt(r));const u=e.fork(),l=u.add(_O()),c=u.add(qO({pulse:VN(l)}));u.addData(i,new wL(u,l,l,c)),u.addSignal("parent",null),a.params.subflow={$subflow:u.parse(t).toRuntime()}}(t,e,m):g?function(t,e,n){const r=e.add(zO({pulse:n.pulse})),i=e.fork();i.add(qO()),i.addSignal("parent",null),r.params.subflow={$subflow:i.parse(t).toRuntime()}}(t,e,m):e.parse(t),e.popState(),g&&(p&&a.push(p),a.push(x))),o&&(d=function(t,e,n){const r=t.method,i=t.bound,o=t.separation,a={separation:nO(o)?n.signalRef(o.signal):o,method:nO(r)?n.signalRef(r.signal):r,pulse:e};t.order&&(a.sort=n.compareRef({field:t.order}));if(i){const t=i.tolerance;a.boundTolerance=nO(t)?n.signalRef(t.signal):+t,a.boundScale=n.scaleRef(i.scale),a.boundOrient=i.orient}return VN(n.add(TO(a)))}(o,d,e));const b=e.add(LO({pulse:d})),w=e.add(qO({pulse:VN(b)},void 0,e.parent()));null!=t.name&&(f=t.name,e.addData(f,new wL(e,l,b,w)),t.on&&t.on.forEach((t=>{(t.insert||t.remove||t.toggle)&&s("Marks only support modify triggers."),EL(t,e,f)})))}function CL(t,e){const n=e.config.legend,r=t.encode||{},i=LR(t,n),o=r.legend||{},a=o.name||void 0,u=o.interactive,l=o.style,c={};let f,h,d,p=0;CR.forEach((e=>t[e]?(c[e]=t[e],p=p||t[e]):0)),p||s("Missing valid scale for legend.");const g=function(t,e){let n=t.type||AR;t.type||1!==function(t){return CR.reduce(((e,n)=>e+(t[n]?1:0)),0)}(t)||!t.fill&&!t.stroke||(n=up(e)?MR:cp(e)?ER:AR);return n!==MR?n:cp(e)?ER:MR}(t,e.scaleType(p)),m={title:null!=t.title,scales:c,type:g,vgrad:"symbol"!==g&&i.isVertical()},y=VN(e.add(_O(null,[m]))),v=VN(e.add(DO(h={type:g,scale:e.scaleRef(p),count:e.objectProperty(i("tickCount")),limit:e.property(i("symbolLimit")),values:e.objectProperty(t.values),minstep:e.property(t.tickMinStep),formatType:e.property(t.formatType),formatSpecifier:e.property(t.format)})));return g===MR?(d=[WR(t,p,n,r.gradient),VR(t,n,r.labels,v)],h.count=h.count||e.signalRef(`max(2,2*floor((${oO(i.gradientLength())})/100))`)):g===ER?d=[HR(t,p,n,r.gradient,v),VR(t,n,r.labels,v)]:(f=function(t,e){const n=LR(t,e);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}(t,n),d=[XR(t,n,r,v,oO(f.columns))],h.size=function(t,e,n){const r=oO(SL("size",t,n)),i=oO(SL("strokeWidth",t,n)),o=oO(function(t,e,n){return UR("fontSize",t)||function(t,e,n){const r=e.config.style[n];return r&&r[t]}("fontSize",e,n)}(n[1].encode,e,xR));return TB(`max(ceil(sqrt(${r})+${i}),${o})`,e)}(t,e,d[0].marks)),d=[RR({role:kN,from:y,encode:{enter:{x:{value:0},y:{value:0}}},marks:d,layout:f,interactive:u})],m.title&&d.push(function(t,e,n,r){const i=LR(t,e),o={enter:{opacity:SR},update:{opacity:$R,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:SR}};return lN(o,{orient:i("titleOrient"),_anchor:i("titleAnchor"),anchor:{signal:nL},angle:{signal:rL},align:{signal:eL},baseline:{signal:iL},text:t.title,fill:i("titleColor"),fillOpacity:i("titleOpacity"),font:i("titleFont"),fontSize:i("titleFontSize"),fontStyle:i("titleFontStyle"),fontWeight:i("titleFontWeight"),limit:i("titleLimit"),lineHeight:i("titleLineHeight")},{align:i("titleAlign"),baseline:i("titleBaseline")}),IR({type:OR,role:DN,style:bR,from:r,encode:o},n)}(t,n,r.title,y)),DL(RR({role:bN,from:y,encode:cN(FL(i,t,n),o,FR),marks:d,aria:i("aria"),description:i("description"),zindex:i("zindex"),name:a,interactive:u,style:l}),e)}function FL(t,e,n){const r={enter:{},update:{}};return lN(r,{orient:t("orient"),offset:t("offset"),padding:t("padding"),titlePadding:t("titlePadding"),cornerRadius:t("cornerRadius"),fill:t("fillColor"),stroke:t("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:t("legendX"),y:t("legendY"),format:e.format,formatType:e.formatType}),r}function SL(t,e,n){return e[t]?`scale("${e[t]}",datum)`:UR(t,n[0].encode)}wL.fromEntries=function(t,e){const n=e.length,r=e[n-1],i=e[n-2];let o=e[0],a=null,s=1;for(o&&"load"===o.type&&(o=e[1]),t.add(e[0]);s<n;++s)e[s].params.pulse=VN(e[s-1]),t.add(e[s]),"aggregate"===e[s].type&&(a=e[s]);return new wL(t,o,i,r,a)},wL.prototype={countsRef(t,e,n){const r=this,i=r.counts||(r.counts={}),o=kL(e);let a,s,u;return null!=o&&(t=r.scope,a=i[o]),a?n&&n.field&&AL(t,a.agg.params,n):(u={groupby:t.fieldRef(e,"key"),pulse:VN(r.output)},n&&n.field&&AL(t,u,n),s=t.add(mO(u)),a=t.add(_O({pulse:VN(s)})),a={agg:s,ref:VN(a)},null!=o&&(i[o]=a)),a.ref},tuplesRef(){return VN(this.values)},extentRef(t,e){return ML(t,this,"extent","extent",e,!1)},domainRef(t,e){return ML(t,this,"domain","values",e,!1)},valuesRef(t,e,n){return ML(t,this,"vals","values",e,n||!0)},lookupRef(t,e){return ML(t,this,"lookup","tupleindex",e,!1)},indataRef(t,e){return ML(t,this,"indata","tupleindex",e,!0,!0)}};const $L=`item.orient==="${sR}"?-90:item.orient==="${uR}"?90:0`;function TL(t,e){const n=LR(t=_t(t)?{text:t}:t,e.config.title),r=t.encode||{},i=r.group||{},o=i.name||void 0,a=i.interactive,s=i.style,u=[],l=VN(e.add(_O(null,[{}])));return u.push(function(t,e,n,r){const i={value:0},o=t.text,a={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};return lN(a,{text:o,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:e("dx"),dy:e("dy"),fill:e("color"),font:e("font"),fontSize:e("fontSize"),fontStyle:e("fontStyle"),fontWeight:e("fontWeight"),lineHeight:e("lineHeight")},{align:e("align"),angle:e("angle"),baseline:e("baseline")}),IR({type:OR,role:FN,style:wR,from:r,encode:a},n)}(t,n,function(t){const e=t.encode;return e&&e.title||ot({name:t.name,interactive:t.interactive,style:t.style},e)}(t),l)),t.subtitle&&u.push(function(t,e,n,r){const i={value:0},o=t.subtitle,a={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};return lN(a,{text:o,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:e("dx"),dy:e("dy"),fill:e("subtitleColor"),font:e("subtitleFont"),fontSize:e("subtitleFontSize"),fontStyle:e("subtitleFontStyle"),fontWeight:e("subtitleFontWeight"),lineHeight:e("subtitleLineHeight")},{align:e("align"),angle:e("angle"),baseline:e("baseline")}),IR({type:OR,role:SN,style:kR,from:r,encode:a},n)}(t,n,r.subtitle,l)),DL(RR({role:CN,from:l,encode:BL(n,i),marks:u,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:o,interactive:a,style:s}),e)}function BL(t,e){const n={enter:{},update:{}};return lN(n,{orient:t("orient"),anchor:t("anchor"),align:{signal:PR},angle:{signal:$L},limit:t("limit"),frame:t("frame"),offset:t("offset")||0,padding:t("subtitlePadding")}),cN(n,e,FR)}function zL(t,e){const n=[];t.transform&&t.transform.forEach((t=>{n.push(cL(t,e))})),t.on&&t.on.forEach((n=>{EL(n,e,t.name)})),e.addDataPipeline(t.name,function(t,e,n){const r=[];let i,o,a,s,u,l=null,c=!1,f=!1;t.values?nO(t.values)||rO(t.format)?(r.push(OL(e,t)),r.push(l=NL())):r.push(l=NL({$ingest:t.values,$format:t.format})):t.url?rO(t.url)||rO(t.format)?(r.push(OL(e,t)),r.push(l=NL())):r.push(l=NL({$request:t.url,$format:t.format})):t.source&&(l=i=V(t.source).map((t=>VN(e.getData(t).output))),r.push(null));for(o=0,a=n.length;o<a;++o)s=n[o],u=s.metadata,l||u.source||r.push(l=NL()),r.push(s),u.generates&&(f=!0),u.modifies&&!f&&(c=!0),u.source?l=s:u.changes&&(l=null);i&&(a=i.length-1,r[0]=RO({derive:c,pulse:a?i:i[0]}),(c||a)&&r.splice(1,0,NL()));l||r.push(NL());return r.push(qO({})),r}(t,e,n))}function NL(t){const e=_O({},t);return e.metadata={source:!0},e}function OL(t,e){return CO({url:e.url?t.property(e.url):void 0,async:e.async?t.property(e.async):void 0,values:e.values?t.property(e.values):void 0,format:t.objectProperty(e.format)})}const RL=t=>t===lR||t===aR,LL=(t,e,n)=>nO(t)?HL(t.signal,e,n):t===sR||t===aR?e:n,UL=(t,e,n)=>nO(t)?IL(t.signal,e,n):RL(t)?e:n,qL=(t,e,n)=>nO(t)?WL(t.signal,e,n):RL(t)?n:e,PL=(t,e,n)=>nO(t)?YL(t.signal,e,n):t===aR?{value:e}:{value:n},jL=(t,e,n)=>nO(t)?GL(t.signal,e,n):t===uR?{value:e}:{value:n},IL=(t,e,n)=>VL(`${t} === '${aR}' || ${t} === '${lR}'`,e,n),WL=(t,e,n)=>VL(`${t} !== '${aR}' && ${t} !== '${lR}'`,e,n),HL=(t,e,n)=>JL(`${t} === '${sR}' || ${t} === '${aR}'`,e,n),YL=(t,e,n)=>JL(`${t} === '${aR}'`,e,n),GL=(t,e,n)=>JL(`${t} === '${uR}'`,e,n),VL=(t,e,n)=>(e=null!=e?sN(e):e,n=null!=n?sN(n):n,XL(e)&&XL(n)?{signal:`${t} ? (${e=e?e.signal||Dt(e.value):null}) : (${n=n?n.signal||Dt(n.value):null})`}:[ot({test:t},e)].concat(n||[])),XL=t=>null==t||1===Object.keys(t).length,JL=(t,e,n)=>({signal:`${t} ? (${QL(e)}) : (${QL(n)})`}),ZL=(t,e,n,r,i)=>({signal:(null!=r?`${t} === '${sR}' ? (${QL(r)}) : `:"")+(null!=n?`${t} === '${lR}' ? (${QL(n)}) : `:"")+(null!=i?`${t} === '${uR}' ? (${QL(i)}) : `:"")+(null!=e?`${t} === '${aR}' ? (${QL(e)}) : `:"")+"(null)"}),QL=t=>nO(t)?t.signal:null==t?null:Dt(t),KL=(t,e)=>0===e?0:nO(t)?{signal:`(${t.signal}) * ${e}`}:{value:t*e},tU=(t,e)=>{const n=t.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+e.signal}:t};function eU(t,e,n,r){let i;if(e&&ut(e,t))return e[t];if(ut(n,t))return n[t];if(t.startsWith("title")){switch(t){case"titleColor":i="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":i=t[5].toLowerCase()+t.slice(6)}return r[bR][i]}if(t.startsWith("label")){switch(t){case"labelColor":i="fill";break;case"labelFont":case"labelFontSize":i=t[5].toLowerCase()+t.slice(6)}return r[xR][i]}return null}function nU(t){const e={};for(const n of t)if(n)for(const t in n)e[t]=1;return Object.keys(e)}function rU(t,e){return{scale:t.scale,range:e}}function iU(t,e,n,r,i){const o=LR(t,e),a=t.orient,s=t.gridScale,u=LL(a,1,-1),l=function(t,e){if(1===e);else if(A(t)){let n=t=ot({},t);for(;null!=n.mult;){if(!A(n.mult))return n.mult=nO(e)?{signal:`(${n.mult}) * (${e.signal})`}:n.mult*e,t;n=n.mult=ot({},n.mult)}n.mult=e}else t=nO(e)?{signal:`(${e.signal}) * (${t||0})`}:e*(t||0);return t}(t.offset,u);let c,f,h;const d={enter:c={opacity:SR},update:h={opacity:$R},exit:f={opacity:SR}};lN(d,{stroke:o("gridColor"),strokeCap:o("gridCap"),strokeDash:o("gridDash"),strokeDashOffset:o("gridDashOffset"),strokeOpacity:o("gridOpacity"),strokeWidth:o("gridWidth")});const p={scale:t.scale,field:_R,band:i.band,extra:i.extra,offset:i.offset,round:o("tickRound")},g=UL(a,{signal:"height"},{signal:"width"}),m=s?{scale:s,range:0,mult:u,offset:l}:{value:0,offset:l},y=s?{scale:s,range:1,mult:u,offset:l}:ot(g,{mult:u,offset:l});return c.x=h.x=UL(a,p,m),c.y=h.y=qL(a,p,m),c.x2=h.x2=qL(a,y),c.y2=h.y2=UL(a,y),f.x=UL(a,p),f.y=qL(a,p),IR({type:zR,role:yN,key:_R,from:r,encode:d},n)}function oU(t,e,n,r,i){return{signal:'flush(range("'+t+'"), scale("'+t+'", datum.value), '+e+","+n+","+r+","+i+")"}}function aU(t,e,n,r){const i=LR(t,e),o=t.orient,a=LL(o,-1,1);let s,u;const l={enter:s={opacity:SR,anchor:sN(i("titleAnchor",null)),align:{signal:PR}},update:u=ot({},s,{opacity:$R,text:sN(t.title)}),exit:{opacity:SR}},c={signal:`lerp(range("${t.scale}"), ${qR(0,1,.5)})`};return u.x=UL(o,c),u.y=qL(o,c),s.angle=UL(o,SR,KL(a,90)),s.baseline=UL(o,PL(o,lR,aR),{value:lR}),u.angle=s.angle,u.baseline=s.baseline,lN(l,{fill:i("titleColor"),fillOpacity:i("titleOpacity"),font:i("titleFont"),fontSize:i("titleFontSize"),fontStyle:i("titleFontStyle"),fontWeight:i("titleFontWeight"),limit:i("titleLimit"),lineHeight:i("titleLineHeight")},{align:i("titleAlign"),angle:i("titleAngle"),baseline:i("titleBaseline")}),function(t,e,n,r){const i=(t,e)=>null!=t?(n.update[e]=tU(sN(t),n.update[e]),!1):!fN(e,r),o=i(t("titleX"),"x"),a=i(t("titleY"),"y");n.enter.auto=a===o?sN(a):UL(e,sN(a),sN(o))}(i,o,l,n),l.update.align=tU(l.update.align,s.align),l.update.angle=tU(l.update.angle,s.angle),l.update.baseline=tU(l.update.baseline,s.baseline),IR({type:OR,role:xN,style:bR,from:r,encode:l},n)}function sU(t,e){const n=function(t,e){var n,r,i,o=e.config,a=o.style,s=o.axis,u="band"===e.scaleType(t.scale)&&o.axisBand,l=t.orient;if(nO(l)){const t=nU([o.axisX,o.axisY]),e=nU([o.axisTop,o.axisBottom,o.axisLeft,o.axisRight]);for(i of(n={},t))n[i]=UL(l,eU(i,o.axisX,s,a),eU(i,o.axisY,s,a));for(i of(r={},e))r[i]=ZL(l.signal,eU(i,o.axisTop,s,a),eU(i,o.axisBottom,s,a),eU(i,o.axisLeft,s,a),eU(i,o.axisRight,s,a))}else n=l===aR||l===lR?o.axisX:o.axisY,r=o["axis"+l[0].toUpperCase()+l.slice(1)];return n||r||u?ot({},s,n,r,u):s}(t,e),r=t.encode||{},i=r.axis||{},o=i.name||void 0,a=i.interactive,s=i.style,u=LR(t,n),l=function(t){const e=t("tickBand");let n,r,i=t("tickOffset");return e?e.signal?(n={signal:`(${e.signal}) === 'extent' ? 1 : 0.5`},r={signal:`(${e.signal}) === 'extent'`},A(i)||(i={signal:`(${e.signal}) === 'extent' ? 0 : ${i}`})):"extent"===e?(n=1,r=!0,i=0):(n=.5,r=!1):(n=t("bandPosition"),r=t("tickExtra")),{extra:r,band:n,offset:i}}(u),c={scale:t.scale,ticks:!!u("ticks"),labels:!!u("labels"),grid:!!u("grid"),domain:!!u("domain"),title:null!=t.title},f=VN(e.add(_O({},[c]))),h=VN(e.add(yO({scale:e.scaleRef(t.scale),extra:e.property(l.extra),count:e.objectProperty(t.tickCount),values:e.objectProperty(t.values),minstep:e.property(t.tickMinStep),formatType:e.property(t.formatType),formatSpecifier:e.property(t.format)}))),d=[];let p;return c.grid&&d.push(iU(t,n,r.grid,h,l)),c.ticks&&(p=u("tickSize"),d.push(function(t,e,n,r,i,o){const a=LR(t,e),s=t.orient,u=LL(s,-1,1);let l,c,f;const h={enter:l={opacity:SR},update:f={opacity:$R},exit:c={opacity:SR}};lN(h,{stroke:a("tickColor"),strokeCap:a("tickCap"),strokeDash:a("tickDash"),strokeDashOffset:a("tickDashOffset"),strokeOpacity:a("tickOpacity"),strokeWidth:a("tickWidth")});const d=sN(i);d.mult=u;const p={scale:t.scale,field:_R,band:o.band,extra:o.extra,offset:o.offset,round:a("tickRound")};return f.y=l.y=UL(s,SR,p),f.y2=l.y2=UL(s,d),c.x=UL(s,p),f.x=l.x=qL(s,SR,p),f.x2=l.x2=qL(s,d),c.y=qL(s,p),IR({type:zR,role:_N,key:_R,from:r,encode:h},n)}(t,n,r.ticks,h,p,l))),c.labels&&(p=c.ticks?p:0,d.push(function(t,e,n,r,i,o){const a=LR(t,e),s=t.orient,u=t.scale,l=LL(s,-1,1),c=oO(a("labelFlush")),f=oO(a("labelFlushOffset")),h=a("labelAlign"),d=a("labelBaseline");let p,g=0===c||!!c;const m=sN(i);m.mult=l,m.offset=sN(a("labelPadding")||0),m.offset.mult=l;const y={scale:u,field:_R,band:.5,offset:jR(o.offset,a("labelOffset"))},v=UL(s,g?oU(u,c,'"left"','"right"','"center"'):{value:"center"},jL(s,"left","right")),_=UL(s,PL(s,"bottom","top"),g?oU(u,c,'"top"','"bottom"','"middle"'):{value:"middle"}),x=oU(u,c,`-(${f})`,f,0);g=g&&f;const b={opacity:SR,x:UL(s,y,m),y:qL(s,y,m)},w={enter:b,update:p={opacity:$R,text:{field:gR},x:b.x,y:b.y,align:v,baseline:_},exit:{opacity:SR,x:b.x,y:b.y}};lN(w,{dx:!h&&g?UL(s,x):null,dy:!d&&g?qL(s,x):null}),lN(w,{angle:a("labelAngle"),fill:a("labelColor"),fillOpacity:a("labelOpacity"),font:a("labelFont"),fontSize:a("labelFontSize"),fontWeight:a("labelFontWeight"),fontStyle:a("labelFontStyle"),limit:a("labelLimit"),lineHeight:a("labelLineHeight")},{align:h,baseline:d});const k=a("labelBound");let A=a("labelOverlap");return A=A||k?{separation:a("labelSeparation"),method:A,order:"datum.index",bound:k?{scale:u,orient:s,tolerance:k}:null}:void 0,p.align!==v&&(p.align=tU(p.align,v)),p.baseline!==_&&(p.baseline=tU(p.baseline,_)),IR({type:OR,role:vN,style:xR,key:_R,from:r,encode:w,overlap:A},n)}(t,n,r.labels,h,p,l))),c.domain&&d.push(function(t,e,n,r){const i=LR(t,e),o=t.orient;let a,s;const u={enter:a={opacity:SR},update:s={opacity:$R},exit:{opacity:SR}};lN(u,{stroke:i("domainColor"),strokeCap:i("domainCap"),strokeDash:i("domainDash"),strokeDashOffset:i("domainDashOffset"),strokeWidth:i("domainWidth"),strokeOpacity:i("domainOpacity")});const l=rU(t,0),c=rU(t,1);return a.x=s.x=UL(o,l,SR),a.x2=s.x2=UL(o,c),a.y=s.y=qL(o,l,SR),a.y2=s.y2=qL(o,c),IR({type:zR,role:mN,from:r,encode:u},n)}(t,n,r.domain,f)),c.title&&d.push(aU(t,n,r.title,f)),DL(RR({role:gN,from:f,encode:cN(uU(u,t),i,FR),marks:d,aria:u("aria"),description:u("description"),zindex:u("zindex"),name:o,interactive:a,style:s}),e)}function uU(t,e){const n={enter:{},update:{}};return lN(n,{orient:t("orient"),offset:t("offset")||0,position:iO(e.position,0),titlePadding:t("titlePadding"),minExtent:t("minExtent"),maxExtent:t("maxExtent"),range:{signal:`abs(span(range("${e.scale}")))`},translate:t("translate"),format:e.format,formatType:e.formatType}),n}function lU(t,e,n){const r=V(t.signals),i=V(t.scales);return n||r.forEach((t=>WN(t,e))),V(t.projections).forEach((t=>function(t,e){const n=e.config.projection||{},r={};for(const n in t)"name"!==n&&(r[n]=oR(t[n],n,e));for(const t in n)null==r[t]&&(r[t]=oR(n[t],t,e));e.addProjection(t.name,r)}(t,e))),i.forEach((t=>function(t,e){const n=t.type||"linear";ap(n)||s("Unrecognized scale type: "+Dt(n)),e.addScale(t.name,{type:n,domain:void 0})}(t,e))),V(t.data).forEach((t=>zL(t,e))),i.forEach((t=>YO(t,e))),(n||r).forEach((t=>function(t,e){const n=e.getSignal(t.name);let r=t.update;t.init&&(r?s("Signals can not include both init and update expressions."):(r=t.init,n.initonly=!0)),r&&(r=TB(r,e),n.update=r.$expr,n.params=r.$params),t.on&&t.on.forEach((t=>dO(t,e,n.id)))}(t,e))),V(t.axes).forEach((t=>sU(t,e))),V(t.marks).forEach((t=>DL(t,e))),V(t.legends).forEach((t=>CL(t,e))),t.title&&TL(t.title,e),e.parseLambdas(),e}const cU=t=>cN({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},t);function fU(t,e){const n=e.config,r=VN(e.root=e.add(GN())),i=function(t,e){const n=n=>iO(t[n],e[n]),r=[hU("background",n("background")),hU("autosize",rN(n("autosize"))),hU("padding",aN(n("padding"))),hU("width",n("width")||0),hU("height",n("height")||0)],i=r.reduce(((t,e)=>(t[e.name]=e,t)),{}),o={};return V(t.signals).forEach((t=>{ut(i,t.name)?t=ot(i[t.name],t):r.push(t),o[t.name]=t})),V(e.signals).forEach((t=>{ut(o,t.name)||ut(i,t.name)||r.push(t)})),r}(t,n);i.forEach((t=>WN(t,e))),e.description=t.description||n.description,e.eventConfig=n.events,e.legends=e.objectProperty(n.legend&&n.legend.layout),e.locale=n.locale;const o=e.add(_O()),a=e.add(wO(LN(cU(t.encode),TR,dN,t.style,e,{pulse:VN(o)}))),s=e.add(jO({layout:e.objectProperty(t.layout),legends:e.legends,autosize:e.signalRef("autosize"),mark:r,pulse:VN(a)}));e.operators.pop(),e.pushState(VN(a),VN(s),null),lU(t,e,i),e.operators.push(s);let u=e.add(vO({mark:r,pulse:VN(s)}));return u=e.add(LO({pulse:VN(u)})),u=e.add(qO({pulse:VN(u)})),e.addData("root",new wL(e,o,o,u)),e}function hU(t,e){return e&&e.signal?{name:t,update:e.signal}:{name:t,value:e}}function dU(t,e){this.config=t||{},this.options=e||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function pU(t){this.config=t.config,this.options=t.options,this.legends=t.legends,this.field=Object.create(t.field),this.signals=Object.create(t.signals),this.lambdas=Object.create(t.lambdas),this.scales=Object.create(t.scales),this.events=Object.create(t.events),this.data=Object.create(t.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++t._nextsub[0],this._nextsub=t._nextsub,this._parent=t._parent.slice(),this._encode=t._encode.slice(),this._lookup=t._lookup.slice(),this._markpath=t._markpath}function gU(t){return(k(t)?mU:yU)(t)}function mU(t){const e=t.length;let n="[";for(let r=0;r<e;++r){const e=t[r];n+=(r>0?",":"")+(A(e)?e.signal||gU(e):Dt(e))}return n+"]"}function yU(t){let e,n,r="{",i=0;for(e in t)n=t[e],r+=(++i>1?",":"")+Dt(e)+":"+(A(n)?n.signal||gU(n):Dt(n));return r+"}"}dU.prototype=pU.prototype={parse(t){return lU(t,this)},fork(){return new pU(this)},isSubscope(){return this._subid>0},toRuntime(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(t){return this.operators.push(t),t.id=this.id(),t.refs&&(t.refs.forEach((e=>{e.$ref=t.id})),t.refs=null),t},proxy(t){const e=t instanceof HN?VN(t):t;return this.add(OO({value:e}))},addStream(t){return this.streams.push(t),t.id=this.id(),t},addUpdate(t){return this.updates.push(t),t},finish(){let t,e;for(t in this.root&&(this.root.root=!0),this.signals)this.signals[t].signal=t;for(t in this.scales)this.scales[t].scale=t;function n(t,e,n){let r,i;t&&(r=t.data||(t.data={}),i=r[e]||(r[e]=[]),i.push(n))}for(t in this.data){e=this.data[t],n(e.input,t,"input"),n(e.output,t,"output"),n(e.values,t,"values");for(const r in e.index)n(e.index[r],t,"index:"+r)}return this},pushState(t,e,n){this._encode.push(VN(this.add(qO({pulse:t})))),this._parent.push(e),this._lookup.push(n?VN(this.proxy(n)):null),this._markpath.push(-1)},popState(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent(){return F(this._parent)},encode(){return F(this._encode)},lookup(){return F(this._lookup)},markpath(){const t=this._markpath;return++t[t.length-1]},fieldRef(t,e){if(_t(t))return XN(t,e);t.signal||s("Unsupported field reference: "+Dt(t));const n=t.signal;let r=this.field[n];if(!r){const t={name:this.signalRef(n)};e&&(t.as=e),this.field[n]=r=VN(this.add(MO(t)))}return r},compareRef(t){let e=!1;const n=t=>nO(t)?(e=!0,this.signalRef(t.signal)):function(t){return t&&t.expr}(t)?(e=!0,this.exprRef(t.expr)):t,r=V(t.field).map(n),i=V(t.order).map(n);return e?VN(this.add(xO({fields:r,orders:i}))):ZN(r,i)},keyRef(t,e){let n=!1;const r=this.signals;return t=V(t).map((t=>nO(t)?(n=!0,VN(r[t.signal])):t)),n?VN(this.add(EO({fields:t,flat:e}))):function(t,e){const n={$key:t};return e&&(n.$flat=!0),n}(t,e)},sortRef(t){if(!t)return t;const e=KN(t.op,t.field),n=t.order||"ascending";return n.signal?VN(this.add(xO({fields:e,orders:this.signalRef(n.signal)}))):ZN(e,n)},event(t,e){const n=t+":"+e;if(!this.events[n]){const r=this.id();this.streams.push({id:r,source:t,type:e}),this.events[n]=r}return this.events[n]},hasOwnSignal(t){return ut(this.signals,t)},addSignal(t,e){this.hasOwnSignal(t)&&s("Duplicate signal name: "+Dt(t));const n=e instanceof HN?e:this.add(GN(e));return this.signals[t]=n},getSignal(t){return this.signals[t]||s("Unrecognized signal name: "+Dt(t)),this.signals[t]},signalRef(t){return this.signals[t]?VN(this.signals[t]):(ut(this.lambdas,t)||(this.lambdas[t]=this.add(GN(null))),VN(this.lambdas[t]))},parseLambdas(){const t=Object.keys(this.lambdas);for(let e=0,n=t.length;e<n;++e){const n=t[e],r=TB(n,this),i=this.lambdas[n];i.params=r.$params,i.update=r.$expr}},property(t){return t&&t.signal?this.signalRef(t.signal):t},objectProperty(t){return t&&A(t)?this.signalRef(t.signal||gU(t)):t},exprRef(t,e){const n={expr:TB(t,this)};return e&&(n.expr.$name=e),VN(this.add(kO(n)))},addBinding(t,e){this.bindings||s("Nested signals do not support binding: "+Dt(t)),this.bindings.push(ot({signal:t},e))},addScaleProj(t,e){ut(this.scales,t)&&s("Duplicate scale or projection name: "+Dt(t)),this.scales[t]=this.add(e)},addScale(t,e){this.addScaleProj(t,UO(e))},addProjection(t,e){this.addScaleProj(t,NO(e))},getScale(t){return this.scales[t]||s("Unrecognized scale name: "+Dt(t)),this.scales[t]},scaleRef(t){return VN(this.getScale(t))},scaleType(t){return this.getScale(t).params.type},projectionRef(t){return this.scaleRef(t)},projectionType(t){return this.scaleType(t)},addData(t,e){return ut(this.data,t)&&s("Duplicate data set name: "+Dt(t)),this.data[t]=e},getData(t){return this.data[t]||s("Undefined data set name: "+Dt(t)),this.data[t]},addDataPipeline(t,e){return ut(this.data,t)&&s("Duplicate data set name: "+Dt(t)),this.addData(t,wL.fromEntries(this,e))}},ot(Ja,ml,ob,Rb,FE,$D,xF,JC,MF,sS,wS,$S),t.Bounds=Gg,t.CanvasHandler=Fv,t.CanvasRenderer=Ov,t.DATE=Hn,t.DAY=Yn,t.DAYOFYEAR=Gn,t.Dataflow=Ga,t.Debug=b,t.Error=v,t.EventStream=Ta,t.Gradient=Zp,t.GroupItem=Xg,t.HOURS=Vn,t.Handler=av,t.HybridHandler=M_,t.HybridRenderer=A_,t.Info=x,t.Item=Vg,t.MILLISECONDS=Zn,t.MINUTES=Xn,t.MONTH=In,t.Marks=Wy,t.MultiPulse=ja,t.None=y,t.Operator=Fa,t.Parameters=Ea,t.Pulse=La,t.QUARTER=jn,t.RenderType=F_,t.Renderer=uv,t.ResourceLoader=Jg,t.SECONDS=Jn,t.SVGHandler=Lv,t.SVGRenderer=l_,t.SVGStringRenderer=w_,t.Scenegraph=Qy,t.TIME_UNITS=Qn,t.Transform=Xa,t.View=Nz,t.WEEK=Wn,t.Warn=_,t.YEAR=Pn,t.accessor=e,t.accessorFields=r,t.accessorName=n,t.array=V,t.ascending=K,t.bandwidthNRD=ns,t.bin=rs,t.bootstrapCI=is,t.boundClip=R_,t.boundContext=ym,t.boundItem=Hy,t.boundMark=Gy,t.boundStroke=Kg,t.changeset=Aa,t.clampRange=X,t.codegenExpression=bT,t.compare=Q,t.constant=rt,t.cumulativeLogNormal=ys,t.cumulativeNormal=fs,t.cumulativeUniform=ks,t.dayofyear=or,t.debounce=it,t.defaultLocale=Ro,t.definition=Za,t.densityLogNormal=ms,t.densityNormal=cs,t.densityUniform=ws,t.domChild=nv,t.domClear=rv,t.domCreate=tv,t.domFind=ev,t.dotbin=os,t.error=s,t.expressionFunction=$B,t.extend=ot,t.extent=at,t.extentIndex=st,t.falsy=g,t.fastmap=ct,t.field=l,t.flush=ft,t.font=Oy,t.fontFamily=Ny,t.fontSize=Sy,t.format=aa,t.formatLocale=Fo,t.formats=sa,t.hasOwnProperty=ut,t.id=c,t.identity=f,t.inferType=Ko,t.inferTypes=ta,t.ingest=va,t.inherits=ht,t.inrange=dt,t.interpolate=_p,t.interpolateColors=mp,t.interpolateRange=gp,t.intersect=T_,t.intersectBoxLine=Cm,t.intersectPath=Am,t.intersectPoint=Mm,t.intersectRule=Dm,t.isArray=k,t.isBoolean=pt,t.isDate=gt,t.isFunction=J,t.isIterable=mt,t.isNumber=yt,t.isObject=A,t.isRegExp=vt,t.isString=_t,t.isTuple=ga,t.key=xt,t.lerp=bt,t.lineHeight=$y,t.loader=ca,t.locale=Oo,t.logger=w,t.lruCache=wt,t.markup=e_,t.merge=kt,t.mergeConfig=E,t.multiLineOffset=By,t.one=d,t.pad=Mt,t.panLinear=R,t.panLog=L,t.panPow=U,t.panSymlog=q,t.parse=function(t,e,n){return A(t)||s("Input Vega specification must be an object."),fU(t,new dU(e=E(function(){const t="sans-serif",e="#4c78a8",n="#000",r="#888",i="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:e},area:{fill:e},image:null,line:{stroke:e,strokeWidth:2},path:{stroke:e},rect:{fill:e},rule:{stroke:n},shape:{stroke:e},symbol:{fill:e,size:64},text:{fill:n,font:t,fontSize:11},trail:{fill:e,size:2},style:{"guide-label":{fill:n,font:t,fontSize:10},"guide-title":{fill:n,font:t,fontSize:11,fontWeight:"bold"},"group-title":{fill:n,font:t,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:n,font:t,fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:i},view:{fill:"transparent"}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:r,grid:!1,gridWidth:1,gridColor:i,labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:r,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:i,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:r,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}(),e,t.config),n)).toRuntime()},t.parseExpression=vT,t.parseSelector=Kz,t.path=Ol,t.pathCurves=Kp,t.pathEqual=q_,t.pathParse=og,t.pathRectangle=Fg,t.pathRender=mg,t.pathSymbols=xg,t.pathTrail=Sg,t.peek=F,t.point=ov,t.projection=ZM,t.quantileLogNormal=vs,t.quantileNormal=hs,t.quantileUniform=As,t.quantiles=ts,t.quantizeInterpolator=yp,t.quarter=Y,t.quartiles=es,t.randomInteger=function(e,n){let r,i,o;null==n&&(n=e,e=0);const a={min(t){return arguments.length?(r=t||0,o=i-r,a):r},max(t){return arguments.length?(i=t||0,o=i-r,a):i},sample:()=>r+Math.floor(o*t.random()),pdf:t=>t===Math.floor(t)&&t>=r&&t<i?1/o:0,cdf(t){const e=Math.floor(t);return e<r?0:e>=i?1:(e-r+1)/o},icdf:t=>t>=0&&t<=1?r-1+Math.floor(t*o):NaN};return a.min(e).max(n)},t.randomKDE=ps,t.randomLCG=function(t){return function(){return(t=(1103515245*t+12345)%2147483647)/2147483647}},t.randomLogNormal=_s,t.randomMixture=xs,t.randomNormal=ds,t.randomUniform=Ms,t.read=la,t.regressionConstant=Es,t.regressionExp=Bs,t.regressionLinear=$s,t.regressionLoess=Ls,t.regressionLog=Ts,t.regressionPoly=Os,t.regressionPow=zs,t.regressionQuad=Ns,t.renderModule=$_,t.repeat=At,t.resetDefaultLocale=function(){return Do(),To(),Ro()},t.resetSVGClipId=Hg,t.resetSVGDefIds=function(){Hg(),Yp=0},t.responseType=ua,t.runtimeContext=PB,t.sampleCurve=js,t.sampleLogNormal=gs,t.sampleNormal=ls,t.sampleUniform=bs,t.scale=op,t.sceneEqual=U_,t.sceneFromJSON=Jy,t.scenePickVisit=Um,t.sceneToJSON=Xy,t.sceneVisit=Lm,t.sceneZOrder=Rm,t.scheme=kp,t.serializeXML=n_,t.setHybridRendererOptions=function(t){k_.svgMarkTypes=t.svgMarkTypes??["text"],k_.svgOnTop=t.svgOnTop??!0,k_.debug=t.debug??!1},t.setRandom=function(e){t.random=e},t.span=Et,t.splitAccessPath=u,t.stringValue=Dt,t.textMetrics=Ay,t.timeBin=Xr,t.timeFloor=br,t.timeFormatLocale=zo,t.timeInterval=Dr,t.timeOffset=Sr,t.timeSequence=Br,t.timeUnitSpecifier=nr,t.timeUnits=tr,t.toBoolean=Ct,t.toDate=St,t.toNumber=S,t.toSet=Tt,t.toString=$t,t.transform=Qa,t.transforms=Ja,t.truncate=Bt,t.truthy=p,t.tupleid=ma,t.typeParsers=Jo,t.utcFloor=Ar,t.utcInterval=Cr,t.utcOffset=$r,t.utcSequence=zr,t.utcdayofyear=fr,t.utcquarter=G,t.utcweek=hr,t.version="5.31.0",t.visitArray=zt,t.week=ar,t.writeConfig=D,t.zero=h,t.zoomLinear=j,t.zoomLog=I,t.zoomPow=W,t.zoomSymlog=H}));
//# sourceMappingURL=vega.min.js.map</script>
<script>!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vega")):"function"==typeof define&&define.amd?define(["exports","vega"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).vegaLite={},e.vega)}(this,(function(e,t){"use strict";var n="5.2.0";Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,(function(n,i){return Array.isArray(i)?n.push.apply(n,e.call(i,t-1)):n.push(i),n}),[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var i={exports:{}};!function(e){var t=function(){function e(e,t){return null!=t&&e instanceof t}var t,n,i;try{t=Map}catch(e){t=function(){}}try{n=Set}catch(e){n=function(){}}try{i=Promise}catch(e){i=function(){}}function o(r,s,c,l,u){"object"==typeof s&&(c=s.depth,l=s.prototype,u=s.includeNonEnumerable,s=s.circular);var d=[],f=[],p="undefined"!=typeof Buffer;return void 0===s&&(s=!0),void 0===c&&(c=1/0),function r(c,m){if(null===c)return null;if(0===m)return c;var g,h;if("object"!=typeof c)return c;if(e(c,t))g=new t;else if(e(c,n))g=new n;else if(e(c,i))g=new i((function(e,t){c.then((function(t){e(r(t,m-1))}),(function(e){t(r(e,m-1))}))}));else if(o.__isArray(c))g=[];else if(o.__isRegExp(c))g=new RegExp(c.source,a(c)),c.lastIndex&&(g.lastIndex=c.lastIndex);else if(o.__isDate(c))g=new Date(c.getTime());else{if(p&&Buffer.isBuffer(c))return g=Buffer.allocUnsafe?Buffer.allocUnsafe(c.length):new Buffer(c.length),c.copy(g),g;e(c,Error)?g=Object.create(c):void 0===l?(h=Object.getPrototypeOf(c),g=Object.create(h)):(g=Object.create(l),h=l)}if(s){var v=d.indexOf(c);if(-1!=v)return f[v];d.push(c),f.push(g)}for(var y in e(c,t)&&c.forEach((function(e,t){var n=r(t,m-1),i=r(e,m-1);g.set(n,i)})),e(c,n)&&c.forEach((function(e){var t=r(e,m-1);g.add(t)})),c){var b;h&&(b=Object.getOwnPropertyDescriptor(h,y)),b&&null==b.set||(g[y]=r(c[y],m-1))}if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(c);for(y=0;y<x.length;y++){var w=x[y];(!(S=Object.getOwnPropertyDescriptor(c,w))||S.enumerable||u)&&(g[w]=r(c[w],m-1),S.enumerable||Object.defineProperty(g,w,{enumerable:!1}))}}if(u){var k=Object.getOwnPropertyNames(c);for(y=0;y<k.length;y++){var S,D=k[y];(S=Object.getOwnPropertyDescriptor(c,D))&&S.enumerable||(g[D]=r(c[D],m-1),Object.defineProperty(g,D,{enumerable:!1}))}}return g}(r,c)}function r(e){return Object.prototype.toString.call(e)}function a(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t}return o.clonePrototype=function(e){if(null===e)return null;var t=function(){};return t.prototype=e,new t},o.__objToStr=r,o.__isDate=function(e){return"object"==typeof e&&"[object Date]"===r(e)},o.__isArray=function(e){return"object"==typeof e&&"[object Array]"===r(e)},o.__isRegExp=function(e){return"object"==typeof e&&"[object RegExp]"===r(e)},o.__getRegExpFlags=a,o}();e.exports&&(e.exports=t)}(i);var o=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var n,i="boolean"==typeof t.cycles&&t.cycles,o=t.cmp&&(n=t.cmp,function(e){return function(t,i){var o={key:t,value:e[t]},r={key:i,value:e[i]};return n(o,r)}}),r=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);var n,a;if(Array.isArray(t)){for(a="[",n=0;n<t.length;n++)n&&(a+=","),a+=e(t[n])||"null";return a+"]"}if(null===t)return"null";if(-1!==r.indexOf(t)){if(i)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var s=r.push(t)-1,c=Object.keys(t).sort(o&&o(t));for(a="",n=0;n<c.length;n++){var l=c[n],u=e(t[l]);u&&(a&&(a+=","),a+=JSON.stringify(l)+":"+u)}return r.splice(s,1),"{"+a+"}"}}(e)};function r(e){return!!e.or}function a(e){return!!e.and}function s(e){return!!e.not}function c(e,t){if(s(e))c(e.not,t);else if(a(e))for(const n of e.and)c(n,t);else if(r(e))for(const n of e.or)c(n,t);else t(e)}function l(e,t){return s(e)?{not:l(e.not,t)}:a(e)?{and:e.and.map((e=>l(e,t)))}:r(e)?{or:e.or.map((e=>l(e,t)))}:t(e)}const u=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var i,o,r;if(Array.isArray(t)){if((i=t.length)!=n.length)return!1;for(o=i;0!=o--;)if(!e(t[o],n[o]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((i=(r=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(o=i;0!=o--;)if(!Object.prototype.hasOwnProperty.call(n,r[o]))return!1;for(o=i;0!=o--;){var a=r[o];if(!e(t[a],n[a]))return!1}return!0}return t!=t&&n!=n},d=i.exports;function f(e){throw new Error(e)}function p(e,n){const i={};for(const o of n)t.hasOwnProperty(e,o)&&(i[o]=e[o]);return i}function m(e,t){const n={...e};for(const e of t)delete n[e];return n}Set.prototype.toJSON=function(){return"Set(".concat([...this].map((e=>o(e))).join(","),")")};const g=o;function h(e){if(t.isNumber(e))return e;const n=t.isString(e)?e:o(e);if(n.length<250)return n;let i=0;for(let e=0;e<n.length;e++){i=(i<<5)-i+n.charCodeAt(e),i&=i}return i}function v(e){return!1===e||null===e}function y(e,t){return e.includes(t)}function b(e,t){let n=0;for(const[i,o]of e.entries())if(t(o,i,n++))return!0;return!1}function x(e,t){let n=0;for(const[i,o]of e.entries())if(!t(o,i,n++))return!1;return!0}function w(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(const t of n)k(e,null!=t?t:{});return e}function k(e,n){for(const i of C(n))t.writeConfig(e,i,n[i],!0)}function S(e,t){const n=[],i={};let o;for(const r of e)o=t(r),o in i||(i[o]=1,n.push(r));return n}function D(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function F(e,t){for(const n of e)if(t.has(n))return!0;return!1}function O(e){const n=new Set;for(const i of e){const e=t.splitAccessPath(i).map(((e,t)=>0===t?e:"[".concat(e,"]"))),o=e.map(((t,n)=>e.slice(0,n+1).join("")));for(const e of o)n.add(e)}return n}function _(e,t){return void 0===e||void 0===t||F(O(e),O(t))}function z(e){return 0===C(e).length}const C=Object.keys,P=Object.values,A=Object.entries;function N(e){return!0===e||!1===e}function j(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function E(e,t){return s(e)?"!(".concat(E(e.not,t),")"):a(e)?"(".concat(e.and.map((e=>E(e,t))).join(") && ("),")"):r(e)?"(".concat(e.or.map((e=>E(e,t))).join(") || ("),")"):t(e)}function M(e,t){if(0===t.length)return!0;const n=t.shift();return n in e&&M(e[n],t)&&delete e[n],z(e)}function T(e){return e.charAt(0).toUpperCase()+e.substr(1)}function L(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"datum";const i=t.splitAccessPath(e),o=[];for(let e=1;e<=i.length;e++){const r="[".concat(i.slice(0,e).map(t.stringValue).join("]["),"]");o.push("".concat(n).concat(r))}return o.join(" && ")}function q(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"datum";return"".concat(n,"[").concat(t.stringValue(t.splitAccessPath(e).join(".")),"]")}function W(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function R(e){return"".concat(t.splitAccessPath(e).map(W).join("\\."))}function U(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function B(e){return"".concat(t.splitAccessPath(e).join("."))}function H(e){return e?t.splitAccessPath(e).length:0}function V(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const e of t)if(void 0!==e)return e}let I=42;function G(e){const t=++I;return e?String(e)+t:t}function Y(e){return X(e)?e:"__".concat(e)}function X(e){return e.startsWith("__")}function J(e){if(void 0!==e)return(e%360+360)%360}function Q(e){return!!t.isNumber(e)||!isNaN(e)&&!isNaN(parseFloat(e))}const $="row",K="column",Z="facet",ee="x",te="y",ne="x2",ie="y2",oe="xOffset",re="yOffset",ae="radius",se="radius2",ce="theta",le="theta2",ue="latitude",de="longitude",fe="latitude2",pe="longitude2",me="color",ge="fill",he="stroke",ve="shape",ye="size",be="angle",xe="opacity",we="fillOpacity",ke="strokeOpacity",Se="strokeWidth",De="strokeDash",Fe="text",Oe="order",_e="detail",ze="key",Ce="tooltip",Pe="href",Ae="url",Ne="description",je={theta:1,theta2:1,radius:1,radius2:1};function Ee(e){return e in je}const Me={longitude:1,longitude2:1,latitude:1,latitude2:1};const Te=C(Me),Le={x:1,y:1,x2:1,y2:1,...je,...Me,xOffset:1,yOffset:1,color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1};function qe(e){return e===me||e===ge||e===he}const We={row:1,column:1,facet:1},Re=C(We),Ue={...Le,...We},Be=C(Ue),{order:He,detail:Ve,tooltip:Ie,...Ge}=Ue,{row:Ye,column:Xe,facet:Je,...Qe}=Ge;function $e(e){return!!Ue[e]}const Ke=[ne,ie,fe,pe,le,se];function Ze(e){return et(e)!==e}function et(e){switch(e){case ne:return ee;case ie:return te;case fe:return ue;case pe:return de;case le:return ce;case se:return ae}return e}function tt(e){if(Ee(e))switch(e){case ce:return"startAngle";case le:return"endAngle";case ae:return"outerRadius";case se:return"innerRadius"}return e}function nt(e){switch(e){case ee:return ne;case te:return ie;case ue:return fe;case de:return pe;case ce:return le;case ae:return se}}function it(e){switch(e){case ee:case ne:return"width";case te:case ie:return"height"}}function ot(e){switch(e){case ee:return"xOffset";case te:return"yOffset"}}function rt(e){switch(e){case"xOffset":return"x";case"yOffset":return"y"}}const at=C(Le),{x:st,y:ct,x2:lt,y2:ut,xOffset:dt,yOffset:ft,latitude:pt,longitude:mt,latitude2:gt,longitude2:ht,theta:vt,theta2:yt,radius:bt,radius2:xt,...wt}=Le,kt=C(wt),St={x:1,y:1},Dt=C(St);function Ft(e){return e in St}const Ot={theta:1,radius:1},_t=C(Ot);function zt(e){return"width"===e?ee:te}const Ct={xOffset:1,yOffset:1};function Pt(e){return e in Ct}const{text:At,tooltip:Nt,href:jt,url:Et,description:Mt,detail:Tt,key:Lt,order:qt,...Wt}=wt,Rt=C(Wt);const Ut={...St,...Ot,...Ct,...Wt},Bt=C(Ut);function Ht(e){return!!Ut[e]}function Vt(e,t){return function(e){switch(e){case me:case ge:case he:case Ne:case _e:case ze:case Ce:case Pe:case Oe:case xe:case we:case ke:case Se:case Z:case $:case K:return It;case ee:case te:case oe:case re:case ue:case de:return Yt;case ne:case ie:case fe:case pe:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case ye:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case De:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case ve:return{point:"always",geoshape:"always"};case Fe:return{text:"always"};case be:return{point:"always",square:"always",text:"always"};case Ae:return{image:"always"};case ce:case ae:return{text:"always",arc:"always"};case le:case se:return{arc:"always"}}}(e)[t]}const It={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},{geoshape:Gt,...Yt}=It;function Xt(e){switch(e){case ee:case te:case ce:case ae:case oe:case re:case ye:case be:case Se:case xe:case we:case ke:case ne:case ie:case le:case se:return;case Z:case $:case K:case ve:case De:case Fe:case Ce:case Pe:case Ae:case Ne:return"discrete";case me:case ge:case he:return"flexible";case ue:case de:case fe:case pe:case _e:case ze:case Oe:return}}const Jt={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},Qt={count:1,min:1,max:1};function $t(e){return!!e&&!!e.argmin}function Kt(e){return!!e&&!!e.argmax}function Zt(e){return t.isString(e)&&!!Jt[e]}const en=new Set(["count","valid","missing","distinct"]);function tn(e){return t.isString(e)&&en.has(e)}const nn=new Set(["count","sum","distinct","valid","missing"]),on=new Set(["mean","average","median","q1","q3","min","max"]);function rn(e){return t.isBoolean(e)&&(e=Wa(e,void 0)),"bin"+C(e).map((t=>ln(e[t])?j("_".concat(t,"_").concat(A(e[t]))):j("_".concat(t,"_").concat(e[t])))).join("")}function an(e){return!0===e||cn(e)&&!e.binned}function sn(e){return"binned"===e||cn(e)&&!0===e.binned}function cn(e){return t.isObject(e)}function ln(e){return null==e?void 0:e.param}function un(e){switch(e){case $:case K:case ye:case me:case ge:case he:case Se:case xe:case we:case ke:case ve:return 6;case De:return 4;default:return 10}}function dn(e){return e&&!!e.expr}function fn(e){const t=C(e||{}),n={};for(const i of t)n[i]=kn(e[i]);return n}function pn(e){const{anchor:t,frame:n,offset:i,orient:o,angle:r,limit:a,color:s,subtitleColor:c,subtitleFont:l,subtitleFontSize:u,subtitleFontStyle:d,subtitleFontWeight:f,subtitleLineHeight:m,subtitlePadding:g,...h}=e,v={...t?{anchor:t}:{},...n?{frame:n}:{},...i?{offset:i}:{},...o?{orient:o}:{},...void 0!==r?{angle:r}:{},...void 0!==a?{limit:a}:{}},y={...c?{subtitleColor:c}:{},...l?{subtitleFont:l}:{},...u?{subtitleFontSize:u}:{},...d?{subtitleFontStyle:d}:{},...f?{subtitleFontWeight:f}:{},...m?{subtitleLineHeight:m}:{},...g?{subtitlePadding:g}:{}};return{titleMarkConfig:{...h,...s?{fill:s}:{}},subtitleMarkConfig:p(e,["align","baseline","dx","dy","limit"]),nonMarkTitleProperties:v,subtitle:y}}function mn(e){return t.isString(e)||t.isArray(e)&&t.isString(e[0])}function gn(e){return e&&!!e.signal}function hn(e){return!!e.step}function vn(e){return!t.isArray(e)&&("field"in e&&"data"in e)}const yn=C({aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1,url:1,smooth:1}),bn={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},xn=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function wn(e){const n=t.isArray(e.condition)?e.condition.map(Sn):Sn(e.condition);return{...kn(e),condition:n}}function kn(e){if(dn(e)){const{expr:t,...n}=e;return{signal:t,...n}}return e}function Sn(e){if(dn(e)){const{expr:t,...n}=e;return{signal:t,...n}}return e}function Dn(e){if(dn(e)){const{expr:t,...n}=e;return{signal:t,...n}}return gn(e)?e:void 0!==e?{value:e}:void 0}function Fn(e){return gn(e)?e.signal:t.stringValue(e.value)}function On(e){return gn(e)?e.signal:null==e?null:t.stringValue(e)}function _n(e,t,n){for(const i of n){const n=Pn(i,t.markDef,t.config);void 0!==n&&(e[i]=Dn(n))}return e}function zn(e){var t;return[].concat(e.type,null!==(t=e.style)&&void 0!==t?t:[])}function Cn(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const{vgChannel:o,ignoreVgConfig:r}=i;return o&&void 0!==t[o]?t[o]:void 0!==t[e]?t[e]:!r||o&&o!==e?Pn(e,t,n,i):void 0}function Pn(e,t,n){let{vgChannel:i}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return V(i?An(e,t,n.style):void 0,An(e,t,n.style),i?n[t.type][i]:void 0,n[t.type][e],i?n.mark[i]:n.mark[e])}function An(e,t,n){return Nn(e,zn(t),n)}function Nn(e,n,i){let o;n=t.array(n);for(const t of n){const n=i[t];n&&void 0!==n[e]&&(o=n[e])}return o}function jn(e,n){return t.array(e).reduce(((e,t)=>{var i;return e.field.push(ka(t,n)),e.order.push(null!==(i=t.sort)&&void 0!==i?i:"ascending"),e}),{field:[],order:[]})}function En(e,t){const n=[...e];return t.forEach((e=>{for(const t of n)if(u(t,e))return;n.push(e)})),n}function Mn(e,n){return u(e,n)||!n?e:e?[...t.array(e),...t.array(n)].join(", "):n}function Tn(e,t){const n=e.value,i=t.value;if(null==n||null===i)return{explicit:e.explicit,value:null};if((mn(n)||gn(n))&&(mn(i)||gn(i)))return{explicit:e.explicit,value:Mn(n,i)};if(mn(n)||gn(n))return{explicit:e.explicit,value:n};if(mn(i)||gn(i))return{explicit:e.explicit,value:i};if(!(mn(n)||gn(n)||mn(i)||gn(i)))return{explicit:e.explicit,value:En(n,i)};throw new Error("It should never reach here")}function Ln(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function qn(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,Wn(e,t,"set"),n),n}function Wn(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function Rn(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}function Un(e){return"Invalid specification ".concat(g(e),'. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".')}const Bn='Autosize "fit" only works for single views and layered views.';function Hn(e){return"".concat("width"==e?"Width":"Height",' "container" only works for single views and layered views.')}function Vn(e){const t="width"==e?"x":"y";return"".concat("width"==e?"Width":"Height",' "container" only works well with autosize "fit" or "fit-').concat(t,'".')}function In(e){return e?'Dropping "fit-'.concat(e,'" because spec has discrete ').concat(it(e),"."):'Dropping "fit" because spec has discrete size.'}function Gn(e){return"Unknown field for ".concat(e,". Cannot calculate view size.")}function Yn(e){return'Cannot project a selection on encoding channel "'.concat(e,'", which has no field.')}function Xn(e,t){return'Cannot project a selection on encoding channel "'.concat(e,'" as it uses an aggregate function ("').concat(t,'").')}function Jn(e){return"Selection not supported for ".concat(e," yet.")}const Qn="The same selection must be used to override scale domains in a layered view.";function $n(e){return'The "columns" property cannot be used when "'.concat(e,'" has nested row/column.')}function Kn(e,t,n){return'An ancestor parsed field "'.concat(e,'" as ').concat(n," but a child wants to parse the field as ").concat(t,".")}function Zn(e){return"Config.customFormatTypes is not true, thus custom format type and format for channel ".concat(e," are dropped.")}function ei(e){return"".concat(e,"Offset dropped because ").concat(e," is continuous")}function ti(e){return"There is no ".concat(e," encoding. Replacing ").concat(e,"Offset encoding as ").concat(e,".")}function ni(e,t,n){return"Channel ".concat(e," is a ").concat(t,". Converted to {value: ").concat(g(n),"}.")}function ii(e){return'Invalid field type "'.concat(e,'".')}function oi(e,t){return'Invalid field type "'.concat(e,'" for aggregate: "').concat(t,'", using "quantitative" instead.')}function ri(e){return'Invalid aggregation operator "'.concat(e,'".')}function ai(e,t){const{fill:n,stroke:i}=t;return"Dropping color ".concat(e," as the plot also has ").concat(n&&i?"fill and stroke":n?"fill":"stroke",".")}function si(e,t){return"Dropping ".concat(g(e),' from channel "').concat(t,'" since it does not contain any data field, datum, value, or signal.')}function ci(e,t,n){return"".concat(e,' dropped as it is incompatible with "').concat(t,'"').concat(n?" when ".concat(n):"",".")}function li(e){return"".concat(e," encoding has no scale, so specified scale is ignored.")}function ui(e){return"".concat(e," encoding should be discrete (ordinal / nominal / binned).")}function di(e){return"".concat(e," encoding should be discrete (ordinal / nominal / binned) or use a discretizing scale (e.g. threshold).")}function fi(e,t){return'Using discrete channel "'.concat(e,'" to encode "').concat(t,'" field can be misleading as it does not encode ').concat("ordinal"===t?"order":"magnitude",".")}function pi(e){return"The ".concat(e," for range marks cannot be an expression")}function mi(e){return"Using unaggregated domain with raw field has no effect (".concat(g(e),").")}function gi(e){return'Unaggregated domain not applicable for "'.concat(e,'" since it produces values outside the origin domain of the source data.')}function hi(e){return"Unaggregated domain is currently unsupported for log scale (".concat(g(e),").")}function vi(e,t,n){return'Channel "'.concat(e,'" does not work with "').concat(t,'" scale. We are using "').concat(n,'" scale instead.')}function yi(e,t){return'FieldDef does not work with "'.concat(e,'" scale. We are using "').concat(t,'" scale instead.')}function bi(e,t,n){return"".concat(n,"-scale's \"").concat(t,'" is dropped as it does not work with ').concat(e," scale.")}function xi(e){return'The step for "'.concat(e,'" is dropped because the ').concat("width"===e?"x":"y"," is continuous.")}const wi="Domains that should be unioned has conflicting sort properties. Sort will be set to true.";function ki(e){return'Cannot stack "'.concat(e,'" if there is already "').concat(e,'2".')}function Si(e){return"Cannot stack non-linear scale (".concat(e,").")}function Di(e){return'Stacking is applied even though the aggregate function is non-summative ("'.concat(e,'").')}function Fi(e,t){return"Invalid ".concat(e,": ").concat(g(t),".")}function Oi(e){return"1D error band does not support ".concat(e,".")}function _i(e){return"Channel ".concat(e,' is required for "binned" bin.')}function zi(e){return"Channel ".concat(e,' should not be used with "binned" bin.')}const Ci=t.logger(t.Warn);let Pi=Ci;function Ai(e){return Pi=e,Pi}function Ni(){return Pi=Ci,Pi}function ji(){Pi.warn(...arguments)}function Ei(e){if(e&&t.isObject(e))for(const t of Vi)if(t in e)return!0;return!1}const Mi=["january","february","march","april","may","june","july","august","september","october","november","december"],Ti=Mi.map((e=>e.substr(0,3))),Li=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],qi=Li.map((e=>e.substr(0,3)));function Wi(e,n){const i=[];if(n&&void 0!==e.day&&C(e).length>1&&(ji(function(e){return"Dropping day from datetime ".concat(g(e)," as day cannot be combined with other units.")}(e)),delete(e=d(e)).day),void 0!==e.year?i.push(e.year):i.push(2012),void 0!==e.month){const o=n?function(e){if(Q(e)&&(e=+e),t.isNumber(e))return e-1;{const t=e.toLowerCase(),n=Mi.indexOf(t);if(-1!==n)return n;const i=t.substr(0,3),o=Ti.indexOf(i);if(-1!==o)return o;throw new Error(Fi("month",e))}}(e.month):e.month;i.push(o)}else if(void 0!==e.quarter){const o=n?function(e){if(Q(e)&&(e=+e),t.isNumber(e))return e>4&&ji(Fi("quarter",e)),e-1;throw new Error(Fi("quarter",e))}(e.quarter):e.quarter;i.push(t.isNumber(o)?3*o:"".concat(o,"*3"))}else i.push(0);if(void 0!==e.date)i.push(e.date);else if(void 0!==e.day){const o=n?function(e){if(Q(e)&&(e=+e),t.isNumber(e))return e%7;{const t=e.toLowerCase(),n=Li.indexOf(t);if(-1!==n)return n;const i=t.substr(0,3),o=qi.indexOf(i);if(-1!==o)return o;throw new Error(Fi("day",e))}}(e.day):e.day;i.push(t.isNumber(o)?o+1:"".concat(o,"+1"))}else i.push(1);for(const t of["hours","minutes","seconds","milliseconds"]){const n=e[t];i.push(void 0===n?0:n)}return i}function Ri(e){const t=Wi(e,!0).join(", ");return e.utc?"utc(".concat(t,")"):"datetime(".concat(t,")")}function Ui(e){const t=Wi(e,!1).join(", ");return e.utc?"utc(".concat(t,")"):"datetime(".concat(t,")")}function Bi(e){const t=Wi(e,!0);return e.utc?+new Date(Date.UTC(...t)):+new Date(...t)}const Hi={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},Vi=C(Hi);function Ii(e){return e.startsWith("utc")}const Gi={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function Yi(e){return Vi.filter((t=>Xi(e,t)))}function Xi(e,t){const n=e.indexOf(t);return!(n<0)&&(!(n>0&&"seconds"===t&&"i"===e.charAt(n-1))&&(!(e.length>n+3&&"day"===t&&"o"===e.charAt(n+3))&&!(n>0&&"year"===t&&"f"===e.charAt(n-1))))}function Ji(e,t){let{end:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{end:!1};const i=L(t),o=Ii(e)?"utc":"";function r(e){return"quarter"===e?"(".concat(o,"quarter(").concat(i,")-1)"):"".concat(o).concat(e,"(").concat(i,")")}let a;const s={};for(const t of Vi)Xi(e,t)&&(s[t]=r(t),a=t);return n&&(s[a]+="+1"),Ui(s)}function Qi(e){if(!e)return;const t=Yi(e);return"timeUnitSpecifier(".concat(g(t),", ").concat(g(Gi),")")}function $i(e){if(!e)return;let n;return t.isString(e)?n={unit:e}:t.isObject(e)&&(n={...e,...e.unit?{unit:e.unit}:{}}),Ii(n.unit)&&(n.utc=!0,n.unit=n.unit.substr(3)),n}function Ki(e){const{utc:t,...n}=$i(e);return n.unit?(t?"utc":"")+C(n).map((e=>j("".concat("unit"===e?"":"_".concat(e,"_")).concat(n[e])))).join(""):(t?"utc":"")+"timeunit"+C(n).map((e=>j("_".concat(e,"_").concat(n[e])))).join("")}function Zi(e){return e&&!!e.field&&void 0!==e.equal}function eo(e){return e&&!!e.field&&void 0!==e.lt}function to(e){return e&&!!e.field&&void 0!==e.lte}function no(e){return e&&!!e.field&&void 0!==e.gt}function io(e){return e&&!!e.field&&void 0!==e.gte}function oo(e){if(null!=e&&e.field){if(t.isArray(e.range)&&2===e.range.length)return!0;if(gn(e.range))return!0}return!1}function ro(e){return e&&!!e.field&&(t.isArray(e.oneOf)||t.isArray(e.in))}function ao(e){return e&&!!e.field&&void 0!==e.valid}function so(e){return ro(e)||Zi(e)||oo(e)||eo(e)||no(e)||to(e)||io(e)}function co(e,t){return Ha(e,{timeUnit:t,wrapTime:!0})}function lo(e,t){return e.map((e=>co(e,t)))}function uo(e){var t;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{field:i}=e,o=null===(t=$i(e.timeUnit))||void 0===t?void 0:t.unit,r=o?"time(".concat(Ji(o,i),")"):ka(e,{expr:"datum"});if(Zi(e))return"".concat(r,"===").concat(co(e.equal,o));if(eo(e)){const t=e.lt;return"".concat(r,"<").concat(co(t,o))}if(no(e)){const t=e.gt;return"".concat(r,">").concat(co(t,o))}if(to(e)){const t=e.lte;return"".concat(r,"<=").concat(co(t,o))}if(io(e)){const t=e.gte;return"".concat(r,">=").concat(co(t,o))}if(ro(e))return"indexof([".concat(lo(e.oneOf,o).join(","),"], ").concat(r,") !== -1");if(ao(e))return fo(r,e.valid);if(oo(e)){const{range:t}=e,i=gn(t)?{signal:"".concat(t.signal,"[0]")}:t[0],a=gn(t)?{signal:"".concat(t.signal,"[1]")}:t[1];if(null!==i&&null!==a&&n)return"inrange("+r+", ["+co(i,o)+", "+co(a,o)+"])";const s=[];return null!==i&&s.push("".concat(r," >= ").concat(co(i,o))),null!==a&&s.push("".concat(r," <= ").concat(co(a,o))),s.length>0?s.join(" && "):"true"}throw new Error("Invalid field predicate: ".concat(g(e)))}function fo(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return t?"isValid(".concat(e,") && isFinite(+").concat(e,")"):"!isValid(".concat(e,") || !isFinite(+").concat(e,")")}function po(e){var t;return so(e)&&e.timeUnit?{...e,timeUnit:null===(t=$i(e.timeUnit))||void 0===t?void 0:t.unit}:e}function mo(e){return"quantitative"===e||"temporal"===e}function go(e){return"ordinal"===e||"nominal"===e}const ho="quantitative",vo="ordinal",yo="temporal",bo="nominal",xo="geojson";function wo(e){if(e)switch(e=e.toLowerCase()){case"q":case ho:return"quantitative";case"t":case yo:return"temporal";case"o":case vo:return"ordinal";case"n":case bo:return"nominal";case xo:return"geojson"}}const ko="linear",So="log",Do="time",Fo="utc",Oo="point",_o="band",zo={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"};function Co(e,t){const n=zo[e],i=zo[t];return n===i||"ordinal-position"===n&&"time"===i||"ordinal-position"===i&&"time"===n}const Po={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function Ao(e){return Po[e]}const No=new Set(["linear","log","pow","sqrt","symlog"]),jo=new Set([...No,"time","utc"]);function Eo(e){return No.has(e)}const Mo=new Set(["quantile","quantize","threshold"]),To=new Set([...jo,...Mo,"sequential","identity"]),Lo=new Set(["ordinal","bin-ordinal","point","band"]);function qo(e){return Lo.has(e)}function Wo(e){return To.has(e)}function Ro(e){return jo.has(e)}function Uo(e){return Mo.has(e)}function Bo(e){return null==e?void 0:e.param}const{type:Ho,domain:Vo,range:Io,rangeMax:Go,rangeMin:Yo,scheme:Xo,...Jo}={type:1,domain:1,domainMax:1,domainMin:1,domainMid:1,align:1,range:1,rangeMax:1,rangeMin:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},Qo=C(Jo);function $o(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!["point","band","identity"].includes(e);case"bins":return!["point","band","identity","ordinal"].includes(e);case"round":return Ro(e)||"band"===e||"point"===e;case"padding":case"rangeMin":case"rangeMax":return Ro(e)||["point","band"].includes(e);case"paddingOuter":case"align":return["point","band"].includes(e);case"paddingInner":return"band"===e;case"domainMax":case"domainMid":case"domainMin":case"clamp":return Ro(e);case"nice":return Ro(e)||"quantize"===e||"threshold"===e;case"exponent":return"pow"===e;case"base":return"log"===e;case"constant":return"symlog"===e;case"zero":return Wo(e)&&!y(["log","time","utc","threshold","quantile"],e)}}function Ko(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return qe(e)?void 0:'Cannot use the scale property "'.concat(e,'" with non-color channel.');case"align":case"type":case"bins":case"domain":case"domainMax":case"domainMin":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeMax":case"rangeMin":case"reverse":case"round":case"clamp":case"zero":return}}function Zo(e,t){return y([vo,bo],t)?void 0===e||qo(e):t===yo?y([Do,Fo,void 0],e):t!==ho||(Eo(e)||Uo(e)||void 0===e)}function er(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!Ht(e))return!1;switch(e){case ee:case te:case oe:case re:case ce:case ae:return!!Ro(t)||("band"===t||"point"===t&&!n);case ye:case Se:case xe:case we:case ke:case be:return Ro(t)||Uo(t)||y(["band","point","ordinal"],t);case me:case ge:case he:return"band"!==t;case De:case ve:return"ordinal"===t||Uo(t)}}const tr={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},nr=tr.arc,ir=tr.area,or=tr.bar,rr=tr.image,ar=tr.line,sr=tr.point,cr=tr.rect,lr=tr.rule,ur=tr.text,dr=tr.tick,fr=tr.trail,pr=tr.circle,mr=tr.square,gr=tr.geoshape;function hr(e){return["line","area","trail"].includes(e)}function vr(e){return["rect","bar","image","arc"].includes(e)}const yr=new Set(C(tr));function br(e){return e.type}const xr=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit","fill","fillOpacity"],wr=C({color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBandSize:1,timeUnitBandPosition:1}),kr=C({mark:1,arc:1,area:1,bar:1,circle:1,image:1,line:1,point:1,rect:1,rule:1,square:1,text:1,tick:1,trail:1,geoshape:1});function Sr(e){return e&&null!=e.band}const Dr={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},Fr={binSpacing:1,continuousBandSize:5,timeUnitBandPosition:.5},Or={binSpacing:0,continuousBandSize:5,timeUnitBandPosition:.5};function _r(e){const{channel:t,channelDef:n,markDef:i,scale:o,config:r}=e,a=Nr(e);return ca(n)&&!tn(n.aggregate)&&o&&Ro(o.get("type"))?function(e){let{fieldDef:t,channel:n,markDef:i,ref:o,config:r}=e;if(hr(i.type))return o;if(null===Cn("invalid",i,r))return[zr(t,n),o];return o}({fieldDef:n,channel:t,markDef:i,ref:a,config:r}):a}function zr(e,t){return{test:Cr(e,!0),..."y"===et(t)?{field:{group:"height"}}:{value:0}}}function Cr(e){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return fo(t.isString(e)?e:ka(e,{expr:"datum"}),!n)}function Pr(e,t,n,i){const o={};if(t&&(o.scale=t),ua(e)){const{datum:t}=e;Ei(t)?o.signal=Ri(t):gn(t)?o.signal=t.signal:dn(t)?o.signal=t.expr:o.value=t}else o.field=ka(e,n);if(i){const{offset:e,band:t}=i;e&&(o.offset=e),t&&(o.band=t)}return o}function Ar(e){let{scaleName:t,fieldOrDatumDef:n,fieldOrDatumDef2:i,offset:o,startSuffix:r,bandPosition:a=.5}=e;const s=0<a&&a<1?"datum":void 0,c=ka(n,{expr:s,suffix:r}),l=void 0!==i?ka(i,{expr:s}):ka(n,{suffix:"end",expr:s}),u={};if(0===a||1===a){u.scale=t;const e=0===a?c:l;u.field=e}else{const e=gn(a)?"".concat(a.signal," * ").concat(c," + (1-").concat(a.signal,") * ").concat(l):"".concat(a," * ").concat(c," + ").concat(1-a," * ").concat(l);u.signal='scale("'.concat(t,'", ').concat(e,")")}return o&&(u.offset=o),u}function Nr(e){let{channel:n,channelDef:i,channel2Def:o,markDef:r,config:a,scaleName:s,scale:c,stack:l,offset:u,defaultRef:d,bandPosition:f}=e;if(i){if(pa(i)){var p,m;const e=null==c?void 0:c.get("type");if(ma(i)){var g;null!==(g=f)&&void 0!==g||(f=na({fieldDef:i,fieldDef2:o,markDef:r,config:a}));const{bin:t,timeUnit:c,type:d}=i;if(an(t)||f&&c&&d===yo)return null!=l&&l.impute?Pr(i,s,{binSuffix:"mid"},{offset:u}):f&&!qo(e)?Ar({scaleName:s,fieldOrDatumDef:i,bandPosition:f,offset:u}):Pr(i,s,Ia(i,n)?{binSuffix:"range"}:{},{offset:u});if(sn(t)){if(ca(o))return Ar({scaleName:s,fieldOrDatumDef:i,fieldOrDatumDef2:o,bandPosition:f,offset:u});ji(_i(n===ee?ne:ie))}}return Pr(i,s,qo(e)?{binSuffix:"range"}:{},{offset:u,band:"band"===e?null!==(p=null!==(m=f)&&void 0!==m?m:i.bandPosition)&&void 0!==p?p:.5:void 0})}if(ga(i)){const e=u?{offset:u}:{};return{...jr(n,i.value),...e}}}return t.isFunction(d)&&(d=d()),d?{...d,...u?{offset:u}:{}}:d}function jr(e,t){return y(["x","x2"],e)&&"width"===t?{field:{group:"width"}}:y(["y","y2"],e)&&"height"===t?{field:{group:"height"}}:Dn(t)}function Er(e){return e&&"number"!==e&&"time"!==e}function Mr(e,t,n){return"".concat(e,"(").concat(t).concat(n?", ".concat(g(n)):"",")")}function Tr(e){let{fieldOrDatumDef:n,format:i,formatType:o,expr:r,normalizeStack:a,config:s}=e;if(Er(o))return qr({fieldOrDatumDef:n,format:i,formatType:o,expr:r,config:s});const c=Lr(n,r,a);if(Ba(n)){var l,u;const e=function(e,n,i,o,r){return!n||i?(i=t.isString(i)?i:o,"".concat(r?"utc":"time","Format(").concat(e,", '").concat(i,"')")):function(e,t,n){if(!e)return;const i=Qi(e),o=n||Ii(e);return"".concat(o?"utc":"time","Format(").concat(t,", ").concat(i,")")}(n,e,r)}(c,ca(n)?null===(l=$i(n.timeUnit))||void 0===l?void 0:l.unit:void 0,i,s.timeFormat,ha(n)&&(null===(u=n.scale)||void 0===u?void 0:u.type)===Fo);return e?{signal:e}:void 0}if(i=Ur(la(n),i,s),ca(n)&&an(n.bin)){return{signal:Vr(c,ka(n,{expr:r,binSuffix:"end"}),i,o,s)}}return i||"quantitative"===la(n)?{signal:"".concat(Br(c,i))}:{signal:"isValid(".concat(c,") ? ").concat(c,' : ""+').concat(c)}}function Lr(e,t,n){return ca(e)?n?"".concat(ka(e,{expr:t,suffix:"end"}),"-").concat(ka(e,{expr:t,suffix:"start"})):ka(e,{expr:t}):function(e){const{datum:t}=e;return Ei(t)?Ri(t):"".concat(g(t))}(e)}function qr(e){var t;let{fieldOrDatumDef:n,format:i,formatType:o,expr:r,normalizeStack:a,config:s,field:c}=e;if(null!==(t=c)&&void 0!==t||(c=Lr(n,r,a)),ca(n)&&an(n.bin)){return{signal:Vr(c,ka(n,{expr:r,binSuffix:"end"}),i,o,s)}}return{signal:Mr(o,c,i)}}function Wr(e,t,n,i,o,r){if(!Er(i)){if(Ba(e)){var a;return function(e,t,n,i){if(e)return e;if(t)return{signal:Qi(t)};return i?void 0:n.timeFormat}(n,ca(e)?null===(a=$i(e.timeUnit))||void 0===a?void 0:a.unit:void 0,o,r)}return Ur(t,n,o)}}function Rr(e,t,n){return e&&(gn(e)||"number"===e||"time"===e)?e:Ba(t)&&"time"!==n&&"utc"!==n?"time":void 0}function Ur(e,n,i){return t.isString(n)?n:e===ho?i.numberFormat:void 0}function Br(e,t){return"format(".concat(e,', "').concat(t||"",'")')}function Hr(e,n,i,o){var r;return Er(i)?Mr(i,e,n):Br(e,null!==(r=t.isString(n)?n:void 0)&&void 0!==r?r:o.numberFormat)}function Vr(e,t,n,i,o){const r=Hr(e,n,i,o),a=Hr(t,n,i,o);return"".concat(fo(e,!1),' ? "null" : ').concat(r,' + "').concat(" â€“ ",'" + ').concat(a)}const Ir="min",Gr={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function Yr(e){return e in Gr}function Xr(e){return!!e&&!!e.encoding}function Jr(e){return!(!e||"count"!==e.op&&!e.field)}function Qr(e){return!!e&&t.isArray(e)}function $r(e){return"row"in e||"column"in e}function Kr(e){return!!e&&"header"in e}function Zr(e){return"facet"in e}function ea(e){const{field:t,timeUnit:n,bin:i,aggregate:o}=e;return{...n?{timeUnit:n}:{},...i?{bin:i}:{},...o?{aggregate:o}:{},field:t}}function ta(e){return"sort"in e}function na(e){let{fieldDef:t,fieldDef2:n,markDef:i,config:o}=e;if(pa(t)&&void 0!==t.bandPosition)return t.bandPosition;if(ca(t)){const{timeUnit:e,bin:r}=t;if(e&&!n)return vr(i.type)?0:Pn("timeUnitBandPosition",i,o);if(an(r))return.5}}function ia(e){let{channel:t,fieldDef:n,fieldDef2:i,markDef:o,config:r,scaleType:a,useVlSizeChannel:s}=e;const c=it(t),l=Cn(s?"size":c,o,r,{vgChannel:c});if(void 0!==l)return l;if(ca(n)){const{timeUnit:e,bin:t}=n;if(e&&!i)return{band:Pn("timeUnitBandSize",o,r)};if(an(t)&&!qo(a))return{band:1}}var u,d,f;return vr(o.type)?a?qo(a)?(null===(d=r[o.type])||void 0===d?void 0:d.discreteBandSize)||{band:1}:null===(f=r[o.type])||void 0===f?void 0:f.continuousBandSize:null===(u=r[o.type])||void 0===u?void 0:u.discreteBandSize:void 0}function oa(e,t,n,i){return!!(an(e.bin)||e.timeUnit&&ma(e)&&"temporal"===e.type)&&void 0!==na({fieldDef:e,fieldDef2:t,markDef:n,config:i})}function ra(e){return e&&"condition"in e}function aa(e){const n=e&&e.condition;return!!n&&!t.isArray(n)&&ca(n)}function sa(e){const n=e&&e.condition;return!!n&&!t.isArray(n)&&pa(n)}function ca(e){return e&&(!!e.field||"count"===e.aggregate)}function la(e){return e&&e.type}function ua(e){return e&&"datum"in e}function da(e){return ma(e)&&!Sa(e)||fa(e)}function fa(e){return ua(e)&&t.isNumber(e.datum)}function pa(e){return ca(e)||ua(e)}function ma(e){return e&&("field"in e||"count"===e.aggregate)&&"type"in e}function ga(e){return e&&"value"in e&&"value"in e}function ha(e){return e&&("scale"in e||"sort"in e)}function va(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function ya(e){return e&&"legend"in e}function ba(e){return e&&("format"in e||"formatType"in e)}function xa(e){return m(e,["legend","axis","header","scale"])}function wa(e){return"op"in e}function ka(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.field;const i=t.prefix;let o=t.suffix,r="";if(Da(e))n=Y("count");else{let i;if(!t.nofn)if(wa(e))i=e.op;else{const{bin:l,aggregate:u,timeUnit:d}=e;var a,s;if(an(l))i=rn(l),o=(null!==(a=t.binSuffix)&&void 0!==a?a:"")+(null!==(s=t.suffix)&&void 0!==s?s:"");else if(u)Kt(u)?(r='["'.concat(n,'"]'),n="argmax_".concat(u.argmax)):$t(u)?(r='["'.concat(n,'"]'),n="argmin_".concat(u.argmin)):i=String(u);else if(d){var c;i=Ki(d),o=(!["range","mid"].includes(t.binSuffix)&&t.binSuffix||"")+(null!==(c=t.suffix)&&void 0!==c?c:"")}}i&&(n=n?"".concat(i,"_").concat(n):i)}return o&&(n="".concat(n,"_").concat(o)),i&&(n="".concat(i,"_").concat(n)),t.forAs?B(n):t.expr?q(n,t.expr)+r:R(n)+r}function Sa(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return ca(e)&&!!e.bin;case"temporal":return!1}throw new Error(ii(e.type))}function Da(e){return"count"===e.aggregate}const Fa=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return function(e){const{aggregate:t,bin:n,timeUnit:i,field:o}=e;if(Kt(t))return"".concat(o," for argmax(").concat(t.argmax,")");if($t(t))return"".concat(o," for argmin(").concat(t.argmin,")");const r=$i(i),a=t||(null==r?void 0:r.unit)||(null==r?void 0:r.maxbins)&&"timeunit"||an(n)&&"bin";return a?"".concat(a.toUpperCase(),"(").concat(o,")"):o}(e);default:return function(e,t){const{field:n,bin:i,timeUnit:o,aggregate:r}=e;if("count"===r)return t.countTitle;if(an(i))return"".concat(n," (binned)");if(o){var a;const e=null===(a=$i(o))||void 0===a?void 0:a.unit;if(e)return"".concat(n," (").concat(Yi(e).join("-"),")")}else if(r)return Kt(r)?"".concat(n," for max ").concat(r.argmax):$t(r)?"".concat(n," for min ").concat(r.argmin):"".concat(T(r)," of ").concat(n);return n}(e,t)}};let Oa=Fa;function _a(e){Oa=e}function za(){_a(Fa)}function Ca(e,t,n){var i;let{allowDisabling:o,includeDefault:r=!0}=n;const a=null===(i=Pa(e))||void 0===i?void 0:i.title;if(!ca(e))return null!=a?a:e.title;const s=e,c=r?Aa(s,t):void 0;return o?V(a,s.title,c):null!==(l=null!=a?a:s.title)&&void 0!==l?l:c;var l}function Pa(e){return va(e)&&e.axis?e.axis:ya(e)&&e.legend?e.legend:Kr(e)&&e.header?e.header:void 0}function Aa(e,t){return Oa(e,t)}function Na(e){if(ba(e)){const{format:t,formatType:n}=e;return{format:t,formatType:n}}{var t;const n=null!==(t=Pa(e))&&void 0!==t?t:{},{format:i,formatType:o}=n;return{format:i,formatType:o}}}function ja(e,n){var i;switch(n){case"latitude":case"longitude":return"quantitative";case"row":case"column":case"facet":case"shape":case"strokeDash":return"nominal";case"order":return"ordinal"}if(ta(e)&&t.isArray(e.sort))return"ordinal";const{aggregate:o,bin:r,timeUnit:a}=e;if(a)return"temporal";if(r||o&&!Kt(o)&&!$t(o))return"quantitative";if(ha(e)&&null!==(i=e.scale)&&void 0!==i&&i.type)switch(zo[e.scale.type]){case"numeric":case"discretizing":return"quantitative";case"time":return"temporal"}return"nominal"}function Ea(e){return ca(e)?e:aa(e)?e.condition:void 0}function Ma(e){return pa(e)?e:sa(e)?e.condition:void 0}function Ta(e,n,i){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(t.isString(e)||t.isNumber(e)||t.isBoolean(e)){return ji(ni(n,t.isString(e)?"string":t.isNumber(e)?"number":"boolean",e)),{value:e}}return pa(e)?La(e,n,i,o):sa(e)?{...e,condition:La(e.condition,n,i,o)}:e}function La(e,n,i,o){if(ba(e)){const{format:t,formatType:r,...a}=e;if(Er(r)&&!i.customFormatTypes)return ji(Zn(n)),La(a,n,i,o)}else{const t=va(e)?"axis":ya(e)?"legend":Kr(e)?"header":null;if(t&&e[t]){const{format:r,formatType:a,...s}=e[t];if(Er(a)&&!i.customFormatTypes)return ji(Zn(n)),La({...e,[t]:s},n,i,o)}}return ca(e)?qa(e,n,o):function(e){let n=e.type;if(n)return e;const{datum:i}=e;return n=t.isNumber(i)?"quantitative":t.isString(i)?"nominal":Ei(i)?"temporal":void 0,{...e,type:n}}(e)}function qa(e,n){let{compositeMark:i=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{aggregate:o,timeUnit:r,bin:a,field:s}=e,c={...e};if(i||!o||Zt(o)||Kt(o)||$t(o)||(ji(ri(o)),delete c.aggregate),r&&(c.timeUnit=$i(r)),s&&(c.field="".concat(s)),an(a)&&(c.bin=Wa(a,n)),sn(a)&&!Ft(n)&&ji(zi(n)),ma(c)){const{type:e}=c,t=wo(e);e!==t&&(c.type=t),"quantitative"!==e&&tn(o)&&(ji(oi(e,o)),c.type="quantitative")}else if(!Ze(n)){const e=ja(c,n);c.type=e}if(ma(c)){const{compatible:e,warning:t}=Ua(c,n)||{};!1===e&&ji(t)}if(ta(c)&&t.isString(c.sort)){const{sort:e}=c;if(Yr(e))return{...c,sort:{encoding:e}};const t=e.substr(1);if("-"===e.charAt(0)&&Yr(t))return{...c,sort:{encoding:t,order:"descending"}}}if(Kr(c)){const{header:e}=c;if(e){const{orient:t,...n}=e;if(t)return{...c,header:{...n,labelOrient:e.labelOrient||t,titleOrient:e.titleOrient||t}}}}return c}function Wa(e,n){return t.isBoolean(e)?{maxbins:un(n)}:"binned"===e?{binned:!0}:e.maxbins||e.step?e:{...e,maxbins:un(n)}}const Ra={compatible:!0};function Ua(e,t){const n=e.type;if("geojson"===n&&"shape"!==t)return{compatible:!1,warning:"Channel ".concat(t," should not be used with a geojson data.")};switch(t){case $:case K:case Z:return Sa(e)?Ra:{compatible:!1,warning:ui(t)};case ee:case te:case oe:case re:case me:case ge:case he:case Fe:case _e:case ze:case Ce:case Pe:case Ae:case be:case ce:case ae:case Ne:return Ra;case de:case pe:case ue:case fe:return n!==ho?{compatible:!1,warning:"Channel ".concat(t," should be used with a quantitative field only, not ").concat(e.type," field.")}:Ra;case xe:case we:case ke:case Se:case ye:case le:case se:case ne:case ie:return"nominal"!==n||e.sort?Ra:{compatible:!1,warning:"Channel ".concat(t," should not be used with an unsorted discrete field.")};case ve:case De:return Sa(e)||ha(i=e)&&Uo(null===(o=i.scale)||void 0===o?void 0:o.type)?Ra:{compatible:!1,warning:di(t)};case Oe:return"nominal"!==e.type||"sort"in e?Ra:{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}}var i,o}function Ba(e){const{formatType:t}=Na(e);return"time"===t||!t&&((n=e)&&("temporal"===n.type||ca(n)&&!!n.timeUnit));var n}function Ha(e,n){var i;let{timeUnit:o,type:r,wrapTime:a,undefinedIfExprNotRequired:s}=n;const c=o&&(null===(i=$i(o))||void 0===i?void 0:i.unit);let l,u=c||"temporal"===r;return dn(e)?l=e.expr:gn(e)?l=e.signal:Ei(e)?(u=!0,l=Ri(e)):(t.isString(e)||t.isNumber(e))&&u&&(l="datetime(".concat(g(e),")"),function(e){return!!Hi[e]}(c)&&(t.isNumber(e)&&e<1e4||t.isString(e)&&isNaN(Date.parse(e)))&&(l=Ri({[c]:e}))),l?a&&u?"time(".concat(l,")"):l:s?void 0:g(e)}function Va(e,t){const{type:n}=e;return t.map((t=>{const i=Ha(t,{timeUnit:ca(e)?e.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return void 0!==i?{signal:i}:t}))}function Ia(e,t){return an(e.bin)?Ht(t)&&["ordinal","nominal"].includes(e.type):(console.warn("Only call this method for binned field defs."),!1)}const Ga={labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDashOffset"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDashOffset"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"}};function Ya(e){return e&&e.condition}const Xa=["domain","grid","labels","ticks","title"],Ja={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"both",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},Qa={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},$a={...Qa,style:1,labelExpr:1,encoding:1};function Ka(e){return!!$a[e]}const Za=C({axis:1,axisBand:1,axisBottom:1,axisDiscrete:1,axisLeft:1,axisPoint:1,axisQuantitative:1,axisRight:1,axisTemporal:1,axisTop:1,axisX:1,axisXBand:1,axisXDiscrete:1,axisXPoint:1,axisXQuantitative:1,axisXTemporal:1,axisY:1,axisYBand:1,axisYDiscrete:1,axisYPoint:1,axisYQuantitative:1,axisYTemporal:1});function es(e){return"mark"in e}class ts{constructor(e,t){this.name=e,this.run=t}hasMatchingType(e){return!!es(e)&&(br(t=e.mark)?t.type:t)===this.name;var t}}function ns(e,n){const i=e&&e[n];return!!i&&(t.isArray(i)?b(i,(e=>!!e.field)):ca(i)||aa(i))}function is(e,n){const i=e&&e[n];return!!i&&(t.isArray(i)?b(i,(e=>!!e.field)):ca(i)||ua(i)||sa(i))}function os(e,t){if(Ft(t)){const n=e[t];if((ca(n)||ua(n))&&go(n.type)){return is(e,ot(t))}}return!1}function rs(e){return b(Be,(n=>{if(ns(e,n)){const i=e[n];if(t.isArray(i))return b(i,(e=>!!e.aggregate));{const e=Ea(i);return e&&!!e.aggregate}}return!1}))}function as(e,t){const n=[],i=[],o=[],r=[],a={};return us(e,((s,c)=>{if(ca(s)){const{field:l,aggregate:u,bin:d,timeUnit:f,...p}=s;if(u||f||d){const e=Pa(s),m=null==e?void 0:e.title;let g=ka(s,{forAs:!0});const h={...m?[]:{title:Ca(s,t,{allowDisabling:!0})},...p,field:g};if(u){let e;if(Kt(u)?(e="argmax",g=ka({op:"argmax",field:u.argmax},{forAs:!0}),h.field="".concat(g,".").concat(l)):$t(u)?(e="argmin",g=ka({op:"argmin",field:u.argmin},{forAs:!0}),h.field="".concat(g,".").concat(l)):"boxplot"!==u&&"errorbar"!==u&&"errorband"!==u&&(e=u),e){const t={op:e,as:g};l&&(t.field=l),r.push(t)}}else if(n.push(g),ma(s)&&an(d)){if(i.push({bin:d,field:l,as:g}),n.push(ka(s,{binSuffix:"end"})),Ia(s,c)&&n.push(ka(s,{binSuffix:"range"})),Ft(c)){const e={field:"".concat(g,"_end")};a["".concat(c,"2")]=e}h.bin="binned",Ze(c)||(h.type=ho)}else if(f){o.push({timeUnit:f,field:l,as:g});const e=ma(s)&&s.type!==yo&&"time";e&&(c===Fe||c===Ce?h.formatType=e:!function(e){return!!wt[e]}(c)?Ft(c)&&(h.axis={formatType:e,...h.axis}):h.legend={formatType:e,...h.legend})}a[c]=h}else n.push(l),a[c]=e[c]}else a[c]=e[c]})),{bins:i,timeUnits:o,aggregate:r,groupby:n,encoding:a}}function ss(e,t,n){const i=Vt(t,n);if(!i)return!1;if("binned"===i){const n=e[t===ne?ee:te];return!!(ca(n)&&ca(e[t])&&sn(n.bin))}return!0}function cs(e,t){const n={};for(const i of C(e)){const o=Ta(e[i],i,t,{compositeMark:!0});n[i]=o}return n}function ls(e){const n=[];for(const i of C(e))if(ns(e,i)){const o=e[i],r=t.array(o);for(const e of r)ca(e)?n.push(e):aa(e)&&n.push(e.condition)}return n}function us(e,n,i){if(e)for(const o of C(e)){const r=e[o];if(t.isArray(r))for(const e of r)n.call(i,e,o);else n.call(i,r,o)}}function ds(e,n){return C(n).reduce(((i,o)=>{switch(o){case ee:case te:case Pe:case Ne:case Ae:case ne:case ie:case oe:case re:case ce:case le:case ae:case se:case ue:case de:case fe:case pe:case Fe:case ve:case be:case Ce:return i;case Oe:if("line"===e||"trail"===e)return i;case _e:case ze:{const e=n[o];if(t.isArray(e)||ca(e))for(const n of t.array(e))n.aggregate||i.push(ka(n,{}));return i}case ye:if("trail"===e)return i;case me:case ge:case he:case xe:case we:case ke:case De:case Se:{const e=Ea(n[o]);return e&&!e.aggregate&&i.push(ka(e,{})),i}}}),[])}function fs(e,t,n){let i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if("tooltip"in n)return{tooltip:n.tooltip};const o=e.map((e=>{let{fieldPrefix:n,titlePrefix:o}=e;const r=i?" of ".concat(ps(t)):"";return{field:n+t.field,type:t.type,title:gn(o)?{signal:"".concat(o,'"').concat(escape(r),'"')}:o+r}})),r=ls(n).map(xa);return{tooltip:[...o,...S(r,h)]}}function ps(e){const{title:t,field:n}=e;return V(t,n)}function ms(e,n,i,o,r){const{scale:a,axis:s}=i;return c=>{let{partName:l,mark:u,positionPrefix:d,endPositionPrefix:f,extraEncoding:p={}}=c;const m=ps(i);return gs(e,l,r,{mark:u,encoding:{[n]:{field:"".concat(d,"_").concat(i.field),type:i.type,...void 0!==m?{title:m}:{},...void 0!==a?{scale:a}:{},...void 0!==s?{axis:s}:{}},...t.isString(f)?{["".concat(n,"2")]:{field:"".concat(f,"_").concat(i.field)}}:{},...o,...p}})}}function gs(e,n,i,o){const{clip:r,color:a,opacity:s}=e,c=e.type;return e[n]||void 0===e[n]&&i[n]?[{...o,mark:{...i[n],...r?{clip:r}:{},...a?{color:a}:{},...s?{opacity:s}:{},...br(o.mark)?o.mark:{type:o.mark},style:"".concat(c,"-").concat(n),...t.isBoolean(e[n])?{}:e[n]}}]:[]}function hs(e,t,n){const{encoding:i}=e,o="vertical"===t?"y":"x",r=i[o],a=i["".concat(o,"2")],s=i["".concat(o,"Error")],c=i["".concat(o,"Error2")];return{continuousAxisChannelDef:vs(r,n),continuousAxisChannelDef2:vs(a,n),continuousAxisChannelDefError:vs(s,n),continuousAxisChannelDefError2:vs(c,n),continuousAxis:o}}function vs(e,t){if(null!=e&&e.aggregate){const{aggregate:n,...i}=e;return n!==t&&ji(function(e,t){return"Continuous axis should not have customized aggregation function ".concat(e,"; ").concat(t," already agregates the axis.")}(n,t)),i}return e}function ys(e,t){const{mark:n,encoding:i}=e,{x:o,y:r}=i;if(br(n)&&n.orient)return n.orient;if(da(o)){if(da(r)){const e=ca(o)&&o.aggregate,n=ca(r)&&r.aggregate;if(e||n!==t){if(n||e!==t){if(e===t&&n===t)throw new Error("Both x and y cannot have aggregate");return Ba(r)&&!Ba(o)?"horizontal":"vertical"}return"horizontal"}return"vertical"}return"horizontal"}if(da(r))return"vertical";throw new Error("Need a valid continuous axis for ".concat(t,"s"))}const bs="boxplot",xs=new ts(bs,ks);function ws(e){return t.isNumber(e)?"tukey":e}function ks(e,n){var i;let{config:o}=n;e={...e,encoding:cs(e.encoding,o)};const{mark:r,encoding:a,params:s,projection:c,...l}=e,u=br(r)?r:{type:r};s&&ji(Jn("boxplot"));const d=null!==(i=u.extent)&&void 0!==i?i:o.boxplot.extent,f=Cn("size",u,o),p=ws(d),{bins:g,timeUnits:h,transform:v,continuousAxisChannelDef:y,continuousAxis:b,groupby:x,aggregate:w,encodingWithoutContinuousAxis:k,ticksOrient:S,boxOrient:D,customTooltipWithoutAggregatedField:F}=function(e,n,i){const o=ys(e,bs),{continuousAxisChannelDef:r,continuousAxis:a}=hs(e,o,bs),s=r.field,c=ws(n),l=[...Ss(s),{op:"median",field:s,as:"mid_box_".concat(s)},{op:"min",field:s,as:("min-max"===c?"lower_whisker_":"min_")+s},{op:"max",field:s,as:("min-max"===c?"upper_whisker_":"max_")+s}],u="min-max"===c||"tukey"===c?[]:[{calculate:'datum["upper_box_'.concat(s,'"] - datum["lower_box_').concat(s,'"]'),as:"iqr_".concat(s)},{calculate:'min(datum["upper_box_'.concat(s,'"] + datum["iqr_').concat(s,'"] * ').concat(n,', datum["max_').concat(s,'"])'),as:"upper_whisker_".concat(s)},{calculate:'max(datum["lower_box_'.concat(s,'"] - datum["iqr_').concat(s,'"] * ').concat(n,', datum["min_').concat(s,'"])'),as:"lower_whisker_".concat(s)}],{[a]:d,...f}=e.encoding,{customTooltipWithoutAggregatedField:p,filteredEncoding:m}=function(e){const{tooltip:n,...i}=e;if(!n)return{filteredEncoding:i};let o,r;if(t.isArray(n)){for(const e of n)e.aggregate?(o||(o=[]),o.push(e)):(r||(r=[]),r.push(e));o&&(i.tooltip=o)}else n.aggregate?i.tooltip=n:r=n;return t.isArray(r)&&1===r.length&&(r=r[0]),{customTooltipWithoutAggregatedField:r,filteredEncoding:i}}(f),{bins:g,timeUnits:h,aggregate:v,groupby:y,encoding:b}=as(m,i),x="vertical"===o?"horizontal":"vertical",w=o,k=[...g,...h,{aggregate:[...v,...l],groupby:y},...u];return{bins:g,timeUnits:h,transform:k,groupby:y,aggregate:v,continuousAxisChannelDef:r,continuousAxis:a,encodingWithoutContinuousAxis:b,ticksOrient:x,boxOrient:w,customTooltipWithoutAggregatedField:p}}(e,d,o),{color:O,size:_,...C}=k,P=e=>ms(u,b,y,e,o.boxplot),A=P(C),N=P(k),j=P({...C,..._?{size:_}:{}}),E=fs([{fieldPrefix:"min-max"===p?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:"min-max"===p?"lower_whisker_":"min_",titlePrefix:"Min"}],y,k),M={type:"tick",color:"black",opacity:1,orient:S,invalid:null,aria:!1},T="min-max"===p?E:fs([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],y,k),L=[...A({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",extraEncoding:T}),...A({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",extraEncoding:T}),...A({partName:"ticks",mark:M,positionPrefix:"lower_whisker",extraEncoding:T}),...A({partName:"ticks",mark:M,positionPrefix:"upper_whisker",extraEncoding:T})],q=[..."tukey"!==p?L:[],...N({partName:"box",mark:{type:"bar",...f?{size:f}:{},orient:D,invalid:null,ariaRoleDescription:"box"},positionPrefix:"lower_box",endPositionPrefix:"upper_box",extraEncoding:E}),...j({partName:"median",mark:{type:"tick",invalid:null,...t.isObject(o.boxplot.median)&&o.boxplot.median.color?{color:o.boxplot.median.color}:{},...f?{size:f}:{},orient:S,aria:!1},positionPrefix:"mid_box",extraEncoding:E})];var W;if("min-max"===p)return{...l,transform:(null!==(W=l.transform)&&void 0!==W?W:[]).concat(v),layer:q};const R='datum["lower_box_'.concat(y.field,'"]'),U='datum["upper_box_'.concat(y.field,'"]'),B="(".concat(U," - ").concat(R,")"),H="".concat(R," - ").concat(d," * ").concat(B),V="".concat(U," + ").concat(d," * ").concat(B),I='datum["'.concat(y.field,'"]'),G={joinaggregate:Ss(y.field),groupby:x},Y={transform:[{filter:"(".concat(H," <= ").concat(I,") && (").concat(I," <= ").concat(V,")")},{aggregate:[{op:"min",field:y.field,as:"lower_whisker_".concat(y.field)},{op:"max",field:y.field,as:"upper_whisker_".concat(y.field)},{op:"min",field:"lower_box_".concat(y.field),as:"lower_box_".concat(y.field)},{op:"max",field:"upper_box_".concat(y.field),as:"upper_box_".concat(y.field)},...w],groupby:x}],layer:L},{tooltip:X,...J}=C,{scale:Q,axis:$}=y,K=ps(y),Z=m($,["title"]),ee=gs(u,"outliers",o.boxplot,{transform:[{filter:"(".concat(I," < ").concat(H,") || (").concat(I," > ").concat(V,")")}],mark:"point",encoding:{[b]:{field:y.field,type:y.type,...void 0!==K?{title:K}:{},...void 0!==Q?{scale:Q}:{},...z(Z)?{}:{axis:Z}},...J,...O?{color:O}:{},...F?{tooltip:F}:{}}})[0];let te;const ne=[...g,...h,G];return ee?te={transform:ne,layer:[ee,Y]}:(te=Y,te.transform.unshift(...ne)),{...l,layer:[te,{transform:v,layer:q}]}}function Ss(e){return[{op:"q1",field:e,as:"lower_box_".concat(e)},{op:"q3",field:e,as:"upper_box_".concat(e)}]}const Ds="errorbar",Fs=new ts(Ds,Os);function Os(e,t){let{config:n}=t;e={...e,encoding:cs(e.encoding,n)};const{transform:i,continuousAxisChannelDef:o,continuousAxis:r,encodingWithoutContinuousAxis:a,ticksOrient:s,markDef:c,outerSpec:l,tooltipEncoding:u}=zs(e,Ds,n);delete a.size;const d=ms(c,r,o,a,n.errorbar),f=c.thickness,p=c.size,m={type:"tick",orient:s,aria:!1,...void 0!==f?{thickness:f}:{},...void 0!==p?{size:p}:{}},g=[...d({partName:"ticks",mark:m,positionPrefix:"lower",extraEncoding:u}),...d({partName:"ticks",mark:m,positionPrefix:"upper",extraEncoding:u}),...d({partName:"rule",mark:{type:"rule",ariaRoleDescription:"errorbar",...void 0!==f?{size:f}:{}},positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:u})];return{...l,transform:i,...g.length>1?{layer:g}:{...g[0]}}}function _s(e,t){const{encoding:n}=e;if(function(e){return(pa(e.x)||pa(e.y))&&!pa(e.x2)&&!pa(e.y2)&&!pa(e.xError)&&!pa(e.xError2)&&!pa(e.yError)&&!pa(e.yError2)}(n))return{orient:ys(e,t),inputType:"raw"};const i=function(e){return pa(e.x2)||pa(e.y2)}(n),o=function(e){return pa(e.xError)||pa(e.xError2)||pa(e.yError)||pa(e.yError2)}(n),r=n.x,a=n.y;if(i){if(o)throw new Error("".concat(t," cannot be both type aggregated-upper-lower and aggregated-error"));const e=n.x2,i=n.y2;if(pa(e)&&pa(i))throw new Error("".concat(t," cannot have both x2 and y2"));if(pa(e)){if(da(r))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error("Both x and x2 have to be quantitative in ".concat(t))}if(pa(i)){if(da(a))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error("Both y and y2 have to be quantitative in ".concat(t))}throw new Error("No ranged axis")}{const e=n.xError,i=n.xError2,o=n.yError,s=n.yError2;if(pa(i)&&!pa(e))throw new Error("".concat(t," cannot have xError2 without xError"));if(pa(s)&&!pa(o))throw new Error("".concat(t," cannot have yError2 without yError"));if(pa(e)&&pa(o))throw new Error("".concat(t," cannot have both xError and yError with both are quantiative"));if(pa(e)){if(da(r))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}if(pa(o)){if(da(a))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function zs(e,t,n){var i;const{mark:o,encoding:r,params:a,projection:s,...c}=e,l=br(o)?o:{type:o};a&&ji(Jn(t));const{orient:u,inputType:d}=_s(e,t),{continuousAxisChannelDef:f,continuousAxisChannelDef2:p,continuousAxisChannelDefError:m,continuousAxisChannelDefError2:g,continuousAxis:h}=hs(e,u,t),{errorBarSpecificAggregate:v,postAggregateCalculates:y,tooltipSummary:b,tooltipTitleWithFieldName:x}=function(e,t,n,i,o,r,a,s){let c=[],l=[];const u=t.field;let d,f=!1;if("raw"===r){const t=e.center?e.center:e.extent?"iqr"===e.extent?"median":"mean":s.errorbar.center,n=e.extent?e.extent:"mean"===t?"stderr":"iqr";if("median"===t!=("iqr"===n)&&ji(function(e,t,n){return"".concat(e," is not usually used with ").concat(t," for ").concat(n,".")}(t,n,a)),"stderr"===n||"stdev"===n)c=[{op:n,field:u,as:"extent_".concat(u)},{op:t,field:u,as:"center_".concat(u)}],l=[{calculate:'datum["center_'.concat(u,'"] + datum["extent_').concat(u,'"]'),as:"upper_".concat(u)},{calculate:'datum["center_'.concat(u,'"] - datum["extent_').concat(u,'"]'),as:"lower_".concat(u)}],d=[{fieldPrefix:"center_",titlePrefix:T(t)},{fieldPrefix:"upper_",titlePrefix:Cs(t,n,"+")},{fieldPrefix:"lower_",titlePrefix:Cs(t,n,"-")}],f=!0;else{let e,t,i;"ci"===n?(e="mean",t="ci0",i="ci1"):(e="median",t="q1",i="q3"),c=[{op:t,field:u,as:"lower_".concat(u)},{op:i,field:u,as:"upper_".concat(u)},{op:e,field:u,as:"center_".concat(u)}],d=[{fieldPrefix:"upper_",titlePrefix:Ca({field:u,aggregate:i,type:"quantitative"},s,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:Ca({field:u,aggregate:t,type:"quantitative"},s,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:Ca({field:u,aggregate:e,type:"quantitative"},s,{allowDisabling:!1})}]}}else{(e.center||e.extent)&&ji((p=e.center,m=e.extent,"".concat(m?"extent ":"").concat(m&&p?"and ":"").concat(p?"center ":"").concat(m&&p?"are ":"is ","not needed when data are aggregated."))),"aggregated-upper-lower"===r?(d=[],l=[{calculate:'datum["'.concat(n.field,'"]'),as:"upper_".concat(u)},{calculate:'datum["'.concat(u,'"]'),as:"lower_".concat(u)}]):"aggregated-error"===r&&(d=[{fieldPrefix:"",titlePrefix:u}],l=[{calculate:'datum["'.concat(u,'"] + datum["').concat(i.field,'"]'),as:"upper_".concat(u)}],o?l.push({calculate:'datum["'.concat(u,'"] + datum["').concat(o.field,'"]'),as:"lower_".concat(u)}):l.push({calculate:'datum["'.concat(u,'"] - datum["').concat(i.field,'"]'),as:"lower_".concat(u)}));for(const e of l)d.push({fieldPrefix:e.as.substring(0,6),titlePrefix:U(U(e.calculate,'datum["',""),'"]',"")})}var p,m;return{postAggregateCalculates:l,errorBarSpecificAggregate:c,tooltipSummary:d,tooltipTitleWithFieldName:f}}(l,f,p,m,g,d,t,n),{[h]:w,["x"===h?"x2":"y2"]:k,["x"===h?"xError":"yError"]:S,["x"===h?"xError2":"yError2"]:D,...F}=r,{bins:O,timeUnits:_,aggregate:z,groupby:C,encoding:P}=as(F,n),A=[...z,...v],N="raw"!==d?[]:C,j=fs(b,f,P,x);return{transform:[...null!==(i=c.transform)&&void 0!==i?i:[],...O,..._,...0===A.length?[]:[{aggregate:A,groupby:N}],...y],groupby:N,continuousAxisChannelDef:f,continuousAxis:h,encodingWithoutContinuousAxis:P,ticksOrient:"vertical"===u?"horizontal":"vertical",markDef:l,outerSpec:c,tooltipEncoding:j}}function Cs(e,t,n){return"".concat(T(e)," ").concat(n," ").concat(t)}const Ps="errorband",As=new ts(Ps,Ns);function Ns(e,t){let{config:n}=t;e={...e,encoding:cs(e.encoding,n)};const{transform:i,continuousAxisChannelDef:o,continuousAxis:r,encodingWithoutContinuousAxis:a,markDef:s,outerSpec:c,tooltipEncoding:l}=zs(e,Ps,n),u=s,d=ms(u,r,o,a,n.errorband),f=void 0!==e.encoding.x&&void 0!==e.encoding.y;let p={type:f?"area":"rect"},m={type:f?"line":"rule"};const g={...u.interpolate?{interpolate:u.interpolate}:{},...u.tension&&u.interpolate?{tension:u.tension}:{}};return f?(p={...p,...g,ariaRoleDescription:"errorband"},m={...m,...g,aria:!1}):u.interpolate?ji(Oi("interpolate")):u.tension&&ji(Oi("tension")),{...c,transform:i,layer:[...d({partName:"band",mark:p,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l}),...d({partName:"borders",mark:m,positionPrefix:"lower",extraEncoding:l}),...d({partName:"borders",mark:m,positionPrefix:"upper",extraEncoding:l})]}}const js={};function Es(e,t,n){const i=new ts(e,t);js[e]={normalizer:i,parts:n}}Es(bs,ks,["box","median","outliers","rule","ticks"]),Es(Ds,Os,["ticks","rule"]),Es(Ps,Ns,["band","borders"]);const Ms=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],Ts={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},Ls={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},qs=C(Ts),Ws=C(Ls),Rs=C({header:1,headerRow:1,headerColumn:1,headerFacet:1}),Us=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],Bs="_vgsid_",Hs={point:{on:"click",fields:[Bs],toggle:"event.shiftKey",resolve:"global",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function Vs(e){return!(!e||"legend"!==e&&!e.legend)}function Is(e){return Vs(e)&&t.isObject(e)}function Gs(e){return!!e.select}function Ys(e){const t=[];for(const n of e||[]){if(Gs(n))continue;const{expr:e,bind:i,...o}=n;if(i&&e){const n={...o,bind:i,init:e};t.push(n)}else{const n={...o,...e?{update:e}:{},...i?{bind:i}:{}};t.push(n)}}return t}function Xs(e){return"concat"in e}function Js(e){return"vconcat"in e}function Qs(e){return"hconcat"in e}const $s=["background","padding"];function Ks(e,t){const n={};for(const t of $s)e&&void 0!==e[t]&&(n[t]=kn(e[t]));return t&&(n.params=e.params),n}function Zs(e){let{step:t,offsetIsDiscrete:n}=e;var i;return n?null!==(i=t.for)&&void 0!==i?i:"offset":"position"}function ec(e){return t.isObject(e)&&void 0!==e.step}function tc(e){return e.view||e.width||e.height}const nc=C({align:1,bounds:1,center:1,columns:1,spacing:1});function ic(e,t){var n;return null!==(n=e[t])&&void 0!==n?n:e["width"===t?"continuousWidth":"continuousHeight"]}function oc(e,t){const n=rc(e,t);return ec(n)?n.step:ac}function rc(e,t){var n;return V(null!==(n=e[t])&&void 0!==n?n:e["width"===t?"discreteWidth":"discreteHeight"],{step:e.step})}const ac=20,sc={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:{continuousWidth:200,continuousHeight:200,step:ac},mark:{color:"#4c78a8",invalid:"filter",timeUnitBandSize:1},arc:{},area:{},bar:Fr,circle:{},geoshape:{},image:{},line:{},point:{},rect:Or,rule:{color:"black"},square:{},text:{color:"black"},tick:{thickness:1},trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:{pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,bandWithNestedOffsetPaddingInner:.2,bandWithNestedOffsetPaddingOuter:.2,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4},projection:{},legend:{gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:Hs,style:{},title:{},facet:{spacing:20},concat:{spacing:20}},cc=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],lc={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},uc={blue:cc[0],orange:cc[1],red:cc[2],teal:cc[3],green:cc[4],yellow:cc[5],purple:cc[6],pink:cc[7],brown:cc[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function dc(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{signals:[{name:"color",value:t.isObject(e)?{...uc,...e}:uc}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}function fc(e){return{signals:[{name:"fontSize",value:t.isObject(e)?{...lc,...e}:lc}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}function pc(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}function mc(e){const t=C(e||{}),n={};for(const i of t){const t=e[i];n[i]=Ya(t)?wn(t):kn(t)}return n}function gc(e){const t=C(e),n={};for(const i of t)n[i]=mc(e[i]);return n}const hc=[...kr,...Za,...Rs,"background","padding","legend","lineBreak","scale","style","title","view"];function vc(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{color:n,font:i,fontSize:o,selection:r,...a}=e,s=t.mergeConfig({},d(sc),i?pc(i):{},n?dc(n):{},o?fc(o):{},a||{});r&&t.writeConfig(s,"selection",r,!0);const c=m(s,hc);for(const e of["background","lineBreak","padding"])s[e]&&(c[e]=kn(s[e]));for(const e of kr)s[e]&&(c[e]=fn(s[e]));for(const e of Za)s[e]&&(c[e]=mc(s[e]));for(const e of Rs)s[e]&&(c[e]=fn(s[e]));return s.legend&&(c.legend=fn(s.legend)),s.scale&&(c.scale=fn(s.scale)),s.style&&(c.style=gc(s.style)),s.title&&(c.title=fn(s.title)),s.view&&(c.view=fn(s.view)),c}const yc=new Set(["view",...yr]),bc=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],xc={view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"],area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]};function wc(e){e=d(e);for(const t of bc)delete e[t];if(e.axis)for(const t in e.axis)Ya(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of Ms)delete e.legend[t];if(e.mark){for(const t of wr)delete e.mark[t];e.mark.tooltip&&t.isObject(e.mark.tooltip)&&delete e.mark.tooltip}e.params&&(e.signals=(e.signals||[]).concat(Ys(e.params)),delete e.params);for(const t of yc){for(const n of wr)delete e[t][n];const n=xc[t];if(n)for(const i of n)delete e[t][i];kc(e,t)}for(const t of C(js))delete e[t];!function(e){const{titleMarkConfig:t,subtitleMarkConfig:n,subtitle:i}=pn(e.title);z(t)||(e.style["group-title"]={...e.style["group-title"],...t});z(n)||(e.style["group-subtitle"]={...e.style["group-subtitle"],...n});z(i)?delete e.title:e.title=i}(e);for(const n in e)t.isObject(e[n])&&z(e[n])&&delete e[n];return z(e)?void 0:e}function kc(e,t,n,i){var o;"view"===t&&(n="cell");const r={...i?e[t][i]:e[t],...e.style[null!==(o=n)&&void 0!==o?o:t]};var a;z(r)||(e.style[null!==(a=n)&&void 0!==a?a:t]=r);i||delete e[t]}function Sc(e){return"layer"in e}class Dc{map(e,t){return Zr(e)?this.mapFacet(e,t):function(e){return"repeat"in e}(e)?this.mapRepeat(e,t):Qs(e)?this.mapHConcat(e,t):Js(e)?this.mapVConcat(e,t):Xs(e)?this.mapConcat(e,t):this.mapLayerOrUnit(e,t)}mapLayerOrUnit(e,t){if(Sc(e))return this.mapLayer(e,t);if(es(e))return this.mapUnit(e,t);throw new Error(Un(e))}mapLayer(e,t){return{...e,layer:e.layer.map((e=>this.mapLayerOrUnit(e,t)))}}mapHConcat(e,t){return{...e,hconcat:e.hconcat.map((e=>this.map(e,t)))}}mapVConcat(e,t){return{...e,vconcat:e.vconcat.map((e=>this.map(e,t)))}}mapConcat(e,t){const{concat:n,...i}=e;return{...i,concat:n.map((e=>this.map(e,t)))}}mapFacet(e,t){return{...e,spec:this.map(e.spec,t)}}mapRepeat(e,t){return{...e,spec:this.map(e.spec,t)}}}const Fc={zero:1,center:1,normalize:1};function Oc(e){return e in Fc}const _c=new Set([nr,or,ir,lr,sr,pr,mr,ar,ur,dr]),zc=new Set([or,ir,nr]);function Cc(e){return ca(e)&&"quantitative"===la(e)&&!e.bin}function Pc(e,t){const n="x"===t?"y":"radius",i=e[t],o=e[n];if(ca(i)&&ca(o))if(Cc(i)&&Cc(o)){if(i.stack)return t;if(o.stack)return n;const e=ca(i)&&!!i.aggregate;if(e!==(ca(o)&&!!o.aggregate))return e?t:n;{var r,a;const e=null===(r=i.scale)||void 0===r?void 0:r.type,s=null===(a=o.scale)||void 0===a?void 0:a.type;if(e&&"linear"!==e)return n;if(s&&"linear"!==s)return t}}else{if(Cc(i))return t;if(Cc(o))return n}else{if(Cc(i))return t;if(Cc(o))return n}}function Ac(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}function Nc(e,n){var i,o;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=br(e)?e.type:e;if(!_c.has(a))return null;const s=Pc(n,"x")||Pc(n,"theta");if(!s)return null;const c=n[s],l=ca(c)?ka(c,{}):void 0,u=Ac(s),d=[],f=new Set;if(n[u]){const e=n[u],t=ca(e)?ka(e,{}):void 0;t&&t!==l&&(d.push(u),f.add(t));const i="x"===u?"xOffset":"yOffset",o=n[i],r=ca(o)?ka(o,{}):void 0;r&&r!==l&&(d.push(i),f.add(r))}const p=kt.reduce(((e,i)=>{if("tooltip"!==i&&ns(n,i)){const o=n[i];for(const n of t.array(o)){const t=Ea(n);if(t.aggregate)continue;const o=ka(t,{});o&&f.has(o)||e.push({channel:i,fieldDef:t})}}return e}),[]);let m;if(void 0!==c.stack?m=t.isBoolean(c.stack)?c.stack?"zero":null:c.stack:zc.has(a)&&(m="zero"),!m||!Oc(m))return null;if(rs(n)&&0===p.length)return null;if(null!=c&&null!==(i=c.scale)&&void 0!==i&&i.type&&(null==c||null===(o=c.scale)||void 0===o?void 0:o.type)!==ko){if(r.disallowNonLinearStack)return null;ji(Si(c.scale.type))}return pa(n[nt(s)])?(void 0!==c.stack&&ji(ki(s)),null):(ca(c)&&c.aggregate&&!nn.has(c.aggregate)&&ji(Di(c.aggregate)),{groupbyChannels:d,groupbyFields:f,fieldChannel:s,impute:null!==c.impute&&hr(a),stackBy:p,offset:m})}function jc(e){const{point:t,line:n,...i}=e;return C(i).length>1?i:i.type}function Ec(e){for(const t of["line","area","rule","trail"])e[t]&&(e={...e,[t]:m(e[t],["point","line"])});return e}function Mc(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;return"transparent"===e.point?{opacity:0}:e.point?t.isObject(e.point)?e.point:{}:void 0!==e.point?null:n.point||i.shape?t.isObject(n.point)?n.point:{}:void 0}function Tc(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.line?!0===e.line?{}:e.line:void 0!==e.line?null:t.line?!0===t.line?{}:t.line:void 0}class Lc{constructor(){Ln(this,"name","path-overlay")}hasMatchingType(e,t){if(es(e)){const{mark:n,encoding:i}=e,o=br(n)?n:{type:n};switch(o.type){case"line":case"rule":case"trail":return!!Mc(o,t[o.type],i);case"area":return!!Mc(o,t[o.type],i)||!!Tc(o,t[o.type])}}return!1}run(e,t,n){const{config:i}=t,{params:o,projection:r,mark:a,encoding:s,...c}=e,l=cs(s,i),u=br(a)?a:{type:a},d=Mc(u,i[u.type],l),f="area"===u.type&&Tc(u,i[u.type]),g=[{...o?{params:o}:{},mark:jc({..."area"===u.type&&void 0===u.opacity&&void 0===u.fillOpacity?{opacity:.7}:{},...u}),encoding:m(l,["shape"])}],h=Nc(u,l);let v=l;if(h){const{fieldChannel:e,offset:t}=h;v={...l,[e]:{...l[e],...t?{stack:t}:{}}}}return f&&g.push({...r?{projection:r}:{},mark:{type:"line",...p(u,["clip","interpolate","tension","tooltip"]),...f},encoding:v}),d&&g.push({...r?{projection:r}:{},mark:{type:"point",opacity:1,filled:!0,...p(u,["clip","tooltip"]),...d},encoding:v}),n({...c,layer:g},{...t,config:Ec(i)})}}function qc(e,t){return t?$r(e)?Vc(e,t):Uc(e,t):e}function Wc(e,t){return t?Vc(e,t):e}function Rc(e,n,i){const o=n[e];return(r=o)&&!t.isString(r)&&"repeat"in r?o.repeat in i?{...n,[e]:i[o.repeat]}:void ji(function(e){return'Unknown repeated value "'.concat(e,'".')}(o.repeat)):n;var r}function Uc(e,t){if(void 0!==(e=Rc("field",e,t))){if(null===e)return null;if(ta(e)&&Jr(e.sort)){const n=Rc("field",e.sort,t);e={...e,...n?{sort:n}:{}}}return e}}function Bc(e,t){if(ca(e))return Uc(e,t);{const n=Rc("datum",e,t);return n===e||n.type||(n.type="nominal"),n}}function Hc(e,t){if(!pa(e)){if(sa(e)){const n=Bc(e.condition,t);if(n)return{...e,condition:n};{const{condition:t,...n}=e;return n}}return e}{const n=Bc(e,t);if(n)return n;if(ra(e))return{condition:e.condition}}}function Vc(e,n){const i={};for(const o in e)if(t.hasOwnProperty(e,o)){const r=e[o];if(t.isArray(r))i[o]=r.map((e=>Hc(e,n))).filter((e=>e));else{const e=Hc(r,n);void 0!==e&&(i[o]=e)}}return i}class Ic{constructor(){Ln(this,"name","RuleForRangedLine")}hasMatchingType(e){if(es(e)){const{encoding:t,mark:n}=e;if("line"===n||br(n)&&"line"===n.type)for(const e of Ke){const n=t[et(e)];if(t[e]&&(ca(n)&&!sn(n.bin)||ua(n)))return!0}}return!1}run(e,n,i){const{encoding:o,mark:r}=e;var a,s;return ji((a=!!o.x2,s=!!o.y2,"Line mark is for continuous lines and thus cannot be used with ".concat(a&&s?"x2 and y2":a?"x2":"y2",". We will use the rule mark (line segments) instead."))),i({...e,mark:t.isObject(r)?{...r,type:"rule"}:"rule"},n)}}function Gc(e){let{parentEncoding:n,encoding:i={},layer:o}=e,r={};if(n){const e=new Set([...C(n),...C(i)]);for(const a of e){const e=i[a],s=n[a];if(pa(e)){const t={...s,...e};r[a]=t}else sa(e)?r[a]={...e,condition:{...s,...e.condition}}:e||null===e?r[a]=e:(o||ga(s)||gn(s)||pa(s)||t.isArray(s))&&(r[a]=s)}}else r=i;return!r||z(r)?void 0:r}function Yc(e){const{parentProjection:t,projection:n}=e;return t&&n&&ji(function(e){const{parentProjection:t,projection:n}=e;return"Layer's shared projection ".concat(g(t)," is overridden by a child projection ").concat(g(n),".")}({parentProjection:t,projection:n})),null!=n?n:t}function Xc(e){return"filter"in e}function Jc(e){return"lookup"in e}function Qc(e){return"pivot"in e}function $c(e){return"density"in e}function Kc(e){return"quantile"in e}function Zc(e){return"regression"in e}function el(e){return"loess"in e}function tl(e){return"sample"in e}function nl(e){return"window"in e}function il(e){return"joinaggregate"in e}function ol(e){return"flatten"in e}function rl(e){return"calculate"in e}function al(e){return"bin"in e}function sl(e){return"impute"in e}function cl(e){return"timeUnit"in e}function ll(e){return"aggregate"in e}function ul(e){return"stack"in e}function dl(e){return"fold"in e}function fl(e,t){const{transform:n,...i}=e;if(n){return{...i,transform:n.map((e=>{if(Xc(e))return{filter:gl(e,t)};if(al(e)&&cn(e.bin))return{...e,bin:ml(e.bin)};if(Jc(e)){const{selection:t,...n}=e.from;return t?{...e,from:{param:t,...n}}:e}return e}))}}return e}function pl(e,n){var i,o;const r=d(e);if(ca(r)&&cn(r.bin)&&(r.bin=ml(r.bin)),ha(r)&&null!==(i=r.scale)&&void 0!==i&&null!==(o=i.domain)&&void 0!==o&&o.selection){const{selection:e,...t}=r.scale.domain;r.scale.domain={...t,...e?{param:e}:{}}}if(ra(r))if(t.isArray(r.condition))r.condition=r.condition.map((e=>{const{selection:t,param:i,test:o,...r}=e;return i?e:{...r,test:gl(e,n)}}));else{const{selection:e,param:t,test:i,...o}=pl(r.condition,n);r.condition=t?r.condition:{...o,test:gl(r.condition,n)}}return r}function ml(e){const t=e.extent;if(null!=t&&t.selection){const{selection:n,...i}=t;return{...e,extent:{...i,param:n}}}return e}function gl(e,t){const n=e=>l(e,(e=>{var n,i,o;const r={param:e,empty:null===(n=t.emptySelections[e])||void 0===n||n};return null!==(o=(i=t.selectionPredicates)[e])&&void 0!==o||(i[e]=[]),t.selectionPredicates[e].push(r),r}));return e.selection?n(e.selection):l(e.test||e.filter,(e=>e.selection?n(e.selection):e))}class hl extends Dc{map(e,t){var n;const i=null!==(n=t.selections)&&void 0!==n?n:[];if(e.params&&!es(e)){const t=[];for(const n of e.params)Gs(n)?i.push(n):t.push(n);e.params=t}return t.selections=i,super.map(e,vl(e,t))}mapUnit(e,n){var i;const o=n.selections;if(!o||!o.length)return e;const r=(null!==(i=n.path)&&void 0!==i?i:[]).concat(e.name),a=[];for(const n of o)if(n.views&&n.views.length)for(const i of n.views)(t.isString(i)&&(i===e.name||r.indexOf(i)>=0)||t.isArray(i)&&i.map((e=>r.indexOf(e))).every(((e,t,n)=>-1!==e&&(0===t||e>n[t-1]))))&&a.push(n);else a.push(n);return a.length&&(e.params=a),e}}for(const e of["mapFacet","mapRepeat","mapHConcat","mapVConcat","mapLayer"]){const t=hl.prototype[e];hl.prototype[e]=function(e,n){return t.call(this,e,vl(e,n))}}function vl(e,t){var n;return e.name?{...t,path:(null!==(n=t.path)&&void 0!==n?n:[]).concat(e.name)}:t}function yl(e,t){void 0===t&&(t=vc(e.config));const n=function(e){const t={config:arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}};return wl.map(bl.map(xl.map(e,t),t),t)}(e,t),{width:i,height:o}=e,r=function(e,t,n){let{width:i,height:o}=t;const r=es(e)||Sc(e),a={};r?"container"==i&&"container"==o?(a.type="fit",a.contains="padding"):"container"==i?(a.type="fit-x",a.contains="padding"):"container"==o&&(a.type="fit-y",a.contains="padding"):("container"==i&&(ji(Hn("width")),i=void 0),"container"==o&&(ji(Hn("height")),o=void 0));const s={type:"pad",...a,...n?kl(n.autosize):{},...kl(e.autosize)};"fit"!==s.type||r||(ji(Bn),s.type="pad");"container"==i&&"fit"!=s.type&&"fit-x"!=s.type&&ji(Vn("width"));"container"==o&&"fit"!=s.type&&"fit-y"!=s.type&&ji(Vn("height"));if(u(s,{type:"pad"}))return;return s}(n,{width:i,height:o,autosize:e.autosize},t);return{...n,...r?{autosize:r}:{}}}const bl=new class extends Dc{constructor(){super(...arguments),Ln(this,"nonFacetUnitNormalizers",[xs,Fs,As,new Lc,new Ic])}map(e,t){if(es(e)){const n=ns(e.encoding,$),i=ns(e.encoding,K),o=ns(e.encoding,Z);if(n||i||o)return this.mapFacetedUnit(e,t)}return super.map(e,t)}mapUnit(e,t){const{parentEncoding:n,parentProjection:i}=t,o=Wc(e.encoding,t.repeater),r={...e,...o?{encoding:o}:{}};if(n||i)return this.mapUnitWithParentEncodingOrProjection(r,t);const a=this.mapLayerOrUnit.bind(this);for(const e of this.nonFacetUnitNormalizers)if(e.hasMatchingType(r,t.config))return e.run(r,t,a);return r}mapRepeat(e,n){return function(e){return!t.isArray(e.repeat)&&e.repeat.layer}(e)?this.mapLayerRepeat(e,n):this.mapNonLayerRepeat(e,n)}mapLayerRepeat(e,t){const{repeat:n,spec:i,...o}=e,{row:r,column:a,layer:s}=n,{repeater:c={},repeaterPrefix:l=""}=t;return r||a?this.mapRepeat({...e,repeat:{...r?{row:r}:{},...a?{column:a}:{}},spec:{repeat:{layer:s},spec:i}},t):{...o,layer:s.map((e=>{const n={...c,layer:e},o="".concat((i.name||"")+l,"child__layer_").concat(j(e)),r=this.mapLayerOrUnit(i,{...t,repeater:n,repeaterPrefix:o});return r.name=o,r}))}}mapNonLayerRepeat(e,n){var i;const{repeat:o,spec:r,data:a,...s}=e;!t.isArray(o)&&e.columns&&(e=m(e,["columns"]),ji($n("repeat")));const c=[],{repeater:l={},repeaterPrefix:u=""}=n,d=!t.isArray(o)&&o.row||[l?l.row:null],f=!t.isArray(o)&&o.column||[l?l.column:null],p=t.isArray(o)&&o||[l?l.repeat:null];for(const e of p)for(const i of d)for(const a of f){const s={repeat:e,row:i,column:a,layer:l.layer},d=(r.name||"")+u+"child__"+(t.isArray(o)?"".concat(j(e)):(o.row?"row_".concat(j(i)):"")+(o.column?"column_".concat(j(a)):"")),f=this.map(r,{...n,repeater:s,repeaterPrefix:d});f.name=d,c.push(m(f,["data"]))}const g=t.isArray(o)?e.columns:o.column?o.column.length:1;return{data:null!==(i=r.data)&&void 0!==i?i:a,align:"all",...s,columns:g,concat:c}}mapFacet(e,t){const{facet:n}=e;return $r(n)&&e.columns&&(e=m(e,["columns"]),ji($n("facet"))),super.mapFacet(e,t)}mapUnitWithParentEncodingOrProjection(e,t){const{encoding:n,projection:i}=e,{parentEncoding:o,parentProjection:r,config:a}=t,s=Yc({parentProjection:r,projection:i}),c=Gc({parentEncoding:o,encoding:Wc(n,t.repeater)});return this.mapUnit({...e,...s?{projection:s}:{},...c?{encoding:c}:{}},{config:a})}mapFacetedUnit(e,t){const{row:n,column:i,facet:o,...r}=e.encoding,{mark:a,width:s,projection:c,height:l,view:u,params:d,encoding:f,...p}=e,{facetMapping:m,layout:g}=this.getFacetMappingAndLayout({row:n,column:i,facet:o},t),h=Wc(r,t.repeater);return this.mapFacet({...p,...g,facet:m,spec:{...s?{width:s}:{},...l?{height:l}:{},...u?{view:u}:{},...c?{projection:c}:{},mark:a,encoding:h,...d?{params:d}:{}}},t)}getFacetMappingAndLayout(e,t){const{row:n,column:i,facet:o}=e;if(n||i){o&&ji((a=[...n?[$]:[],...i?[K]:[]],"Facet encoding dropped as ".concat(a.join(" and ")," ").concat(a.length>1?"are":"is"," also specified.")));const t={},s={};for(const n of[$,K]){const i=e[n];if(i){const{align:e,center:o,spacing:a,columns:c,...l}=i;t[n]=l;for(const e of["align","center","spacing"]){var r;if(void 0!==i[e])null!==(r=s[e])&&void 0!==r||(s[e]={}),s[e][n]=i[e]}}}return{facetMapping:t,layout:s}}{const{align:e,center:n,spacing:i,columns:r,...a}=o;return{facetMapping:qc(a,t.repeater),layout:{...e?{align:e}:{},...n?{center:n}:{},...i?{spacing:i}:{},...r?{columns:r}:{}}}}var a}mapLayer(e,t){let{parentEncoding:n,parentProjection:i,...o}=t;const{encoding:r,projection:a,...s}=e,c={...o,parentEncoding:Gc({parentEncoding:n,encoding:r,layer:!0}),parentProjection:Yc({parentProjection:i,projection:a})};return super.mapLayer(s,c)}},xl=new class extends Dc{map(e,t){var n,i;return null!==(n=t.emptySelections)&&void 0!==n||(t.emptySelections={}),null!==(i=t.selectionPredicates)&&void 0!==i||(t.selectionPredicates={}),e=fl(e,t),super.map(e,t)}mapLayerOrUnit(e,t){if((e=fl(e,t)).encoding){const n={};for(const[i,o]of A(e.encoding))n[i]=pl(o,t);e={...e,encoding:n}}return super.mapLayerOrUnit(e,t)}mapUnit(e,t){const{selection:n,...i}=e;return n?{...i,params:A(n).map((e=>{let[n,i]=e;const{init:o,bind:r,empty:a,...s}=i;"single"===s.type?(s.type="point",s.toggle=!1):"multi"===s.type&&(s.type="point"),t.emptySelections[n]="none"!==a;for(const e of P(null!==(c=t.selectionPredicates[n])&&void 0!==c?c:{})){var c;e.empty="none"!==a}return{name:n,value:o,select:s,bind:r}}))}:e}},wl=new hl;function kl(e){return t.isString(e)?{type:e}:null!=e?e:{}}class Sl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.explicit=e,this.implicit=t}clone(){return new Sl(d(this.explicit),d(this.implicit))}combine(){return{...this.explicit,...this.implicit}}get(e){return V(this.explicit[e],this.implicit[e])}getWithExplicit(e){return void 0!==this.explicit[e]?{explicit:!0,value:this.explicit[e]}:void 0!==this.implicit[e]?{explicit:!1,value:this.implicit[e]}:{explicit:!1,value:void 0}}setWithExplicit(e,t){let{value:n,explicit:i}=t;void 0!==n&&this.set(e,n,i)}set(e,t,n){return delete this[n?"implicit":"explicit"][e],this[n?"explicit":"implicit"][e]=t,this}copyKeyFromSplit(e,t){let{explicit:n,implicit:i}=t;void 0!==n[e]?this.set(e,n[e],!0):void 0!==i[e]&&this.set(e,i[e],!1)}copyKeyFromObject(e,t){void 0!==t[e]&&this.set(e,t[e],!0)}copyAll(e){for(const t of C(e.combine())){const n=e.getWithExplicit(t);this.setWithExplicit(t,n)}}}function Dl(e){return{explicit:!0,value:e}}function Fl(e){return{explicit:!1,value:e}}function Ol(e){return(t,n,i,o)=>{const r=e(t.value,n.value);return r>0?t:r<0?n:_l(t,n,i,o)}}function _l(e,t,n,i){return e.explicit&&t.explicit&&ji(function(e,t,n,i){return"Conflicting ".concat(t.toString(),' property "').concat(e.toString(),'" (').concat(g(n)," and ").concat(g(i),"). Using ").concat(g(n),".")}(n,i,e.value,t.value)),e}function zl(e,t,n,i){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:_l;return void 0===e||void 0===e.value?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:u(e.value,t.value)?e:o(e,t,n,i)}class Cl extends Sl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(e,t),this.explicit=e,this.implicit=t,this.parseNothing=n}clone(){const e=super.clone();return e.parseNothing=this.parseNothing,e}}function Pl(e){return"url"in e}function Al(e){return"values"in e}function Nl(e){return"name"in e&&!Pl(e)&&!Al(e)&&!jl(e)}function jl(e){return e&&(El(e)||Ml(e)||Tl(e))}function El(e){return"sequence"in e}function Ml(e){return"sphere"in e}function Tl(e){return"graticule"in e}let Ll;function ql(e){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.identity;if(t.isArray(e)){const t=e.map((e=>ql(e,n,i)));return n?"[".concat(t.join(", "),"]"):t}return Ei(e)?i(n?Ri(e):Bi(e)):n?i(g(e)):e}function Wl(e,n){for(const o of P(null!==(i=e.component.selection)&&void 0!==i?i:{})){var i;const r=o.name;let a="".concat(r).concat(Qu,", ").concat("global"===o.resolve?"true":"{unit: ".concat(td(e),"}"));for(const t of Zu)t.defined(o)&&(t.signals&&(n=t.signals(e,o,n)),t.modifyExpr&&(a=t.modifyExpr(e,o,a)));n.push({name:r+$u,on:[{events:{signal:o.name+Qu},update:"modify(".concat(t.stringValue(o.name+Ju),", ").concat(a,")")}]})}return Bl(n)}function Rl(e,n){if(e.component.selection&&C(e.component.selection).length){const i=t.stringValue(e.getName("cell"));n.unshift({name:"facet",value:{},on:[{events:t.parseSelector("mousemove","scope"),update:"isTuple(facet) ? facet : group(".concat(i,").datum")}]})}return Bl(n)}function Ul(e,t){for(const i of P(null!==(n=e.component.selection)&&void 0!==n?n:{})){var n;for(const n of Zu)n.defined(i)&&n.marks&&(t=n.marks(e,i,t))}return t}function Bl(e){return e.map((e=>(e.on&&!e.on.length&&delete e.on,e)))}!function(e){e[e.Raw=0]="Raw",e[e.Main=1]="Main",e[e.Row=2]="Row",e[e.Column=3]="Column",e[e.Lookup=4]="Lookup"}(Ll||(Ll={}));class Hl{constructor(e,t){this.debugName=t,Ln(this,"_children",[]),Ln(this,"_parent",null),Ln(this,"_hash",void 0),e&&(this.parent=e)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(e){this._parent=e,e&&e.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(e,t){this._children.includes(e)?ji("Attempt to add the same child twice."):void 0!==t?this._children.splice(t,0,e):this._children.push(e)}removeChild(e){const t=this._children.indexOf(e);return this._children.splice(t,1),t}remove(){let e=this._parent.removeChild(this);for(const t of this._children)t._parent=this._parent,this._parent.addChild(t,e++)}insertAsParentOf(e){const t=e.parent;t.removeChild(this),this.parent=t,e.parent=this}swapWithParent(){const e=this._parent,t=e.parent;for(const t of this._children)t.parent=e;this._children=[],e.removeChild(this),e.parent.removeChild(e),this.parent=t,e.parent=this}}class Vl extends Hl{clone(){const e=new this.constructor;return e.debugName="clone_".concat(this.debugName),e._source=this._source,e._name="clone_".concat(this._name),e.type=this.type,e.refCounts=this.refCounts,e.refCounts[e._name]=0,e}constructor(e,t,n,i){super(e,t),this.type=n,this.refCounts=i,Ln(this,"_source",void 0),Ln(this,"_name",void 0),this._source=this._name=t,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}dependentFields(){return new Set}producedFields(){return new Set}hash(){return void 0===this._hash&&(this._hash="Output ".concat(G())),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(e){this._source=e}}class Il extends Hl{clone(){return new Il(null,d(this.formula))}constructor(e,t){super(e),this.formula=t}static makeFromEncoding(e,t){const n=t.reduceFieldDef(((e,t)=>{const{field:n,timeUnit:i}=t;if(i){const o=ka(t,{forAs:!0});e[h({as:o,field:n,timeUnit:i})]={as:o,field:n,timeUnit:i}}return e}),{});return z(n)?null:new Il(e,n)}static makeFromTransform(e,t){const{timeUnit:n,...i}={...t},o={...i,timeUnit:$i(n)};return new Il(e,{[h(o)]:o})}merge(e){this.formula={...this.formula};for(const t in e.formula)this.formula[t]||(this.formula[t]=e.formula[t]);for(const t of e.children)e.removeChild(t),t.parent=this;e.remove()}removeFormulas(e){const t={};for(const[n,i]of A(this.formula))e.has(i.as)||(t[n]=i);this.formula=t}producedFields(){return new Set(P(this.formula).map((e=>e.as)))}dependentFields(){return new Set(P(this.formula).map((e=>e.field)))}hash(){return"TimeUnit ".concat(h(this.formula))}assemble(){const e=[];for(const t of P(this.formula)){const{field:n,as:i,timeUnit:o}=t,{unit:r,utc:a,...s}=$i(o);e.push({field:R(n),type:"timeunit",...r?{units:Yi(r)}:{},...a?{timezone:"utc"}:{},...s,as:[i,"".concat(i,"_end")]})}return e}}const Gl="_tuple_fields";class Yl{constructor(){Ln(this,"hasChannel",void 0),Ln(this,"hasField",void 0),Ln(this,"timeUnit",void 0),Ln(this,"items",void 0);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.items=t,this.hasChannel={},this.hasField={}}}const Xl={defined:()=>!0,parse:(e,n,i)=>{var o;const r=n.name,a=null!==(o=n.project)&&void 0!==o?o:n.project=new Yl,s={},c={},l=new Set,u=(e,t)=>{const n="visual"===t?e.channel:e.field;let i=j("".concat(r,"_").concat(n));for(let e=1;l.has(i);e++)i=j("".concat(r,"_").concat(n,"_").concat(e));return l.add(i),{[t]:i}},d=n.type,f=e.config.selection[d],p=void 0!==i.value?t.array(i.value):null;let{fields:m,encodings:g}=t.isObject(i.select)?i.select:{};if(!m&&!g&&p)for(const e of p)if(t.isObject(e))for(const t of C(e))Qe[t]?(g||(g=[])).push(t):"interval"===d?(ji('Interval selections should be initialized using "x" and/or "y" keys.'),g=f.encodings):(m||(m=[])).push(t);m||g||(g=f.encodings,"fields"in f&&(m=f.fields));for(const t of null!==(v=g)&&void 0!==v?v:[]){var v;const n=e.fieldDef(t);if(n){let i=n.field;if(n.aggregate){ji(Xn(t,n.aggregate));continue}if(!i){ji(Yn(t));continue}if(n.timeUnit){i=e.vgField(t);const o={timeUnit:n.timeUnit,as:i,field:n.field};c[h(o)]=o}if(!s[i]){let o="E";if("interval"===d){Wo(e.getScaleComponent(t).get("type"))&&(o="R")}else n.bin&&(o="R-RE");const r={field:i,channel:t,type:o};r.signals={...u(r,"data"),...u(r,"visual")},a.items.push(s[i]=r),a.hasField[i]=a.hasChannel[t]=s[i]}}else ji(Yn(t))}for(const e of null!==(y=m)&&void 0!==y?y:[]){var y;if(a.hasField[e])continue;const t={type:"E",field:e};t.signals={...u(t,"data")},a.items.push(t),a.hasField[e]=t}p&&(n.init=p.map((e=>a.items.map((n=>t.isObject(e)?void 0!==e[n.channel]?e[n.channel]:e[n.field]:e))))),z(c)||(a.timeUnit=new Il(null,c))},signals:(e,t,n)=>{const i=t.name+Gl;return n.filter((e=>e.name===i)).length>0?n:n.concat({name:i,value:t.project.items.map((e=>{const{signals:t,hasLegend:n,...i}=e;return i.field=R(i.field),i}))})}},Jl={defined:e=>"interval"===e.type&&"global"===e.resolve&&e.bind&&"scales"===e.bind,parse:(e,t)=>{const n=t.scales=[];for(const i of t.project.items){const o=i.channel;if(!Ht(o))continue;const r=e.getScaleComponent(o),a=r?r.get("type"):void 0;r&&Wo(a)?(r.set("selectionExtent",{param:t.name,field:i.field},!0),n.push(i)):ji("Scale bindings are currently only supported for scales with unbinned, continuous domains.")}},topLevelSignals:(e,n,i)=>{const o=n.scales.filter((e=>0===i.filter((t=>t.name===e.signals.data)).length));if(!e.parent||$l(e)||0===o.length)return i;const r=i.filter((e=>e.name===n.name))[0];let a=r.update;if(a.indexOf(Ku)>=0)r.update="{".concat(o.map((e=>"".concat(t.stringValue(R(e.field)),": ").concat(e.signals.data))).join(", "),"}");else{for(const e of o){const n="".concat(t.stringValue(R(e.field)),": ").concat(e.signals.data);a.includes(n)||(a="".concat(a.substring(0,a.length-1),", ").concat(n,"}"))}r.update=a}return i.concat(o.map((e=>({name:e.signals.data}))))},signals:(e,t,n)=>{if(e.parent&&!$l(e))for(const e of t.scales){const t=n.filter((t=>t.name===e.signals.data))[0];t.push="outer",delete t.value,delete t.update}return n}};function Ql(e,n){const i=t.stringValue(e.scaleName(n));return"domain(".concat(i,")")}function $l(e){var t;return e.parent&&Bp(e.parent)&&(null!==(t=!e.parent.parent)&&void 0!==t?t:$l(e.parent.parent))}const Kl="_brush",Zl="_scale_trigger",eu={defined:e=>"interval"===e.type,signals:(e,n,i)=>{const o=n.name,r=o+Gl,a=Jl.defined(n),s=n.init?n.init[0]:null,c=[],l=[];if(n.translate&&!a){const e="!event.item || event.item.mark.name !== ".concat(t.stringValue(o+Kl));tu(n,((n,i)=>{var o,r;const a=t.array(null!==(r=(o=i.between[0]).filter)&&void 0!==r?r:o.filter=[]);return a.includes(e)||a.push(e),n}))}n.project.items.forEach(((o,r)=>{const a=o.channel;if(a!==ee&&a!==te)return void ji("Interval selections only support x and y encoding channels.");const u=s?s[r]:null,d=function(e,n,i,o){const r=i.channel,a=i.signals.visual,s=i.signals.data,c=Jl.defined(n),l=t.stringValue(e.scaleName(r)),u=e.getScaleComponent(r),d=u?u.get("type"):void 0,f=e=>"scale(".concat(l,", ").concat(e,")"),p=e.getSizeSignalRef(r===ee?"width":"height").signal,m="".concat(r,"(unit)"),g=tu(n,((e,t)=>[...e,{events:t.between[0],update:"[".concat(m,", ").concat(m,"]")},{events:t,update:"[".concat(a,"[0], clamp(").concat(m,", 0, ").concat(p,")]")}]));return g.push({events:{signal:n.name+Zl},update:Wo(d)?"[".concat(f("".concat(s,"[0]")),", ").concat(f("".concat(s,"[1]")),"]"):"[0, 0]"}),c?[{name:s,on:[]}]:[{name:a,...o?{init:ql(o,!0,f)}:{value:[]},on:g},{name:s,...o?{init:ql(o)}:{},on:[{events:{signal:a},update:"".concat(a,"[0] === ").concat(a,"[1] ? null : invert(").concat(l,", ").concat(a,")")}]}]}(e,n,o,u),f=o.signals.data,p=o.signals.visual,m=t.stringValue(e.scaleName(a)),g=Wo(e.getScaleComponent(a).get("type"))?"+":"";i.push(...d),c.push(f),l.push({scaleName:e.scaleName(a),expr:"(!isArray(".concat(f,") || ")+"(".concat(g,"invert(").concat(m,", ").concat(p,")[0] === ").concat(g).concat(f,"[0] && ")+"".concat(g,"invert(").concat(m,", ").concat(p,")[1] === ").concat(g).concat(f,"[1]))")})})),!a&&l.length&&i.push({name:o+Zl,value:{},on:[{events:l.map((e=>({scale:e.scaleName}))),update:"".concat(l.map((e=>e.expr)).join(" && ")," ? ").concat(o+Zl," : {}")}]});const u="unit: ".concat(td(e),", fields: ").concat(r,", values");return i.concat({name:o+Qu,...s?{init:"{".concat(u,": ").concat(ql(s),"}")}:{},...c.length?{on:[{events:[{signal:c.join(" || ")}],update:"".concat(c.join(" && ")," ? {").concat(u,": [").concat(c,"]} : null")}]}:{}})},marks:(e,n,i)=>{const o=n.name,{x:r,y:a}=n.project.hasChannel,s=null==r?void 0:r.signals.visual,c=null==a?void 0:a.signals.visual,l="data(".concat(t.stringValue(n.name+Ju),")");if(Jl.defined(n)||!r&&!a)return i;const u={x:void 0!==r?{signal:"".concat(s,"[0]")}:{value:0},y:void 0!==a?{signal:"".concat(c,"[0]")}:{value:0},x2:void 0!==r?{signal:"".concat(s,"[1]")}:{field:{group:"width"}},y2:void 0!==a?{signal:"".concat(c,"[1]")}:{field:{group:"height"}}};if("global"===n.resolve)for(const t of C(u))u[t]=[{test:"".concat(l,".length && ").concat(l,"[0].unit === ").concat(td(e)),...u[t]},{value:0}];const{fill:d,fillOpacity:f,cursor:p,...m}=n.mark,g=C(m).reduce(((e,t)=>(e[t]=[{test:[void 0!==r&&"".concat(s,"[0] !== ").concat(s,"[1]"),void 0!==a&&"".concat(c,"[0] !== ").concat(c,"[1]")].filter((e=>e)).join(" && "),value:m[t]},{value:null}],e)),{});return[{name:"".concat(o+Kl,"_bg"),type:"rect",clip:!0,encode:{enter:{fill:{value:d},fillOpacity:{value:f}},update:u}},...i,{name:o+Kl,type:"rect",clip:!0,encode:{enter:{...p?{cursor:{value:p}}:{},fill:{value:"transparent"}},update:{...u,...g}}}]}};function tu(e,t){return e.events.reduce(((e,n)=>n.between?t(e,n):(ji("".concat(n," is not an ordered event stream for interval selections.")),e)),[])}const nu={defined:e=>"point"===e.type,signals:(e,n,i)=>{var o;const r=n.name,a=r+Gl,s=n.project,c="(item().isVoronoi ? datum.datum : datum)",l=s.items.map((n=>{const i=e.fieldDef(n.channel);return null!=i&&i.bin?"[".concat(c,"[").concat(t.stringValue(e.vgField(n.channel,{})),"], ")+"".concat(c,"[").concat(t.stringValue(e.vgField(n.channel,{binSuffix:"end"})),"]]"):"".concat(c,"[").concat(t.stringValue(n.field),"]")})).join(", "),u="unit: ".concat(td(e),", fields: ").concat(a,", values"),d=n.events,f=P(null!==(o=e.component.selection)&&void 0!==o?o:{}).reduce(((e,t)=>"interval"===t.type?e.concat(t.name+Kl):e),[]).map((e=>"indexof(item().mark.name, '".concat(e,"') < 0"))).join(" && "),p="datum && item().mark.marktype !== 'group'".concat(f?" && ".concat(f):"");return i.concat([{name:r+Qu,on:d?[{events:d,update:"".concat(p," ? {").concat(u,": [").concat(l,"]} : null"),force:!0}]:[]}])}};function iu(e,n,i,o){const r=ra(n)&&n.condition,a=o(n);if(r){return{[i]:[...t.array(r).map((t=>{const n=o(t);if(function(e){return e.param}(t)){const{param:i,empty:o}=t;return{test:cd(e,{param:i,empty:o}),...n}}return{test:ud(e,t.test),...n}})),...void 0!==a?[a]:[]]}}return void 0!==a?{[i]:a}:{}}function ou(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"text";const n=e.encoding[t];return iu(e,n,t,(t=>ru(t,e.config)))}function ru(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"datum";if(e){if(ga(e))return Dn(e.value);if(pa(e)){const{format:i,formatType:o}=Na(e);return Tr({fieldOrDatumDef:e,format:i,formatType:o,expr:n,config:t})}}}function au(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{encoding:i,markDef:o,config:r,stack:a}=e,s=i.tooltip;if(t.isArray(s))return{tooltip:cu({tooltip:s},a,r,n)};{const c=n.reactiveGeom?"datum.datum":"datum";return iu(e,s,"tooltip",(e=>{const s=ru(e,r,c);if(s)return s;if(null===e)return;let l=Cn("tooltip",o,r);return!0===l&&(l={content:"encoding"}),t.isString(l)?{value:l}:t.isObject(l)?gn(l)?l:"encoding"===l.content?cu(i,a,r,n):{signal:c}:void 0}))}}function su(e,n,i){let{reactiveGeom:o}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const r={},a=o?"datum.datum":"datum",s=[];function c(o,c){var l;const u=et(c),d=ma(o)?o:{...o,type:e[u].type},f=d.title||Aa(d,i),p=t.array(f).join(", ");let m;if(Ft(c)){const t="x"===c?"x2":"y2",o=Ea(e[t]);if(sn(d.bin)&&o){const e=ka(d,{expr:a}),n=ka(o,{expr:a}),{format:s,formatType:c}=Na(d);m=Vr(e,n,s,c,i),r[t]=!0}else if(n&&n.fieldChannel===c&&"normalize"===n.offset){const{format:e,formatType:t}=Na(d);m=Tr({fieldOrDatumDef:d,format:e,formatType:t,expr:a,config:i,normalizeStack:!0}).signal}}null!==(l=m)&&void 0!==l||(m=ru(d,i,a).signal),s.push({channel:c,key:p,value:m})}us(e,((e,t)=>{ca(e)?c(e,t):aa(e)&&c(e.condition,t)}));const l={};for(const{channel:e,key:t,value:n}of s)r[e]||l[t]||(l[t]=n);return l}function cu(e,t,n){let{reactiveGeom:i}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const o=su(e,t,n,{reactiveGeom:i}),r=A(o).map((e=>{let[t,n]=e;return'"'.concat(t,'": ').concat(n)}));return r.length>0?{signal:"{".concat(r.join(", "),"}")}:void 0}function lu(e){const{markDef:t,config:n}=e,i=Cn("aria",t,n);return!1===i?{}:{...i?{aria:i}:{},...uu(e),...du(e)}}function uu(e){const{mark:t,markDef:n,config:i}=e;if(!1===i.aria)return{};const o=Cn("ariaRoleDescription",n,i);return null!=o?{ariaRoleDescription:{value:o}}:t in bn?{}:{ariaRoleDescription:{value:t}}}function du(e){const{encoding:t,markDef:n,config:i,stack:o}=e,r=t.description;if(r)return iu(e,r,"description",(t=>ru(t,e.config)));const a=Cn("description",n,i);if(null!=a)return{description:Dn(a)};if(!1===i.aria)return{};const s=su(t,o,i);return z(s)?void 0:{description:{signal:A(s).map(((e,t)=>{let[n,i]=e;return'"'.concat(t>0?"; ":"").concat(n,': " + (').concat(i,")")})).join(" + ")}}}function fu(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{markDef:i,encoding:o,config:r}=t,{vgChannel:a}=n;let{defaultRef:s,defaultValue:c}=n;var l;void 0===s&&(null!==(l=c)&&void 0!==l||(c=Cn(e,i,r,{vgChannel:a,ignoreVgConfig:!0})),void 0!==c&&(s=Dn(c)));const u=o[e];return iu(t,u,null!=a?a:e,(n=>Nr({channel:e,channelDef:n,markDef:i,config:r,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:s})))}function pu(e){var t,n,i,o;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{filled:void 0};const{markDef:a,encoding:s,config:c}=e,{type:l}=a,u=null!==(t=r.filled)&&void 0!==t?t:Cn("filled",a,c),d=y(["bar","point","circle","square","geoshape"],l)?"transparent":void 0,f=null!==(n=null!==(i=Cn(!0===u?"color":void 0,a,c,{vgChannel:"fill"}))&&void 0!==i?i:c.mark[!0===u&&"color"])&&void 0!==n?n:d,p=null!==(o=Cn(!1===u?"color":void 0,a,c,{vgChannel:"stroke"}))&&void 0!==o?o:c.mark[!1===u&&"color"],m=u?"fill":"stroke",g={...f?{fill:Dn(f)}:{},...p?{stroke:Dn(p)}:{}};return a.color&&(u?a.fill:a.stroke)&&ji(ai("property",{fill:"fill"in a,stroke:"stroke"in a})),{...g,...fu("color",e,{vgChannel:m,defaultValue:u?f:p}),...fu("fill",e,{defaultValue:s.fill?f:void 0}),...fu("stroke",e,{defaultValue:s.stroke?p:void 0})}}function mu(e){const{encoding:t,mark:n}=e,i=t.order;return!hr(n)&&ga(i)?iu(e,i,"zindex",(e=>Dn(e.value))):{}}function gu(e){let{channel:t,markDef:n,encoding:i={},model:o,bandPosition:r}=e;const a="".concat(t,"Offset"),s=n[a],c=i[a];if(("xOffset"===a||"yOffset"===a)&&c){return{offsetType:"encoding",offset:Nr({channel:a,channelDef:c,markDef:n,config:null==o?void 0:o.config,scaleName:o.scaleName(a),scale:o.getScaleComponent(a),stack:null,defaultRef:Dn(s),bandPosition:r})}}const l=n[a];return l?{offsetType:"visual",offset:l}:{}}function hu(e,t,n){let{defaultPos:i,vgChannel:o}=n;const{encoding:r,markDef:a,config:s,stack:c}=t,l=r[e],u=r[nt(e)],d=t.scaleName(e),f=t.getScaleComponent(e),{offset:p,offsetType:m}=gu({channel:e,markDef:a,encoding:r,model:t,bandPosition:.5}),g=vu({model:t,defaultPos:i,channel:e,scaleName:d,scale:f}),h=!l&&Ft(e)&&(r.latitude||r.longitude)?{field:t.getName(e)}:function(e){const{channel:t,channelDef:n,scaleName:i,stack:o,offset:r,markDef:a}=e;if(pa(n)&&o&&t===o.fieldChannel){if(ca(n)){let e=n.bandPosition;if(void 0!==e||"text"!==a.type||"radius"!==t&&"theta"!==t||(e=.5),void 0!==e)return Ar({scaleName:i,fieldOrDatumDef:n,startSuffix:"start",bandPosition:e,offset:r})}return Pr(n,i,{suffix:"end"},{offset:r})}return _r(e)}({channel:e,channelDef:l,channel2Def:u,markDef:a,config:s,scaleName:d,scale:f,stack:c,offset:p,defaultRef:g,bandPosition:"encoding"===m?0:void 0});return h?{[o||e]:h}:void 0}function vu(e){let{model:t,defaultPos:n,channel:i,scaleName:o,scale:r}=e;const{markDef:a,config:s}=t;return()=>{const e=et(i),c=tt(i),l=Cn(i,a,s,{vgChannel:c});if(void 0!==l)return jr(i,l);switch(n){case"zeroOrMin":case"zeroOrMax":if(o){const e=r.get("type");if(y([So,Do,Fo],e));else if(r.domainDefinitelyIncludesZero())return{scale:o,value:0}}if("zeroOrMin"===n)return"y"===e?{field:{group:"height"}}:{value:0};switch(e){case"radius":return{signal:"min(".concat(t.width.signal,",").concat(t.height.signal,")/2")};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":return{...t[it(i)],mult:.5}}}}const yu={left:"x",center:"xc",right:"x2"},bu={top:"y",middle:"yc",bottom:"y2"};function xu(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"middle";if("radius"===e||"theta"===e)return tt(e);const o="x"===e?"align":"baseline",r=Cn(o,t,n);let a;return gn(r)?(ji(pi(o)),a=void 0):a=r,"x"===e?yu[a||("top"===i?"left":"center")]:bu[a||i]}function wu(e,t,n){let{defaultPos:i,defaultPos2:o,range:r}=n;return r?ku(e,t,{defaultPos:i,defaultPos2:o}):hu(e,t,{defaultPos:i})}function ku(e,t,n){let{defaultPos:i,defaultPos2:o}=n;const{markDef:r,config:a}=t,s=nt(e),c=it(e),l=function(e,t,n){const{encoding:i,mark:o,markDef:r,stack:a,config:s}=e,c=et(n),l=it(n),u=tt(n),d=i[c],f=e.scaleName(c),p=e.getScaleComponent(c),{offset:m}=gu(n in i||n in r?{channel:n,markDef:r,encoding:i,model:e}:{channel:c,markDef:r,encoding:i,model:e});if(!d&&("x2"===n||"y2"===n)&&(i.latitude||i.longitude)){const t=it(n),i=e.markDef[t];return null!=i?{[t]:{value:i}}:{[u]:{field:e.getName(n)}}}const g=function(e){let{channel:t,channelDef:n,channel2Def:i,markDef:o,config:r,scaleName:a,scale:s,stack:c,offset:l,defaultRef:u}=e;if(pa(n)&&c&&t.charAt(0)===c.fieldChannel.charAt(0))return Pr(n,a,{suffix:"start"},{offset:l});return _r({channel:t,channelDef:i,scaleName:a,scale:s,stack:c,markDef:o,config:r,offset:l,defaultRef:u})}({channel:n,channelDef:d,channel2Def:i[n],markDef:r,config:s,scaleName:f,scale:p,stack:a,offset:m,defaultRef:void 0});if(void 0!==g)return{[u]:g};return Su(n,r)||Su(n,{[n]:An(n,r,s.style),[l]:An(l,r,s.style)})||Su(n,s[o])||Su(n,s.mark)||{[u]:vu({model:e,defaultPos:t,channel:n,scaleName:f,scale:p})()}}(t,o,s);return{...hu(e,t,{defaultPos:i,vgChannel:l[c]?xu(e,r,a):tt(e)}),...l}}function Su(e,t){const n=it(e),i=tt(e);if(void 0!==t[i])return{[i]:jr(e,t[i])};if(void 0!==t[e])return{[i]:jr(e,t[e])};if(t[n]){const i=t[n];if(!Sr(i))return{[n]:jr(e,i)};ji(function(e){return"Position range does not support relative band size for ".concat(e,".")}(n))}}function Du(e,n){var i,o;const{config:r,encoding:a,markDef:s}=e,c=s.type,l=nt(n),u=it(n),d=a[n],f=a[l],p=e.getScaleComponent(n),m=p?p.get("type"):void 0,g=s.orient,h=null!==(i=null!==(o=a[u])&&void 0!==o?o:a.size)&&void 0!==i?i:Cn("size",s,r,{vgChannel:u}),v="bar"===c&&("x"===n?"vertical"===g:"horizontal"===g);return!ca(d)||!(an(d.bin)||sn(d.bin)||d.timeUnit&&!f)||h&&!Sr(h)||qo(m)?(pa(d)&&qo(m)||v)&&!f?function(e,n,i){const{markDef:o,encoding:r,config:a,stack:s}=i,c=o.orient,l=i.scaleName(n),u=i.getScaleComponent(n),d=it(n),f=nt(n),p=function(e){switch(e){case ee:return"xOffset";case te:return"yOffset";case ne:return"x2Offset";case ie:return"y2Offset";case ce:return"thetaOffset";case ae:return"radiusOffset";case le:return"theta2Offset";case se:return"radius2Offset"}}(n),m=i.scaleName(p),g="horizontal"===c&&"y"===n||"vertical"===c&&"x"===n;let h;(r.size||o.size)&&(g?h=fu("size",i,{vgChannel:d,defaultRef:Dn(o.size)}):ji(function(e){return'Cannot apply size to non-oriented mark "'.concat(e,'".')}(o.type)));const v=ia({channel:n,fieldDef:e,markDef:o,config:a,scaleType:null==u?void 0:u.get("type"),useVlSizeChannel:g});h=h||{[d]:Fu(d,m||l,u,a,v)};const y="band"===(null==u?void 0:u.get("type"))&&"band"in h[d]?"top":"middle",b=xu(n,o,a,y),x="xc"===b||"yc"===b,{offset:w,offsetType:k}=gu({channel:n,markDef:o,encoding:r,model:i,bandPosition:x?.5:0}),S=_r({channel:n,channelDef:e,markDef:o,config:a,scaleName:l,scale:u,stack:s,offset:w,defaultRef:vu({model:i,defaultPos:"mid",channel:n,scaleName:l,scale:u}),bandPosition:x?"encoding"===k?0:.5:gn(v)?{signal:"(1-".concat(v,")/2")}:Sr(v)?(1-v.band)/2:0});if(d)return{[b]:S,...h};{const e=tt(f),n=h[d],i=w?{...n,offset:w}:n;return{[b]:S,[e]:t.isArray(S)?[S[0],{...S[1],offset:i}]:{...S,offset:i}}}}(d,n,e):ku(n,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"}):function(e){var t,n,i;let{fieldDef:o,fieldDef2:r,channel:a,model:s}=e;const{config:c,markDef:l,encoding:u}=s,d=s.getScaleComponent(a),f=s.scaleName(a),p=d?d.get("type"):void 0,m=d.get("reverse"),g=ia({channel:a,fieldDef:o,markDef:l,config:c,scaleType:p}),h=null===(t=s.component.axes[a])||void 0===t?void 0:t[0],v=null!==(n=null==h?void 0:h.get("translate"))&&void 0!==n?n:.5,y=Ft(a)&&null!==(i=Cn("binSpacing",l,c))&&void 0!==i?i:0,b=nt(a),x=tt(a),w=tt(b),{offset:k}=gu({channel:a,markDef:l,encoding:u,model:s,bandPosition:0}),S=gn(g)?{signal:"(1-".concat(g.signal,")/2")}:Sr(g)?(1-g.band)/2:.5;if(an(o.bin)||o.timeUnit)return{[w]:_u({fieldDef:o,scaleName:f,bandPosition:S,offset:Ou(b,y,m,v,k)}),[x]:_u({fieldDef:o,scaleName:f,bandPosition:gn(S)?{signal:"1-".concat(S.signal)}:1-S,offset:Ou(a,y,m,v,k)})};if(sn(o.bin)){const e=Pr(o,f,{},{offset:Ou(b,y,m,v,k)});if(ca(r))return{[w]:e,[x]:Pr(r,f,{},{offset:Ou(a,y,m,v,k)})};if(cn(o.bin)&&o.bin.step)return{[w]:e,[x]:{signal:'scale("'.concat(f,'", ').concat(ka(o,{expr:"datum"})," + ").concat(o.bin.step,")"),offset:Ou(a,y,m,v,k)}}}return void ji(_i(b))}({fieldDef:d,fieldDef2:f,channel:n,model:e})}function Fu(e,n,i,o,r){if(Sr(r)){if(!i)return{mult:r.band,field:{group:e}};{const e=i.get("type");if("band"===e)return{scale:n,band:r.band};1!==r.band&&(ji(function(e){return"Cannot use the relative band size with ".concat(e," scale.")}(e)),r=void 0)}}else{if(gn(r))return r;if(r)return{value:r}}if(i){const e=i.get("range");if(hn(e)&&t.isNumber(e.step))return{value:e.step-2}}return{value:oc(o.view,e)-2}}function Ou(e,t,n,i,o){if(Ee(e))return 0;const r="x"===e||"y2"===e?-t/2:t/2;if(gn(n)||gn(o)||gn(i)){const e=On(n),t=On(o),a=On(i);return{signal:(a?"".concat(a," + "):"")+(e?"(".concat(e," ? -1 : 1) * "):"")+(t?"(".concat(t," + ").concat(r,")"):r)}}return o=o||0,i+(n?-o-r:+o+r)}function _u(e){let{fieldDef:t,scaleName:n,bandPosition:i,offset:o}=e;return Ar({scaleName:n,fieldOrDatumDef:t,bandPosition:i,offset:o})}const zu=new Set(["aria","width","height"]);function Cu(e,t){const{fill:n,stroke:i}="include"===t.color?pu(e):{};return{...Au(e.markDef,t),...Pu(e,"fill",n),...Pu(e,"stroke",i),...fu("opacity",e),...fu("fillOpacity",e),...fu("strokeOpacity",e),...fu("strokeWidth",e),...fu("strokeDash",e),...mu(e),...au(e),...ou(e,"href"),...lu(e)}}function Pu(e,n,i){const{config:o,mark:r,markDef:a}=e;if("hide"===Cn("invalid",a,o)&&i&&!hr(r)){const o=function(e,t){let{invalid:n=!1,channels:i}=t;const o=i.reduce(((t,n)=>{const i=e.getScaleComponent(n);if(i){const o=i.get("type"),r=e.vgField(n,{expr:"datum"});r&&Wo(o)&&(t[r]=!0)}return t}),{}),r=C(o);if(r.length>0){const e=n?"||":"&&";return r.map((e=>Cr(e,n))).join(" ".concat(e," "))}return}(e,{invalid:!0,channels:Bt});if(o)return{[n]:[{test:o,value:null},...t.array(i)]}}return i?{[n]:i}:{}}function Au(e,t){return yn.reduce(((n,i)=>(zu.has(i)||void 0===e[i]||"ignore"===t[i]||(n[i]=Dn(e[i])),n)),{})}function Nu(e){const{config:t,markDef:n}=e;if(Cn("invalid",n,t)){const t=function(e,t){let{invalid:n=!1,channels:i}=t;const o=i.reduce(((t,n)=>{const i=e.getScaleComponent(n);if(i){const o=i.get("type"),r=e.vgField(n,{expr:"datum"});r&&Wo(o)&&(t[r]=!0)}return t}),{}),r=C(o);if(r.length>0){const e=n?"||":"&&";return r.map((e=>Cr(e,n))).join(" ".concat(e," "))}return}(e,{channels:Dt});if(t)return{defined:{signal:t}}}return{}}function ju(e,t){if(void 0!==t)return{[e]:Dn(t)}}const Eu="voronoi",Mu={defined:e=>"point"===e.type&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName(Eu)},marks:(e,t,n)=>{const{x:i,y:o}=t.project.hasChannel,r=e.mark;if(hr(r))return ji('The "nearest" transform is not supported for '.concat(r," marks.")),n;const a={name:e.getName(Eu),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:{fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0},...au(e,{reactiveGeom:!0})}},transform:[{type:"voronoi",x:{expr:i||!o?"datum.datum.x || 0":"0"},y:{expr:o||!i?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let s=0,c=!1;return n.forEach(((t,n)=>{var i;const o=null!==(i=t.name)&&void 0!==i?i:"";o===e.component.mark[0].name?s=n:o.indexOf(Eu)>=0&&(c=!0)})),c||n.splice(s+1,0,a),n}},Tu={defined:e=>"point"===e.type&&"global"===e.resolve&&e.bind&&"scales"!==e.bind&&!Vs(e.bind),parse:(e,t,n)=>id(t,n),topLevelSignals:(e,n,i)=>{const o=n.name,r=n.project,a=n.bind,s=n.init&&n.init[0],c=Mu.defined(n)?"(item().isVoronoi ? datum.datum : datum)":"datum";return r.items.forEach(((e,r)=>{const l=j("".concat(o,"_").concat(e.field));var u,d;i.filter((e=>e.name===l)).length||i.unshift({name:l,...s?{init:ql(s[r])}:{value:null},on:n.events?[{events:n.events,update:"datum && item().mark.marktype !== 'group' ? ".concat(c,"[").concat(t.stringValue(e.field),"] : null")}]:[],bind:null!==(u=null!==(d=a[e.field])&&void 0!==d?d:a[e.channel])&&void 0!==u?u:a})})),i},signals:(e,t,n)=>{const i=t.name,o=t.project,r=n.filter((e=>e.name===i+Qu))[0],a=i+Gl,s=o.items.map((e=>j("".concat(i,"_").concat(e.field)))),c=s.map((e=>"".concat(e," !== null"))).join(" && ");return s.length&&(r.update="".concat(c," ? {fields: ").concat(a,", values: [").concat(s.join(", "),"]} : null")),delete r.value,delete r.on,n}},Lu="_toggle",qu={defined:e=>"point"===e.type&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+Lu,value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+Qu,i=t.name+Lu;return"".concat(i," ? null : ").concat(n,", ")+("global"===t.resolve?"".concat(i," ? null : true, "):"".concat(i," ? null : {unit: ").concat(td(e),"}, "))+"".concat(i," ? ").concat(n," : null")}},Wu={defined:e=>void 0!==e.clear&&!1!==e.clear,parse:(e,n)=>{n.clear&&(n.clear=t.isString(n.clear)?t.parseSelector(n.clear,"view"):n.clear)},topLevelSignals:(e,t,n)=>{if(Tu.defined(t))for(const e of t.project.items){const i=n.findIndex((n=>n.name===j("".concat(t.name,"_").concat(e.field))));-1!==i&&n[i].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function i(e,i){-1!==e&&n[e].on&&n[e].on.push({events:t.clear,update:i})}if("interval"===t.type)for(const e of t.project.items){const t=n.findIndex((t=>t.name===e.signals.visual));if(i(t,"[0, 0]"),-1===t){i(n.findIndex((t=>t.name===e.signals.data)),"null")}}else{let e=n.findIndex((e=>e.name===t.name+Qu));i(e,"null"),qu.defined(t)&&(e=n.findIndex((e=>e.name===t.name+Lu)),i(e,"false"))}return n}},Ru={defined:e=>{const t="global"===e.resolve&&e.bind&&Vs(e.bind),n=1===e.project.items.length&&e.project.items[0].field!==Bs;return t&&!n&&ji("Legend bindings are only supported for selections over an individual field or encoding channel."),t&&n},parse:(e,n,i)=>{const o=d(i);if(o.select=t.isString(o.select)?{type:o.select,toggle:n.toggle}:{...o.select,toggle:n.toggle},id(n,o),t.isObject(i.select)&&(i.select.on||i.select.clear)){const e='event.item && indexof(event.item.mark.role, "legend") < 0';for(const i of n.events){var r;i.filter=t.array(null!==(r=i.filter)&&void 0!==r?r:[]),i.filter.includes(e)||i.filter.push(e)}}const a=Is(n.bind)?n.bind.legend:"click",s=t.isString(a)?t.parseSelector(a,"view"):t.array(a);n.bind={legend:{merge:s}}},topLevelSignals:(e,t,n)=>{const i=t.name,o=Is(t.bind)&&t.bind.legend,r=e=>t=>{const n=d(t);return n.markname=e,n};for(const e of t.project.items){if(!e.hasLegend)continue;const a="".concat(j(e.field),"_legend"),s="".concat(i,"_").concat(a);if(0===n.filter((e=>e.name===s)).length){const e=o.merge.map(r("".concat(a,"_symbols"))).concat(o.merge.map(r("".concat(a,"_labels")))).concat(o.merge.map(r("".concat(a,"_entries"))));n.unshift({name:s,...t.init?{}:{value:null},on:[{events:e,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:o.merge,update:"!event.item || !datum ? null : ".concat(s),force:!0}]})}}return n},signals:(e,t,n)=>{const i=t.name,o=t.project,r=n.find((e=>e.name===i+Qu)),a=i+Gl,s=o.items.filter((e=>e.hasLegend)).map((e=>j("".concat(i,"_").concat(j(e.field),"_legend")))),c=s.map((e=>"".concat(e," !== null"))).join(" && "),l="".concat(c," ? {fields: ").concat(a,", values: [").concat(s.join(", "),"]} : null");t.events&&s.length>0?r.on.push({events:s.map((e=>({signal:e}))),update:l}):s.length>0&&(r.update=l,delete r.value,delete r.on);const u=n.find((e=>e.name===i+Lu)),d=Is(t.bind)&&t.bind.legend;return u&&(t.events?u.on.push({...u.on[0],events:d}):u.on[0].events=d),n}};const Uu="_translate_anchor",Bu="_translate_delta",Hu={defined:e=>"interval"===e.type&&e.translate,signals:(e,n,i)=>{const o=n.name,r=Jl.defined(n),a=o+Uu,{x:s,y:c}=n.project.hasChannel;let l=t.parseSelector(n.translate,"scope");return r||(l=l.map((e=>(e.between[0].markname=o+Kl,e)))),i.push({name:a,value:{},on:[{events:l.map((e=>e.between[0])),update:"{x: x(unit), y: y(unit)"+(void 0!==s?", extent_x: ".concat(r?Ql(e,ee):"slice(".concat(s.signals.visual,")")):"")+(void 0!==c?", extent_y: ".concat(r?Ql(e,te):"slice(".concat(c.signals.visual,")")):"")+"}"}]},{name:o+Bu,value:{},on:[{events:l,update:"{x: ".concat(a,".x - x(unit), y: ").concat(a,".y - y(unit)}")}]}),void 0!==s&&Vu(e,n,s,"width",i),void 0!==c&&Vu(e,n,c,"height",i),i}};function Vu(e,t,n,i,o){var r,a;const s=t.name,c=s+Uu,l=s+Bu,u=n.channel,d=Jl.defined(t),f=o.filter((e=>e.name===n.signals[d?"data":"visual"]))[0],p=e.getSizeSignalRef(i).signal,m=e.getScaleComponent(u),g=m.get("type"),h=m.get("reverse"),v=d?u===ee?h?"":"-":h?"-":"":"",y="".concat(c,".extent_").concat(u),b="".concat(v).concat(l,".").concat(u," / ").concat(d?"".concat(p):"span(".concat(y,")")),x=d?"log"===g?"panLog":"symlog"===g?"panSymlog":"pow"===g?"panPow":"panLinear":"panLinear",w=d?"pow"===g?", ".concat(null!==(r=m.get("exponent"))&&void 0!==r?r:1):"symlog"===g?", ".concat(null!==(a=m.get("constant"))&&void 0!==a?a:1):"":"",k="".concat(x,"(").concat(y,", ").concat(b).concat(w,")");f.on.push({events:{signal:l},update:d?k:"clampRange(".concat(k,", 0, ").concat(p,")")})}const Iu="_zoom_anchor",Gu="_zoom_delta",Yu={defined:e=>"interval"===e.type&&e.zoom,signals:(e,n,i)=>{const o=n.name,r=Jl.defined(n),a=o+Gu,{x:s,y:c}=n.project.hasChannel,l=t.stringValue(e.scaleName(ee)),u=t.stringValue(e.scaleName(te));let d=t.parseSelector(n.zoom,"scope");return r||(d=d.map((e=>(e.markname=o+Kl,e)))),i.push({name:o+Iu,on:[{events:d,update:r?"{"+[l?"x: invert(".concat(l,", x(unit))"):"",u?"y: invert(".concat(u,", y(unit))"):""].filter((e=>!!e)).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:a,on:[{events:d,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),void 0!==s&&Xu(e,n,s,"width",i),void 0!==c&&Xu(e,n,c,"height",i),i}};function Xu(e,t,n,i,o){var r,a;const s=t.name,c=n.channel,l=Jl.defined(t),u=o.filter((e=>e.name===n.signals[l?"data":"visual"]))[0],d=e.getSizeSignalRef(i).signal,f=e.getScaleComponent(c),p=f.get("type"),m=l?Ql(e,c):u.name,g=s+Gu,h="".concat(s).concat(Iu,".").concat(c),v=l?"log"===p?"zoomLog":"symlog"===p?"zoomSymlog":"pow"===p?"zoomPow":"zoomLinear":"zoomLinear",y=l?"pow"===p?", ".concat(null!==(r=f.get("exponent"))&&void 0!==r?r:1):"symlog"===p?", ".concat(null!==(a=f.get("constant"))&&void 0!==a?a:1):"":"",b="".concat(v,"(").concat(m,", ").concat(h,", ").concat(g).concat(y,")");u.on.push({events:{signal:g},update:l?b:"clampRange(".concat(b,", 0, ").concat(d,")")})}const Ju="_store",Qu="_tuple",$u="_modify",Ku="vlSelectionResolve",Zu=[nu,eu,Xl,qu,Tu,Jl,Ru,Wu,Hu,Yu,Mu];function ed(e){let t=e.parent;for(;t&&!Rp(t);)t=t.parent;return t}function td(e){let{escape:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{escape:!0},i=n?t.stringValue(e.name):e.name;const o=ed(e);if(o){const{facet:e}=o;for(const n of Re)e[n]&&(i+=" + '__facet_".concat(n,"_' + (facet[").concat(t.stringValue(o.vgField(n)),"])"))}return i}function nd(e){var t;return P(null!==(t=e.component.selection)&&void 0!==t?t:{}).reduce(((e,t)=>e||t.project.items.some((e=>e.field===Bs))),!1)}function id(e,n){!t.isString(n.select)&&n.select.on||delete e.events,!t.isString(n.select)&&n.select.clear||delete e.clear,!t.isString(n.select)&&n.select.toggle||delete e.toggle}function od(e){const t=[];return"Identifier"===e.type?[e.name]:"Literal"===e.type?[e.value]:("MemberExpression"===e.type&&(t.push(...od(e.object)),t.push(...od(e.property))),t)}function rd(e){return"MemberExpression"===e.object.type?rd(e.object):"datum"===e.object.name}function ad(e){const n=t.parseExpression(e),i=new Set;return n.visit((e=>{"MemberExpression"===e.type&&rd(e)&&i.add(od(e).slice(1).join("."))})),i}class sd extends Hl{clone(){return new sd(null,this.model,d(this.filter))}constructor(e,t,n){super(e),this.model=t,this.filter=n,Ln(this,"expr",void 0),Ln(this,"_dependentFields",void 0),this.expr=ud(this.model,this.filter,this),this._dependentFields=ad(this.expr)}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return"Filter ".concat(this.expr)}}function cd(e,n,i){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"datum";const r=t.isString(n)?n:n.param,a=j(r),s=t.stringValue(a+Ju);let c;try{c=e.getSelectionComponent(a,r)}catch(e){return"!!".concat(a)}if(c.project.timeUnit){const t=null!=i?i:e.component.data.raw,n=c.project.timeUnit.clone();t.parent?n.insertAsParentOf(t):t.parent=n}const l="vlSelectionTest(".concat(s,", ").concat(o).concat("global"===c.resolve?")":", ".concat(t.stringValue(c.resolve),")")),u="length(data(".concat(s,"))");return!1===n.empty?"".concat(u," && ").concat(l):"!".concat(u," || ").concat(l)}function ld(e,n,i){const o=j(n),r=i.encoding;let a,s=i.field;try{a=e.getSelectionComponent(o,n)}catch(e){return o}if(r||s){if(r&&!s){const e=a.project.items.filter((e=>e.channel===r));!e.length||e.length>1?(s=a.project.items[0].field,ji((e.length?"Multiple ":"No ")+"matching ".concat(t.stringValue(r)," encoding found for selection ").concat(t.stringValue(i.param),". ")+'Using "field": '.concat(t.stringValue(s),"."))):s=e[0].field}}else s=a.project.items[0].field,a.project.items.length>1&&ji('A "field" or "encoding" must be specified when using a selection as a scale domain. '+'Using "field": '.concat(t.stringValue(s),"."));return"".concat(a.name,"[").concat(t.stringValue(R(s)),"]")}function ud(e,n,i){return E(n,(n=>t.isString(n)?n:function(e){return null==e?void 0:e.param}(n)?cd(e,n,i):uo(n)))}function dd(e,n){if(e)return t.isArray(e)&&!mn(e)?e.map((e=>Aa(e,n))).join(", "):e}function fd(e,t,n,i){var o,r,a,s,c;null!==(o=e.encode)&&void 0!==o||(e.encode={}),null!==(a=(r=e.encode)[t])&&void 0!==a||(r[t]={}),null!==(c=(s=e.encode[t]).update)&&void 0!==c||(s.update={}),e.encode[t].update[n]=i}function pd(e,n,i){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{header:!1};const{disable:r,orient:a,scale:s,labelExpr:c,title:l,zindex:u,...d}=e.combine();if(!r){for(const e in d){const i=Ja[e],o=d[e];if(i&&i!==n&&"both"!==i)delete d[e];else if(Ya(o)){const{condition:n,...i}=o,r=t.array(n),a=Ga[e];if(a){const{vgProp:t,part:n}=a;fd(d,n,t,[...r.map((e=>{const{test:t,...n}=e;return{test:ud(null,t),...n}})),i]),delete d[e]}else if(null===a){const t={signal:r.map((e=>{const{test:t,...n}=e;return"".concat(ud(null,t)," ? ").concat(Fn(n)," : ")})).join("")+Fn(i)};d[e]=t}}else if(gn(o)){const t=Ga[e];if(t){const{vgProp:n,part:i}=t;fd(d,i,n,o),delete d[e]}}y(["labelAlign","labelBaseline"],e)&&null===d[e]&&delete d[e]}if("grid"===n){if(!d.grid)return;if(d.encode){const{grid:e}=d.encode;d.encode={...e?{grid:e}:{}},z(d.encode)&&delete d.encode}return{scale:s,orient:a,...d,domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:V(u,0)}}{if(!o.header&&e.mainExtracted)return;if(void 0!==c){var f,p;let e=c;null!==(f=d.encode)&&void 0!==f&&null!==(p=f.labels)&&void 0!==p&&p.update&&gn(d.encode.labels.update.text)&&(e=U(c,"datum.label",d.encode.labels.update.text.signal)),fd(d,"labels","text",{signal:e})}if(null===d.labelAlign&&delete d.labelAlign,d.encode){for(const t of Xa)e.hasAxisPart(t)||delete d.encode[t];z(d.encode)&&delete d.encode}const t=dd(l,i);return{scale:s,orient:a,grid:!1,...t?{title:t}:{},...d,...!1===i.aria?{aria:!1}:{},zindex:V(u,0)}}}}function md(e){const{axes:t}=e.component,n=[];for(const i of Dt)if(t[i])for(const o of t[i])if(!o.get("disable")&&!o.get("gridScale")){const t="x"===i?"height":"width",o=e.getSizeSignalRef(t).signal;t!==o&&n.push({name:t,update:o})}return n}function gd(e,t,n,i){return Object.assign.apply(null,[{},...e.map((e=>{if("axisOrient"===e){const e="x"===n?"bottom":"left",o=t["x"===n?"axisBottom":"axisLeft"]||{},r=t["x"===n?"axisTop":"axisRight"]||{},a=new Set([...C(o),...C(r)]),s={};for(const t of a.values())s[t]={signal:"".concat(i.signal,' === "').concat(e,'" ? ').concat(On(o[t])," : ").concat(On(r[t]))};return s}return t[e]}))])}function hd(e,n){const i=[{}];for(const r of e){var o;let e=null===(o=n[r])||void 0===o?void 0:o.style;if(e){e=t.array(e);for(const t of e)i.push(n.style[t])}}return Object.assign.apply(null,i)}function vd(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const o=Nn(e,n,t);if(void 0!==o)return{configFrom:"style",configValue:o};for(const t of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"]){var r;if(void 0!==(null===(r=i[t])||void 0===r?void 0:r[e]))return{configFrom:t,configValue:i[t][e]}}return{}}const yd={scale:e=>{let{model:t,channel:n}=e;return t.scaleName(n)},format:e=>{let{fieldOrDatumDef:t,config:n,axis:i}=e;const{format:o,formatType:r}=i;return Wr(t,t.type,o,r,n,!0)},formatType:e=>{let{axis:t,fieldOrDatumDef:n,scaleType:i}=e;const{formatType:o}=t;return Rr(o,n,i)},grid:e=>{var t;let{fieldOrDatumDef:n,axis:i,scaleType:o}=e;return null!==(t=i.grid)&&void 0!==t?t:function(e,t){return!qo(e)&&ca(t)&&!an(null==t?void 0:t.bin)&&!sn(null==t?void 0:t.bin)}(o,n)},gridScale:e=>{let{model:t,channel:n}=e;return function(e,t){const n="x"===t?"y":"x";if(e.getScaleComponent(n))return e.scaleName(n);return}(t,n)},labelAlign:e=>{let{axis:t,labelAngle:n,orient:i,channel:o}=e;return t.labelAlign||wd(n,i,o)},labelAngle:e=>{let{labelAngle:t}=e;return t},labelBaseline:e=>{let{axis:t,labelAngle:n,orient:i,channel:o}=e;return t.labelBaseline||xd(n,i,o)},labelFlush:e=>{var t;let{axis:n,fieldOrDatumDef:i,channel:o}=e;return null!==(t=n.labelFlush)&&void 0!==t?t:function(e,t){if("x"===t&&y(["quantitative","temporal"],e))return!0;return}(i.type,o)},labelOverlap:e=>{var n;let{axis:i,fieldOrDatumDef:o,scaleType:r}=e;return null!==(n=i.labelOverlap)&&void 0!==n?n:function(e,n,i,o){if(i&&!t.isObject(o)||"nominal"!==e&&"ordinal"!==e)return"log"!==n&&"symlog"!==n||"greedy";return}(o.type,r,ca(o)&&!!o.timeUnit,ca(o)?o.sort:void 0)},orient:e=>{let{orient:t}=e;return t},tickCount:e=>{var t;let{channel:n,model:i,axis:o,fieldOrDatumDef:r,scaleType:a}=e;const s="x"===n?"width":"y"===n?"height":void 0,c=s?i.getSizeSignalRef(s):void 0;return null!==(t=o.tickCount)&&void 0!==t?t:function(e){let{fieldOrDatumDef:t,scaleType:n,size:i,values:o}=e;if(!o&&!qo(n)&&"log"!==n){if(ca(t)){var r;if(an(t.bin))return{signal:"ceil(".concat(i.signal,"/10)")};if(t.timeUnit&&y(["month","hours","day","quarter"],null===(r=$i(t.timeUnit))||void 0===r?void 0:r.unit))return}return{signal:"ceil(".concat(i.signal,"/40)")}}return}({fieldOrDatumDef:r,scaleType:a,size:c,values:o.values})},title:e=>{let{axis:t,model:n,channel:i}=e;if(void 0!==t.title)return t.title;const o=kd(n,i);if(void 0!==o)return o;const r=n.typedFieldDef(i),a="x"===i?"x2":"y2",s=n.fieldDef(a);return En(r?[ea(r)]:[],ca(s)?[ea(s)]:[])},values:e=>{let{axis:n,fieldOrDatumDef:i}=e;return function(e,n){const i=e.values;if(t.isArray(i))return Va(n,i);if(gn(i))return i;return}(n,i)},zindex:e=>{var t;let{axis:n,fieldOrDatumDef:i,mark:o}=e;return null!==(t=n.zindex)&&void 0!==t?t:function(e,t){if("rect"===e&&Sa(t))return 1;return 0}(o,i)}};function bd(e){return"(((".concat(e.signal," % 360) + 360) % 360)")}function xd(e,t,n,i){if(void 0!==e){if("x"===n){if(gn(e)){const n=bd(e),i=gn(t)?"(".concat(t.signal,' === "top")'):"top"===t;return{signal:"(45 < ".concat(n," && ").concat(n," < 135) || (225 < ").concat(n," && ").concat(n,' < 315) ? "middle" :')+"(".concat(n," <= 45 || 315 <= ").concat(n,") === ").concat(i,' ? "bottom" : "top"')}}if(45<e&&e<135||225<e&&e<315)return"middle";if(gn(t)){const n=e<=45||315<=e?"===":"!==";return{signal:"".concat(t.signal," ").concat(n,' "top" ? "bottom" : "top"')}}return(e<=45||315<=e)==("top"===t)?"bottom":"top"}if(gn(e)){const n=bd(e),o=gn(t)?"(".concat(t.signal,' === "left")'):"left"===t,r=i?'"middle"':"null";return{signal:"".concat(n," <= 45 || 315 <= ").concat(n," || (135 <= ").concat(n," && ").concat(n," <= 225) ? ").concat(r," : (45 <= ").concat(n," && ").concat(n," <= 135) === ").concat(o,' ? "top" : "bottom"')}}if(e<=45||315<=e||135<=e&&e<=225)return i?"middle":null;if(gn(t)){const n=45<=e&&e<=135?"===":"!==";return{signal:"".concat(t.signal," ").concat(n,' "left" ? "top" : "bottom"')}}return(45<=e&&e<=135)==("left"===t)?"top":"bottom"}}function wd(e,t,n){if(void 0===e)return;const i="x"===n,o=i?0:90,r=i?"bottom":"left";if(gn(e)){const n=bd(e),a=gn(t)?"(".concat(t.signal,' === "').concat(r,'")'):t===r;return{signal:"(".concat(o?"(".concat(n," + 90)"):n," % 180 === 0) ? ").concat(i?null:'"center"'," :")+"(".concat(o," < ").concat(n," && ").concat(n," < ").concat(180+o,") === ").concat(a,' ? "left" : "right"')}}if((e+o)%180==0)return i?null:"center";if(gn(t)){const n=o<e&&e<180+o?"===":"!==",i="".concat(t.signal," ").concat(n,' "').concat(r,'"');return{signal:"".concat(i,' ? "left" : "right"')}}return(o<e&&e<180+o)==(t===r)?"left":"right"}function kd(e,t){const n="x"===t?"x2":"y2",i=e.fieldDef(t),o=e.fieldDef(n),r=i?i.title:void 0,a=o?o.title:void 0;return r&&a?Mn(r,a):r||(a||(void 0!==r?r:void 0!==a?a:void 0))}class Sd extends Hl{clone(){return new Sd(null,d(this.transform))}constructor(e,t){super(e),this.transform=t,Ln(this,"_dependentFields",void 0),this._dependentFields=ad(this.transform.calculate)}static parseAllForSortIndex(e,t){return t.forEachFieldDef(((t,n)=>{if(ha(t)&&Qr(t.sort)){const{field:i,timeUnit:o}=t,r=t.sort,a=r.map(((e,t)=>"".concat(uo({field:i,timeUnit:o,equal:e})," ? ").concat(t," : "))).join("")+r.length;e=new Sd(e,{calculate:a,as:Dd(t,n,{forAs:!0})})}})),e}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return"Calculate ".concat(h(this.transform))}}function Dd(e,t,n){return ka(e,{prefix:t,suffix:"sort_index",...null!=n?n:{}})}function Fd(e,t){return y(["top","bottom"],t)?"column":y(["left","right"],t)||"row"===e?"row":"column"}function Od(e,t,n,i){const o="row"===i?n.headerRow:"column"===i?n.headerColumn:n.headerFacet;return V((t||{})[e],o[e],n.header[e])}function _d(e,t,n,i){const o={};for(const r of e){const e=Od(r,t||{},n,i);void 0!==e&&(o[r]=e)}return o}const zd=["row","column"],Cd=["header","footer"];function Pd(e,t){const n=e.component.layoutHeaders[t].title,i=e.config?e.config:void 0,o=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:r,titleAngle:a,titleOrient:s}=_d(["titleAnchor","titleAngle","titleOrient"],o.header,i,t),c=Fd(t,s),l=J(a);return{name:"".concat(t,"-title"),type:"group",role:"".concat(c,"-title"),title:{text:n,..."row"===t?{orient:"left"}:{},style:"guide-title",...Nd(l,c),...Ad(c,l,r),...Wd(i,o,t,qs,Ts)}}}function Ad(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"middle";switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const i=wd(t,"row"===e?"left":"top","row"===e?"y":"x");return i?{align:i}:{}}function Nd(e,t){const n=xd(e,"row"===t?"left":"top","row"===t?"y":"x",!0);return n?{baseline:n}:{}}function jd(e,t){const n=e.component.layoutHeaders[t],i=[];for(const o of Cd)if(n[o])for(const r of n[o]){const a=Td(e,t,o,n,r);null!=a&&i.push(a)}return i}function Ed(e,n){const{sort:i}=e;var o;return Jr(i)?{field:ka(i,{expr:"datum"}),order:null!==(o=i.order)&&void 0!==o?o:"ascending"}:t.isArray(i)?{field:Dd(e,n,{expr:"datum"}),order:"ascending"}:{field:ka(e,{expr:"datum"}),order:null!=i?i:"ascending"}}function Md(e,t,n){const{format:i,formatType:o,labelAngle:r,labelAnchor:a,labelOrient:s,labelExpr:c}=_d(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e.header,n,t),l=Tr({fieldOrDatumDef:e,format:i,formatType:o,expr:"parent",config:n}).signal,u=Fd(t,s);return{text:{signal:c?U(U(c,"datum.label",l),"datum.value",ka(e,{expr:"parent"})):l},..."row"===t?{orient:"left"}:{},style:"guide-label",frame:"group",...Nd(r,u),...Ad(u,r,a),...Wd(n,e,t,Ws,Ls)}}function Td(e,t,n,i,o){if(o){let r=null;const{facetFieldDef:a}=i,s=e.config?e.config:void 0;if(a&&o.labels){const{labelOrient:e}=_d(["labelOrient"],a.header,s,t);("row"===t&&!y(["top","bottom"],e)||"column"===t&&!y(["left","right"],e))&&(r=Md(a,t,s))}const c=Rp(e)&&!$r(e.facet),l=o.axes,u=(null==l?void 0:l.length)>0;if(r||u){const s="row"===t?"height":"width";return{name:e.getName("".concat(t,"_").concat(n)),type:"group",role:"".concat(t,"-").concat(n),...i.facetFieldDef?{from:{data:e.getName("".concat(t,"_domain"))},sort:Ed(a,t)}:{},...u&&c?{from:{data:e.getName("facet_domain_".concat(t))}}:{},...r?{title:r}:{},...o.sizeSignal?{encode:{update:{[s]:o.sizeSignal}}}:{},...u?{axes:l}:{}}}}return null}const Ld={column:{start:0,end:1},row:{start:1,end:0}};function qd(e,t){return Ld[t][e]}function Wd(e,t,n,i,o){const r={};for(const a of i){if(!o[a])continue;const i=Od(a,null==t?void 0:t.header,e,n);void 0!==i&&(r[o[a]]=i)}return r}function Rd(e){return[...Ud(e,"width"),...Ud(e,"height"),...Ud(e,"childWidth"),...Ud(e,"childHeight")]}function Ud(e,t){const n="width"===t?"x":"y",i=e.component.layoutSize.get(t);if(!i||"merged"===i)return[];const o=e.getSizeSignalRef(t).signal;if("step"===i){const t=e.getScaleComponent(n);if(t){const i=t.get("type"),r=t.get("range");if(qo(i)&&hn(r)){const i=e.scaleName(n);if(Rp(e.parent)){if("independent"===e.parent.component.resolve.scale[n])return[Bd(i,r)]}return[Bd(i,r),{name:o,update:Hd(i,t,"domain('".concat(i,"').length"))}]}}throw new Error("layout size is step although width/height is not step.")}if("container"==i){const t=o.endsWith("width"),n=t?"containerSize()[0]":"containerSize()[1]",i=ic(e.config.view,t?"width":"height"),r="isFinite(".concat(n,") ? ").concat(n," : ").concat(i);return[{name:o,init:r,on:[{update:r,events:"window:resize"}]}]}return[{name:o,value:i}]}function Bd(e,t){const n="".concat(e,"_step");return gn(t.step)?{name:n,update:t.step.signal}:{name:n,value:t.step}}function Hd(e,t,n){const i=t.get("type"),o=t.get("padding"),r=V(t.get("paddingOuter"),o);let a=t.get("paddingInner");return a="band"===i?void 0!==a?a:o:1,"bandspace(".concat(n,", ").concat(On(a),", ").concat(On(r),") * ").concat(e,"_step")}function Vd(e){return"childWidth"===e?"width":"childHeight"===e?"height":e}function Id(e,t){return C(e).reduce(((n,i)=>{const o=e[i];return{...n,...iu(t,o,i,(e=>Dn(e.value)))}}),{})}function Gd(e,t){if(Rp(t))return"theta"===e?"independent":"shared";if(Bp(t))return"shared";if(Up(t))return Ft(e)||"theta"===e||"radius"===e?"independent":"shared";throw new Error("invalid model type for resolve")}function Yd(e,t){const n=e.scale[t],i=Ft(t)?"axis":"legend";return"independent"===n?("shared"===e[i][t]&&ji(function(e){return'Setting the scale to be independent for "'.concat(e,'" means we also have to set the guide (axis or legend) to be independent.')}(t)),"independent"):e[i][t]||"shared"}const Xd=C({aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1,disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1});class Jd extends Sl{}const Qd={symbols:function(e,n){var i,o,r,a;let{fieldOrDatumDef:s,model:c,channel:l,legendCmpt:u,legendType:d}=n;if("symbol"!==d)return;const{markDef:f,encoding:p,config:m,mark:g}=c,h=f.filled&&"trail"!==g;let v={..._n({},c,xr),...pu(c,{filled:h})};const y=null!==(i=u.get("symbolOpacity"))&&void 0!==i?i:m.legend.symbolOpacity,b=null!==(o=u.get("symbolFillColor"))&&void 0!==o?o:m.legend.symbolFillColor,x=null!==(r=u.get("symbolStrokeColor"))&&void 0!==r?r:m.legend.symbolStrokeColor,w=void 0===y?null!==(a=$d(p.opacity))&&void 0!==a?a:f.opacity:void 0;if(v.fill){var k;if("fill"===l||h&&l===me)delete v.fill;else if(v.fill.field)if(b)delete v.fill;else v.fill=Dn(null!==(k=m.legend.symbolBaseFillColor)&&void 0!==k?k:"black"),v.fillOpacity=Dn(null!=w?w:1);else if(t.isArray(v.fill)){var S,D,F;const e=null!==(S=null!==(D=Kd(null!==(F=p.fill)&&void 0!==F?F:p.color))&&void 0!==D?D:f.fill)&&void 0!==S?S:h&&f.color;e&&(v.fill=Dn(e))}}if(v.stroke)if("stroke"===l||!h&&l===me)delete v.stroke;else if(v.stroke.field||x)delete v.stroke;else if(t.isArray(v.stroke)){const e=V(Kd(p.stroke||p.color),f.stroke,h?f.color:void 0);e&&(v.stroke={value:e})}if(l!==xe){const e=ca(s)&&ef(c,u,s);e?v.opacity=[{test:e,...Dn(null!=w?w:1)},Dn(m.legend.unselectedOpacity)]:w&&(v.opacity=Dn(w))}return v={...v,...e},z(v)?void 0:v},gradient:function(e,t){var n;let{model:i,legendType:o,legendCmpt:r}=t;if("gradient"!==o)return;const{config:a,markDef:s,encoding:c}=i;let l={};const u=void 0===(null!==(n=r.get("gradientOpacity"))&&void 0!==n?n:a.legend.gradientOpacity)?$d(c.opacity)||s.opacity:void 0;u&&(l.opacity=Dn(u));return l={...l,...e},z(l)?void 0:l},labels:function(e,t){let{fieldOrDatumDef:n,model:i,channel:o,legendCmpt:r}=t;const a=i.legend(o)||{},s=i.config,c=ca(n)?ef(i,r,n):void 0,l=c?[{test:c,value:1},{value:s.legend.unselectedOpacity}]:void 0,{format:u,formatType:d}=a,f=Er(d)?qr({fieldOrDatumDef:n,field:"datum.value",format:u,formatType:d,config:s}):void 0,p={...l?{opacity:l}:{},...f?{text:f}:{},...e};return z(p)?void 0:p},entries:function(e,t){let{legendCmpt:n}=t;const i=n.get("selections");return null!=i&&i.length?{...e,fill:{value:"transparent"}}:e}};function $d(e){return Zd(e,((e,t)=>Math.max(e,t.value)))}function Kd(e){return Zd(e,((e,t)=>V(e,t.value)))}function Zd(e,n){return function(e){const n=e&&e.condition;return!!n&&(t.isArray(n)||ga(n))}(e)?t.array(e.condition).reduce(n,e.value):ga(e)?e.value:void 0}function ef(e,n,i){const o=n.get("selections");if(null==o||!o.length)return;const r=t.stringValue(i.field);return o.map((e=>{const n=t.stringValue(j(e)+Ju);return"(!length(data(".concat(n,")) || (").concat(e,"[").concat(r,"] && indexof(").concat(e,"[").concat(r,"], datum.value) >= 0))")})).join(" || ")}const tf={direction:e=>{let{direction:t}=e;return t},format:e=>{let{fieldOrDatumDef:t,legend:n,config:i}=e;const{format:o,formatType:r}=n;return Wr(t,t.type,o,r,i,!1)},formatType:e=>{let{legend:t,fieldOrDatumDef:n,scaleType:i}=e;const{formatType:o}=t;return Rr(o,n,i)},gradientLength:e=>{var t,n;const{legend:i,legendConfig:o}=e;return null!==(t=null!==(n=i.gradientLength)&&void 0!==n?n:o.gradientLength)&&void 0!==t?t:function(e){let{legendConfig:t,model:n,direction:i,orient:o,scaleType:r}=e;const{gradientHorizontalMaxLength:a,gradientHorizontalMinLength:s,gradientVerticalMaxLength:c,gradientVerticalMinLength:l}=t;if(Ro(r))return"horizontal"===i?"top"===o||"bottom"===o?rf(n,"width",s,a):s:rf(n,"height",l,c);return}(e)},labelOverlap:e=>{var t,n;let{legend:i,legendConfig:o,scaleType:r}=e;return null!==(t=null!==(n=i.labelOverlap)&&void 0!==n?n:o.labelOverlap)&&void 0!==t?t:function(e){if(y(["quantile","threshold","log","symlog"],e))return"greedy";return}(r)},symbolType:e=>{var t;let{legend:n,markDef:i,channel:o,encoding:r}=e;return null!==(t=n.symbolType)&&void 0!==t?t:function(e,t,n,i){if("shape"!==t){var o;const e=null!==(o=Kd(n))&&void 0!==o?o:i;if(e)return e}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}(i.type,o,r.shape,i.shape)},title:e=>{let{fieldOrDatumDef:t,config:n}=e;return Ca(t,n,{allowDisabling:!0})},type:e=>{let{legendType:t,scaleType:n,channel:i}=e;if(qe(i)&&Ro(n)){if("gradient"===t)return}else if("symbol"===t)return;return t},values:e=>{let{fieldOrDatumDef:n,legend:i}=e;return function(e,n){const i=e.values;if(t.isArray(i))return Va(n,i);if(gn(i))return i;return}(i,n)}};function nf(e){const{legend:t}=e;return V(t.type,function(e){let{channel:t,timeUnit:n,scaleType:i}=e;if(qe(t)){if(y(["quarter","month","day"],n))return"symbol";if(Ro(i))return"gradient"}return"symbol"}(e))}function of(e){var t,n;let{legendConfig:i,legendType:o,orient:r,legend:a}=e;return null!==(t=null!==(n=a.direction)&&void 0!==n?n:i[o?"gradientDirection":"symbolDirection"])&&void 0!==t?t:function(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return"gradient"===t?"horizontal":void 0}}(r,o)}function rf(e,t,n,i){const o=e.getSizeSignalRef(t).signal;return{signal:"clamp(".concat(o,", ").concat(n,", ").concat(i,")")}}function af(e){const t=Wp(e)?function(e){const{encoding:t}=e,n={};for(const i of[me,...Us]){const o=Ma(t[i]);o&&e.getScaleComponent(i)&&(i===ve&&ca(o)&&o.type===xo||(n[i]=cf(e,i)))}return n}(e):function(e){const{legends:t,resolve:n}=e.component;for(const i of e.children){af(i);for(const o of C(i.component.legends))n.legend[o]=Yd(e.component.resolve,o),"shared"===n.legend[o]&&(t[o]=lf(t[o],i.component.legends[o]),t[o]||(n.legend[o]="independent",delete t[o]))}for(const i of C(t))for(const t of e.children)t.component.legends[i]&&"shared"===n.legend[i]&&delete t.component.legends[i];return t}(e);return e.component.legends=t,t}function sf(e,t,n,i){switch(t){case"disable":return void 0!==n;case"values":return!(null==n||!n.values);case"title":if("title"===t&&e===(null==i?void 0:i.title))return!0}return e===(n||{})[t]}function cf(e,t){var n,i,o;let r=e.legend(t);const{markDef:a,encoding:s,config:c}=e,l=c.legend,u=new Jd({},function(e,t){const n=e.scaleName(t);if("trail"===e.mark){if("color"===t)return{stroke:n};if("size"===t)return{strokeWidth:n}}return"color"===t?e.markDef.filled?{fill:n}:{stroke:n}:{[t]:n}}(e,t));!function(e,t,n){var i;const o=null===(i=e.fieldDef(t))||void 0===i?void 0:i.field;for(const i of P(null!==(r=e.component.selection)&&void 0!==r?r:{})){var r,a;const e=null!==(a=i.project.hasField[o])&&void 0!==a?a:i.project.hasChannel[t];if(e&&Ru.defined(i)){var s;const t=null!==(s=n.get("selections"))&&void 0!==s?s:[];t.push(i.name),n.set("selections",t,!1),e.hasLegend=!0}}}(e,t,u);const d=void 0!==r?!r:l.disable;if(u.set("disable",d,void 0!==r),d)return u;r=r||{};const f=e.getScaleComponent(t).get("type"),p=Ma(s[t]),m=ca(p)?null===(n=$i(p.timeUnit))||void 0===n?void 0:n.unit:void 0,g=r.orient||c.legend.orient||"right",h=nf({legend:r,channel:t,timeUnit:m,scaleType:f}),v={legend:r,channel:t,model:e,markDef:a,encoding:s,fieldOrDatumDef:p,legendConfig:l,config:c,scaleType:f,orient:g,legendType:h,direction:of({legend:r,legendType:h,orient:g,legendConfig:l})};for(const n of Xd){if("gradient"===h&&n.startsWith("symbol")||"symbol"===h&&n.startsWith("gradient"))continue;const i=n in tf?tf[n](v):r[n];if(void 0!==i){const o=sf(i,n,r,e.fieldDef(t));(o||void 0===c.legend[n])&&u.set(n,i,o)}}const y=null!==(i=null===(o=r)||void 0===o?void 0:o.encoding)&&void 0!==i?i:{},b=u.get("selections"),x={},w={fieldOrDatumDef:p,model:e,channel:t,legendCmpt:u,legendType:h};for(const t of["labels","legend","title","symbols","gradient","entries"]){var k;const n=Id(null!==(k=y[t])&&void 0!==k?k:{},e),i=t in Qd?Qd[t](n,w):n;void 0===i||z(i)||(x[t]={...null!=b&&b.length&&ca(p)?{name:"".concat(j(p.field),"_legend_").concat(t)}:{},...null!=b&&b.length?{interactive:!!b}:{},update:i})}var S;z(x)||u.set("encode",x,!(null===(S=r)||void 0===S||!S.encoding));return u}function lf(e,t){if(!e)return t.clone();const n=e.getWithExplicit("orient"),i=t.getWithExplicit("orient");if(n.explicit&&i.explicit&&n.value!==i.value)return;let o=!1;for(const n of Xd){const i=zl(e.getWithExplicit(n),t.getWithExplicit(n),n,"legend",((e,t)=>{switch(n){case"symbolType":return uf(e,t);case"title":return Tn(e,t);case"type":return o=!0,Fl("symbol")}return _l(e,t,n,"legend")}));e.setWithExplicit(n,i)}var r,a,s,c;o&&(null!==(r=e.implicit)&&void 0!==r&&null!==(a=r.encode)&&void 0!==a&&a.gradient&&M(e.implicit,["encode","gradient"]),null!==(s=e.explicit)&&void 0!==s&&null!==(c=s.encode)&&void 0!==c&&c.gradient&&M(e.explicit,["encode","gradient"]));return e}function uf(e,t){return"circle"===t.value?t:e}function df(e){const t=e.component.legends,n={};for(const i of C(t)){const o=e.getScaleComponent(i),r=g(o.get("domains"));if(n[r])for(const e of n[r]){lf(e,t[i])||n[r].push(t[i])}else n[r]=[t[i].clone()]}return P(n).flat().map((t=>function(e,t){var n;const{disable:i,labelExpr:o,selections:r,...a}=e.combine();if(i)return;!1===t.aria&&null==a.aria&&(a.aria=!1);if(null!==(n=a.encode)&&void 0!==n&&n.symbols){const e=a.encode.symbols.update;!e.fill||"transparent"===e.fill.value||e.stroke||a.stroke||(e.stroke={value:"transparent"});for(const t of Us)a[t]&&delete e[t]}a.title||delete a.title;if(void 0!==o){var s,c;let e=o;null!==(s=a.encode)&&void 0!==s&&null!==(c=s.labels)&&void 0!==c&&c.update&&gn(a.encode.labels.update.text)&&(e=U(o,"datum.label",a.encode.labels.update.text.signal)),function(e,t,n,i){var o,r,a,s,c;null!==(o=e.encode)&&void 0!==o||(e.encode={}),null!==(a=(r=e.encode)[t])&&void 0!==a||(r[t]={}),null!==(c=(s=e.encode[t]).update)&&void 0!==c||(s.update={}),e.encode[t].update[n]=i}(a,"labels","text",{signal:e})}return a}(t,e.config))).filter((e=>void 0!==e))}function ff(e){return Bp(e)||Up(e)?function(e){return e.children.reduce(((e,t)=>e.concat(t.assembleProjections())),pf(e))}(e):pf(e)}function pf(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:i}=n;if(t.data){const o={signal:"[".concat(t.size.map((e=>e.signal)).join(", "),"]")},r=t.data.reduce(((t,n)=>{const i=gn(n)?n.signal:"data('".concat(e.lookupDataSource(n),"')");return y(t,i)||t.push(i),t}),[]);if(r.length<=0)throw new Error("Projection's fit didn't find any data sources");return[{name:i,size:o,fit:{signal:r.length>1?"[".concat(r.join(", "),"]"):r[0]},...n}]}return[{name:i,translate:{signal:"[width / 2, height / 2]"},...n}]}const mf=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class gf extends Sl{constructor(e,t,n,i){super({...t},{name:e}),this.specifiedProjection=t,this.size=n,this.data=i,Ln(this,"merged",!1)}get isFit(){return!!this.data}}function hf(e){e.component.projection=Wp(e)?function(e){if(e.hasProjection){var t;const n=fn(e.specifiedProjection),i=!(n&&(null!=n.scale||null!=n.translate)),o=i?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:void 0,r=i?function(e){const t=[],{encoding:n}=e;for(const i of[[de,ue],[pe,fe]])(Ma(n[i[0]])||Ma(n[i[1]]))&&t.push({signal:e.getName("geojson_".concat(t.length))});e.channelHasField(ve)&&e.typedFieldDef(ve).type===xo&&t.push({signal:e.getName("geojson_".concat(t.length))});0===t.length&&t.push(e.requestDataName(Ll.Main));return t}(e):void 0,a=new gf(e.projectionName(!0),{...null!==(t=fn(e.config.projection))&&void 0!==t?t:{},...null!=n?n:{}},o,r);return a.get("type")||a.set("type","equalEarth",!1),a}return}(e):function(e){if(0===e.children.length)return;let n;for(const t of e.children)hf(t);const i=x(e.children,(e=>{const i=e.component.projection;if(i){if(n){const e=function(e,n){const i=x(mf,(i=>!t.hasOwnProperty(e.explicit,i)&&!t.hasOwnProperty(n.explicit,i)||!!(t.hasOwnProperty(e.explicit,i)&&t.hasOwnProperty(n.explicit,i)&&u(e.get(i),n.get(i)))));if(u(e.size,n.size)){if(i)return e;if(u(e.explicit,{}))return n;if(u(n.explicit,{}))return e}return null}(n,i);return e&&(n=e),!!e}return n=i,!0}return!0}));if(n&&i){const t=e.projectionName(!0),i=new gf(t,n.specifiedProjection,n.size,d(n.data));for(const n of e.children){const e=n.component.projection;e&&(e.isFit&&i.data.push(...n.component.projection.data),n.renameProjection(e.get("name"),t),e.merged=!0)}return i}return}(e)}function vf(e,t,n,i){if(Ia(t,n)){var o,r;const a=Wp(e)&&null!==(o=null!==(r=e.axis(n))&&void 0!==r?r:e.legend(n))&&void 0!==o?o:{},s=ka(t,{expr:"datum"}),c=ka(t,{expr:"datum",binSuffix:"end"});return{formulaAs:ka(t,{binSuffix:"range",forAs:!0}),formula:Vr(s,c,a.format,a.formatType,i)}}return{}}function yf(e,t){return"".concat(rn(e),"_").concat(t)}function bf(e,t,n){var i;const o=yf(null!==(i=Wa(n,void 0))&&void 0!==i?i:{},t);return e.getName("".concat(o,"_bins"))}function xf(e,n,i){let o,r;o=function(e){return"as"in e}(e)?t.isString(e.as)?[e.as,"".concat(e.as,"_end")]:[e.as[0],e.as[1]]:[ka(e,{forAs:!0}),ka(e,{binSuffix:"end",forAs:!0})];const a={...Wa(n,void 0)},s=yf(a,e.field),{signal:c,extentSignal:l}=function(e,t){return{signal:e.getName("".concat(t,"_bins")),extentSignal:e.getName("".concat(t,"_extent"))}}(i,s);if(ln(a.extent)){const e=a.extent;r=ld(i,e.param,e),delete a.extent}return{key:s,binComponent:{bin:a,field:e.field,as:[o],...c?{signal:c}:{},...l?{extentSignal:l}:{},...r?{span:r}:{}}}}class wf extends Hl{clone(){return new wf(null,d(this.bins))}constructor(e,t){super(e),this.bins=t}static makeFromEncoding(e,t){const n=t.reduceFieldDef(((e,n,i)=>{if(ma(n)&&an(n.bin)){const{key:o,binComponent:r}=xf(n,n.bin,t);e[o]={...r,...e[o],...vf(t,n,i,t.config)}}return e}),{});return z(n)?null:new wf(e,n)}static makeFromTransform(e,t,n){const{key:i,binComponent:o}=xf(t,t.bin,n);return new wf(e,{[i]:o})}merge(e,t){for(const n of C(e.bins))n in this.bins?(t(e.bins[n].signal,this.bins[n].signal),this.bins[n].as=S([...this.bins[n].as,...e.bins[n].as],h)):this.bins[n]=e.bins[n];for(const t of e.children)e.removeChild(t),t.parent=this;e.remove()}producedFields(){return new Set(P(this.bins).map((e=>e.as)).flat(2))}dependentFields(){return new Set(P(this.bins).map((e=>e.field)))}hash(){return"Bin ".concat(h(this.bins))}assemble(){return P(this.bins).flatMap((e=>{const t=[],[n,...i]=e.as,{extent:o,...r}=e.bin,a={type:"bin",field:R(e.field),as:n,signal:e.signal,...ln(o)?{extent:null}:{extent:o},...e.span?{span:{signal:"span(".concat(e.span,")")}}:{},...r};!o&&e.extentSignal&&(t.push({type:"extent",field:R(e.field),signal:e.extentSignal}),a.extent={signal:e.extentSignal}),t.push(a);for(const e of i)for(let i=0;i<2;i++)t.push({type:"formula",expr:ka({field:n[i]},{expr:"datum"}),as:e[i]});return e.formula&&t.push({type:"formula",expr:e.formula,as:e.formulaAs}),t}))}}function kf(e,n,i,o){var r;const a=Wp(o)?o.encoding[nt(n)]:void 0;if(ma(i)&&Wp(o)&&oa(i,a,o.markDef,o.config))e.add(ka(i,{})),e.add(ka(i,{suffix:"end"})),i.bin&&Ia(i,n)&&e.add(ka(i,{binSuffix:"range"}));else if(n in Me){const t=function(e){switch(e){case ue:return"y";case fe:return"y2";case de:return"x";case pe:return"x2"}}(n);e.add(o.getName(t))}else e.add(ka(i));return ha(i)&&function(e){return t.isObject(e)&&"field"in e}(null===(r=i.scale)||void 0===r?void 0:r.range)&&e.add(i.scale.range.field),e}class Sf extends Hl{clone(){return new Sf(null,new Set(this.dimensions),d(this.measures))}constructor(e,t,n){super(e),this.dimensions=t,this.measures=n}get groupBy(){return this.dimensions}static makeFromEncoding(e,t){let n=!1;t.forEachFieldDef((e=>{e.aggregate&&(n=!0)}));const i={},o=new Set;return n?(t.forEachFieldDef(((e,n)=>{const{aggregate:r,field:a}=e;if(r)if("count"===r){var s;null!==(s=i["*"])&&void 0!==s||(i["*"]={}),i["*"].count=new Set([ka(e,{forAs:!0})])}else{if($t(r)||Kt(r)){var c;const e=$t(r)?"argmin":"argmax",t=r[e];null!==(c=i[t])&&void 0!==c||(i[t]={}),i[t][e]=new Set([ka({op:e,field:t},{forAs:!0})])}else{var l;null!==(l=i[a])&&void 0!==l||(i[a]={}),i[a][r]=new Set([ka(e,{forAs:!0})])}var u;if(Ht(n)&&"unaggregated"===t.scaleDomain(n))null!==(u=i[a])&&void 0!==u||(i[a]={}),i[a].min=new Set([ka({field:a,aggregate:"min"},{forAs:!0})]),i[a].max=new Set([ka({field:a,aggregate:"max"},{forAs:!0})])}else kf(o,n,e,t)})),o.size+C(i).length===0?null:new Sf(e,o,i)):null}static makeFromTransform(e,t){const n=new Set,i={};for(const e of t.aggregate){const{op:t,field:n,as:a}=e;var o,r;if(t)if("count"===t)null!==(o=i["*"])&&void 0!==o||(i["*"]={}),i["*"].count=new Set([a||ka(e,{forAs:!0})]);else null!==(r=i[n])&&void 0!==r||(i[n]={}),i[n][t]=new Set([a||ka(e,{forAs:!0})])}for(const e of null!==(a=t.groupby)&&void 0!==a?a:[]){var a;n.add(e)}return n.size+C(i).length===0?null:new Sf(e,n,i)}merge(e){return D(this.dimensions,e.dimensions)?(function(e,t){for(const i of C(t)){const o=t[i];for(const t of C(o)){var n;i in e?e[i][t]=new Set([...null!==(n=e[i][t])&&void 0!==n?n:[],...o[t]]):e[i]={[t]:o[t]}}}}(this.measures,e.measures),!0):(function(){Pi.debug(...arguments)}("different dimensions, cannot merge"),!1)}addDimensions(e){e.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...C(this.measures)])}producedFields(){const e=new Set;for(const t of C(this.measures))for(const n of C(this.measures[t])){const i=this.measures[t][n];0===i.size?e.add("".concat(n,"_").concat(t)):i.forEach(e.add,e)}return e}hash(){return"Aggregate ".concat(h({dimensions:this.dimensions,measures:this.measures}))}assemble(){const e=[],t=[],n=[];for(const i of C(this.measures))for(const o of C(this.measures[i]))for(const r of this.measures[i][o])n.push(r),e.push(o),t.push("*"===i?null:R(i));return{type:"aggregate",groupby:[...this.dimensions].map(R),ops:e,fields:t,as:n}}}class Df extends Hl{constructor(e,n,i,o){super(e),this.model=n,this.name=i,this.data=o,Ln(this,"column",void 0),Ln(this,"row",void 0),Ln(this,"facet",void 0),Ln(this,"childModel",void 0);for(const e of Re){const i=n.facet[e];if(i){const{bin:o,sort:r}=i;this[e]={name:n.getName("".concat(e,"_domain")),fields:[ka(i),...an(o)?[ka(i,{binSuffix:"end"})]:[]],...Jr(r)?{sortField:r}:t.isArray(r)?{sortIndexField:Dd(i,e)}:{}}}}this.childModel=n.child}hash(){let e="Facet";for(const t of Re)this[t]&&(e+=" ".concat(t.charAt(0),":").concat(h(this[t])));return e}get fields(){const e=[];for(const n of Re){var t;null!==(t=this[n])&&void 0!==t&&t.fields&&e.push(...this[n].fields)}return e}dependentFields(){const e=new Set(this.fields);for(const t of Re)this[t]&&(this[t].sortField&&e.add(this[t].sortField.field),this[t].sortIndexField&&e.add(this[t].sortIndexField));return e}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const e={};for(const t of Dt){const n=this.childModel.component.scales[t];if(n&&!n.merged){const i=n.get("type"),o=n.get("range");if(qo(i)&&hn(o)){const n=gp(hp(this.childModel,t));n?e[t]=n:ji(Gn(t))}}}return e}assembleRowColumnHeaderData(e,t,n){const i={row:"y",column:"x",facet:void 0}[e],o=[],r=[],a=[];i&&n&&n[i]&&(t?(o.push("distinct_".concat(n[i])),r.push("max")):(o.push(n[i]),r.push("distinct")),a.push("distinct_".concat(n[i])));const{sortField:s,sortIndexField:c}=this[e];if(s){const{op:e=Ir,field:t}=s;o.push(t),r.push(e),a.push(ka(s,{forAs:!0}))}else c&&(o.push(c),r.push("max"),a.push(c));return{name:this[e].name,source:null!=t?t:this.data,transform:[{type:"aggregate",groupby:this[e].fields,...o.length?{fields:o,ops:r,as:a}:{}}]}}assembleFacetHeaderData(e){const{columns:t}=this.model.layout,{layoutHeaders:n}=this.model.component,i=[],o={};for(const e of zd){for(const t of Cd){var r;const i=null!==(r=n[e]&&n[e][t])&&void 0!==r?r:[];for(const t of i){var a;if((null===(a=t.axes)||void 0===a?void 0:a.length)>0){o[e]=!0;break}}}if(o[e]){const n='length(data("'.concat(this.facet.name,'"))'),o="row"===e?t?{signal:"ceil(".concat(n," / ").concat(t,")")}:1:t?{signal:"min(".concat(n,", ").concat(t,")")}:{signal:n};i.push({name:"".concat(this.facet.name,"_").concat(e),transform:[{type:"sequence",start:0,stop:o}]})}}const{row:s,column:c}=o;return(s||c)&&i.unshift(this.assembleRowColumnHeaderData("facet",null,e)),i}assemble(){const e=[];let t=null;const n=this.getChildIndependentFieldsWithStep(),{column:i,row:o,facet:r}=this;if(i&&o&&(n.x||n.y)){var a,s;t="cross_".concat(this.column.name,"_").concat(this.row.name);const i=[].concat(null!==(a=n.x)&&void 0!==a?a:[],null!==(s=n.y)&&void 0!==s?s:[]),o=i.map((()=>"distinct"));e.push({name:t,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:i,ops:o}]})}for(const i of[K,$])this[i]&&e.push(this.assembleRowColumnHeaderData(i,t,n));if(r){const t=this.assembleFacetHeaderData(n);t&&e.push(...t)}return e}}function Ff(e){return e.startsWith("'")&&e.endsWith("'")||e.startsWith('"')&&e.endsWith('"')?e.slice(1,-1):e}function Of(e){const n={};return c(e.filter,(e=>{if(so(e)){let o=null;if(Zi(e))o=kn(e.equal);else if(to(e))o=kn(e.lte);else if(eo(e))o=kn(e.lt);else if(no(e))o=kn(e.gt);else if(io(e))o=kn(e.gte);else if(oo(e))o=e.range[0];else if(ro(e)){var i;o=(null!==(i=e.oneOf)&&void 0!==i?i:e.in)[0]}o&&(Ei(o)?n[e.field]="date":t.isNumber(o)?n[e.field]="number":t.isString(o)&&(n[e.field]="string")),e.timeUnit&&(n[e.field]="date")}})),n}function _f(e){const n={};function i(e){var i;Ba(e)?n[e.field]="date":"quantitative"===e.type&&(i=e.aggregate,t.isString(i)&&y(["min","max"],i))?n[e.field]="number":H(e.field)>1?e.field in n||(n[e.field]="flatten"):ha(e)&&Jr(e.sort)&&H(e.sort.field)>1&&(e.sort.field in n||(n[e.sort.field]="flatten"))}if((Wp(e)||Rp(e))&&e.forEachFieldDef(((t,n)=>{if(ma(t))i(t);else{const o=et(n),r=e.fieldDef(o);i({...t,type:r.type})}})),Wp(e)){const{mark:t,markDef:i,encoding:o}=e;if(hr(t)&&!e.encoding.order){const e=o["horizontal"===i.orient?"y":"x"];ca(e)&&"quantitative"===e.type&&!(e.field in n)&&(n[e.field]="number")}}return n}class zf extends Hl{clone(){return new zf(null,d(this._parse))}constructor(e,t){super(e),Ln(this,"_parse",void 0),this._parse=t}hash(){return"Parse ".concat(h(this._parse))}static makeExplicit(e,t,n){var i;let o={};const r=t.data;return!jl(r)&&null!=r&&null!==(i=r.format)&&void 0!==i&&i.parse&&(o=r.format.parse),this.makeWithAncestors(e,o,{},n)}static makeWithAncestors(e,t,n,i){for(const e of C(n)){const t=i.getWithExplicit(e);void 0!==t.value&&(t.explicit||t.value===n[e]||"derived"===t.value||"flatten"===n[e]?delete n[e]:ji(Kn(e,n[e],t.value)))}for(const e of C(t)){const n=i.get(e);void 0!==n&&(n===t[e]?delete t[e]:ji(Kn(e,t[e],n)))}const o=new Sl(t,n);i.copyAll(o);const r={};for(const e of C(o.combine())){const t=o.get(e);null!==t&&(r[e]=t)}return 0===C(r).length||i.parseNothing?null:new zf(e,r)}get parse(){return this._parse}merge(e){this._parse={...this._parse,...e.parse},e.remove()}assembleFormatParse(){const e={};for(const t of C(this._parse)){const n=this._parse[t];1===H(t)&&(e[t]=n)}return e}producedFields(){return new Set(C(this._parse))}dependentFields(){return new Set(C(this._parse))}assembleTransforms(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return C(this._parse).filter((t=>!e||H(t)>1)).map((e=>{const t=function(e,t){const n=L(e);if("number"===t)return"toNumber(".concat(n,")");if("boolean"===t)return"toBoolean(".concat(n,")");if("string"===t)return"toString(".concat(n,")");if("date"===t)return"toDate(".concat(n,")");if("flatten"===t)return n;if(t.startsWith("date:")){const e=Ff(t.slice(5,t.length));return"timeParse(".concat(n,",'").concat(e,"')")}if(t.startsWith("utc:")){const e=Ff(t.slice(4,t.length));return"utcParse(".concat(n,",'").concat(e,"')")}return ji('Unrecognized parse "'.concat(t,'".')),null}(e,this._parse[e]);if(!t)return null;return{type:"formula",expr:t,as:B(e)}})).filter((e=>null!==e))}}class Cf extends Hl{clone(){return new Cf(null)}constructor(e){super(e)}dependentFields(){return new Set}producedFields(){return new Set([Bs])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:Bs}}}class Pf extends Hl{clone(){return new Pf(null,this.params)}constructor(e,t){super(e),this.params=t}dependentFields(){return new Set}producedFields(){}hash(){return"Graticule ".concat(h(this.params))}assemble(){return{type:"graticule",...!0===this.params?{}:this.params}}}class Af extends Hl{clone(){return new Af(null,this.params)}constructor(e,t){super(e),this.params=t}dependentFields(){return new Set}producedFields(){var e;return new Set([null!==(e=this.params.as)&&void 0!==e?e:"data"])}hash(){return"Hash ".concat(h(this.params))}assemble(){return{type:"sequence",...this.params}}}class Nf extends Hl{constructor(e){var t;let n;if(super(null),Ln(this,"_data",void 0),Ln(this,"_name",void 0),Ln(this,"_generator",void 0),null!==(t=e)&&void 0!==t||(e={name:"source"}),jl(e)||(n=e.format?{...m(e.format,["parse"])}:{}),Al(e))this._data={values:e.values};else if(Pl(e)){if(this._data={url:e.url},!n.type){let t=/(?:\.([^.]+))?$/.exec(e.url)[1];y(["json","csv","tsv","dsv","topojson"],t)||(t="json"),n.type=t}}else Ml(e)?this._data={values:[{type:"Sphere"}]}:(Nl(e)||jl(e))&&(this._data={});this._generator=jl(e),e.name&&(this._name=e.name),n&&!z(n)&&(this._data.format=n)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(e){this._name=e}set parent(e){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return{name:this._name,...this._data,transform:[]}}}function jf(e){return e instanceof Nf||e instanceof Pf||e instanceof Af}var Ef=new WeakMap;class Mf{constructor(){Rn(this,Ef,{writable:!0,value:void 0}),qn(this,Ef,!1)}setModified(){qn(this,Ef,!0)}get modifiedFlag(){return function(e,t){return t.get?t.get.call(e):t.value}(e=this,Wn(e,Ef,"get"));var e}}class Tf extends Mf{getNodeDepths(e,t,n){n.set(e,t);for(const i of e.children)this.getNodeDepths(i,t+1,n);return n}optimize(e){const t=[...this.getNodeDepths(e,0,new Map).entries()].sort(((e,t)=>t[1]-e[1]));for(const e of t)this.run(e[0]);return this.modifiedFlag}}class Lf extends Mf{optimize(e){this.run(e);for(const t of e.children)this.optimize(t);return this.modifiedFlag}}class qf extends Lf{mergeNodes(e,t){const n=t.shift();for(const i of t)e.removeChild(i),i.parent=n,i.remove()}run(e){const t=e.children.map((e=>e.hash())),n={};for(let i=0;i<t.length;i++)void 0===n[t[i]]?n[t[i]]=[e.children[i]]:n[t[i]].push(e.children[i]);for(const t of C(n))n[t].length>1&&(this.setModified(),this.mergeNodes(e,n[t]))}}class Wf extends Lf{constructor(e){super(),Ln(this,"requiresSelectionId",void 0),this.requiresSelectionId=e&&nd(e)}run(e){e instanceof Cf&&(this.requiresSelectionId&&(jf(e.parent)||e.parent instanceof Sf||e.parent instanceof zf)||(this.setModified(),e.remove()))}}class Rf extends Mf{optimize(e){return this.run(e,new Set),this.modifiedFlag}run(e,t){let n=new Set;e instanceof Il&&(n=e.producedFields(),F(n,t)&&(this.setModified(),e.removeFormulas(t),0===e.producedFields.length&&e.remove()));for(const i of e.children)this.run(i,new Set([...t,...n]))}}class Uf extends Lf{constructor(){super()}run(e){e instanceof Vl&&!e.isRequired()&&(this.setModified(),e.remove())}}class Bf extends Tf{run(e){if(!(jf(e)||e.numChildren()>1))for(const t of e.children)if(t instanceof zf)if(e instanceof zf)this.setModified(),e.merge(t);else{if(_(e.producedFields(),t.dependentFields()))continue;this.setModified(),t.swapWithParent()}}}class Hf extends Tf{run(e){const t=[...e.children],n=e.children.filter((e=>e instanceof zf));if(e.numChildren()>1&&n.length>=1){const i={},o=new Set;for(const e of n){const t=e.parse;for(const e of C(t))e in i?i[e]!==t[e]&&o.add(e):i[e]=t[e]}for(const e of o)delete i[e];if(!z(i)){this.setModified();const n=new zf(e,i);for(const o of t){if(o instanceof zf)for(const e of C(i))delete o.parse[e];e.removeChild(o),o.parent=n,o instanceof zf&&0===C(o.parse).length&&o.remove()}}}}}class Vf extends Tf{run(e){e instanceof Vl||e.numChildren()>0||e instanceof Df||e instanceof Nf||(this.setModified(),e.remove())}}class If extends Tf{run(e){const t=e.children.filter((e=>e instanceof Il)),n=t.pop();for(const e of t)this.setModified(),n.merge(e)}}class Gf extends Tf{run(e){const t=e.children.filter((e=>e instanceof Sf)),n={};for(const e of t){const t=h(e.groupBy);t in n||(n[t]=[]),n[t].push(e)}for(const t of C(n)){const i=n[t];if(i.length>1){const t=i.pop();for(const n of i)t.merge(n)&&(e.removeChild(n),n.parent=t,n.remove(),this.setModified())}}}}class Yf extends Tf{constructor(e){super(),this.model=e}run(e){const t=!(jf(e)||e instanceof sd||e instanceof zf||e instanceof Cf),n=[],i=[];for(const o of e.children)o instanceof wf&&(t&&!_(e.producedFields(),o.dependentFields())?n.push(o):i.push(o));if(n.length>0){const t=n.pop();for(const e of n)t.merge(e,this.model.renameSignal.bind(this.model));this.setModified(),e instanceof wf?e.merge(t,this.model.renameSignal.bind(this.model)):t.swapWithParent()}if(i.length>1){const e=i.pop();for(const t of i)e.merge(t,this.model.renameSignal.bind(this.model));this.setModified()}}}class Xf extends Tf{run(e){const t=[...e.children];if(!b(t,(e=>e instanceof Vl))||e.numChildren()<=1)return;const n=[];let i;for(const o of t)if(o instanceof Vl){let t=o;for(;1===t.numChildren();){const[e]=t.children;if(!(e instanceof Vl))break;t=e}n.push(...t.children),i?(e.removeChild(o),o.parent=i.parent,i.parent.removeChild(i),i.parent=t,this.setModified()):i=t}else n.push(o);if(n.length){this.setModified();for(const e of n)e.parent.removeChild(e),e.parent=i}}}class Jf extends Hl{clone(){return new Jf(null,d(this.transform))}constructor(e,t){super(e),this.transform=t}addDimensions(e){this.transform.groupby=S(this.transform.groupby.concat(e),(e=>e))}dependentFields(){const e=new Set;return this.transform.groupby&&this.transform.groupby.forEach(e.add,e),this.transform.joinaggregate.map((e=>e.field)).filter((e=>void 0!==e)).forEach(e.add,e),e}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(e){var t;return null!==(t=e.as)&&void 0!==t?t:ka(e)}hash(){return"JoinAggregateTransform ".concat(h(this.transform))}assemble(){const e=[],t=[],n=[];for(const i of this.transform.joinaggregate)t.push(i.op),n.push(this.getDefaultName(i)),e.push(void 0===i.field?null:i.field);const i=this.transform.groupby;return{type:"joinaggregate",as:n,ops:t,fields:e,...void 0!==i?{groupby:i}:{}}}}class Qf extends Hl{clone(){return new Qf(null,d(this._stack))}constructor(e,t){super(e),Ln(this,"_stack",void 0),this._stack=t}static makeFromTransform(e,n){const{stack:i,groupby:o,as:r,offset:a="zero"}=n,s=[],c=[];if(void 0!==n.sort)for(const e of n.sort)s.push(e.field),c.push(V(e.order,"ascending"));const l={field:s,order:c};let u;return u=function(e){return t.isArray(e)&&e.every((e=>t.isString(e)))&&e.length>1}(r)?r:t.isString(r)?[r,"".concat(r,"_end")]:["".concat(n.stack,"_start"),"".concat(n.stack,"_end")],new Qf(e,{dimensionFieldDefs:[],stackField:i,groupby:o,offset:a,sort:l,facetby:[],as:u})}static makeFromEncoding(e,n){const i=n.stack,{encoding:o}=n;if(!i)return null;const{groupbyChannels:r,fieldChannel:a,offset:s,impute:c}=i,l=r.map((e=>Ea(o[e]))).filter((e=>!!e)),u=function(e){return e.stack.stackBy.reduce(((e,t)=>{const n=ka(t.fieldDef);return n&&e.push(n),e}),[])}(n),d=n.encoding.order;let f;return f=t.isArray(d)||ca(d)?jn(d):u.reduce(((e,t)=>(e.field.push(t),e.order.push("y"===a?"descending":"ascending"),e)),{field:[],order:[]}),new Qf(e,{dimensionFieldDefs:l,stackField:n.vgField(a),facetby:[],stackby:u,sort:f,offset:s,impute:c,as:[n.vgField(a,{suffix:"start",forAs:!0}),n.vgField(a,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(e){this._stack.facetby.push(...e)}dependentFields(){const e=new Set;return e.add(this._stack.stackField),this.getGroupbyFields().forEach(e.add,e),this._stack.facetby.forEach(e.add,e),this._stack.sort.field.forEach(e.add,e),e}producedFields(){return new Set(this._stack.as)}hash(){return"Stack ".concat(h(this._stack))}getGroupbyFields(){const{dimensionFieldDefs:e,impute:t,groupby:n}=this._stack;return e.length>0?e.map((e=>e.bin?t?[ka(e,{binSuffix:"mid"})]:[ka(e,{}),ka(e,{binSuffix:"end"})]:[ka(e)])).flat():null!=n?n:[]}assemble(){const e=[],{facetby:t,dimensionFieldDefs:n,stackField:i,stackby:o,sort:r,offset:a,impute:s,as:c}=this._stack;if(s)for(const r of n){const{bandPosition:n=.5,bin:a}=r;if(a){const t=ka(r,{expr:"datum"}),i=ka(r,{expr:"datum",binSuffix:"end"});e.push({type:"formula",expr:"".concat(n,"*").concat(t,"+").concat(1-n,"*").concat(i),as:ka(r,{binSuffix:"mid",forAs:!0})})}e.push({type:"impute",field:i,groupby:[...o,...t],key:ka(r,{binSuffix:"mid"}),method:"value",value:0})}return e.push({type:"stack",groupby:[...this.getGroupbyFields(),...t],field:i,sort:r,as:c,offset:a}),e}}class $f extends Hl{clone(){return new $f(null,d(this.transform))}constructor(e,t){super(e),this.transform=t}addDimensions(e){this.transform.groupby=S(this.transform.groupby.concat(e),(e=>e))}dependentFields(){var e,t;const n=new Set;return(null!==(e=this.transform.groupby)&&void 0!==e?e:[]).forEach(n.add,n),(null!==(t=this.transform.sort)&&void 0!==t?t:[]).forEach((e=>n.add(e.field))),this.transform.window.map((e=>e.field)).filter((e=>void 0!==e)).forEach(n.add,n),n}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(e){var t;return null!==(t=e.as)&&void 0!==t?t:ka(e)}hash(){return"WindowTransform ".concat(h(this.transform))}assemble(){const e=[],t=[],n=[],i=[];for(const o of this.transform.window)t.push(o.op),n.push(this.getDefaultName(o)),i.push(void 0===o.param?null:o.param),e.push(void 0===o.field?null:o.field);const o=this.transform.frame,r=this.transform.groupby;if(o&&null===o[0]&&null===o[1]&&t.every((e=>Zt(e))))return{type:"joinaggregate",as:n,ops:t,fields:e,...void 0!==r?{groupby:r}:{}};const a=[],s=[];if(void 0!==this.transform.sort)for(const e of this.transform.sort){var c;a.push(e.field),s.push(null!==(c=e.order)&&void 0!==c?c:"ascending")}const l={field:a,order:s},u=this.transform.ignorePeers;return{type:"window",params:i,as:n,ops:t,fields:e,sort:l,...void 0!==u?{ignorePeers:u}:{},...void 0!==r?{groupby:r}:{},...void 0!==o?{frame:o}:{}}}}function Kf(e){if(e instanceof Df)if(1!==e.numChildren()||e.children[0]instanceof Vl){const n=e.model.component.data.main;Zf(n);const i=(t=e,function e(n){if(!(n instanceof Df)){const i=n.clone();if(i instanceof Vl){const e=ep+i.getSource();i.setSource(e),t.model.component.data.outputNodes[e]=i}else(i instanceof Sf||i instanceof Qf||i instanceof $f||i instanceof Jf)&&i.addDimensions(t.fields);for(const t of n.children.flatMap(e))t.parent=i;return[i]}return n.children.flatMap(e)}),o=e.children.map(i).flat();for(const e of o)e.parent=n}else{const t=e.children[0];(t instanceof Sf||t instanceof Qf||t instanceof $f||t instanceof Jf)&&t.addDimensions(e.fields),t.swapWithParent(),Kf(e)}else e.children.map(Kf);var t}function Zf(e){if(e instanceof Vl&&e.type===Ll.Main&&1===e.numChildren()){const t=e.children[0];t instanceof Df||(t.swapWithParent(),Zf(e))}}const ep="scale_";function tp(e){for(const t of e){for(const e of t.children)if(e.parent!==t)return!1;if(!tp(t.children))return!1}return!0}function np(e,t){let n=!1;for(const i of t)n=e.optimize(i)||n;return n}function ip(e,t,n){let i=e.sources,o=!1;return o=np(new Uf,i)||o,o=np(new Wf(t),i)||o,i=i.filter((e=>e.numChildren()>0)),o=np(new Vf,i)||o,i=i.filter((e=>e.numChildren()>0)),n||(o=np(new Bf,i)||o,o=np(new Yf(t),i)||o,o=np(new Rf,i)||o,o=np(new Hf,i)||o,o=np(new Gf,i)||o,o=np(new If,i)||o,o=np(new qf,i)||o,o=np(new Xf,i)||o),e.sources=i,o}function op(e,t){tp(e.sources);let n=0,i=0;for(let i=0;i<5&&ip(e,t,!0);i++)n++;e.sources.map(Kf);for(let n=0;n<5&&ip(e,t,!1);n++)i++;tp(e.sources),5===Math.max(n,i)&&ji("Maximum optimization runs(".concat(5,") reached."))}class rp{constructor(e){Ln(this,"signal",void 0),Object.defineProperty(this,"signal",{enumerable:!0,get:e})}static fromName(e,t){return new rp((()=>e(t)))}}function ap(e){Wp(e)?function(e){const t=e.component.scales;for(const n of C(t)){const i=sp(e,n);if(t[n].setWithExplicit("domains",i),dp(e,n),e.component.data.isFaceted){let t=e;for(;!Rp(t)&&t.parent;)t=t.parent;if("shared"===t.component.resolve.scale[n])for(const e of i.value)vn(e)&&(e.data=ep+e.data.replace(ep,""))}}}(e):function(e){for(const t of e.children)ap(t);const t=e.component.scales;for(const n of C(t)){let i,o=null;for(const t of e.children){const e=t.component.scales[n];if(e){i=void 0===i?e.getWithExplicit("domains"):zl(i,e.getWithExplicit("domains"),"domains","scale",pp);const t=e.get("selectionExtent");o&&t&&o.param!==t.param&&ji(Qn),o=t}}t[n].setWithExplicit("domains",i),o&&t[n].set("selectionExtent",o,!0)}}(e)}function sp(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:i}=e,o=function(e,t,n,i){if("unaggregated"===e){const{valid:e,reason:i}=fp(t,n);if(!e)return void ji(i)}else if(void 0===e&&i.useUnaggregatedDomain){const{valid:e}=fp(t,n);if(e)return"unaggregated"}return e}(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return o!==e.scaleDomain(t)&&(e.specifiedScales[t]={...e.specifiedScales[t],domain:o}),"x"===t&&Ma(i.x2)?Ma(i.x)?zl(lp(n,o,e,"x"),lp(n,o,e,"x2"),"domain","scale",pp):lp(n,o,e,"x2"):"y"===t&&Ma(i.y2)?Ma(i.y)?zl(lp(n,o,e,"y"),lp(n,o,e,"y2"),"domain","scale",pp):lp(n,o,e,"y2"):lp(n,o,e,t)}function cp(e,t,n){var i;const o=null===(i=$i(n))||void 0===i?void 0:i.unit;return"temporal"===t||o?function(e,t,n){return e.map((e=>{const i=Ha(e,{timeUnit:n,type:t});return{signal:"{data: ".concat(i,"}")}}))}(e,t,o):[e]}function lp(e,n,i,o){const{encoding:r}=i,a=Ma(r[o]),{type:s}=a,c=a.timeUnit;if(function(e){return e&&e.unionWith}(n)){const t=lp(e,void 0,i,o),r=cp(n.unionWith,s,c);return Dl([...t.value,...r])}if(gn(n))return Dl([n]);if(n&&"unaggregated"!==n&&!Bo(n))return Dl(cp(n,s,c));const l=i.stack;if(l&&o===l.fieldChannel){if("normalize"===l.offset)return Fl([[0,1]]);const e=i.requestDataName(Ll.Main);return Fl([{data:e,field:i.vgField(o,{suffix:"start"})},{data:e,field:i.vgField(o,{suffix:"end"})}])}const u=Ht(o)&&ca(a)?function(e,t,n){if(!qo(n))return;const i=e.fieldDef(t),o=i.sort;if(Qr(o))return{op:"min",field:Dd(i,t),order:"ascending"};const{stack:r}=e,a=r?new Set([...r.groupbyFields,...r.stackBy.map((e=>e.fieldDef.field))]):void 0;if(Jr(o)){return up(o,r&&!a.has(o.field))}if(Xr(o)){const{encoding:t,order:n}=o,i=e.fieldDef(t),{aggregate:s,field:c}=i,l=r&&!a.has(c);if($t(s)||Kt(s))return up({field:ka(i),order:n},l);if(Zt(s)||!s)return up({op:s,field:c,order:n},l)}else{if("descending"===o)return{op:"min",field:e.vgField(t),order:"descending"};if(y(["ascending",void 0],o))return!0}return}(i,o,e):void 0;if(ua(a)){return Fl(cp([a.datum],s,c))}const d=a;if("unaggregated"===n){const e=i.requestDataName(Ll.Main),{field:t}=a;return Fl([{data:e,field:ka({field:t,aggregate:"min"})},{data:e,field:ka({field:t,aggregate:"max"})}])}if(an(d.bin)){if(qo(e))return Fl("bin-ordinal"===e?[]:[{data:N(u)?i.requestDataName(Ll.Main):i.requestDataName(Ll.Raw),field:i.vgField(o,Ia(d,o)?{binSuffix:"range"}:{}),sort:!0!==u&&t.isObject(u)?u:{field:i.vgField(o,{}),op:"min"}}]);{const{bin:e}=d;if(an(e)){const t=bf(i,d.field,e);return Fl([new rp((()=>{const e=i.getSignalName(t);return"[".concat(e,".start, ").concat(e,".stop]")}))])}return Fl([{data:i.requestDataName(Ll.Main),field:i.vgField(o,{})}])}}if(d.timeUnit&&y(["time","utc"],e)&&oa(d,Wp(i)?i.encoding[nt(o)]:void 0,i.markDef,i.config)){const e=i.requestDataName(Ll.Main);return Fl([{data:e,field:i.vgField(o)},{data:e,field:i.vgField(o,{suffix:"end"})}])}return Fl(u?[{data:N(u)?i.requestDataName(Ll.Main):i.requestDataName(Ll.Raw),field:i.vgField(o),sort:u}]:[{data:i.requestDataName(Ll.Main),field:i.vgField(o)}])}function up(e,t){const{op:n,field:i,order:o}=e;return{op:null!=n?n:t?"sum":Ir,...i?{field:R(i)}:{},...o?{order:o}:{}}}function dp(e,t){var n;const i=e.component.scales[t],o=e.specifiedScales[t].domain,r=null===(n=e.fieldDef(t))||void 0===n?void 0:n.bin,a=Bo(o)&&o,s=cn(r)&&ln(r.extent)&&r.extent;(a||s)&&i.set("selectionExtent",null!=a?a:s,!0)}function fp(e,n){const{aggregate:i,type:o}=e;return i?t.isString(i)&&!on.has(i)?{valid:!1,reason:gi(i)}:"quantitative"===o&&"log"===n?{valid:!1,reason:hi(e)}:{valid:!0}:{valid:!1,reason:mi(e)}}function pp(e,t,n,i){return e.explicit&&t.explicit&&ji(function(e,t,n,i){return"Conflicting ".concat(t.toString(),' property "').concat(e.toString(),'" (').concat(g(n)," and ").concat(g(i),"). Using the union of the two domains.")}(n,i,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function mp(e){const n=S(e.map((e=>{if(vn(e)){const{sort:t,...n}=e;return n}return e})),h),i=S(e.map((e=>{if(vn(e)){const t=e.sort;return void 0===t||N(t)||("op"in t&&"count"===t.op&&delete t.field,"ascending"===t.order&&delete t.order),t}})).filter((e=>void 0!==e)),h);if(0===n.length)return;if(1===n.length){const n=e[0];if(vn(n)&&i.length>0){let e=i[0];if(i.length>1)ji(wi),e=!0;else if(t.isObject(e)&&"field"in e){const t=e.field;n.field===t&&(e=!e.order||{order:e.order})}return{...n,sort:e}}return n}const o=S(i.map((e=>N(e)||!("op"in e)||t.isString(e.op)&&e.op in Qt?e:(ji(function(e){return"Dropping sort property ".concat(g(e),' as unioned domains only support boolean or op "count", "min", and "max".')}(e)),!0))),h);let r;1===o.length?r=o[0]:o.length>1&&(ji(wi),r=!0);const a=S(e.map((e=>vn(e)?e.data:null)),(e=>e));if(1===a.length&&null!==a[0]){return{data:a[0],fields:n.map((e=>e.field)),...r?{sort:r}:{}}}return{fields:n,...r?{sort:r}:{}}}function gp(e){if(vn(e)&&t.isString(e.field))return e.field;if(function(e){return!t.isArray(e)&&"fields"in e&&!("data"in e)}(e)){let n;for(const i of e.fields)if(vn(i)&&t.isString(i.field))if(n){if(n!==i.field)return ji("Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect."),n}else n=i.field;return ji("Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect."),n}if(function(e){return!t.isArray(e)&&"fields"in e&&"data"in e}(e)){ji("Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.");const n=e.fields[0];return t.isString(n)?n:void 0}}function hp(e,t){const n=e.component.scales[t].get("domains").map((t=>(vn(t)&&(t.data=e.lookupDataSource(t.data)),t)));return mp(n)}function vp(e){return Bp(e)||Up(e)?e.children.reduce(((e,t)=>e.concat(vp(t))),yp(e)):yp(e)}function yp(e){return C(e.component.scales).reduce(((n,i)=>{const o=e.component.scales[i];if(o.merged)return n;const r=o.combine(),{name:a,type:s,selectionExtent:c,domains:l,range:u,reverse:d,...f}=r,p=function(e,n,i,o){if(Ft(i)){if(hn(e))return{step:{signal:"".concat(n,"_step")}}}else if(t.isObject(e)&&vn(e))return{...e,data:o.lookupDataSource(e.data)};return e}(r.range,a,i,e),m=hp(e,i),g=c?function(e,n,i,o){const r=ld(e,n.param,n);return{signal:Wo(i.get("type"))&&t.isArray(o)&&o[0]>o[1]?"isValid(".concat(r,") && reverse(").concat(r,")"):r}}(e,c,o,m):null;return n.push({name:a,type:s,...m?{domain:m}:{},...g?{domainRaw:g}:{},range:p,...void 0!==d?{reverse:d}:{},...f}),n}),[])}class bp extends Sl{constructor(e,t){super({},{name:e}),Ln(this,"merged",!1),this.setWithExplicit("type",t)}domainDefinitelyIncludesZero(){return!1!==this.get("zero")||b(this.get("domains"),(e=>t.isArray(e)&&2===e.length&&e[0]<=0&&e[1]>=0))}}const xp=["range","scheme"];function wp(e,n){const i=e.fieldDef(n);if(null!=i&&i.bin){const{bin:o,field:r}=i,a=it(n),s=e.getName(a);if(t.isObject(o)&&o.binned&&void 0!==o.step)return new rp((()=>{const t=e.scaleName(n),i='(domain("'.concat(t,'")[1] - domain("').concat(t,'")[0]) / ').concat(o.step);return"".concat(e.getSignalName(s)," / (").concat(i,")")}));if(an(o)){const t=bf(e,r,o);return new rp((()=>{const n=e.getSignalName(t),i="(".concat(n,".stop - ").concat(n,".start) / ").concat(n,".step");return"".concat(e.getSignalName(s)," / (").concat(i,")")}))}}}function kp(e,n){const i=n.specifiedScales[e],{size:o}=n,r=n.getScaleComponent(e).get("type");for(const o of xp)if(void 0!==i[o]){const a=$o(r,o),s=Ko(e,o);if(a)if(s)ji(s);else switch(o){case"range":{const o=i.range;if(t.isArray(o)){if(Ft(e))return Dl(o.map((e=>{if("width"===e||"height"===e){const t=n.getName(e),i=n.getSignalName.bind(n);return rp.fromName(i,t)}return e})))}else if(t.isObject(o))return Dl({data:n.requestDataName(Ll.Main),field:o.field,sort:{op:"min",field:n.vgField(e)}});return Dl(o)}case"scheme":return Dl(Sp(i[o]))}else ji(bi(r,o,e))}const a=e===ee||"xOffset"===e?"width":"height",s=o[a];if(ec(s))if(Ft(e))if(qo(r)){const t=Dp(s,n,e);if(t)return Dl({step:t})}else ji(xi(a));else if(Pt(e)){const t=e===oe?"x":"y";if("band"===n.getScaleComponent(t).get("type")){const e=Fp(s,r);if(e)return Dl(e)}}const{rangeMin:c,rangeMax:l}=i,u=function(e,n){const{size:i,config:o,mark:r,encoding:a}=n,s=n.getSignalName.bind(n),{type:c}=Ma(a[e]),l=n.getScaleComponent(e).get("type"),{domain:u,domainMid:d}=n.specifiedScales[e];switch(e){case ee:case te:{if(y(["point","band"],l)){const t=Op(e,i,o.view);if(ec(t)){return{step:Dp(t,n,e)}}}const t=it(e),r=n.getName(t);return e===te&&Wo(l)?[rp.fromName(s,r),0]:[0,rp.fromName(s,r)]}case oe:case re:return function(e,t,n){const i=e===oe?"x":"y",o=t.getScaleComponent(i).get("type"),r=t.scaleName(i);if("band"===o){const e=Op(i,t.size,t.config.view);if(ec(e)){const t=Fp(e,n);if(t)return t}return[0,{signal:"bandwidth('".concat(r,"')")}]}return f("Cannot use ".concat(e," scale if ").concat(i," scale is not discrete."))}(e,n,l);case ye:{const a=_p(r,n.component.scales[e].get("zero"),o),s=function(e,n,i,o){const r={x:wp(i,"x"),y:wp(i,"y")};switch(e){case"bar":case"tick":{if(void 0!==o.scale.maxBandSize)return o.scale.maxBandSize;const e=Cp(n,r,o.view);return t.isNumber(e)?e-1:new rp((()=>"".concat(e.signal," - 1")))}case"line":case"trail":case"rule":return o.scale.maxStrokeWidth;case"text":return o.scale.maxFontSize;case"point":case"square":case"circle":{if(o.scale.maxSize)return o.scale.maxSize;const e=Cp(n,r,o.view);return t.isNumber(e)?Math.pow(zp*e,2):new rp((()=>"pow(".concat(zp," * ").concat(e.signal,", 2)")))}}throw new Error(ci("size",e))}(r,i,n,o);return Uo(l)?function(e,t,n){const i=()=>{const i=On(t),o=On(e),r="(".concat(i," - ").concat(o,") / (").concat(n," - 1)");return"sequence(".concat(o,", ").concat(i," + ").concat(r,", ").concat(r,")")};return gn(t)?new rp(i):{signal:i()}}(a,s,function(e,n,i,o){switch(e){case"quantile":return n.scale.quantileCount;case"quantize":return n.scale.quantizeCount;case"threshold":return void 0!==i&&t.isArray(i)?i.length+1:(ji(function(e){return"Domain for ".concat(e," is required for threshold scale.")}(o)),3)}}(l,o,u,e)):[a,s]}case ce:return[0,2*Math.PI];case be:return[0,360];case ae:return[0,new rp((()=>{const e=n.getSignalName("width"),t=n.getSignalName("height");return"min(".concat(e,",").concat(t,")/2")}))];case Se:return[o.scale.minStrokeWidth,o.scale.maxStrokeWidth];case De:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case ve:return"symbol";case me:case ge:case he:return"ordinal"===l?"nominal"===c?"category":"ordinal":void 0!==d?"diverging":"rect"===r||"geoshape"===r?"heatmap":"ramp";case xe:case we:case ke:return[o.scale.minOpacity,o.scale.maxOpacity]}}(e,n);return(void 0!==c||void 0!==l)&&$o(r,"rangeMin")&&t.isArray(u)&&2===u.length?Dl([null!=c?c:u[0],null!=l?l:u[1]]):Fl(u)}function Sp(e){return function(e){return!t.isString(e)&&!!e.name}(e)?{scheme:e.name,...m(e,["name"])}:{scheme:e}}function Dp(e,n,i){const{encoding:o}=n,r=n.getScaleComponent(i),a=ot(i),s=o[a];if("offset"===Zs({step:e,offsetIsDiscrete:pa(s)&&go(s.type)})&&is(o,a)){var c;const i=n.getScaleComponent(a),o=n.scaleName(a);let s="domain('".concat(o,"').length");if("band"===i.get("type")){var l,u,d,f;const e=null!==(l=null!==(u=i.get("paddingInner"))&&void 0!==u?u:i.get("padding"))&&void 0!==l?l:0,t=null!==(d=null!==(f=i.get("paddingOuter"))&&void 0!==f?f:i.get("padding"))&&void 0!==d?d:0;s="bandspace(".concat(s,", ").concat(e,", ").concat(t,")")}const m=null!==(c=r.get("paddingInner"))&&void 0!==c?c:r.get("padding");return{signal:"".concat(e.step," * ").concat(s," / (1-").concat((p=m,gn(p)?p.signal:t.stringValue(p)),")")}}return e.step;var p}function Fp(e,t){if("offset"===Zs({step:e,offsetIsDiscrete:qo(t)}))return{step:e.step}}function Op(e,t,n){const i=e===ee?"width":"height",o=t[i];return o||rc(n,i)}function _p(e,t,n){if(t)return gn(t)?{signal:"".concat(t.signal," ? 0 : ").concat(_p(e,!1,n))}:0;switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(ci("size",e))}const zp=.95;function Cp(e,t,n){const i=ec(e.width)?e.width.step:oc(n,"width"),o=ec(e.height)?e.height.step:oc(n,"height");return t.x||t.y?new rp((()=>{const e=[t.x?t.x.signal:i,t.y?t.y.signal:o];return"min(".concat(e.join(", "),")")})):Math.min(i,o)}function Pp(e,t){Wp(e)?function(e,t){const n=e.component.scales,{config:i,encoding:o,markDef:r,specifiedScales:a}=e;for(const s of C(n)){const c=a[s],l=n[s],u=e.getScaleComponent(s),d=Ma(o[s]),f=c[t],p=u.get("type"),m=u.get("padding"),g=u.get("paddingInner"),h=$o(p,t),v=Ko(s,t);if(void 0!==f&&(h?v&&ji(v):ji(bi(p,t,s))),h&&void 0===v)if(void 0!==f){const e=d.timeUnit,n=d.type;switch(t){case"domainMax":case"domainMin":Ei(c[t])||"temporal"===n||e?l.set(t,{signal:Ha(c[t],{type:n,timeUnit:e})},!0):l.set(t,c[t],!0);break;default:l.copyKeyFromObject(t,c)}}else{const n=t in Ap?Ap[t]({model:e,channel:s,fieldOrDatumDef:d,scaleType:p,scalePadding:m,scalePaddingInner:g,domain:c.domain,domainMin:c.domainMin,domainMax:c.domainMax,markDef:r,config:i,hasNestedOffsetScale:os(o,s)}):i.scale[t];void 0!==n&&l.set(t,n,!1)}}}(e,t):jp(e,t)}const Ap={bins:e=>{let{model:t,fieldOrDatumDef:n}=e;return ca(n)?function(e,t){const n=t.bin;if(an(n)){const i=bf(e,t.field,n);return new rp((()=>e.getSignalName(i)))}if(sn(n)&&cn(n)&&void 0!==n.step)return{step:n.step};return}(t,n):void 0},interpolate:e=>{let{channel:t,fieldOrDatumDef:n}=e;return function(e,t){if(y([me,ge,he],e)&&"nominal"!==t)return"hcl";return}(t,n.type)},nice:e=>{let{scaleType:n,channel:i,domain:o,domainMin:r,domainMax:a,fieldOrDatumDef:s}=e;return function(e,n,i,o,r,a){var s;if(null!==(s=Ea(a))&&void 0!==s&&s.bin||t.isArray(i)||null!=r||null!=o||y([Do,Fo],e))return;return!!Ft(n)||void 0}(n,i,o,r,a,s)},padding:e=>{let{channel:t,scaleType:n,fieldOrDatumDef:i,markDef:o,config:r}=e;return function(e,t,n,i,o,r){if(Ft(e)){if(Ro(t)){if(void 0!==n.continuousPadding)return n.continuousPadding;const{type:t,orient:a}=o;if("bar"===t&&(!ca(i)||!i.bin&&!i.timeUnit)&&("vertical"===a&&"x"===e||"horizontal"===a&&"y"===e))return r.continuousBandSize}if(t===Oo)return n.pointPadding}return}(t,n,r.scale,i,o,r.bar)},paddingInner:e=>{let{scalePadding:t,channel:n,markDef:i,scaleType:o,config:r,hasNestedOffsetScale:a}=e;return function(e,t,n,i,o){let r=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(void 0!==e)return;if(Ft(t)){const{bandPaddingInner:e,barBandPaddingInner:t,rectBandPaddingInner:i,bandWithNestedOffsetPaddingInner:a}=o;return r?a:V(e,"bar"===n?t:i)}if(Pt(t)&&i===_o)return o.offsetBandPaddingInner;return}(t,n,i.type,o,r.scale,a)},paddingOuter:e=>{let{scalePadding:t,channel:n,scaleType:i,scalePaddingInner:o,config:r,hasNestedOffsetScale:a}=e;return function(e,t,n,i,o){let r=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(void 0!==e)return;if(Ft(t)){const{bandPaddingOuter:e,bandWithNestedOffsetPaddingOuter:t}=o;if(r)return t;if(n===_o)return V(e,gn(i)?{signal:"".concat(i.signal,"/2")}:i/2)}else if(Pt(t)){if(n===Oo)return.5;if(n===_o)return o.offsetBandPaddingOuter}return}(t,n,i,o,r.scale,a)},reverse:e=>{let{fieldOrDatumDef:t,scaleType:n,channel:i,config:o}=e;return function(e,t,n,i){if("x"===n&&void 0!==i.xReverse)return Wo(e)&&"descending"===t?gn(i.xReverse)?{signal:"!".concat(i.xReverse.signal)}:!i.xReverse:i.xReverse;if(Wo(e)&&"descending"===t)return!0;return}(n,ca(t)?t.sort:void 0,i,o.scale)},zero:e=>{let{channel:n,fieldOrDatumDef:i,domain:o,markDef:r,scaleType:a}=e;return function(e,n,i,o,r){if(i&&"unaggregated"!==i&&Wo(r)){if(t.isArray(i)){const e=i[0],t=i[i.length-1];if(e<=0&&t>=0)return!0}return!1}if("size"===e&&"quantitative"===n.type&&!Uo(r))return!0;if((!ca(n)||!n.bin)&&y([...Dt,..._t],e)){const{orient:t,type:n}=o;return!y(["bar","area","line","trail"],n)||!("horizontal"===t&&"y"===e||"vertical"===t&&"x"===e)}return!1}(n,i,o,r,a)}};function Np(e){Wp(e)?function(e){const t=e.component.scales;for(const n of Bt){const i=t[n];if(!i)continue;const o=kp(n,e);i.setWithExplicit("range",o)}}(e):jp(e,"range")}function jp(e,t){const n=e.component.scales;for(const n of e.children)"range"===t?Np(n):Pp(n,t);for(const i of C(n)){let o;for(const n of e.children){const e=n.component.scales[i];if(e){o=zl(o,e.getWithExplicit(t),t,"scale",Ol(((e,n)=>"range"===t&&e.step&&n.step?e.step-n.step:0)))}}n[i].setWithExplicit(t,o)}}function Ep(e,t,n,i){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const r=Mp(t,n,i,o),{type:a}=e;return Ht(t)?void 0!==a?er(t,a)?ca(n)&&!Zo(a,n.type)?(ji(yi(a,r)),r):a:(ji(vi(t,a,r)),r):r:null}function Mp(e,t,n,i){switch(t.type){case"nominal":case"ordinal":var o;if(qe(e)||"discrete"===Xt(e))return"shape"===e&&"ordinal"===t.type&&ji(fi(e,"ordinal")),"ordinal";if(Ft(e)||Pt(e)){if(y(["rect","bar","image","rule"],n.type))return"band";if(i)return"band"}else if("arc"===n.type&&e in Ot)return"band";return Sr(n[it(e)])||va(t)&&null!==(o=t.axis)&&void 0!==o&&o.tickBand?"band":"point";case"temporal":return qe(e)?"time":"discrete"===Xt(e)?(ji(fi(e,"temporal")),"ordinal"):ca(t)&&t.timeUnit&&$i(t.timeUnit).utc?"utc":"time";case"quantitative":return qe(e)?ca(t)&&an(t.bin)?"bin-ordinal":"linear":"discrete"===Xt(e)?(ji(fi(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(ii(t.type))}function Tp(e){Wp(e)?e.component.scales=function(e){const{encoding:t,mark:n,markDef:i}=e,o={};for(const a of Bt){const s=Ma(t[a]);if(s&&n===gr&&a===ve&&s.type===xo)continue;let c=s&&s.scale;if(Pt(a)){if(!os(t,rt(a))){c&&ji(li(a));continue}}if(s&&null!==c&&!1!==c){var r;null!==(r=c)&&void 0!==r||(c={});const n=Ep(c,a,s,i,os(t,a));o[a]=new bp(e.scaleName("".concat(a),!0),{value:n,explicit:c.type===n})}}return o}(e):e.component.scales=function(e){const t=e.component.scales={},n={},i=e.component.resolve;for(const t of e.children){Tp(t);for(const a of C(t.component.scales)){var o,r;if(null!==(r=(o=i.scale)[a])&&void 0!==r||(o[a]=Gd(a,e)),"shared"===i.scale[a]){const e=n[a],o=t.component.scales[a].getWithExplicit("type");e?Co(e.value,o.value)?n[a]=zl(e,o,"type","scale",Lp):(i.scale[a]="independent",delete n[a]):n[a]=o}}}for(const i of C(n)){const o=e.scaleName(i,!0),r=n[i];t[i]=new bp(o,r);for(const t of e.children){const e=t.component.scales[i];e&&(t.renameScale(e.get("name"),o),e.merged=!0)}}return t}(e)}const Lp=Ol(((e,t)=>Ao(e)-Ao(t)));class qp{constructor(){Ln(this,"nameMap",void 0),this.nameMap={}}rename(e,t){this.nameMap[e]=t}has(e){return void 0!==this.nameMap[e]}get(e){for(;this.nameMap[e]&&e!==this.nameMap[e];)e=this.nameMap[e];return e}}function Wp(e){return"unit"===(null==e?void 0:e.type)}function Rp(e){return"facet"===(null==e?void 0:e.type)}function Up(e){return"concat"===(null==e?void 0:e.type)}function Bp(e){return"layer"===(null==e?void 0:e.type)}class Hp{constructor(e,n,i,o,r,a,s){var c,u;this.type=n,this.parent=i,this.config=r,Ln(this,"name",void 0),Ln(this,"size",void 0),Ln(this,"title",void 0),Ln(this,"description",void 0),Ln(this,"data",void 0),Ln(this,"transforms",void 0),Ln(this,"layout",void 0),Ln(this,"scaleNameMap",void 0),Ln(this,"projectionNameMap",void 0),Ln(this,"signalNameMap",void 0),Ln(this,"component",void 0),Ln(this,"view",void 0),Ln(this,"children",void 0),Ln(this,"correctDataNames",(e=>{var t,n,i;return null!==(t=e.from)&&void 0!==t&&t.data&&(e.from.data=this.lookupDataSource(e.from.data)),null!==(n=e.from)&&void 0!==n&&null!==(i=n.facet)&&void 0!==i&&i.data&&(e.from.facet.data=this.lookupDataSource(e.from.facet.data)),e})),this.parent=i,this.config=r,this.view=fn(s),this.name=null!==(c=e.name)&&void 0!==c?c:o,this.title=mn(e.title)?{text:e.title}:e.title?fn(e.title):void 0,this.scaleNameMap=i?i.scaleNameMap:new qp,this.projectionNameMap=i?i.projectionNameMap:new qp,this.signalNameMap=i?i.signalNameMap:new qp,this.data=e.data,this.description=e.description,this.transforms=(null!==(u=e.transform)&&void 0!==u?u:[]).map((e=>Xc(e)?{filter:l(e.filter,po)}:e)),this.layout="layer"===n||"unit"===n?{}:function(e,n,i){const o=i[n],r={},{spacing:a,columns:s}=o;void 0!==a&&(r.spacing=a),void 0!==s&&(Zr(e)&&!$r(e.facet)||Xs(e))&&(r.columns=s),Js(e)&&(r.columns=1);for(const n of nc)if(void 0!==e[n])if("spacing"===n){var c,l;const i=e[n];r[n]=t.isNumber(i)?i:{row:null!==(c=i.row)&&void 0!==c?c:a,column:null!==(l=i.column)&&void 0!==l?l:a}}else r[n]=e[n];return r}(e,n,r),this.component={data:{sources:i?i.component.data.sources:[],outputNodes:i?i.component.data.outputNodes:{},outputNodeRefCounts:i?i.component.data.outputNodeRefCounts:{},isFaceted:Zr(e)||(null==i?void 0:i.component.data.isFaceted)&&void 0===e.data},layoutSize:new Sl,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:{scale:{},axis:{},legend:{},...a?d(a):{}},selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){!function(e){let{ignoreRange:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Tp(e),ap(e);for(const t of Qo)Pp(e,t);t||Np(e)}(this)}parseProjection(){hf(this)}renameTopLevelLayoutSizeSignal(){"width"!==this.getName("width")&&this.renameSignal(this.getName("width"),"width"),"height"!==this.getName("height")&&this.renameSignal(this.getName("height"),"height")}parseLegends(){af(this)}assembleEncodeFromView(e){const{style:t,...n}=e,i={};for(const e of C(n)){const t=n[e];void 0!==t&&(i[e]=Dn(t))}return i}assembleGroupEncodeEntry(e){let t={};var n;if((this.view&&(t=this.assembleEncodeFromView(this.view)),!e)&&(this.description&&(t.description=Dn(this.description)),"unit"===this.type||"layer"===this.type))return{width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height"),...null!==(n=t)&&void 0!==n?n:{}};return z(t)?void 0:t}assembleLayout(){if(!this.layout)return;const{spacing:e,...t}=this.layout,{component:n,config:i}=this,o=function(e,t){const n={};for(const i of Re){const o=e[i];if(null!=o&&o.facetFieldDef){const{titleAnchor:e,titleOrient:r}=_d(["titleAnchor","titleOrient"],o.facetFieldDef.header,t,i),a=Fd(i,r),s=qd(e,a);void 0!==s&&(n[a]=s)}}return z(n)?void 0:n}(n.layoutHeaders,i);return{padding:e,...this.assembleDefaultLayout(),...t,...o?{titleBand:o}:{}}}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:e}=this.component;let t=[];for(const n of Re)e[n].title&&t.push(Pd(this,n));for(const e of zd)t=t.concat(jd(this,e));return t}assembleAxes(){return function(e,t){const{x:n=[],y:i=[]}=e;return[...n.map((e=>pd(e,"grid",t))),...i.map((e=>pd(e,"grid",t))),...n.map((e=>pd(e,"main",t))),...i.map((e=>pd(e,"main",t)))].filter((e=>e))}(this.component.axes,this.config)}assembleLegends(){return df(this)}assembleProjections(){return ff(this)}assembleTitle(){var e;const{encoding:t,...n}=null!==(e=this.title)&&void 0!==e?e:{},i={...pn(this.config.title).nonMarkTitleProperties,...n,...t?{encode:{update:t}}:{}};if(i.text){var o,r;if(y(["unit","layer"],this.type)){if(y(["middle",void 0],i.anchor))null!==(o=i.frame)&&void 0!==o||(i.frame="group")}else null!==(r=i.anchor)&&void 0!==r||(i.anchor="start");return z(i)?void 0:i}}assembleGroup(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t={};e=e.concat(this.assembleSignals()),e.length>0&&(t.signals=e);const n=this.assembleLayout();n&&(t.layout=n),t.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const i=!this.parent||Rp(this.parent)?vp(this):[];i.length>0&&(t.scales=i);const o=this.assembleAxes();o.length>0&&(t.axes=o);const r=this.assembleLegends();return r.length>0&&(t.legends=r),t}getName(e){return j((this.name?"".concat(this.name,"_"):"")+e)}getDataName(e){return this.getName(Ll[e].toLowerCase())}requestDataName(e){const t=this.getDataName(e),n=this.component.data.outputNodeRefCounts;return n[t]=(n[t]||0)+1,t}getSizeSignalRef(e){if(Rp(this.parent)){const t=zt(Vd(e)),n=this.component.scales[t];if(n&&!n.merged){const e=n.get("type"),i=n.get("range");if(qo(e)&&hn(i)){const e=n.get("name"),i=gp(hp(this,t));if(i){return{signal:Hd(e,n,ka({aggregate:"distinct",field:i},{expr:"datum"}))}}return ji(Gn(t)),null}}}return{signal:this.signalNameMap.get(this.getName(e))}}lookupDataSource(e){const t=this.component.data.outputNodes[e];return t?t.getSource():e}getSignalName(e){return this.signalNameMap.get(e)}renameSignal(e,t){this.signalNameMap.rename(e,t)}renameScale(e,t){this.scaleNameMap.rename(e,t)}renameProjection(e,t){this.projectionNameMap.rename(e,t)}scaleName(e,t){return t?this.getName(e):$e(e)&&Ht(e)&&this.component.scales[e]||this.scaleNameMap.has(this.getName(e))?this.scaleNameMap.get(this.getName(e)):void 0}projectionName(e){return e?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0}getScaleComponent(e){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const t=this.component.scales[e];return t&&!t.merged?t:this.parent?this.parent.getScaleComponent(e):void 0}getSelectionComponent(e,t){let n=this.component.selection[e];if(!n&&this.parent&&(n=this.parent.getSelectionComponent(e,t)),!n)throw new Error(function(e){return'Cannot find a selection named "'.concat(e,'".')}(t));return n}hasAxisOrientSignalRef(){var e,t;return(null===(e=this.component.axes.x)||void 0===e?void 0:e.some((e=>e.hasOrientSignalRef())))||(null===(t=this.component.axes.y)||void 0===t?void 0:t.some((e=>e.hasOrientSignalRef())))}}class Vp extends Hp{vgField(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=this.fieldDef(e);if(n)return ka(n,t)}reduceFieldDef(e,n){return function(e,n,i,o){return e?C(e).reduce(((i,r)=>{const a=e[r];return t.isArray(a)?a.reduce(((e,t)=>n.call(o,e,t,r)),i):n.call(o,i,a,r)}),i):i}(this.getMapping(),((t,n,i)=>{const o=Ea(n);return o?e(t,o,i):t}),n)}forEachFieldDef(e,t){us(this.getMapping(),((t,n)=>{const i=Ea(t);i&&e(i,n)}),t)}}class Ip extends Hl{clone(){return new Ip(null,d(this.transform))}constructor(e,t){var n,i,o;super(e),this.transform=t,this.transform=d(t);const r=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=r[0])&&void 0!==i?i:"value",null!==(o=r[1])&&void 0!==o?o:"density"]}dependentFields(){var e;return new Set([this.transform.density,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return"DensityTransform ".concat(h(this.transform))}assemble(){const{density:e,...t}=this.transform;return{type:"kde",field:e,...t}}}class Gp extends Hl{clone(){return new Gp(null,{...this.filter})}constructor(e,t){super(e),this.filter=t}static make(e,t){const{config:n,mark:i,markDef:o}=t;if("filter"!==Cn("invalid",o,n))return null;const r=t.reduceFieldDef(((e,n,o)=>{const r=Ht(o)&&t.getScaleComponent(o);if(r){Wo(r.get("type"))&&"count"!==n.aggregate&&!hr(i)&&(e[n.field]=n)}return e}),{});return C(r).length?new Gp(e,r):null}dependentFields(){return new Set(C(this.filter))}producedFields(){return new Set}hash(){return"FilterInvalid ".concat(h(this.filter))}assemble(){const e=C(this.filter).reduce(((e,t)=>{const n=this.filter[t],i=ka(n,{expr:"datum"});return null!==n&&("temporal"===n.type?e.push("(isDate(".concat(i,") || (isValid(").concat(i,") && isFinite(+").concat(i,")))")):"quantitative"===n.type&&(e.push("isValid(".concat(i,")")),e.push("isFinite(+".concat(i,")")))),e}),[]);return e.length>0?{type:"filter",expr:e.join(" && ")}:null}}class Yp extends Hl{clone(){return new Yp(this.parent,d(this.transform))}constructor(e,t){super(e),this.transform=t,this.transform=d(t);const{flatten:n,as:i=[]}=this.transform;this.transform.as=n.map(((e,t)=>{var n;return null!==(n=i[t])&&void 0!==n?n:e}))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return"FlattenTransform ".concat(h(this.transform))}assemble(){const{flatten:e,as:t}=this.transform;return{type:"flatten",fields:e,as:t}}}class Xp extends Hl{clone(){return new Xp(null,d(this.transform))}constructor(e,t){var n,i,o;super(e),this.transform=t,this.transform=d(t);const r=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=r[0])&&void 0!==i?i:"key",null!==(o=r[1])&&void 0!==o?o:"value"]}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return"FoldTransform ".concat(h(this.transform))}assemble(){const{fold:e,as:t}=this.transform;return{type:"fold",fields:e,as:t}}}class Jp extends Hl{clone(){return new Jp(null,d(this.fields),this.geojson,this.signal)}static parseAll(e,t){if(t.component.projection&&!t.component.projection.isFit)return e;let n=0;for(const i of[[de,ue],[pe,fe]]){const o=i.map((e=>{const n=Ma(t.encoding[e]);return ca(n)?n.field:ua(n)?{expr:"".concat(n.datum)}:ga(n)?{expr:"".concat(n.value)}:void 0}));(o[0]||o[1])&&(e=new Jp(e,o,null,t.getName("geojson_".concat(n++))))}if(t.channelHasField(ve)){const i=t.typedFieldDef(ve);i.type===xo&&(e=new Jp(e,null,i.field,t.getName("geojson_".concat(n++))))}return e}constructor(e,t,n,i){super(e),this.fields=t,this.geojson=n,this.signal=i}dependentFields(){var e;const n=(null!==(e=this.fields)&&void 0!==e?e:[]).filter(t.isString);return new Set([...this.geojson?[this.geojson]:[],...n])}producedFields(){return new Set}hash(){return"GeoJSON ".concat(this.geojson," ").concat(this.signal," ").concat(h(this.fields))}assemble(){return[...this.geojson?[{type:"filter",expr:'isValid(datum["'.concat(this.geojson,'"])')}]:[],{type:"geojson",...this.fields?{fields:this.fields}:{},...this.geojson?{geojson:this.geojson}:{},signal:this.signal}]}}class Qp extends Hl{clone(){return new Qp(null,this.projection,d(this.fields),d(this.as))}constructor(e,t,n,i){super(e),this.projection=t,this.fields=n,this.as=i}static parseAll(e,t){if(!t.projectionName())return e;for(const n of[[de,ue],[pe,fe]]){const i=n.map((e=>{const n=Ma(t.encoding[e]);return ca(n)?n.field:ua(n)?{expr:"".concat(n.datum)}:ga(n)?{expr:"".concat(n.value)}:void 0})),o=n[0]===pe?"2":"";(i[0]||i[1])&&(e=new Qp(e,t.projectionName(),i,[t.getName("x".concat(o)),t.getName("y".concat(o))]))}return e}dependentFields(){return new Set(this.fields.filter(t.isString))}producedFields(){return new Set(this.as)}hash(){return"Geopoint ".concat(this.projection," ").concat(h(this.fields)," ").concat(h(this.as))}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class $p extends Hl{clone(){return new $p(null,d(this.transform))}constructor(e,t){super(e),this.transform=t}dependentFields(){var e;return new Set([this.transform.impute,this.transform.key,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(e){const{start:t=0,stop:n,step:i}=e,o=[t,n,...i?[i]:[]].join(",");return{signal:"sequence(".concat(o,")")}}static makeFromTransform(e,t){return new $p(e,t)}static makeFromEncoding(e,t){const n=t.encoding,i=n.x,o=n.y;if(ca(i)&&ca(o)){const r=i.impute?i:o.impute?o:void 0;if(void 0===r)return;const a=i.impute?o:o.impute?i:void 0,{method:s,value:c,frame:l,keyvals:u}=r.impute,d=ds(t.mark,n);return new $p(e,{impute:r.field,key:a.field,...s?{method:s}:{},...void 0!==c?{value:c}:{},...l?{frame:l}:{},...void 0!==u?{keyvals:u}:{},...d.length?{groupby:d}:{}})}return null}hash(){return"Impute ".concat(h(this.transform))}assemble(){const{impute:e,key:t,keyvals:n,method:i,groupby:o,value:r,frame:a=[null,null]}=this.transform,s={type:"impute",field:e,key:t,...n?{keyvals:(c=n,void 0!==(null==c?void 0:c.stop)?this.processSequence(n):n)}:{},method:"value",...o?{groupby:o}:{},value:i&&"value"!==i?null:r};var c;if(i&&"value"!==i){return[s,{type:"window",as:["imputed_".concat(e,"_value")],ops:[i],fields:[e],frame:a,ignorePeers:!1,...o?{groupby:o}:{}},{type:"formula",expr:"datum.".concat(e," === null ? datum.imputed_").concat(e,"_value : datum.").concat(e),as:e}]}return[s]}}class Kp extends Hl{clone(){return new Kp(null,d(this.transform))}constructor(e,t){var n,i,o;super(e),this.transform=t,this.transform=d(t);const r=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=r[0])&&void 0!==i?i:t.on,null!==(o=r[1])&&void 0!==o?o:t.loess]}dependentFields(){var e;return new Set([this.transform.loess,this.transform.on,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return"LoessTransform ".concat(h(this.transform))}assemble(){const{loess:e,on:t,...n}=this.transform;return{type:"loess",x:t,y:e,...n}}}class Zp extends Hl{clone(){return new Zp(null,d(this.transform),this.secondary)}constructor(e,t,n){super(e),this.transform=t,this.secondary=n}static make(e,t,n,i){const o=t.component.data.sources,{from:r}=n;let a=null;if(function(e){return"data"in e}(r)){let e=gm(r.data,o);e||(e=new Nf(r.data),o.push(e));const n=t.getName("lookup_".concat(i));a=new Vl(e,n,Ll.Lookup,t.component.data.outputNodeRefCounts),t.component.data.outputNodes[n]=a}else if(function(e){return"param"in e}(r)){const e=r.param;let i;n={as:e,...n};try{i=t.getSelectionComponent(j(e),e)}catch(t){throw new Error(function(e){return'Lookups can only be performed on selection parameters. "'.concat(e,'" is a variable parameter.')}(e))}if(a=i.materialized,!a)throw new Error(function(e){return'Cannot define and lookup the "'.concat(e,'" selection in the same view. ')+"Try moving the lookup into a second, layered view?"}(e))}return new Zp(e,n,a.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?t.array(this.transform.as):this.transform.from.fields)}hash(){return"Lookup ".concat(h({transform:this.transform,secondary:this.secondary}))}assemble(){let e;if(this.transform.from.fields)e={values:this.transform.from.fields,...this.transform.as?{as:t.array(this.transform.as)}:{}};else{let n=this.transform.as;t.isString(n)||(ji('If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.'),n="_lookup"),e={as:[n]}}return{type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup],...e,...this.transform.default?{default:this.transform.default}:{}}}}class em extends Hl{clone(){return new em(null,d(this.transform))}constructor(e,t){var n,i,o;super(e),this.transform=t,this.transform=d(t);const r=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=r[0])&&void 0!==i?i:"prob",null!==(o=r[1])&&void 0!==o?o:"value"]}dependentFields(){var e;return new Set([this.transform.quantile,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return"QuantileTransform ".concat(h(this.transform))}assemble(){const{quantile:e,...t}=this.transform;return{type:"quantile",field:e,...t}}}class tm extends Hl{clone(){return new tm(null,d(this.transform))}constructor(e,t){var n,i,o;super(e),this.transform=t,this.transform=d(t);const r=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=r[0])&&void 0!==i?i:t.on,null!==(o=r[1])&&void 0!==o?o:t.regression]}dependentFields(){var e;return new Set([this.transform.regression,this.transform.on,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return"RegressionTransform ".concat(h(this.transform))}assemble(){const{regression:e,on:t,...n}=this.transform;return{type:"regression",x:t,y:e,...n}}}class nm extends Hl{clone(){return new nm(null,d(this.transform))}constructor(e,t){super(e),this.transform=t}addDimensions(e){var t;this.transform.groupby=S((null!==(t=this.transform.groupby)&&void 0!==t?t:[]).concat(e),(e=>e))}producedFields(){}dependentFields(){var e;return new Set([this.transform.pivot,this.transform.value,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}hash(){return"PivotTransform ".concat(h(this.transform))}assemble(){const{pivot:e,value:t,groupby:n,limit:i,op:o}=this.transform;return{type:"pivot",field:e,value:t,...void 0!==i?{limit:i}:{},...void 0!==o?{op:o}:{},...void 0!==n?{groupby:n}:{}}}}class im extends Hl{clone(){return new im(null,d(this.transform))}constructor(e,t){super(e),this.transform=t}dependentFields(){return new Set}producedFields(){return new Set}hash(){return"SampleTransform ".concat(h(this.transform))}assemble(){return{type:"sample",size:this.transform.sample}}}function om(e){let t=0;return function n(i,o){if(i instanceof Nf&&!i.isGenerator&&!Pl(i.data)){e.push(o);o={name:null,source:o.name,transform:[]}}var r;if(i instanceof zf&&(i.parent instanceof Nf&&!o.source?(o.format={...null!==(r=o.format)&&void 0!==r?r:{},parse:i.assembleFormatParse()},o.transform.push(...i.assembleTransforms(!0))):o.transform.push(...i.assembleTransforms())),i instanceof Df)return o.name||(o.name="data_".concat(t++)),!o.source||o.transform.length>0?(e.push(o),i.data=o.name):i.data=o.source,void e.push(...i.assemble());if((i instanceof Pf||i instanceof Af||i instanceof Gp||i instanceof sd||i instanceof Sd||i instanceof Qp||i instanceof Sf||i instanceof Zp||i instanceof $f||i instanceof Jf||i instanceof Xp||i instanceof Yp||i instanceof Ip||i instanceof Kp||i instanceof em||i instanceof tm||i instanceof Cf||i instanceof im||i instanceof nm)&&o.transform.push(i.assemble()),(i instanceof wf||i instanceof Il||i instanceof $p||i instanceof Qf||i instanceof Jp)&&o.transform.push(...i.assemble()),i instanceof Vl)if(o.source&&0===o.transform.length)i.setSource(o.source);else if(i.parent instanceof Vl)i.setSource(o.name);else if(o.name||(o.name="data_".concat(t++)),i.setSource(o.name),1===i.numChildren()){e.push(o);o={name:null,source:o.name,transform:[]}}switch(i.numChildren()){case 0:i instanceof Vl&&(!o.source||o.transform.length>0)&&e.push(o);break;case 1:n(i.children[0],o);break;default:{o.name||(o.name="data_".concat(t++));let r=o.name;!o.source||o.transform.length>0?e.push(o):r=o.source;for(const e of i.children){n(e,{name:null,source:r,transform:[]})}break}}}}function rm(e,t){const n=[],i=om(n);let o=0;for(const t of e.sources){t.hasName()||(t.dataName="source_".concat(o++));const e=t.assemble();i(t,e)}for(const e of n)0===e.transform.length&&delete e.transform;let r=0;for(const[e,t]of n.entries()){var a;0!==(null!==(a=t.transform)&&void 0!==a?a:[]).length||t.source||n.splice(r++,0,n.splice(e,1)[0])}for(const t of n)for(const n of null!==(s=t.transform)&&void 0!==s?s:[]){var s;"lookup"===n.type&&(n.from=e.outputNodes[n.from].getSource())}for(const e of n)e.name in t&&(e.values=t[e.name]);return n}function am(e){return"top"===e||"left"===e||gn(e)?"header":"footer"}function sm(e,n){const{facet:i,config:o,child:r,component:a}=e;if(e.channelHasField(n)){var s;const c=i[n],l=Od("title",null,o,n);let u=Ca(c,o,{allowDisabling:!0,includeDefault:void 0===l||!!l});r.component.layoutHeaders[n].title&&(u=t.isArray(u)?u.join(", "):u,u+=" / ".concat(r.component.layoutHeaders[n].title),r.component.layoutHeaders[n].title=null);const d=Od("labelOrient",c.header,o,n),f=null!==c.header&&V(null===(s=c.header)||void 0===s?void 0:s.labels,o.header.labels,!0),p=y(["bottom","right"],d)?"footer":"header";a.layoutHeaders[n]={title:null!==c.header?u:null,facetFieldDef:c,[p]:"facet"===n?[]:[cm(e,n,f)]}}}function cm(e,t,n){const i="row"===t?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(i)?e.child.getSizeSignalRef(i):void 0,axes:[]}}function lm(e,t){const{child:n}=e;if(n.component.axes[t]){const{layoutHeaders:o,resolve:r}=e.component;if(r.axis[t]=Yd(r,t),"shared"===r.axis[t]){const r="x"===t?"column":"row",a=o[r];for(const o of n.component.axes[t]){var i;const t=am(o.get("orient"));null!==(i=a[t])&&void 0!==i||(a[t]=[cm(e,r,!1)]);const n=pd(o,"main",e.config,{header:!0});n&&a[t][0].axes.push(n),o.mainExtracted=!0}}}}function um(e){for(const t of e.children)t.parseLayoutSize()}function dm(e,t){const n=Vd(t),i=zt(n),o=e.component.resolve,r=e.component.layoutSize;let a;for(const t of e.children){var s;const r=t.component.layoutSize.getWithExplicit(n),c=null!==(s=o.scale[i])&&void 0!==s?s:Gd(i,e);if("independent"===c&&"step"===r.value){a=void 0;break}if(a){if("independent"===c&&a.value!==r.value){a=void 0;break}a=zl(a,r,n,"")}else a=r}if(a){for(const i of e.children)e.renameSignal(i.getName(n),e.getName(t)),i.component.layoutSize.set(n,"merged",!1);r.setWithExplicit(t,a)}else r.setWithExplicit(t,{explicit:!1,value:void 0})}function fm(e,t){const n="width"===t?"x":"y",i=e.config,o=e.getScaleComponent(n);if(o){const e=o.get("type"),n=o.get("range");if(qo(e)){const e=rc(i.view,t);return hn(n)||ec(e)?"step":e}return ic(i.view,t)}if(e.hasProjection||"arc"===e.mark)return ic(i.view,t);{const e=rc(i.view,t);return ec(e)?e.step:e}}function pm(e,t,n){return ka(t,{suffix:"by_".concat(ka(e)),...null!=n?n:{}})}class mm extends Vp{constructor(e,t,n,i){super(e,"facet",t,n,i,e.resolve),Ln(this,"facet",void 0),Ln(this,"child",void 0),Ln(this,"children",void 0),this.child=Gm(e.spec,this,this.getName("child"),void 0,i),this.children=[this.child],this.facet=this.initFacet(e.facet)}initFacet(e){if(!$r(e))return{facet:this.initFacetFieldDef(e,"facet")};const t=C(e),n={};for(const i of t){if(![$,K].includes(i)){ji(ci(i,"facet"));break}const t=e[i];if(void 0===t.field){ji(si(t,i));break}n[i]=this.initFacetFieldDef(t,i)}return n}initFacetFieldDef(e,t){const n=qa(e,t);return n.header?n.header=fn(n.header):null===n.header&&(n.header=null),n}channelHasField(e){return!!this.facet[e]}fieldDef(e){return this.facet[e]}parseData(){this.component.data=hm(this),this.child.parseData()}parseLayoutSize(){um(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),function(e){for(const t of Re)sm(e,t);lm(e,"x"),lm(e,"y")}(this)}assembleSelectionTopLevelSignals(e){return this.child.assembleSelectionTopLevelSignals(e)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(e){return this.child.assembleSelectionData(e)}getHeaderLayoutMixins(){const e={};for(const o of Re)for(const r of Cd){const a=this.component.layoutHeaders[o],s=a[r],{facetFieldDef:c}=a;if(c){const n=Od("titleOrient",c.header,this.config,o);if(["right","bottom"].includes(n)){var t;const i=Fd(o,n);null!==(t=e.titleAnchor)&&void 0!==t||(e.titleAnchor={}),e.titleAnchor[i]="end"}}if(null!=s&&s[0]){const t="row"===o?"height":"width",s="header"===r?"headerBand":"footerBand";var n,i;if("facet"!==o&&!this.child.component.layoutSize.get(t))null!==(n=e[s])&&void 0!==n||(e[s]={}),e[s][o]=.5;if(a.title)null!==(i=e.offset)&&void 0!==i||(e.offset={}),e.offset["row"===o?"rowTitle":"columnTitle"]=10}}return e}assembleDefaultLayout(){const{column:e,row:t}=this.facet,n=e?this.columnDistinctSignal():t?1:void 0;let i="all";return(t||"independent"!==this.component.resolve.scale.x)&&(e||"independent"!==this.component.resolve.scale.y)||(i="none"),{...this.getHeaderLayoutMixins(),...n?{columns:n}:{},bounds:"full",align:i}}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof mm)){const e=this.getName("column_domain");return{signal:"length(data('".concat(e,"'))")}}}assembleGroupStyle(){}assembleGroup(e){return this.parent&&this.parent instanceof mm?{...this.channelHasField("column")?{encode:{update:{columns:{field:ka(this.facet.column,{prefix:"distinct"})}}}}:{},...super.assembleGroup(e)}:super.assembleGroup(e)}getCardinalityAggregateForChild(){const e=[],t=[],n=[];if(this.child instanceof mm){if(this.child.channelHasField("column")){const i=ka(this.child.facet.column);e.push(i),t.push("distinct"),n.push("distinct_".concat(i))}}else for(const i of Dt){const o=this.child.component.scales[i];if(o&&!o.merged){const r=o.get("type"),a=o.get("range");if(qo(r)&&hn(a)){const o=gp(hp(this.child,i));o?(e.push(o),t.push("distinct"),n.push("distinct_".concat(o))):ji(Gn(i))}}}return{fields:e,ops:t,as:n}}assembleFacet(){const{name:e,data:n}=this.component.data.facetRoot,{row:i,column:o}=this.facet,{fields:r,ops:a,as:s}=this.getCardinalityAggregateForChild(),c=[];for(const e of Re){const n=this.facet[e];if(n){c.push(ka(n));const{bin:l,sort:u}=n;if(an(l)&&c.push(ka(n,{binSuffix:"end"})),Jr(u)){const{field:e,op:t=Ir}=u,c=pm(n,u);i&&o?(r.push(c),a.push("max"),s.push(c)):(r.push(e),a.push(t),s.push(c))}else if(t.isArray(u)){const t=Dd(n,e);r.push(t),a.push("max"),s.push(t)}}}const l=!!i&&!!o;return{name:e,data:n,groupby:c,...l||r.length>0?{aggregate:{...l?{cross:l}:{},...r.length?{fields:r,ops:a,as:s}:{}}}:{}}}facetSortFields(e){const{facet:n}=this,i=n[e];return i?Jr(i.sort)?[pm(i,i.sort,{expr:"datum"})]:t.isArray(i.sort)?[Dd(i,e,{expr:"datum"})]:[ka(i,{expr:"datum"})]:[]}facetSortOrder(e){const{facet:n}=this,i=n[e];if(i){const{sort:e}=i;return[(Jr(e)?e.order:!t.isArray(e)&&e)||"ascending"]}return[]}assembleLabelTitle(){const{facet:e,config:t}=this;if(e.facet)return Md(e.facet,"facet",t);const n={row:["top","bottom"],column:["left","right"]};for(const o of zd)if(e[o]){var i;const r=Od("labelOrient",null===(i=e[o])||void 0===i?void 0:i.header,t,o);if(n[o].includes(r))return Md(e[o],o,t)}}assembleMarks(){const{child:e}=this,t=function(e){const t=[],n=om(t);for(const t of e.children)n(t,{source:e.name,name:null,transform:[]});return t}(this.component.data.facetRoot),n=e.assembleGroupEncodeEntry(!1),i=this.assembleLabelTitle()||e.assembleTitle(),o=e.assembleGroupStyle();return[{name:this.getName("cell"),type:"group",...i?{title:i}:{},...o?{style:o}:{},from:{facet:this.assembleFacet()},sort:{field:Re.map((e=>this.facetSortFields(e))).flat(),order:Re.map((e=>this.facetSortOrder(e))).flat()},...t.length>0?{data:t}:{},...n?{encode:{update:n}}:{},...e.assembleGroup(Rl(this,[]))}]}getMapping(){return this.facet}}function gm(e,t){for(const a of t){var n,i,o,r;const t=a.data;if(e.name&&a.hasName()&&e.name!==a.dataName)continue;const s=null===(n=e.format)||void 0===n?void 0:n.mesh,c=null===(i=t.format)||void 0===i?void 0:i.feature;if(s&&c)continue;const l=null===(o=e.format)||void 0===o?void 0:o.feature;if((l||c)&&l!==c)continue;const d=null===(r=t.format)||void 0===r?void 0:r.mesh;if(!s&&!d||s===d)if(Al(e)&&Al(t)){if(u(e.values,t.values))return a}else if(Pl(e)&&Pl(t)){if(e.url===t.url)return a}else if(Nl(e)&&e.name===a.dataName)return a}return null}function hm(e){var t,n,i;let o=function(e,t){if(e.data||!e.parent){if(null===e.data){const e=new Nf({values:[]});return t.push(e),e}const n=gm(e.data,t);if(n)return jl(e.data)||(n.data.format=w({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const n=new Nf(e.data);return t.push(n),n}}return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}(e,e.component.data.sources);const{outputNodes:r,outputNodeRefCounts:a}=e.component.data,s=e.data,c=!(s&&(jl(s)||Pl(s)||Al(s)))&&e.parent?e.parent.component.data.ancestorParse.clone():new Cl;jl(s)?(El(s)?o=new Af(o,s.sequence):Tl(s)&&(o=new Pf(o,s.graticule)),c.parseNothing=!0):null===(null==s||null===(t=s.format)||void 0===t?void 0:t.parse)&&(c.parseNothing=!0),o=null!==(n=zf.makeExplicit(o,e,c))&&void 0!==n?n:o,o=new Cf(o);const l=e.parent&&Bp(e.parent);var u;(Wp(e)||Rp(e))&&(l&&(o=null!==(u=wf.makeFromEncoding(o,e))&&void 0!==u?u:o));e.transforms.length>0&&(o=function(e,t,n){let i=0;for(const a of t.transforms){let s,c;if(rl(a))c=e=new Sd(e,a),s="derived";else if(Xc(a)){var o;const i=Of(a);c=e=null!==(o=zf.makeWithAncestors(e,{},i,n))&&void 0!==o?o:e,e=new sd(e,t,a.filter)}else if(al(a))c=e=wf.makeFromTransform(e,a,t),s="number";else if(cl(a))s="date",void 0===n.getWithExplicit(a.field).value&&(e=new zf(e,{[a.field]:s}),n.set(a.field,s,!1)),c=e=Il.makeFromTransform(e,a);else if(ll(a))c=e=Sf.makeFromTransform(e,a),s="number",nd(t)&&(e=new Cf(e));else if(Jc(a))c=e=Zp.make(e,t,a,i++),s="derived";else if(nl(a))c=e=new $f(e,a),s="number";else if(il(a))c=e=new Jf(e,a),s="number";else if(ul(a))c=e=Qf.makeFromTransform(e,a),s="derived";else if(dl(a))c=e=new Xp(e,a),s="derived";else if(ol(a))c=e=new Yp(e,a),s="derived";else if(Qc(a))c=e=new nm(e,a),s="derived";else if(tl(a))e=new im(e,a);else if(sl(a))c=e=$p.makeFromTransform(e,a),s="derived";else if($c(a))c=e=new Ip(e,a),s="derived";else if(Kc(a))c=e=new em(e,a),s="derived";else if(Zc(a))c=e=new tm(e,a),s="derived";else{if(!el(a)){ji("Ignoring an invalid transform: ".concat(g(a),"."));continue}c=e=new Kp(e,a),s="derived"}if(c&&void 0!==s)for(const e of null!==(r=c.producedFields())&&void 0!==r?r:[]){var r;n.set(e,s,!1)}}return e}(o,e,c));const d=function(e){const t={};if(Wp(e)&&e.component.selection)for(const n of C(e.component.selection)){const i=e.component.selection[n];for(const e of i.project.items)!e.channel&&H(e.field)>1&&(t[e.field]="flatten")}return t}(e),f=_f(e);if(o=null!==(i=zf.makeWithAncestors(o,{},{...d,...f},c))&&void 0!==i?i:o,Wp(e)&&(o=Jp.parseAll(o,e),o=Qp.parseAll(o,e)),Wp(e)||Rp(e)){var p,m;if(!l)o=null!==(m=wf.makeFromEncoding(o,e))&&void 0!==m?m:o;o=null!==(p=Il.makeFromEncoding(o,e))&&void 0!==p?p:o,o=Sd.parseAllForSortIndex(o,e)}const h=e.getDataName(Ll.Raw),v=new Vl(o,h,Ll.Raw,a);if(r[h]=v,o=v,Wp(e)){var y,b;const t=Sf.makeFromEncoding(o,e);t&&(o=t,nd(e)&&(o=new Cf(o))),o=null!==(y=$p.makeFromEncoding(o,e))&&void 0!==y?y:o,o=null!==(b=Qf.makeFromEncoding(o,e))&&void 0!==b?b:o}var x;Wp(e)&&(o=null!==(x=Gp.make(o,e))&&void 0!==x?x:o);const k=e.getDataName(Ll.Main),S=new Vl(o,k,Ll.Main,a);r[k]=S,o=S,Wp(e)&&function(e,t){for(const[i,o]of A(null!==(n=e.component.selection)&&void 0!==n?n:{})){var n;const r=e.getName("lookup_".concat(i));e.component.data.outputNodes[r]=o.materialized=new Vl(new sd(t,e,{param:i}),r,Ll.Lookup,e.component.data.outputNodeRefCounts)}}(e,S);let D=null;if(Rp(e)){var F;const t=e.getName("facet");o=null!==(F=function(e,t){const{row:n,column:i}=t;if(n&&i){let t=null;for(const o of[n,i])if(Jr(o.sort)){const{field:n,op:i=Ir}=o.sort;e=t=new Jf(e,{joinaggregate:[{op:i,field:n,as:pm(o,o.sort,{forAs:!0})}],groupby:[ka(o)]})}return t}return null}(o,e.facet))&&void 0!==F?F:o,D=new Df(o,e,t,S.getSource()),r[t]=D}return{...e.component.data,outputNodes:r,outputNodeRefCounts:a,raw:v,main:S,facetRoot:D,ancestorParse:c}}class vm extends Hp{constructor(e,t,n,i){var o,r,a,s;super(e,"concat",t,n,i,e.resolve),Ln(this,"children",void 0),"shared"!==(null===(o=e.resolve)||void 0===o||null===(r=o.axis)||void 0===r?void 0:r.x)&&"shared"!==(null===(a=e.resolve)||void 0===a||null===(s=a.axis)||void 0===s?void 0:s.y)||ji("Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415)."),this.children=this.getChildren(e).map(((e,t)=>Gm(e,this,this.getName("concat_".concat(t)),void 0,i)))}parseData(){this.component.data=hm(this);for(const e of this.children)e.parseData()}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const t of C(e.component.selection))this.component.selection[t]=e.component.selection[t]}}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){for(const e of this.children)e.parseAxesAndHeaders()}getChildren(e){return Js(e)?e.vconcat:Qs(e)?e.hconcat:e.concat}parseLayoutSize(){!function(e){um(e);const t=1===e.layout.columns?"width":"childWidth",n=void 0===e.layout.columns?"height":"childHeight";dm(e,t),dm(e,n)}(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(e){return this.children.reduce(((e,t)=>t.assembleSelectionTopLevelSignals(e)),e)}assembleSignals(){return this.children.forEach((e=>e.assembleSignals())),[]}assembleLayoutSignals(){const e=Rd(this);for(const t of this.children)e.push(...t.assembleLayoutSignals());return e}assembleSelectionData(e){return this.children.reduce(((e,t)=>t.assembleSelectionData(e)),e)}assembleMarks(){return this.children.map((e=>{const t=e.assembleTitle(),n=e.assembleGroupStyle(),i=e.assembleGroupEncodeEntry(!1);return{type:"group",name:e.getName("group"),...t?{title:t}:{},...n?{style:n}:{},...i?{encode:{update:i}}:{},...e.assembleGroup()}}))}assembleGroupStyle(){}assembleDefaultLayout(){const e=this.layout.columns;return{...null!=e?{columns:e}:{},bounds:"full",align:"each"}}}const ym={disable:1,gridScale:1,scale:1,...Qa,labelExpr:1,encode:1},bm=C(ym);class xm extends Sl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(),this.explicit=e,this.implicit=t,this.mainExtracted=n}clone(){return new xm(d(this.explicit),d(this.implicit),this.mainExtracted)}hasAxisPart(e){return"axis"===e||("grid"===e||"title"===e?!!this.get(e):!(!1===(t=this.get(e))||null===t));var t}hasOrientSignalRef(){return gn(this.explicit.orient)}}const wm={bottom:"top",top:"bottom",left:"right",right:"left"};function km(e,t){if(!e)return t.map((e=>e.clone()));{if(e.length!==t.length)return;const n=e.length;for(let i=0;i<n;i++){const n=e[i],o=t[i];if(!!n!=!!o)return;if(n&&o){const t=n.getWithExplicit("orient"),r=o.getWithExplicit("orient");if(t.explicit&&r.explicit&&t.value!==r.value)return;e[i]=Sm(n,o)}}}return e}function Sm(e,t){for(const n of bm){const i=zl(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",((e,t)=>{switch(n){case"title":return Tn(e,t);case"gridScale":return{explicit:e.explicit,value:V(e.value,t.value)}}return _l(e,t,n,"axis")}));e.setWithExplicit(n,i)}return e}function Dm(e,t,n,i,o){if("disable"===t)return void 0!==n;switch(n=n||{},t){case"titleAngle":case"labelAngle":return e===(gn(n.labelAngle)?n.labelAngle:J(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===kd(i,o))return!0}return e===n[t]}const Fm=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function Om(e,t){var n,i,o,r,a;let s=t.axis(e);const c=new xm,l=Ma(t.encoding[e]),{mark:u,config:d}=t,f=(null===(n=s)||void 0===n?void 0:n.orient)||(null===(i=d["x"===e?"axisX":"axisY"])||void 0===i?void 0:i.orient)||(null===(o=d.axis)||void 0===o?void 0:o.orient)||function(e){return"x"===e?"bottom":"left"}(e),p=t.getScaleComponent(e).get("type"),m=function(e,t,n,i){const o="band"===t?["axisDiscrete","axisBand"]:"point"===t?["axisDiscrete","axisPoint"]:Eo(t)?["axisQuantitative"]:"time"===t||"utc"===t?["axisTemporal"]:[],r="x"===e?"axisX":"axisY",a=gn(n)?"axisOrient":"axis".concat(T(n)),s=[...o,...o.map((e=>r+e.substr(4)))],c=["axis",a,r];return{vlOnlyAxisConfig:gd(s,i,e,n),vgAxisConfig:gd(c,i,e,n),axisConfigStyle:hd([...c,...s],i)}}(e,p,f,t.config),g=void 0!==s?!s:vd("disable",d.style,null===(r=s)||void 0===r?void 0:r.style,m).configValue;if(c.set("disable",g,void 0!==s),g)return c;s=s||{};const h=function(e,t,n,i,o){const r=null==t?void 0:t.labelAngle;if(void 0!==r)return gn(r)?r:J(r);{const{configValue:r}=vd("labelAngle",i,null==t?void 0:t.style,o);return void 0!==r?J(r):n!==ee||!y([bo,vo],e.type)||ca(e)&&e.timeUnit?void 0:270}}(l,s,e,d.style,m),v={fieldOrDatumDef:l,axis:s,channel:e,model:t,scaleType:p,orient:f,labelAngle:h,mark:u,config:d};for(const n of bm){const i=n in yd?yd[n](v):Ka(n)?s[n]:void 0,o=void 0!==i,r=Dm(i,n,s,t,e);if(o&&r)c.set(n,i,r);else{const{configValue:e,configFrom:t}=Ka(n)&&"values"!==n?vd(n,d.style,s.style,m):{},a=void 0!==e;o&&!a?c.set(n,i,r):("vgAxisConfig"!==t||Fm.has(n)&&a||Ya(e)||gn(e))&&c.set(n,e,!1)}}const b=null!==(a=s.encoding)&&void 0!==a?a:{},x=Xa.reduce(((n,i)=>{var o;if(!c.hasAxisPart(i))return n;const r=Id(null!==(o=b[i])&&void 0!==o?o:{},t),a="labels"===i?function(e,t,n){var i;const{encoding:o,config:r}=e,a=null!==(i=Ma(o[t]))&&void 0!==i?i:Ma(o[nt(t)]),s=e.axis(t)||{},{format:c,formatType:l}=s;return Er(l)?{text:qr({fieldOrDatumDef:a,field:"datum.value",format:c,formatType:l,config:r}),...n}:n}(t,e,r):r;return void 0===a||z(a)||(n[i]={update:a}),n}),{});return z(x)||c.set("encode",x,!!s.encoding||void 0!==s.labelAngle),c}function _m(e,t,n){const i=fn(e),o=Cn("orient",i,n);var r,a;if(i.orient=function(e,t,n){switch(e){case sr:case pr:case mr:case ur:case cr:case rr:return}const{x:i,y:o,x2:r,y2:a}=t;switch(e){case or:if(ca(i)&&(sn(i.bin)||ca(o)&&o.aggregate&&!i.aggregate))return"vertical";if(ca(o)&&(sn(o.bin)||ca(i)&&i.aggregate&&!o.aggregate))return"horizontal";if(a||r){if(n)return n;if(!r&&(ca(i)&&i.type===ho&&!an(i.bin)||fa(i)))return"horizontal";if(!a&&(ca(o)&&o.type===ho&&!an(o.bin)||fa(o)))return"vertical"}case lr:if(r&&(!ca(i)||!sn(i.bin))&&a&&(!ca(o)||!sn(o.bin)))return;case ir:if(a)return ca(o)&&sn(o.bin)?"horizontal":"vertical";if(r)return ca(i)&&sn(i.bin)?"vertical":"horizontal";if(e===lr){if(i&&!o)return"vertical";if(o&&!i)return"horizontal"}case ar:case dr:{const t=da(i),r=da(o);if(n)return n;if(t&&!r)return"tick"!==e?"horizontal":"vertical";if(!t&&r)return"tick"!==e?"vertical":"horizontal";if(t&&r){const t=i,n=o,r=t.type===yo,a=n.type===yo;return r&&!a?"tick"!==e?"vertical":"horizontal":!r&&a?"tick"!==e?"horizontal":"vertical":!t.aggregate&&n.aggregate?"tick"!==e?"vertical":"horizontal":t.aggregate&&!n.aggregate&&"tick"!==e?"horizontal":"vertical"}return}}return"vertical"}(i.type,t,o),void 0!==o&&o!==i.orient&&ji((r=i.orient,a=o,'Specified orient "'.concat(r,'" overridden with "').concat(a,'".'))),"bar"===i.type&&i.orient){const e=Cn("cornerRadiusEnd",i,n);if(void 0!==e){const n="horizontal"===i.orient&&t.x2||"vertical"===i.orient&&t.y2?["cornerRadius"]:Dr[i.orient];for(const t of n)i[t]=e;void 0!==i.cornerRadiusEnd&&delete i.cornerRadiusEnd}}void 0===Cn("opacity",i,n)&&(i.opacity=function(e,t){if(y([sr,dr,pr,mr],e)&&!rs(t))return.7;return}(i.type,t));return void 0===Cn("cursor",i,n)&&(i.cursor=function(e,t,n){if(t.href||e.href||Cn("href",e,n))return"pointer";return e.cursor}(i,t,n)),i}function zm(e,t){const{config:n}=e;return{...Cu(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"}),...hu("x",e,{defaultPos:"mid"}),...hu("y",e,{defaultPos:"mid"}),...fu("size",e),...fu("angle",e),...Cm(e,n,t)}}function Cm(e,t,n){return n?{shape:{value:n}}:fu("shape",e)}const Pm={vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return e.encoding.x||e.encoding.y||e.encoding.latitude||e.encoding.longitude?{...Cu(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...wu("x",e,{defaultPos:"horizontal"===n?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"vertical"!==n}),...wu("y",e,{defaultPos:"vertical"===n?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"horizontal"!==n}),...fu("size",e,{vgChannel:"strokeWidth"})}:{}}};function Am(e,t,n){if(void 0===Cn("align",e,n))return"center"}function Nm(e,t,n){if(void 0===Cn("baseline",e,n))return"middle"}const jm={vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,i=n.orient,o="horizontal"===i?"width":"height",r="horizontal"===i?"height":"width";return{...Cu(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...hu("x",e,{defaultPos:"mid",vgChannel:"xc"}),...hu("y",e,{defaultPos:"mid",vgChannel:"yc"}),...fu("size",e,{defaultValue:Em(e),vgChannel:o}),[r]:Dn(Cn("thickness",n,t))}}};function Em(e){var n;const{config:i,markDef:o}=e,{orient:r}=o,a="horizontal"===r?"width":"height",s=e.getScaleComponent("horizontal"===r?"x":"y"),c=null!==(n=Cn("size",o,i,{vgChannel:a}))&&void 0!==n?n:i.tick.bandSize;if(void 0!==c)return c;{const e=s?s.get("range"):void 0;if(e&&hn(e)&&t.isNumber(e.step))return 3*e.step/4;return 3*oc(i.view,a)/4}}const Mm={arc:{vgMark:"arc",encodeEntry:e=>({...Cu(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"}),...hu("x",e,{defaultPos:"mid"}),...hu("y",e,{defaultPos:"mid"}),...Du(e,"radius"),...Du(e,"theta")})},area:{vgMark:"area",encodeEntry:e=>({...Cu(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"}),...wu("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"horizontal"===e.markDef.orient}),...wu("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"vertical"===e.markDef.orient}),...Nu(e)})},bar:{vgMark:"rect",encodeEntry:e=>({...Cu(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...Du(e,"x"),...Du(e,"y")})},circle:{vgMark:"symbol",encodeEntry:e=>zm(e,"circle")},geoshape:{vgMark:"shape",encodeEntry:e=>({...Cu(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})}),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape;return[{type:"geoshape",projection:e.projectionName(),...n&&ca(n)&&n.type===xo?{field:ka(n,{expr:"datum"})}:{}}]}},image:{vgMark:"image",encodeEntry:e=>({...Cu(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"}),...Du(e,"x"),...Du(e,"y"),...ou(e,"url")})},line:{vgMark:"line",encodeEntry:e=>({...Cu(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"}),...hu("x",e,{defaultPos:"mid"}),...hu("y",e,{defaultPos:"mid"}),...fu("size",e,{vgChannel:"strokeWidth"}),...Nu(e)})},point:{vgMark:"symbol",encodeEntry:e=>zm(e)},rect:{vgMark:"rect",encodeEntry:e=>({...Cu(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...Du(e,"x"),...Du(e,"y")})},rule:Pm,square:{vgMark:"symbol",encodeEntry:e=>zm(e,"square")},text:{vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return{...Cu(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"}),...hu("x",e,{defaultPos:"mid"}),...hu("y",e,{defaultPos:"mid"}),...ou(e),...fu("size",e,{vgChannel:"fontSize"}),...fu("angle",e),...ju("align",Am(e.markDef,n,t)),...ju("baseline",Nm(e.markDef,n,t)),...hu("radius",e,{defaultPos:null}),...hu("theta",e,{defaultPos:null})}}},tick:jm,trail:{vgMark:"trail",encodeEntry:e=>({...Cu(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"}),...hu("x",e,{defaultPos:"mid"}),...hu("y",e,{defaultPos:"mid"}),...fu("size",e),...Nu(e)})}};function Tm(e){if(y([ar,ir,fr],e.mark)){const t=ds(e.mark,e.encoding);if(t.length>0)return function(e,t){return[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:Lm+e.requestDataName(Ll.Main),data:e.requestDataName(Ll.Main),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:Rm(e,{fromPrefix:Lm})}]}(e,t)}else if(e.mark===or){const t=xn.some((t=>Cn(t,e.markDef,e.config)));if(e.stack&&!e.fieldDef("size")&&t)return function(e){var t;const[n]=Rm(e,{fromPrefix:qm}),i=e.scaleName(e.stack.fieldChannel),o=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.vgField(e.stack.fieldChannel,t)},r=(e,t)=>{const n=[o({prefix:"min",suffix:"start",expr:t}),o({prefix:"max",suffix:"start",expr:t}),o({prefix:"min",suffix:"end",expr:t}),o({prefix:"max",suffix:"end",expr:t})];return"".concat(e,"(").concat(n.map((e=>"scale('".concat(i,"',").concat(e,")"))).join(","),")")};let a,s;"x"===e.stack.fieldChannel?(a={...p(n.encode.update,["y","yc","y2","height",...xn]),x:{signal:r("min","datum")},x2:{signal:r("max","datum")},clip:{value:!0}},s={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},n.encode.update={...m(n.encode.update,["y","yc","y2"]),height:{field:{group:"height"}}}):(a={...p(n.encode.update,["x","xc","x2","width"]),y:{signal:r("min","datum")},y2:{signal:r("max","datum")},clip:{value:!0}},s={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},n.encode.update={...m(n.encode.update,["x","xc","x2"]),width:{field:{group:"width"}}});for(const t of xn){const i=Pn(t,e.markDef,e.config);n.encode.update[t]?(a[t]=n.encode.update[t],delete n.encode.update[t]):i&&(a[t]=Dn(i)),i&&(n.encode.update[t]={value:0})}const c=[];if((null===(t=e.stack.groupbyChannels)||void 0===t?void 0:t.length)>0)for(const t of e.stack.groupbyChannels){const n=e.fieldDef(t),i=ka(n);i&&c.push(i),(null!=n&&n.bin||null!=n&&n.timeUnit)&&c.push(ka(n,{binSuffix:"end"}))}a=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce(((t,i)=>{if(n.encode.update[i])return{...t,[i]:n.encode.update[i]};{const n=Pn(i,e.markDef,e.config);return void 0!==n?{...t,[i]:Dn(n)}:t}}),a),a.stroke&&(a.strokeForeground={value:!0},a.strokeOffset={value:0});return[{type:"group",from:{facet:{data:e.requestDataName(Ll.Main),name:qm+e.requestDataName(Ll.Main),groupby:c,aggregate:{fields:[o({suffix:"start"}),o({suffix:"start"}),o({suffix:"end"}),o({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:a},marks:[{type:"group",encode:{update:s},marks:[n]}]}]}(e)}return Rm(e)}const Lm="faceted_path_";const qm="stack_group_";function Wm(e){const{encoding:n,stack:i,mark:o,markDef:r,config:a}=e,s=n.order;if(!(!t.isArray(s)&&ga(s)&&v(s.value)||!s&&v(Cn("order",r,a)))){if((t.isArray(s)||ca(s))&&!i)return jn(s,{expr:"datum"});if(hr(o)){const i="horizontal"===r.orient?"y":"x",o=n[i];if(ca(o)){const n=o.sort;if(t.isArray(n))return{field:ka(o,{prefix:i,suffix:"sort_index",expr:"datum"})};if(Jr(n))return{field:ka({aggregate:rs(e.encoding)?n.op:void 0,field:n.field},{expr:"datum"})};if(Xr(n)){return{field:ka(e.fieldDef(n.encoding),{expr:"datum"}),order:n.order}}if(null===n)return;var c;return{field:ka(o,{binSuffix:null!==(c=e.stack)&&void 0!==c&&c.impute?"mid":void 0,expr:"datum"})}}}else;}}function Rm(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{fromPrefix:""};const{mark:n,markDef:i,encoding:o,config:r}=e,a=V(i.clip,Um(e),Bm(e)),s=zn(i),c=o.key,l=Wm(e),u=Hm(e),d=Cn("aria",i,r),f=Mm[n].postEncodingTransform?Mm[n].postEncodingTransform(e):null;return[{name:e.getName("marks"),type:Mm[n].vgMark,...a?{clip:!0}:{},...s?{style:s}:{},...c?{key:c.field}:{},...l?{sort:l}:{},...u||{},...!1===d?{aria:d}:{},from:{data:t.fromPrefix+e.requestDataName(Ll.Main)},encode:{update:Mm[n].encodeEntry(e)},...f?{transform:f}:{}}]}function Um(e){const t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return!!(null!=t&&t.get("selectionExtent")||null!=n&&n.get("selectionExtent"))||void 0}function Bm(e){const t=e.component.projection;return!(!t||t.isFit)||void 0}function Hm(e){if(!e.component.selection)return null;const t=C(e.component.selection).length;let n=t,i=e.parent;for(;i&&0===n;)n=C(i.component.selection).length,i=i.parent;return n?{interactive:t>0||!!e.encoding.tooltip}:null}class Vm extends Vp{constructor(e,n,i){var o;let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4?arguments[4]:void 0;super(e,"unit",n,i,a,void 0,tc(e)?e.view:void 0),Ln(this,"markDef",void 0),Ln(this,"encoding",void 0),Ln(this,"specifiedScales",{}),Ln(this,"stack",void 0),Ln(this,"specifiedAxes",{}),Ln(this,"specifiedLegends",{}),Ln(this,"specifiedProjection",{}),Ln(this,"selection",[]),Ln(this,"children",[]);const s=br(e.mark)?{...e.mark}:{type:e.mark},c=s.type;void 0===s.filled&&(s.filled=function(e,t,n){let{graticule:i}=n;if(i)return!1;const o=Pn("filled",e,t),r=e.type;return V(o,r!==sr&&r!==ar&&r!==lr)}(s,a,{graticule:e.data&&Tl(e.data)}));const l=this.encoding=function(e,n,i,o){const r={};for(const t of C(e))$e(t)||ji("".concat(a=t,"-encoding is dropped as ").concat(a," is not a valid encoding channel."));var a;for(let a of at){if(!e[a])continue;const s=e[a];if(Pt(a)){const e=rt(a),t=r[e];if(ca(t)){if(mo(t.type)&&ca(s)){ji(ei(e));continue}}else a=e,ji(ti(e))}if("angle"!==a||"arc"!==n||e.theta||(ji("Arc marks uses theta channel rather than angle, replacing angle with theta."),a=ce),ss(e,a,n)){if(a===ye&&"line"===n){const t=Ea(e[a]);if(null!=t&&t.aggregate){ji("Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.");continue}}if(a===me&&(i?"fill"in e:"stroke"in e))ji(ai("encoding",{fill:"fill"in e,stroke:"stroke"in e}));else if(a===_e||a===Oe&&!t.isArray(s)&&!ga(s)||a===Ce&&t.isArray(s))s&&(r[a]=t.array(s).reduce(((e,t)=>(ca(t)?e.push(qa(t,a)):ji(si(t,a)),e)),[]));else{if(a===Ce&&null===s)r[a]=null;else if(!(ca(s)||ua(s)||ga(s)||ra(s)||gn(s))){ji(si(s,a));continue}r[a]=Ta(s,a,o)}}else ji(ci(a,n))}return r}(e.encoding||{},c,s.filled,a);this.markDef=_m(s,l,a),this.size=function(e){let{encoding:t,size:n}=e;for(const e of Dt){const i=it(e);ec(n[i])&&da(t[e])&&(delete n[i],ji(xi(i)))}return n}({encoding:l,size:tc(e)?{...r,...e.width?{width:e.width}:{},...e.height?{height:e.height}:{}}:r}),this.stack=Nc(c,l),this.specifiedScales=this.initScales(c,l),this.specifiedAxes=this.initAxes(l),this.specifiedLegends=this.initLegends(l),this.specifiedProjection=e.projection,this.selection=(null!==(o=e.params)&&void 0!==o?o:[]).filter((e=>Gs(e)))}get hasProjection(){const{encoding:e}=this,t=this.mark===gr,n=e&&Te.some((t=>pa(e[t])));return t||n}scaleDomain(e){const t=this.specifiedScales[e];return t?t.domain:void 0}axis(e){return this.specifiedAxes[e]}legend(e){return this.specifiedLegends[e]}initScales(e,t){return Bt.reduce(((e,n)=>{const i=Ma(t[n]);var o;i&&(e[n]=this.initScale(null!==(o=i.scale)&&void 0!==o?o:{}));return e}),{})}initScale(e){const{domain:n,range:i}=e,o=fn(e);return t.isArray(n)&&(o.domain=n.map(kn)),t.isArray(i)&&(o.range=i.map(kn)),o}initAxes(e){return Dt.reduce(((t,n)=>{const i=e[n];if(pa(i)||n===ee&&pa(e.x2)||n===te&&pa(e.y2)){const e=pa(i)?i.axis:void 0;t[n]=e?this.initAxis({...e}):e}return t}),{})}initAxis(e){const t=C(e),n={};for(const i of t){const t=e[i];n[i]=Ya(t)?wn(t):kn(t)}return n}initLegends(e){return Rt.reduce(((t,n)=>{const i=Ma(e[n]);if(i&&function(e){switch(e){case me:case ge:case he:case ye:case ve:case xe:case Se:case De:return!0;case we:case ke:case be:return!1}}(n)){const e=i.legend;t[n]=e?fn(e):e}return t}),{})}parseData(){this.component.data=hm(this)}parseLayoutSize(){!function(e){const{size:t,component:n}=e;for(const i of Dt){const o=it(i);if(t[o]){const e=t[o];n.layoutSize.set(o,ec(e)?"step":e,!0)}else{const t=fm(e,o);n.layoutSize.set(o,t,!1)}}}(this)}parseSelections(){this.component.selection=function(e,n){const i={},o=e.config.selection;if(!n||!n.length)return i;for(const a of n){const n=j(a.name),s=a.select,c=t.isString(s)?s:s.type,l=t.isObject(s)?d(s):{type:c},u=o[c];for(const e in u){var r;"fields"!==e&&"encodings"!==e&&("mark"===e&&(l[e]={...u[e],...l[e]}),(void 0===l[e]||!0===l[e])&&(l[e]=null!==(r=u[e])&&void 0!==r?r:l[e]))}const f=i[n]={...l,name:n,type:c,init:a.value,bind:a.bind,events:t.isString(l.on)?t.parseSelector(l.on,"scope"):t.array(d(l.on))};for(const t of Zu)t.defined(f)&&t.parse&&t.parse(e,f,a)}return i}(this,this.selection)}parseMarkGroup(){this.component.mark=Tm(this)}parseAxesAndHeaders(){var e;this.component.axes=(e=this,Dt.reduce(((t,n)=>(e.component.scales[n]&&(t[n]=[Om(n,e)]),t)),{}))}assembleSelectionTopLevelSignals(e){return function(e,n){let i=!1;for(const r of P(null!==(o=e.component.selection)&&void 0!==o?o:{})){var o;const a=r.name,s=t.stringValue(a+Ju);if(0===n.filter((e=>e.name===a)).length){const e="global"===r.resolve?"union":r.resolve,i="point"===r.type?", true, true)":")";n.push({name:r.name,update:"".concat(Ku,"(").concat(s,", ").concat(t.stringValue(e)).concat(i)})}i=!0;for(const t of Zu)t.defined(r)&&t.topLevelSignals&&(n=t.topLevelSignals(e,r,n))}i&&0===n.filter((e=>"unit"===e.name)).length&&n.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]});return Bl(n)}(this,e)}assembleSignals(){return[...md(this),...Wl(this,[])]}assembleSelectionData(e){return function(e,t){const n=[...t];for(const t of P(null!==(i=e.component.selection)&&void 0!==i?i:{})){var i;const o={name:t.name+Ju};if(t.init){const n=t.project.items.map((e=>{const{signals:t,...n}=e;return n}));o.values=t.init.map((t=>({unit:td(e,{escape:!1}),fields:n,values:ql(t,!1)})))}n.filter((e=>e.name===t.name+Ju)).length||n.push(o)}return n}(this,e)}assembleLayout(){return null}assembleLayoutSignals(){return Rd(this)}assembleMarks(){var e;let t=null!==(e=this.component.mark)&&void 0!==e?e:[];return this.parent&&Bp(this.parent)||(t=Ul(this,t)),t.map(this.correctDataNames)}assembleGroupStyle(){const{style:e}=this.view||{};return void 0!==e?e:this.encoding.x||this.encoding.y?"cell":void 0}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(e){return ns(this.encoding,e)}fieldDef(e){return Ea(this.encoding[e])}typedFieldDef(e){const t=this.fieldDef(e);return ma(t)?t:null}}class Im extends Hp{constructor(e,t,n,i,o){super(e,"layer",t,n,o,e.resolve,e.view),Ln(this,"children",void 0);const r={...i,...e.width?{width:e.width}:{},...e.height?{height:e.height}:{}};this.children=e.layer.map(((e,t)=>{if(Sc(e))return new Im(e,this,this.getName("layer_".concat(t)),r,o);if(es(e))return new Vm(e,this,this.getName("layer_".concat(t)),r,o);throw new Error(Un(e))}))}parseData(){this.component.data=hm(this);for(const e of this.children)e.parseData()}parseLayoutSize(){var e;um(e=this),dm(e,"width"),dm(e,"height")}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const t of C(e.component.selection))this.component.selection[t]=e.component.selection[t]}}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){!function(e){const{axes:t,resolve:n}=e.component,i={top:0,bottom:0,right:0,left:0};for(const i of e.children){i.parseAxesAndHeaders();for(const o of C(i.component.axes))n.axis[o]=Yd(e.component.resolve,o),"shared"===n.axis[o]&&(t[o]=km(t[o],i.component.axes[o]),t[o]||(n.axis[o]="independent",delete t[o]))}for(const r of Dt){for(const a of e.children)if(a.component.axes[r]){if("independent"===n.axis[r]){var o;t[r]=(null!==(o=t[r])&&void 0!==o?o:[]).concat(a.component.axes[r]);for(const e of a.component.axes[r]){const{value:t,explicit:n}=e.getWithExplicit("orient");if(!gn(t)){if(i[t]>0&&!n){const n=wm[t];i[t]>i[n]&&e.set("orient",n,!1)}i[t]++}}}delete a.component.axes[r]}if("independent"===n.axis[r]&&t[r]&&t[r].length>1)for(const e of t[r])e.get("grid")&&!e.explicit.grid&&(e.implicit.grid=!1)}}(this)}assembleSelectionTopLevelSignals(e){return this.children.reduce(((e,t)=>t.assembleSelectionTopLevelSignals(e)),e)}assembleSignals(){return this.children.reduce(((e,t)=>e.concat(t.assembleSignals())),md(this))}assembleLayoutSignals(){return this.children.reduce(((e,t)=>e.concat(t.assembleLayoutSignals())),Rd(this))}assembleSelectionData(e){return this.children.reduce(((e,t)=>t.assembleSelectionData(e)),e)}assembleGroupStyle(){const e=new Set;for(const n of this.children)for(const i of t.array(n.assembleGroupStyle()))e.add(i);const n=Array.from(e);return n.length>1?n:1===n.length?n[0]:void 0}assembleTitle(){let e=super.assembleTitle();if(e)return e;for(const t of this.children)if(e=t.assembleTitle(),e)return e}assembleLayout(){return null}assembleMarks(){return function(e,t){for(const n of e.children)Wp(n)&&(t=Ul(n,t));return t}(this,this.children.flatMap((e=>e.assembleMarks())))}assembleLegends(){return this.children.reduce(((e,t)=>e.concat(t.assembleLegends())),df(this))}}function Gm(e,t,n,i,o){if(Zr(e))return new mm(e,t,n,o);if(Sc(e))return new Im(e,t,n,i,o);if(es(e))return new Vm(e,t,n,i,o);if(function(e){return Js(e)||Qs(e)||Xs(e)}(e))return new vm(e,t,n,o);throw new Error(Un(e))}function Ym(e,n,i,o){const r=o.component.layoutSize.get("width"),a=o.component.layoutSize.get("height");if(void 0===n?(n={type:"pad"},o.hasAxisOrientSignalRef()&&(n.resize=!0)):t.isString(n)&&(n={type:n}),r&&a&&("fit"===(s=n.type)||"fit-x"===s||"fit-y"===s))if("step"===r&&"step"===a)ji(In()),n.type="pad";else if("step"===r||"step"===a){const e="step"===r?"width":"height";ji(In(zt(e)));const t="width"===e?"height":"width";n.type=function(e){return e?"fit-".concat(zt(e)):"fit"}(t)}var s;return{...1===C(n).length&&n.type?"pad"===n.type?{}:{autosize:n.type}:{autosize:n},...Ks(i,!1),...Ks(e,!0)}}function Xm(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;const o=e.config?wc(e.config):void 0,r=[].concat(e.assembleSelectionData([]),rm(e.component.data,n)),a=e.assembleProjections(),s=e.assembleTitle(),c=e.assembleGroupStyle(),l=e.assembleGroupEncodeEntry(!0);let u=e.assembleLayoutSignals();u=u.filter((e=>"width"!==e.name&&"height"!==e.name||void 0===e.value||(t[e.name]=+e.value,!1)));const{params:d,...f}=t;return{$schema:"https://vega.github.io/schema/vega/v5.json",...e.description?{description:e.description}:{},...f,...s?{title:s}:{},...c?{style:c}:{},...l?{encode:{update:l}}:{},data:r,...a.length>0?{projections:a}:{},...e.assembleGroup([...u,...e.assembleSelectionTopLevelSignals([]),...Ys(d)]),...o?{config:o}:{},...i?{usermeta:i}:{}}}const Jm=n;e.accessPathDepth=H,e.accessPathWithDatum=L,e.compile=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n.logger&&Ai(n.logger),n.fieldTitle&&_a(n.fieldTitle);try{const i=vc(t.mergeConfig(n.config,e.config)),o=yl(e,i),r=Gm(o,null,"",void 0,i);r.parse(),op(r.component.data,r);return{spec:Xm(r,Ym(e,o.autosize,i,r),e.datasets,e.usermeta),normalized:o}}finally{n.logger&&Ni(),n.fieldTitle&&za()}},e.contains=y,e.deepEqual=u,e.deleteNestedProperty=M,e.duplicate=d,e.entries=A,e.every=x,e.fieldIntersection=_,e.flatAccessWithDatum=q,e.getFirstDefined=V,e.hasIntersection=F,e.hash=h,e.internalField=Y,e.isBoolean=N,e.isEmpty=z,e.isEqual=function(e,t){const n=C(e),i=C(t);if(n.length!==i.length)return!1;for(const i of n)if(e[i]!==t[i])return!1;return!0},e.isInternalField=X,e.isNullOrFalse=v,e.isNumeric=Q,e.keys=C,e.logicalExpr=E,e.mergeDeep=w,e.never=f,e.normalize=yl,e.normalizeAngle=J,e.omit=m,e.pick=p,e.prefixGenerator=O,e.removePathFromField=B,e.replaceAll=U,e.replacePathInField=R,e.resetIdCounter=function(){I=42},e.setEqual=D,e.some=b,e.stringify=g,e.titleCase=T,e.unique=S,e.uniqueId=G,e.vals=P,e.varName=j,e.version=Jm,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=vega-lite.min.js.map
</script>
<script>!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("vega"),require("vega-lite")):"function"==typeof define&&define.amd?define(["vega","vega-lite"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).vegaEmbed=t(e.vega,e.vegaLite)}(this,(function(e,t){"use strict";function n(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var o=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var o,r=n(e),i=n(t),a=(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},o(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=Object.prototype.hasOwnProperty;function c(e,t){return s.call(e,t)}function l(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);t=[];for(var o in e)c(e,o)&&t.push(o);return t}function h(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function p(e){for(var t,n=0,o=e.length;n<o;){if(!((t=e.charCodeAt(n))>=48&&t<=57))return!1;n++}return!0}function u(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function d(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function f(e){if(void 0===e)return!0;if(e)if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(f(e[t]))return!0}else if("object"==typeof e){var o=l(e),r=o.length;for(t=0;t<r;t++)if(f(e[o[t]]))return!0}return!1}function g(e,t){var n=[e];for(var o in t){var r="object"==typeof t[o]?JSON.stringify(t[o],null,2):t[o];void 0!==r&&n.push(o+": "+r)}return n.join("\n")}var v=function(e){function t(t,n,o,r,i){var a=this.constructor,s=e.call(this,g(t,{name:n,index:o,operation:r,tree:i}))||this;return s.name=n,s.index=o,s.operation=r,s.tree=i,Object.setPrototypeOf(s,a.prototype),s.message=g(t,{name:n,index:o,operation:r,tree:i}),s}return a(t,e),t}(Error),m=v,E=h,b={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var o=e[t];return delete e[t],{newDocument:n,removed:o}},replace:function(e,t,n){var o=e[t];return e[t]=this.value,{newDocument:n,removed:o}},move:function(e,t,n){var o=w(n,this.path);o&&(o=h(o));var r=O(n,{op:"remove",path:this.from}).removed;return O(n,{op:"add",path:this.path,value:r}),{newDocument:n,removed:o}},copy:function(e,t,n){var o=w(n,this.from);return O(n,{op:"add",path:this.path,value:h(o)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:N(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},y={add:function(e,t,n){return p(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){return{newDocument:n,removed:e.splice(t,1)[0]}},replace:function(e,t,n){var o=e[t];return e[t]=this.value,{newDocument:n,removed:o}},move:b.move,copy:b.copy,test:b.test,_get:b._get};function w(e,t){if(""==t)return e;var n={op:"_get",path:t};return O(e,n),n.value}function O(e,t,n,o,r,i){if(void 0===n&&(n=!1),void 0===o&&(o=!0),void 0===r&&(r=!0),void 0===i&&(i=0),n&&("function"==typeof n?n(t,0,e,t.path):x(t,0)),""===t.path){var a={newDocument:e};if("add"===t.op)return a.newDocument=t.value,a;if("replace"===t.op)return a.newDocument=t.value,a.removed=e,a;if("move"===t.op||"copy"===t.op)return a.newDocument=w(e,t.from),"move"===t.op&&(a.removed=e),a;if("test"===t.op){if(a.test=N(e,t.value),!1===a.test)throw new m("Test operation failed","TEST_OPERATION_FAILED",i,t,e);return a.newDocument=e,a}if("remove"===t.op)return a.removed=e,a.newDocument=null,a;if("_get"===t.op)return t.value=e,a;if(n)throw new m("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",i,t,e);return a}o||(e=h(e));var s=(t.path||"").split("/"),c=e,l=1,u=s.length,f=void 0,g=void 0,v=void 0;for(v="function"==typeof n?n:x;;){if((g=s[l])&&-1!=g.indexOf("~")&&(g=d(g)),r&&"__proto__"==g)throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&void 0===f&&(void 0===c[g]?f=s.slice(0,l).join("/"):l==u-1&&(f=t.path),void 0!==f&&v(t,0,e,f)),l++,Array.isArray(c)){if("-"===g)g=c.length;else{if(n&&!p(g))throw new m("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",i,t,e);p(g)&&(g=~~g)}if(l>=u){if(n&&"add"===t.op&&g>c.length)throw new m("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",i,t,e);if(!1===(a=y[t.op].call(t,c,g,e)).test)throw new m("Test operation failed","TEST_OPERATION_FAILED",i,t,e);return a}}else if(l>=u){if(!1===(a=b[t.op].call(t,c,g,e)).test)throw new m("Test operation failed","TEST_OPERATION_FAILED",i,t,e);return a}if(c=c[g],n&&l<u&&(!c||"object"!=typeof c))throw new m("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",i,t,e)}}function A(e,t,n,o,r){if(void 0===o&&(o=!0),void 0===r&&(r=!0),n&&!Array.isArray(t))throw new m("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");o||(e=h(e));for(var i=new Array(t.length),a=0,s=t.length;a<s;a++)i[a]=O(e,t[a],n,!0,r,a),e=i[a].newDocument;return i.newDocument=e,i}function x(e,t,n,o){if("object"!=typeof e||null===e||Array.isArray(e))throw new m("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(!b[e.op])throw new m("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n);if("string"!=typeof e.path)throw new m("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new m('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new m("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new m("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&f(e.value))throw new m("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n)if("add"==e.op){var r=e.path.split("/").length,i=o.split("/").length;if(r!==i+1&&r!==i)throw new m("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==o)throw new m("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if("move"===e.op||"copy"===e.op){var a=I([{op:"_get",path:e.from,value:void 0}],n);if(a&&"OPERATION_PATH_UNRESOLVABLE"===a.name)throw new m("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}function I(e,t,n){try{if(!Array.isArray(e))throw new m("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)A(h(t),h(e),n||!0);else{n=n||x;for(var o=0;o<e.length;o++)n(e[o],o,t,void 0)}}catch(e){if(e instanceof m)return e;throw e}}function N(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var n,o,r,i=Array.isArray(e),a=Array.isArray(t);if(i&&a){if((o=e.length)!=t.length)return!1;for(n=o;0!=n--;)if(!N(e[n],t[n]))return!1;return!0}if(i!=a)return!1;var s=Object.keys(e);if((o=s.length)!==Object.keys(t).length)return!1;for(n=o;0!=n--;)if(!t.hasOwnProperty(s[n]))return!1;for(n=o;0!=n--;)if(!N(e[r=s[n]],t[r]))return!1;return!0}return e!=e&&t!=t}var R=Object.freeze({__proto__:null,JsonPatchError:m,deepClone:E,getValueByPointer:w,applyOperation:O,applyPatch:A,applyReducer:function(e,t,n){var o=O(e,t);if(!1===o.test)throw new m("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return o.newDocument},validator:x,validate:I,_areEquals:N}),T=new WeakMap,L=function(e){this.observers=new Map,this.obj=e},S=function(e,t){this.callback=e,this.observer=t};
/*!
     * https://github.com/Starcounter-Jack/JSON-Patch
     * (c) 2017 Joachim Wester
     * MIT license
     */function D(e,t){void 0===t&&(t=!1);var n=T.get(e.object);C(n.value,e.object,e.patches,"",t),e.patches.length&&A(n.value,e.patches);var o=e.patches;return o.length>0&&(e.patches=[],e.callback&&e.callback(o)),o}function C(e,t,n,o,r){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var i=l(t),a=l(e),s=!1,p=a.length-1;p>=0;p--){var d=e[g=a[p]];if(!c(t,g)||void 0===t[g]&&void 0!==d&&!1===Array.isArray(t))Array.isArray(e)===Array.isArray(t)?(r&&n.push({op:"test",path:o+"/"+u(g),value:h(d)}),n.push({op:"remove",path:o+"/"+u(g)}),s=!0):(r&&n.push({op:"test",path:o,value:e}),n.push({op:"replace",path:o,value:t}));else{var f=t[g];"object"==typeof d&&null!=d&&"object"==typeof f&&null!=f&&Array.isArray(d)===Array.isArray(f)?C(d,f,n,o+"/"+u(g),r):d!==f&&(r&&n.push({op:"test",path:o+"/"+u(g),value:h(d)}),n.push({op:"replace",path:o+"/"+u(g),value:h(f)}))}}if(s||i.length!=a.length)for(p=0;p<i.length;p++){var g;c(e,g=i[p])||void 0===t[g]||n.push({op:"add",path:o+"/"+u(g),value:h(t[g])})}}}var F=Object.freeze({__proto__:null,unobserve:function(e,t){t.unobserve()},observe:function(e,t){var n,o=function(e){return T.get(e)}(e);if(o){var r=function(e,t){return e.observers.get(t)}(o,t);n=r&&r.observer}else o=new L(e),T.set(e,o);if(n)return n;if(n={},o.value=h(e),t){n.callback=t,n.next=null;var i=function(){D(n)},a=function(){clearTimeout(n.next),n.next=setTimeout(i)};"undefined"!=typeof window&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return n.patches=[],n.object=e,n.unobserve=function(){D(n),clearTimeout(n.next),function(e,t){e.observers.delete(t.callback)}(o,n),"undefined"!=typeof window&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},o.observers.set(t,new S(t,n)),n},generate:D,compare:function(e,t,n){void 0===n&&(n=!1);var o=[];return C(e,t,o,"",n),o}});Object.assign({},R,F,{JsonPatchError:v,deepClone:h,escapePathComponent:u,unescapePathComponent:d});var k=/("(?:[^\\"]|\\.)*")|[:,]/g,P=function(e,t){var n,o,r;return t=t||{},n=JSON.stringify([1],void 0,void 0===t.indent?2:t.indent).slice(2,-3),o=""===n?1/0:void 0===t.maxLength?80:t.maxLength,r=t.replacer,function e(t,i,a){var s,c,l,h,p,u,d,f,g,v,m,E;if(t&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0===(m=JSON.stringify(t,r)))return m;if(d=o-i.length-a,m.length<=d&&(g=m.replace(k,(function(e,t){return t||e+" "}))).length<=d)return g;if(null!=r&&(t=JSON.parse(m),r=void 0),"object"==typeof t&&null!==t){if(f=i+n,l=[],c=0,Array.isArray(t))for(v="[",s="]",d=t.length;c<d;c++)l.push(e(t[c],f,c===d-1?0:1)||"null");else for(v="{",s="}",d=(u=Object.keys(t)).length;c<d;c++)h=u[c],p=JSON.stringify(h)+": ",void 0!==(E=e(t[h],f,p.length+(c===d-1?0:1)))&&l.push(p+E);if(l.length>0)return[v,n+l.join(",\n"+f),s].join("\n"+i)}return m}(e,"",0)},_=M;function M(e){var t=this;if(t instanceof M||(t=new M),t.tail=null,t.head=null,t.length=0,e&&"function"==typeof e.forEach)e.forEach((function(e){t.push(e)}));else if(arguments.length>0)for(var n=0,o=arguments.length;n<o;n++)t.push(arguments[n]);return t}function j(e,t,n){var o=t===e.head?new B(n,null,t,e):new B(n,t,t.next,e);return null===o.next&&(e.tail=o),null===o.prev&&(e.head=o),e.length++,o}function z(e,t){e.tail=new B(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function U(e,t){e.head=new B(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function B(e,t,n,o){if(!(this instanceof B))return new B(e,t,n,o);this.list=o,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,n?(n.prev=this,this.next=n):this.next=null}M.Node=B,M.create=M,M.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,n=e.prev;return t&&(t.prev=n),n&&(n.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=n),e.list.length--,e.next=null,e.prev=null,e.list=null,t},M.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},M.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},M.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)z(this,arguments[e]);return this.length},M.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)U(this,arguments[e]);return this.length},M.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},M.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},M.prototype.forEach=function(e,t){t=t||this;for(var n=this.head,o=0;null!==n;o++)e.call(t,n.value,o,this),n=n.next},M.prototype.forEachReverse=function(e,t){t=t||this;for(var n=this.tail,o=this.length-1;null!==n;o--)e.call(t,n.value,o,this),n=n.prev},M.prototype.get=function(e){for(var t=0,n=this.head;null!==n&&t<e;t++)n=n.next;if(t===e&&null!==n)return n.value},M.prototype.getReverse=function(e){for(var t=0,n=this.tail;null!==n&&t<e;t++)n=n.prev;if(t===e&&null!==n)return n.value},M.prototype.map=function(e,t){t=t||this;for(var n=new M,o=this.head;null!==o;)n.push(e.call(t,o.value,this)),o=o.next;return n},M.prototype.mapReverse=function(e,t){t=t||this;for(var n=new M,o=this.tail;null!==o;)n.push(e.call(t,o.value,this)),o=o.prev;return n},M.prototype.reduce=function(e,t){var n,o=this.head;if(arguments.length>1)n=t;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");o=this.head.next,n=this.head.value}for(var r=0;null!==o;r++)n=e(n,o.value,r),o=o.next;return n},M.prototype.reduceReverse=function(e,t){var n,o=this.tail;if(arguments.length>1)n=t;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");o=this.tail.prev,n=this.tail.value}for(var r=this.length-1;null!==o;r--)n=e(n,o.value,r),o=o.prev;return n},M.prototype.toArray=function(){for(var e=new Array(this.length),t=0,n=this.head;null!==n;t++)e[t]=n.value,n=n.next;return e},M.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,n=this.tail;null!==n;t++)e[t]=n.value,n=n.prev;return e},M.prototype.slice=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var n=new M;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var o=0,r=this.head;null!==r&&o<e;o++)r=r.next;for(;null!==r&&o<t;o++,r=r.next)n.push(r.value);return n},M.prototype.sliceReverse=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var n=new M;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var o=this.length,r=this.tail;null!==r&&o>t;o--)r=r.prev;for(;null!==r&&o>e;o--,r=r.prev)n.push(r.value);return n},M.prototype.splice=function(e,t){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var n=0,o=this.head;null!==o&&n<e;n++)o=o.next;var r=[];for(n=0;o&&n<t;n++)r.push(o.value),o=this.removeNode(o);null===o&&(o=this.tail),o!==this.head&&o!==this.tail&&(o=o.prev);for(n=0;n<(arguments.length<=2?0:arguments.length-2);n++)o=j(this,o,n+2<2||arguments.length<=n+2?void 0:arguments[n+2]);return r},M.prototype.reverse=function(){for(var e=this.head,t=this.tail,n=e;null!==n;n=n.prev){var o=n.prev;n.prev=n.next,n.next=o}return this.head=t,this.tail=e,this};try{require("./iterator.js")(M)}catch(e){}const G=_,X=Symbol("max"),V=Symbol("length"),W=Symbol("lengthCalculator"),H=Symbol("allowStale"),$=Symbol("maxAge"),q=Symbol("dispose"),Y=Symbol("noDisposeOnSet"),J=Symbol("lruList"),Q=Symbol("cache"),Z=Symbol("updateAgeOnGet"),K=()=>1;const ee=(e,t,n)=>{const o=e[Q].get(t);if(o){const t=o.value;if(te(e,t)){if(oe(e,o),!e[H])return}else n&&(e[Z]&&(o.value.now=Date.now()),e[J].unshiftNode(o));return t.value}},te=(e,t)=>{if(!t||!t.maxAge&&!e[$])return!1;const n=Date.now()-t.now;return t.maxAge?n>t.maxAge:e[$]&&n>e[$]},ne=e=>{if(e[V]>e[X])for(let t=e[J].tail;e[V]>e[X]&&null!==t;){const n=t.prev;oe(e,t),t=n}},oe=(e,t)=>{if(t){const n=t.value;e[q]&&e[q](n.key,n.value),e[V]-=n.length,e[Q].delete(n.key),e[J].removeNode(t)}};class re{constructor(e,t,n,o,r){this.key=e,this.value=t,this.length=n,this.now=o,this.maxAge=r||0}}const ie=(e,t,n,o)=>{let r=n.value;te(e,r)&&(oe(e,n),e[H]||(r=void 0)),r&&t.call(o,r.value,r.key,e)};var ae=class{constructor(e){if("number"==typeof e&&(e={max:e}),e||(e={}),e.max&&("number"!=typeof e.max||e.max<0))throw new TypeError("max must be a non-negative number");this[X]=e.max||1/0;const t=e.length||K;if(this[W]="function"!=typeof t?K:t,this[H]=e.stale||!1,e.maxAge&&"number"!=typeof e.maxAge)throw new TypeError("maxAge must be a number");this[$]=e.maxAge||0,this[q]=e.dispose,this[Y]=e.noDisposeOnSet||!1,this[Z]=e.updateAgeOnGet||!1,this.reset()}set max(e){if("number"!=typeof e||e<0)throw new TypeError("max must be a non-negative number");this[X]=e||1/0,ne(this)}get max(){return this[X]}set allowStale(e){this[H]=!!e}get allowStale(){return this[H]}set maxAge(e){if("number"!=typeof e)throw new TypeError("maxAge must be a non-negative number");this[$]=e,ne(this)}get maxAge(){return this[$]}set lengthCalculator(e){"function"!=typeof e&&(e=K),e!==this[W]&&(this[W]=e,this[V]=0,this[J].forEach((e=>{e.length=this[W](e.value,e.key),this[V]+=e.length}))),ne(this)}get lengthCalculator(){return this[W]}get length(){return this[V]}get itemCount(){return this[J].length}rforEach(e,t){t=t||this;for(let n=this[J].tail;null!==n;){const o=n.prev;ie(this,e,n,t),n=o}}forEach(e,t){t=t||this;for(let n=this[J].head;null!==n;){const o=n.next;ie(this,e,n,t),n=o}}keys(){return this[J].toArray().map((e=>e.key))}values(){return this[J].toArray().map((e=>e.value))}reset(){this[q]&&this[J]&&this[J].length&&this[J].forEach((e=>this[q](e.key,e.value))),this[Q]=new Map,this[J]=new G,this[V]=0}dump(){return this[J].map((e=>!te(this,e)&&{k:e.key,v:e.value,e:e.now+(e.maxAge||0)})).toArray().filter((e=>e))}dumpLru(){return this[J]}set(e,t,n){if((n=n||this[$])&&"number"!=typeof n)throw new TypeError("maxAge must be a number");const o=n?Date.now():0,r=this[W](t,e);if(this[Q].has(e)){if(r>this[X])return oe(this,this[Q].get(e)),!1;const i=this[Q].get(e).value;return this[q]&&(this[Y]||this[q](e,i.value)),i.now=o,i.maxAge=n,i.value=t,this[V]+=r-i.length,i.length=r,this.get(e),ne(this),!0}const i=new re(e,t,r,o,n);return i.length>this[X]?(this[q]&&this[q](e,t),!1):(this[V]+=i.length,this[J].unshift(i),this[Q].set(e,this[J].head),ne(this),!0)}has(e){if(!this[Q].has(e))return!1;const t=this[Q].get(e).value;return!te(this,t)}get(e){return ee(this,e,!0)}peek(e){return ee(this,e,!1)}pop(){const e=this[J].tail;return e?(oe(this,e),e.value):null}del(e){oe(this,this[Q].get(e))}load(e){this.reset();const t=Date.now();for(let n=e.length-1;n>=0;n--){const o=e[n],r=o.e||0;if(0===r)this.set(o.k,o.v);else{const e=r-t;e>0&&this.set(o.k,o.v,e)}}}prune(){this[Q].forEach(((e,t)=>ee(this,t,!1)))}};const se=["includePrerelease","loose","rtl"];var ce=e=>e?"object"!=typeof e?{loose:!0}:se.filter((t=>e[t])).reduce(((e,t)=>(e[t]=!0,e)),{}):{},le={exports:{}};var he={SEMVER_SPEC_VERSION:"2.0.0",MAX_LENGTH:256,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991,MAX_SAFE_COMPONENT_LENGTH:16};const pe="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return console.error("SEMVER",...t)}:()=>{};var ue=pe;!function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:n}=he,o=ue,r=(t=e.exports={}).re=[],i=t.src=[],a=t.t={};let s=0;const c=(e,t,n)=>{const c=s++;o(c,t),a[e]=c,i[c]=t,r[c]=new RegExp(t,n?"g":void 0)};c("NUMERICIDENTIFIER","0|[1-9]\\d*"),c("NUMERICIDENTIFIERLOOSE","[0-9]+"),c("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),c("MAINVERSION","(".concat(i[a.NUMERICIDENTIFIER],")\\.")+"(".concat(i[a.NUMERICIDENTIFIER],")\\.")+"(".concat(i[a.NUMERICIDENTIFIER],")")),c("MAINVERSIONLOOSE","(".concat(i[a.NUMERICIDENTIFIERLOOSE],")\\.")+"(".concat(i[a.NUMERICIDENTIFIERLOOSE],")\\.")+"(".concat(i[a.NUMERICIDENTIFIERLOOSE],")")),c("PRERELEASEIDENTIFIER","(?:".concat(i[a.NUMERICIDENTIFIER],"|").concat(i[a.NONNUMERICIDENTIFIER],")")),c("PRERELEASEIDENTIFIERLOOSE","(?:".concat(i[a.NUMERICIDENTIFIERLOOSE],"|").concat(i[a.NONNUMERICIDENTIFIER],")")),c("PRERELEASE","(?:-(".concat(i[a.PRERELEASEIDENTIFIER],"(?:\\.").concat(i[a.PRERELEASEIDENTIFIER],")*))")),c("PRERELEASELOOSE","(?:-?(".concat(i[a.PRERELEASEIDENTIFIERLOOSE],"(?:\\.").concat(i[a.PRERELEASEIDENTIFIERLOOSE],")*))")),c("BUILDIDENTIFIER","[0-9A-Za-z-]+"),c("BUILD","(?:\\+(".concat(i[a.BUILDIDENTIFIER],"(?:\\.").concat(i[a.BUILDIDENTIFIER],")*))")),c("FULLPLAIN","v?".concat(i[a.MAINVERSION]).concat(i[a.PRERELEASE],"?").concat(i[a.BUILD],"?")),c("FULL","^".concat(i[a.FULLPLAIN],"$")),c("LOOSEPLAIN","[v=\\s]*".concat(i[a.MAINVERSIONLOOSE]).concat(i[a.PRERELEASELOOSE],"?").concat(i[a.BUILD],"?")),c("LOOSE","^".concat(i[a.LOOSEPLAIN],"$")),c("GTLT","((?:<|>)?=?)"),c("XRANGEIDENTIFIERLOOSE","".concat(i[a.NUMERICIDENTIFIERLOOSE],"|x|X|\\*")),c("XRANGEIDENTIFIER","".concat(i[a.NUMERICIDENTIFIER],"|x|X|\\*")),c("XRANGEPLAIN","[v=\\s]*(".concat(i[a.XRANGEIDENTIFIER],")")+"(?:\\.(".concat(i[a.XRANGEIDENTIFIER],")")+"(?:\\.(".concat(i[a.XRANGEIDENTIFIER],")")+"(?:".concat(i[a.PRERELEASE],")?").concat(i[a.BUILD],"?")+")?)?"),c("XRANGEPLAINLOOSE","[v=\\s]*(".concat(i[a.XRANGEIDENTIFIERLOOSE],")")+"(?:\\.(".concat(i[a.XRANGEIDENTIFIERLOOSE],")")+"(?:\\.(".concat(i[a.XRANGEIDENTIFIERLOOSE],")")+"(?:".concat(i[a.PRERELEASELOOSE],")?").concat(i[a.BUILD],"?")+")?)?"),c("XRANGE","^".concat(i[a.GTLT],"\\s*").concat(i[a.XRANGEPLAIN],"$")),c("XRANGELOOSE","^".concat(i[a.GTLT],"\\s*").concat(i[a.XRANGEPLAINLOOSE],"$")),c("COERCE","".concat("(^|[^\\d])(\\d{1,").concat(n,"})")+"(?:\\.(\\d{1,".concat(n,"}))?")+"(?:\\.(\\d{1,".concat(n,"}))?")+"(?:$|[^\\d])"),c("COERCERTL",i[a.COERCE],!0),c("LONETILDE","(?:~>?)"),c("TILDETRIM","(\\s*)".concat(i[a.LONETILDE],"\\s+"),!0),t.tildeTrimReplace="$1~",c("TILDE","^".concat(i[a.LONETILDE]).concat(i[a.XRANGEPLAIN],"$")),c("TILDELOOSE","^".concat(i[a.LONETILDE]).concat(i[a.XRANGEPLAINLOOSE],"$")),c("LONECARET","(?:\\^)"),c("CARETTRIM","(\\s*)".concat(i[a.LONECARET],"\\s+"),!0),t.caretTrimReplace="$1^",c("CARET","^".concat(i[a.LONECARET]).concat(i[a.XRANGEPLAIN],"$")),c("CARETLOOSE","^".concat(i[a.LONECARET]).concat(i[a.XRANGEPLAINLOOSE],"$")),c("COMPARATORLOOSE","^".concat(i[a.GTLT],"\\s*(").concat(i[a.LOOSEPLAIN],")$|^$")),c("COMPARATOR","^".concat(i[a.GTLT],"\\s*(").concat(i[a.FULLPLAIN],")$|^$")),c("COMPARATORTRIM","(\\s*)".concat(i[a.GTLT],"\\s*(").concat(i[a.LOOSEPLAIN],"|").concat(i[a.XRANGEPLAIN],")"),!0),t.comparatorTrimReplace="$1$2$3",c("HYPHENRANGE","^\\s*(".concat(i[a.XRANGEPLAIN],")")+"\\s+-\\s+"+"(".concat(i[a.XRANGEPLAIN],")")+"\\s*$"),c("HYPHENRANGELOOSE","^\\s*(".concat(i[a.XRANGEPLAINLOOSE],")")+"\\s+-\\s+"+"(".concat(i[a.XRANGEPLAINLOOSE],")")+"\\s*$"),c("STAR","(<|>)?=?\\s*\\*"),c("GTE0","^\\s*>=\\s*0.0.0\\s*$"),c("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")}(le,le.exports);const de=/^[0-9]+$/,fe=(e,t)=>{const n=de.test(e),o=de.test(t);return n&&o&&(e=+e,t=+t),e===t?0:n&&!o?-1:o&&!n?1:e<t?-1:1};var ge={compareIdentifiers:fe,rcompareIdentifiers:(e,t)=>fe(t,e)};const ve=ue,{MAX_LENGTH:me,MAX_SAFE_INTEGER:Ee}=he,{re:be,t:ye}=le.exports,we=ce,{compareIdentifiers:Oe}=ge;class Ae{constructor(e,t){if(t=we(t),e instanceof Ae){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError("Invalid Version: ".concat(e));if(e.length>me)throw new TypeError("version is longer than ".concat(me," characters"));ve("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const n=e.trim().match(t.loose?be[ye.LOOSE]:be[ye.FULL]);if(!n)throw new TypeError("Invalid Version: ".concat(e));if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>Ee||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Ee||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Ee||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<Ee)return t}return e})):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version="".concat(this.major,".").concat(this.minor,".").concat(this.patch),this.prerelease.length&&(this.version+="-".concat(this.prerelease.join("."))),this.version}toString(){return this.version}compare(e){if(ve("SemVer.compare",this.version,this.options,e),!(e instanceof Ae)){if("string"==typeof e&&e===this.version)return 0;e=new Ae(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof Ae||(e=new Ae(e,this.options)),Oe(this.major,e.major)||Oe(this.minor,e.minor)||Oe(this.patch,e.patch)}comparePre(e){if(e instanceof Ae||(e=new Ae(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const n=this.prerelease[t],o=e.prerelease[t];if(ve("prerelease compare",t,n,o),void 0===n&&void 0===o)return 0;if(void 0===o)return 1;if(void 0===n)return-1;if(n!==o)return Oe(n,o)}while(++t)}compareBuild(e){e instanceof Ae||(e=new Ae(e,this.options));let t=0;do{const n=this.build[t],o=e.build[t];if(ve("prerelease compare",t,n,o),void 0===n&&void 0===o)return 0;if(void 0===o)return 1;if(void 0===n)return-1;if(n!==o)return Oe(n,o)}while(++t)}inc(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{let e=this.prerelease.length;for(;--e>=0;)"number"==typeof this.prerelease[e]&&(this.prerelease[e]++,e=-2);-1===e&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error("invalid increment argument: ".concat(e))}return this.format(),this.raw=this.version,this}}var xe=Ae;const Ie=xe;var Ne=(e,t,n)=>new Ie(e,n).compare(new Ie(t,n));const Re=Ne;const Te=Ne;const Le=Ne;const Se=Ne;const De=Ne;const Ce=Ne;const Fe=(e,t,n)=>0===Re(e,t,n),ke=(e,t,n)=>0!==Te(e,t,n),Pe=(e,t,n)=>Le(e,t,n)>0,_e=(e,t,n)=>Se(e,t,n)>=0,Me=(e,t,n)=>De(e,t,n)<0,je=(e,t,n)=>Ce(e,t,n)<=0;var ze=(e,t,n,o)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e===n;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e!==n;case"":case"=":case"==":return Fe(e,n,o);case"!=":return ke(e,n,o);case">":return Pe(e,n,o);case">=":return _e(e,n,o);case"<":return Me(e,n,o);case"<=":return je(e,n,o);default:throw new TypeError("Invalid operator: ".concat(t))}};const Ue=Symbol("SemVer ANY");class Be{static get ANY(){return Ue}constructor(e,t){if(t=Xe(t),e instanceof Be){if(e.loose===!!t.loose)return e;e=e.value}$e("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===Ue?this.value="":this.value=this.operator+this.semver.version,$e("comp",this)}parse(e){const t=this.options.loose?Ve[We.COMPARATORLOOSE]:Ve[We.COMPARATOR],n=e.match(t);if(!n)throw new TypeError("Invalid comparator: ".concat(e));this.operator=void 0!==n[1]?n[1]:"","="===this.operator&&(this.operator=""),n[2]?this.semver=new qe(n[2],this.options.loose):this.semver=Ue}toString(){return this.value}test(e){if($e("Comparator.test",e,this.options.loose),this.semver===Ue||e===Ue)return!0;if("string"==typeof e)try{e=new qe(e,this.options)}catch(e){return!1}return He(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof Be))throw new TypeError("a Comparator is required");if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),""===this.operator)return""===this.value||new Ye(e.value,t).test(this.value);if(""===e.operator)return""===e.value||new Ye(this.value,t).test(e.semver);const n=!(">="!==this.operator&&">"!==this.operator||">="!==e.operator&&">"!==e.operator),o=!("<="!==this.operator&&"<"!==this.operator||"<="!==e.operator&&"<"!==e.operator),r=this.semver.version===e.semver.version,i=!(">="!==this.operator&&"<="!==this.operator||">="!==e.operator&&"<="!==e.operator),a=He(this.semver,"<",e.semver,t)&&(">="===this.operator||">"===this.operator)&&("<="===e.operator||"<"===e.operator),s=He(this.semver,">",e.semver,t)&&("<="===this.operator||"<"===this.operator)&&(">="===e.operator||">"===e.operator);return n||o||r&&i||a||s}}var Ge=Be;const Xe=ce,{re:Ve,t:We}=le.exports,He=ze,$e=ue,qe=xe,Ye=Qe;class Je{constructor(e,t){if(t=Ke(t),e instanceof Je)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new Je(e.raw,t);if(e instanceof et)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map((e=>this.parseRange(e.trim()))).filter((e=>e.length)),!this.set.length)throw new TypeError("Invalid SemVer Range: ".concat(e));if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter((e=>!ct(e[0]))),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&lt(e[0])){this.set=[e];break}}this.format()}format(){return this.range=this.set.map((e=>e.join(" ").trim())).join("||").trim(),this.range}toString(){return this.range}parseRange(e){e=e.trim();const t=Object.keys(this.options).join(","),n="parseRange:".concat(t,":").concat(e),o=Ze.get(n);if(o)return o;const r=this.options.loose,i=r?ot[rt.HYPHENRANGELOOSE]:ot[rt.HYPHENRANGE];e=e.replace(i,wt(this.options.includePrerelease)),tt("hyphen replace",e),e=e.replace(ot[rt.COMPARATORTRIM],it),tt("comparator trim",e,ot[rt.COMPARATORTRIM]),e=(e=(e=e.replace(ot[rt.TILDETRIM],at)).replace(ot[rt.CARETTRIM],st)).split(/\s+/).join(" ");const a=r?ot[rt.COMPARATORLOOSE]:ot[rt.COMPARATOR],s=e.split(" ").map((e=>pt(e,this.options))).join(" ").split(/\s+/).map((e=>yt(e,this.options))).filter(this.options.loose?e=>!!e.match(a):()=>!0).map((e=>new et(e,this.options)));s.length;const c=new Map;for(const e of s){if(ct(e))return[e];c.set(e.value,e)}c.size>1&&c.has("")&&c.delete("");const l=[...c.values()];return Ze.set(n,l),l}intersects(e,t){if(!(e instanceof Je))throw new TypeError("a Range is required");return this.set.some((n=>ht(n,t)&&e.set.some((e=>ht(e,t)&&n.every((n=>e.every((e=>n.intersects(e,t)))))))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new nt(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(Ot(this.set[t],e,this.options))return!0;return!1}}var Qe=Je;const Ze=new ae({max:1e3}),Ke=ce,et=Ge,tt=ue,nt=xe,{re:ot,t:rt,comparatorTrimReplace:it,tildeTrimReplace:at,caretTrimReplace:st}=le.exports,ct=e=>"<0.0.0-0"===e.value,lt=e=>""===e.value,ht=(e,t)=>{let n=!0;const o=e.slice();let r=o.pop();for(;n&&o.length;)n=o.every((e=>r.intersects(e,t))),r=o.pop();return n},pt=(e,t)=>(tt("comp",e,t),e=gt(e,t),tt("caret",e),e=dt(e,t),tt("tildes",e),e=mt(e,t),tt("xrange",e),e=bt(e,t),tt("stars",e),e),ut=e=>!e||"x"===e.toLowerCase()||"*"===e,dt=(e,t)=>e.trim().split(/\s+/).map((e=>ft(e,t))).join(" "),ft=(e,t)=>{const n=t.loose?ot[rt.TILDELOOSE]:ot[rt.TILDE];return e.replace(n,((t,n,o,r,i)=>{let a;return tt("tilde",e,t,n,o,r,i),ut(n)?a="":ut(o)?a=">=".concat(n,".0.0 <").concat(+n+1,".0.0-0"):ut(r)?a=">=".concat(n,".").concat(o,".0 <").concat(n,".").concat(+o+1,".0-0"):i?(tt("replaceTilde pr",i),a=">=".concat(n,".").concat(o,".").concat(r,"-").concat(i," <").concat(n,".").concat(+o+1,".0-0")):a=">=".concat(n,".").concat(o,".").concat(r," <").concat(n,".").concat(+o+1,".0-0"),tt("tilde return",a),a}))},gt=(e,t)=>e.trim().split(/\s+/).map((e=>vt(e,t))).join(" "),vt=(e,t)=>{tt("caret",e,t);const n=t.loose?ot[rt.CARETLOOSE]:ot[rt.CARET],o=t.includePrerelease?"-0":"";return e.replace(n,((t,n,r,i,a)=>{let s;return tt("caret",e,t,n,r,i,a),ut(n)?s="":ut(r)?s=">=".concat(n,".0.0").concat(o," <").concat(+n+1,".0.0-0"):ut(i)?s="0"===n?">=".concat(n,".").concat(r,".0").concat(o," <").concat(n,".").concat(+r+1,".0-0"):">=".concat(n,".").concat(r,".0").concat(o," <").concat(+n+1,".0.0-0"):a?(tt("replaceCaret pr",a),s="0"===n?"0"===r?">=".concat(n,".").concat(r,".").concat(i,"-").concat(a," <").concat(n,".").concat(r,".").concat(+i+1,"-0"):">=".concat(n,".").concat(r,".").concat(i,"-").concat(a," <").concat(n,".").concat(+r+1,".0-0"):">=".concat(n,".").concat(r,".").concat(i,"-").concat(a," <").concat(+n+1,".0.0-0")):(tt("no pr"),s="0"===n?"0"===r?">=".concat(n,".").concat(r,".").concat(i).concat(o," <").concat(n,".").concat(r,".").concat(+i+1,"-0"):">=".concat(n,".").concat(r,".").concat(i).concat(o," <").concat(n,".").concat(+r+1,".0-0"):">=".concat(n,".").concat(r,".").concat(i," <").concat(+n+1,".0.0-0")),tt("caret return",s),s}))},mt=(e,t)=>(tt("replaceXRanges",e,t),e.split(/\s+/).map((e=>Et(e,t))).join(" ")),Et=(e,t)=>{e=e.trim();const n=t.loose?ot[rt.XRANGELOOSE]:ot[rt.XRANGE];return e.replace(n,((n,o,r,i,a,s)=>{tt("xRange",e,n,o,r,i,a,s);const c=ut(r),l=c||ut(i),h=l||ut(a),p=h;return"="===o&&p&&(o=""),s=t.includePrerelease?"-0":"",c?n=">"===o||"<"===o?"<0.0.0-0":"*":o&&p?(l&&(i=0),a=0,">"===o?(o=">=",l?(r=+r+1,i=0,a=0):(i=+i+1,a=0)):"<="===o&&(o="<",l?r=+r+1:i=+i+1),"<"===o&&(s="-0"),n="".concat(o+r,".").concat(i,".").concat(a).concat(s)):l?n=">=".concat(r,".0.0").concat(s," <").concat(+r+1,".0.0-0"):h&&(n=">=".concat(r,".").concat(i,".0").concat(s," <").concat(r,".").concat(+i+1,".0-0")),tt("xRange return",n),n}))},bt=(e,t)=>(tt("replaceStars",e,t),e.trim().replace(ot[rt.STAR],"")),yt=(e,t)=>(tt("replaceGTE0",e,t),e.trim().replace(ot[t.includePrerelease?rt.GTE0PRE:rt.GTE0],"")),wt=e=>(t,n,o,r,i,a,s,c,l,h,p,u,d)=>(n=ut(o)?"":ut(r)?">=".concat(o,".0.0").concat(e?"-0":""):ut(i)?">=".concat(o,".").concat(r,".0").concat(e?"-0":""):a?">=".concat(n):">=".concat(n).concat(e?"-0":""),c=ut(l)?"":ut(h)?"<".concat(+l+1,".0.0-0"):ut(p)?"<".concat(l,".").concat(+h+1,".0-0"):u?"<=".concat(l,".").concat(h,".").concat(p,"-").concat(u):e?"<".concat(l,".").concat(h,".").concat(+p+1,"-0"):"<=".concat(c),"".concat(n," ").concat(c).trim()),Ot=(e,t,n)=>{for(let n=0;n<e.length;n++)if(!e[n].test(t))return!1;if(t.prerelease.length&&!n.includePrerelease){for(let n=0;n<e.length;n++)if(tt(e[n].semver),e[n].semver!==et.ANY&&e[n].semver.prerelease.length>0){const o=e[n].semver;if(o.major===t.major&&o.minor===t.minor&&o.patch===t.patch)return!0}return!1}return!0},At=Qe;var xt=(e,t,n)=>{try{t=new At(t,n)}catch(e){return!1}return t.test(e)};var It={NaN:NaN,E:Math.E,LN2:Math.LN2,LN10:Math.LN10,LOG2E:Math.LOG2E,LOG10E:Math.LOG10E,PI:Math.PI,SQRT1_2:Math.SQRT1_2,SQRT2:Math.SQRT2,MIN_VALUE:Number.MIN_VALUE,MAX_VALUE:Number.MAX_VALUE},Nt={"*":(e,t)=>e*t,"+":(e,t)=>e+t,"-":(e,t)=>e-t,"/":(e,t)=>e/t,"%":(e,t)=>e%t,">":(e,t)=>e>t,"<":(e,t)=>e<t,"<=":(e,t)=>e<=t,">=":(e,t)=>e>=t,"==":(e,t)=>e==t,"!=":(e,t)=>e!=t,"===":(e,t)=>e===t,"!==":(e,t)=>e!==t,"&":(e,t)=>e&t,"|":(e,t)=>e|t,"^":(e,t)=>e^t,"<<":(e,t)=>e<<t,">>":(e,t)=>e>>t,">>>":(e,t)=>e>>>t},Rt={"+":e=>+e,"-":e=>-e,"~":e=>~e,"!":e=>!e};const Tt=Array.prototype.slice,Lt=(e,t,n)=>{const o=n?n(t[0]):t[0];return o[e].apply(o,Tt.call(t,1))};var St={isNaN:Number.isNaN,isFinite:Number.isFinite,abs:Math.abs,acos:Math.acos,asin:Math.asin,atan:Math.atan,atan2:Math.atan2,ceil:Math.ceil,cos:Math.cos,exp:Math.exp,floor:Math.floor,log:Math.log,max:Math.max,min:Math.min,pow:Math.pow,random:Math.random,round:Math.round,sin:Math.sin,sqrt:Math.sqrt,tan:Math.tan,clamp:(e,t,n)=>Math.max(t,Math.min(n,e)),now:Date.now,utc:Date.UTC,datetime:(e,t,n,o,r,i,a)=>new Date(e,t||0,null!=n?n:1,o||0,r||0,i||0,a||0),date:e=>new Date(e).getDate(),day:e=>new Date(e).getDay(),year:e=>new Date(e).getFullYear(),month:e=>new Date(e).getMonth(),hours:e=>new Date(e).getHours(),minutes:e=>new Date(e).getMinutes(),seconds:e=>new Date(e).getSeconds(),milliseconds:e=>new Date(e).getMilliseconds(),time:e=>new Date(e).getTime(),timezoneoffset:e=>new Date(e).getTimezoneOffset(),utcdate:e=>new Date(e).getUTCDate(),utcday:e=>new Date(e).getUTCDay(),utcyear:e=>new Date(e).getUTCFullYear(),utcmonth:e=>new Date(e).getUTCMonth(),utchours:e=>new Date(e).getUTCHours(),utcminutes:e=>new Date(e).getUTCMinutes(),utcseconds:e=>new Date(e).getUTCSeconds(),utcmilliseconds:e=>new Date(e).getUTCMilliseconds(),length:e=>e.length,join:function(){return Lt("join",arguments)},indexof:function(){return Lt("indexOf",arguments)},lastindexof:function(){return Lt("lastIndexOf",arguments)},slice:function(){return Lt("slice",arguments)},reverse:e=>e.slice().reverse(),parseFloat:parseFloat,parseInt:parseInt,upper:e=>String(e).toUpperCase(),lower:e=>String(e).toLowerCase(),substring:function(){return Lt("substring",arguments,String)},split:function(){return Lt("split",arguments,String)},replace:function(){return Lt("replace",arguments,String)},trim:e=>String(e).trim(),regexp:RegExp,test:(e,t)=>RegExp(e).test(t)};const Dt=["view","item","group","xy","x","y"],Ct={Literal:(e,t)=>t.value,Identifier:(e,t)=>{const n=t.name;return e.memberDepth>0?n:"datum"===n?e.datum:"event"===n?e.event:"item"===n?e.item:It[n]||e.params["$"+n]},MemberExpression:(e,t)=>{const n=!t.computed,o=e(t.object);n&&(e.memberDepth+=1);const r=e(t.property);return n&&(e.memberDepth-=1),o[r]},CallExpression:(e,t)=>{const n=t.arguments;let o=t.callee.name;return o.startsWith("_")&&(o=o.slice(1)),"if"===o?e(n[0])?e(n[1]):e(n[2]):(e.fn[o]||St[o]).apply(e.fn,n.map(e))},ArrayExpression:(e,t)=>t.elements.map(e),BinaryExpression:(e,t)=>Nt[t.operator](e(t.left),e(t.right)),UnaryExpression:(e,t)=>Rt[t.operator](e(t.argument)),ConditionalExpression:(e,t)=>e(t.test)?e(t.consequent):e(t.alternate),LogicalExpression:(e,t)=>"&&"===t.operator?e(t.left)&&e(t.right):e(t.left)||e(t.right),ObjectExpression:(e,t)=>t.properties.reduce(((t,n)=>{e.memberDepth+=1;const o=e(n.key);return e.memberDepth-=1,t[o]=e(n.value),t}),{})};function Ft(e,t,n,o,r,i){const a=e=>Ct[e.type](a,e);return a.memberDepth=0,a.fn=Object.create(t),a.params=n,a.datum=o,a.event=r,a.item=i,Dt.forEach((e=>a.fn[e]=function(){return r.vega[e](...arguments)})),a(e)}var kt={operator(e,t){const n=t.ast,o=e.functions;return e=>Ft(n,o,e)},parameter(e,t){const n=t.ast,o=e.functions;return(e,t)=>Ft(n,o,t,e)},event(e,t){const n=t.ast,o=e.functions;return e=>Ft(n,o,void 0,void 0,e)},handler(e,t){const n=t.ast,o=e.functions;return(e,t)=>{const r=t.item&&t.item.datum;return Ft(n,o,e,r,t)}},encode(e,t){const{marktype:n,channels:o}=t,r=e.functions,i="group"===n||"image"===n||"rect"===n;return(e,t)=>{const a=e.datum;let s,c=0;for(const n in o)s=Ft(o[n].ast,r,t,a,void 0,e),e[n]!==s&&(e[n]=s,c=1);return"rule"!==n&&function(e,t,n){let o;t.x2&&(t.x?(n&&e.x>e.x2&&(o=e.x,e.x=e.x2,e.x2=o),e.width=e.x2-e.x):e.x=e.x2-(e.width||0)),t.xc&&(e.x=e.xc-(e.width||0)/2),t.y2&&(t.y?(n&&e.y>e.y2&&(o=e.y,e.y=e.y2,e.y2=o),e.height=e.y2-e.y):e.y=e.y2-(e.height||0)),t.yc&&(e.y=e.yc-(e.height||0)/2)}(e,o,i),c}}};function Pt(e){const[t,n]=/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(e).slice(1,3);return{library:t,version:n}}const _t="#fff",Mt={background:"#333",title:{color:_t,subtitleColor:_t},style:{"guide-label":{fill:_t},"guide-title":{fill:_t}},axis:{domainColor:_t,gridColor:"#888",tickColor:_t}},jt="#4572a7",zt={background:"#fff",arc:{fill:jt},area:{fill:jt},line:{stroke:jt,strokeWidth:2},path:{stroke:jt},rect:{fill:jt},shape:{stroke:jt},symbol:{fill:jt,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},Ut="#30a2da",Bt="#cbcbcb",Gt="#f0f0f0",Xt="#333",Vt={arc:{fill:Ut},area:{fill:Ut},axis:{domainColor:Bt,grid:!0,gridColor:Bt,gridWidth:1,labelColor:"#999",labelFontSize:10,titleColor:"#333",tickColor:Bt,tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:Gt,group:{fill:Gt},legend:{labelColor:Xt,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:Xt,titleFontSize:14,titlePadding:10},line:{stroke:Ut,strokeWidth:2},path:{stroke:Ut,strokeWidth:.5},rect:{fill:Ut},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:Ut},bar:{binSpacing:2,fill:Ut,stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},Wt="#000",Ht={group:{fill:"#e5e5e5"},arc:{fill:Wt},area:{fill:Wt},line:{stroke:Wt},path:{stroke:Wt},rect:{fill:Wt},shape:{stroke:Wt},symbol:{fill:Wt,size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},$t="Benton Gothic, sans-serif",qt="#82c6df",Yt="Benton Gothic Bold, sans-serif",Jt="normal",Qt={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},Zt={background:"#ffffff",title:{anchor:"start",color:"#000000",font:Yt,fontSize:22,fontWeight:"normal"},arc:{fill:qt},area:{fill:qt},line:{stroke:qt,strokeWidth:2},path:{stroke:qt},rect:{fill:qt},shape:{stroke:qt},symbol:{fill:qt,size:30},axis:{labelFont:$t,labelFontSize:11.5,labelFontWeight:"normal",titleFont:Yt,titleFontSize:13,titleFontWeight:Jt},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:$t,labelFontSize:11.5,symbolType:"square",titleFont:Yt,titleFontSize:13,titleFontWeight:Jt},range:{category:Qt["category-6"],diverging:Qt["fireandice-6"],heatmap:Qt["fire-7"],ordinal:Qt["fire-7"],ramp:Qt["fire-7"]}},Kt="#ab5787",en="#979797",tn={background:"#f9f9f9",arc:{fill:Kt},area:{fill:Kt},line:{stroke:Kt},path:{stroke:Kt},rect:{fill:Kt},shape:{stroke:Kt},symbol:{fill:Kt,size:30},axis:{domainColor:en,domainWidth:.5,gridWidth:.2,labelColor:en,tickColor:en,tickWidth:.2,titleColor:en},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},nn="#3e5c69",on={background:"#fff",arc:{fill:nn},area:{fill:nn},line:{stroke:nn},path:{stroke:nn},rect:{fill:nn},shape:{stroke:nn},symbol:{fill:nn},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},rn="#1696d2",an="#000000",sn="Lato",cn="Lato",ln={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},hn={background:"#FFFFFF",title:{anchor:"start",fontSize:18,font:sn},axisX:{domain:!0,domainColor:an,domainWidth:1,grid:!1,labelFontSize:12,labelFont:cn,labelAngle:0,tickColor:an,tickSize:5,titleFontSize:12,titlePadding:10,titleFont:sn},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:"#DEDDDD",gridWidth:1,labelFontSize:12,labelFont:cn,labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:sn,titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:cn,symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:sn,orient:"right",offset:10},view:{stroke:"transparent"},range:{category:ln["six-groups-cat-1"],diverging:ln["diverging-colors"],heatmap:ln["diverging-colors"],ordinal:ln["six-groups-seq"],ramp:ln["shades-blue"]},area:{fill:rn},rect:{fill:rn},line:{color:rn,stroke:rn,strokeWidth:5},trail:{color:rn,stroke:rn,strokeWidth:0,size:1},path:{stroke:rn,strokeWidth:.5},point:{filled:!0},text:{font:"Lato",color:rn,fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:rn,stroke:null}},arc:{fill:rn},shape:{stroke:rn},symbol:{fill:rn,size:30}},pn="#3366CC",un="#ccc",dn="Arial, sans-serif",fn={arc:{fill:pn},area:{fill:pn},path:{stroke:pn},rect:{fill:pn},shape:{stroke:pn},symbol:{stroke:pn},circle:{fill:pn},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:dn,fontSize:12},"guide-title":{font:dn,fontSize:12},"group-title":{font:dn,fontSize:12}},title:{font:dn,fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:un,tickColor:un,domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},gn="2.10.0";var vn=Object.freeze({__proto__:null,dark:Mt,excel:zt,fivethirtyeight:Vt,ggplot2:Ht,googlecharts:fn,latimes:Zt,quartz:tn,urbaninstitute:hn,version:gn,vox:on});function mn(e,t,n){return e.fields=t||[],e.fname=n,e}function En(e){return 1===e.length?bn(e[0]):yn(e)}const bn=e=>function(t){return t[e]},yn=e=>{const t=e.length;return function(n){for(let o=0;o<t;++o)n=n[e[o]];return n}};function wn(e){throw Error(e)}!function(e,t,n){const o=function(e){const t=[],n=e.length;let o,r,i,a=null,s=0,c="";function l(){t.push(c+e.substring(o,r)),c="",o=r+1}for(e+="",o=r=0;r<n;++r)if(i=e[r],"\\"===i)c+=e.substring(o,r),c+=e.substring(++r,++r),o=r;else if(i===a)l(),a=null,s=-1;else{if(a)continue;o===s&&'"'===i||o===s&&"'"===i?(o=r+1,a=i):"."!==i||s?"["===i?(r>o&&l(),s=o=r+1):"]"===i&&(s||wn("Access path missing open bracket: "+e),s>0&&l(),s=0,o=r+1):r>o?l():o=r+1}return s&&wn("Access path missing closing bracket: "+e),a&&wn("Access path missing closing quote: "+e),r>o&&(r++,l()),t}(e);e=1===o.length?o[0]:e,mn((n&&n.get||En)(o),[e],t||e)}("id"),mn((e=>e),[],"identity"),mn((()=>0),[],"zero"),mn((()=>1),[],"one"),mn((()=>!0),[],"true"),mn((()=>!1),[],"false");var On=Array.isArray;function An(e){return e===Object(e)}function xn(e,t){return JSON.stringify(e,function(e){const t=[];return function(n,o){if("object"!=typeof o||null===o)return o;const r=t.indexOf(this)+1;return t.length=r,t.length>e?"[Object]":t.indexOf(o)>=0?"[Circular]":(t.push(o),o)}}(t))}const In="vg-tooltip-element",Nn={offsetX:10,offsetY:10,id:In,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;")},maxDepth:2,formatTooltip:function(e,t,n){if(On(e))return"[".concat(e.map((e=>t("string"==typeof e?e:xn(e,n)))).join(", "),"]");if(An(e)){let o="";const r=e,{title:i,image:a}=r,s=
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]])}return n}(r,["title","image"]);i&&(o+="<h2>".concat(t(i),"</h2>")),a&&(o+='<img src="'.concat(t(a),'">'));const c=Object.keys(s);if(c.length>0){o+="<table>";for(const e of c){let r=s[e];void 0!==r&&(An(r)&&(r=xn(r,n)),o+='<tr><td class="key">'.concat(t(e),':</td><td class="value">').concat(t(r),"</td></tr>"))}o+="</table>"}return o||"{}"}return t(e)}};class Rn{constructor(e){this.options=Object.assign(Object.assign({},Nn),e);const t=this.options.id;if(this.el=null,this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const e=document.createElement("style");e.setAttribute("id",this.options.styleId),e.innerHTML=function(e){if(!/^[A-Za-z]+[-:.\w]*$/.test(e))throw new Error("Invalid HTML ID");return"#vg-tooltip-element {\n  visibility: hidden;\n  padding: 8px;\n  position: fixed;\n  z-index: 1000;\n  font-family: sans-serif;\n  font-size: 11px;\n  border-radius: 3px;\n  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);\n  /* The default theme is the light theme. */\n  background-color: rgba(255, 255, 255, 0.95);\n  border: 1px solid #d9d9d9;\n  color: black; }\n  #vg-tooltip-element.visible {\n    visibility: visible; }\n  #vg-tooltip-element h2 {\n    margin-top: 0;\n    margin-bottom: 10px;\n    font-size: 13px; }\n  #vg-tooltip-element img {\n    max-width: 200px;\n    max-height: 200px; }\n  #vg-tooltip-element table {\n    border-spacing: 0; }\n    #vg-tooltip-element table tr {\n      border: none; }\n      #vg-tooltip-element table tr td {\n        overflow: hidden;\n        text-overflow: ellipsis;\n        padding-top: 2px;\n        padding-bottom: 2px; }\n        #vg-tooltip-element table tr td.key {\n          color: #808080;\n          max-width: 150px;\n          text-align: right;\n          padding-right: 4px; }\n        #vg-tooltip-element table tr td.value {\n          display: block;\n          max-width: 300px;\n          max-height: 7em;\n          text-align: left; }\n  #vg-tooltip-element.dark-theme {\n    background-color: rgba(32, 32, 32, 0.9);\n    border: 1px solid #f5f5f5;\n    color: white; }\n    #vg-tooltip-element.dark-theme td.key {\n      color: #bfbfbf; }\n".toString().replace(In,e)}(t);const n=document.head;n.childNodes.length>0?n.insertBefore(e,n.childNodes[0]):n.appendChild(e)}}tooltipHandler(e,t,n,o){var r;this.el=document.getElementById(this.options.id),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",this.options.id),this.el.classList.add("vg-tooltip"),document.body.appendChild(this.el));if((null!==(r=document.fullscreenElement)&&void 0!==r?r:document.body).appendChild(this.el),null==o||""===o)return void this.el.classList.remove("visible","".concat(this.options.theme,"-theme"));this.el.innerHTML=this.options.formatTooltip(o,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible","".concat(this.options.theme,"-theme"));const{x:i,y:a}=function(e,t,n,o){let r=e.clientX+n;r+t.width>window.innerWidth&&(r=+e.clientX-n-t.width);let i=e.clientY+o;return i+t.height>window.innerHeight&&(i=+e.clientY-o-t.height),{x:r,y:i}}(t,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.setAttribute("style","top: ".concat(a,"px; left: ").concat(i,"px"))}}function Tn(e,t,n){const o=e.open(t),{origin:r}=new URL(t);let i=40;e.addEventListener("message",(function t(n){n.source===o&&(i=0,e.removeEventListener("message",t,!1))}),!1),setTimeout((function e(){i<=0||(o.postMessage(n,r),setTimeout(e,250),i-=1)}),250)}var Ln='.vega-embed {\n  position: relative;\n  display: inline-block;\n  box-sizing: border-box;\n}\n.vega-embed.has-actions {\n  padding-right: 38px;\n}\n.vega-embed details:not([open]) > :not(summary) {\n  display: none !important;\n}\n.vega-embed summary {\n  list-style: none;\n  position: absolute;\n  top: 0;\n  right: 0;\n  padding: 6px;\n  z-index: 1000;\n  background: white;\n  box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);\n  color: #1b1e23;\n  border: 1px solid #aaa;\n  border-radius: 999px;\n  opacity: 0.2;\n  transition: opacity 0.4s ease-in;\n  outline: none;\n  cursor: pointer;\n  line-height: 0px;\n}\n.vega-embed summary::-webkit-details-marker {\n  display: none;\n}\n.vega-embed summary:active {\n  box-shadow: #aaa 0px 0px 0px 1px inset;\n}\n.vega-embed summary svg {\n  width: 14px;\n  height: 14px;\n}\n.vega-embed details[open] summary {\n  opacity: 0.7;\n}\n.vega-embed:hover summary, .vega-embed:focus summary {\n  opacity: 1 !important;\n  transition: opacity 0.2s ease;\n}\n.vega-embed .vega-actions {\n  position: absolute;\n  z-index: 1001;\n  top: 35px;\n  right: -9px;\n  display: flex;\n  flex-direction: column;\n  padding-bottom: 8px;\n  padding-top: 8px;\n  border-radius: 4px;\n  box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);\n  border: 1px solid #d9d9d9;\n  background: white;\n  animation-duration: 0.15s;\n  animation-name: scale-in;\n  animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);\n  text-align: left;\n}\n.vega-embed .vega-actions a {\n  padding: 8px 16px;\n  font-family: sans-serif;\n  font-size: 14px;\n  font-weight: 600;\n  white-space: nowrap;\n  color: #434a56;\n  text-decoration: none;\n}\n.vega-embed .vega-actions a:hover {\n  background-color: #f7f7f9;\n  color: black;\n}\n.vega-embed .vega-actions::before, .vega-embed .vega-actions::after {\n  content: "";\n  display: inline-block;\n  position: absolute;\n}\n.vega-embed .vega-actions::before {\n  left: auto;\n  right: 14px;\n  top: -16px;\n  border: 8px solid #0000;\n  border-bottom-color: #d9d9d9;\n}\n.vega-embed .vega-actions::after {\n  left: auto;\n  right: 15px;\n  top: -14px;\n  border: 7px solid #0000;\n  border-bottom-color: #fff;\n}\n.vega-embed .chart-wrapper.fit-x {\n  width: 100%;\n}\n.vega-embed .chart-wrapper.fit-y {\n  height: 100%;\n}\n\n.vega-embed-wrapper {\n  max-width: 100%;\n  overflow: auto;\n  padding-right: 14px;\n}\n\n@keyframes scale-in {\n  from {\n    opacity: 0;\n    transform: scale(0.6);\n  }\n  to {\n    opacity: 1;\n    transform: scale(1);\n  }\n}\n';function Sn(e){return e.startsWith("http://")||e.startsWith("https://")||e.startsWith("//")}function Dn(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];for(const t of n)Cn(e,t);return e}function Cn(t,n){for(const o of Object.keys(n))e.writeConfig(t,o,n[o],!0)}String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e});var Fn;const kn="6.20.2",Pn=r;let _n=i;const Mn="undefined"!=typeof window?window:void 0;void 0===_n&&null!=Mn&&null!==(Fn=Mn.vl)&&void 0!==Fn&&Fn.compile&&(_n=Mn.vl);const jn={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},zn={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},Un={vega:"Vega","vega-lite":"Vega-Lite"},Bn={vega:Pn.version,"vega-lite":_n?_n.version:"not available"},Gn={vega:e=>e,"vega-lite":(e,t)=>_n.compile(e,{config:t}).spec},Xn='\n<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">\n  <circle r="2" cy="8" cx="2"></circle>\n  <circle r="2" cy="8" cx="8"></circle>\n  <circle r="2" cy="8" cx="14"></circle>\n</svg>',Vn="chart-wrapper";function Wn(e){return"function"==typeof e}function Hn(e,t,n,o){const r="<html><head>".concat(t,'</head><body><pre><code class="json">'),i="</code></pre>".concat(n,"</body></html>"),a=window.open("");a.document.write(r+e+i),a.document.title="".concat(Un[o]," JSON Source")}function $n(e,t){if(e.$schema){const o=Pt(e.$schema);var n;if(t&&t!==o.library)console.warn("The given visualization spec is written in ".concat(Un[o.library],", but mode argument sets ").concat(null!==(n=Un[t])&&void 0!==n?n:t,"."));const r=o.library;return xt(Bn[r],"^".concat(o.version.slice(1)))||console.warn("The input spec uses ".concat(Un[r]," ").concat(o.version,", but the current version of ").concat(Un[r]," is v").concat(Bn[r],".")),r}return"mark"in e||"encoding"in e||"layer"in e||"hconcat"in e||"vconcat"in e||"facet"in e||"repeat"in e?"vega-lite":"marks"in e||"signals"in e||"scales"in e||"axes"in e?"vega":null!=t?t:"vega"}function qn(e){return(t=e)&&"load"in t?e:Pn.loader(e);var t}function Yn(e){var t;return null!==(t=e.usermeta&&e.usermeta.embedOptions)&&void 0!==t?t:{}}async function Jn(t,n){var o,r;let i,a,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e.isString(n)?(a=qn(s.loader),i=JSON.parse(await a.load(n))):i=n;const c=Yn(i).loader;var l;a&&!c||(a=qn(null!==(l=s.loader)&&void 0!==l?l:c));const h=await Qn(Yn(i),a),p=await Qn(s,a),u={...Dn(p,h),config:e.mergeConfig(null!==(o=p.config)&&void 0!==o?o:{},null!==(r=h.config)&&void 0!==r?r:{})};return await Kn(t,i,u,a)}async function Qn(t,n){var o;const r=e.isString(t.config)?JSON.parse(await n.load(t.config)):null!==(o=t.config)&&void 0!==o?o:{},i=e.isString(t.patch)?JSON.parse(await n.load(t.patch)):t.patch;return{...t,...i?{patch:i}:{},...r?{config:r}:{}}}function Zn(e){var t;const n=e.getRootNode?e.getRootNode():document;return n instanceof ShadowRoot?{root:n,rootContainer:n}:{root:document,rootContainer:null!==(t=document.head)&&void 0!==t?t:document.body}}async function Kn(t,n){var o,r,i,a,s,c,l;let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},p=arguments.length>3?arguments[3]:void 0;const u=h.theme?e.mergeConfig(vn[h.theme],null!==(o=h.config)&&void 0!==o?o:{}):h.config,d=e.isBoolean(h.actions)?h.actions:Dn({},jn,null!==(r=h.actions)&&void 0!==r?r:{}),f={...zn,...h.i18n},g=null!==(i=h.renderer)&&void 0!==i?i:"canvas",v=null!==(a=h.logLevel)&&void 0!==a?a:Pn.Warn,m=null!==(s=h.downloadFileName)&&void 0!==s?s:"visualization",E="string"==typeof t?document.querySelector(t):t;if(!E)throw new Error("".concat(t," does not exist"));if(!1!==h.defaultStyle){const e="vega-embed-style",{root:t,rootContainer:n}=Zn(E);if(!t.getElementById(e)){const t=document.createElement("style");t.id=e,t.innerText=void 0===h.defaultStyle||!0===h.defaultStyle?Ln.toString():h.defaultStyle,n.appendChild(t)}}const b=$n(n,h.mode);let y=Gn[b](n,u);if("vega-lite"===b&&y.$schema){const e=Pt(y.$schema);xt(Bn.vega,"^".concat(e.version.slice(1)))||console.warn("The compiled spec uses Vega ".concat(e.version,", but current version is v").concat(Bn.vega,"."))}E.classList.add("vega-embed"),d&&E.classList.add("has-actions"),E.innerHTML="";let w=E;if(d){const e=document.createElement("div");e.classList.add(Vn),E.appendChild(e),w=e}const O=h.patch;O&&(y=O instanceof Function?O(y):A(y,O,!0,!1).newDocument),h.formatLocale&&Pn.formatLocale(h.formatLocale),h.timeFormatLocale&&Pn.timeFormatLocale(h.timeFormatLocale);const{ast:x}=h,I=Pn.parse(y,"vega-lite"===b?{}:u,{ast:x}),N=new(h.viewClass||Pn.View)(I,{loader:p,logLevel:v,renderer:g,...x?{expr:null!==(c=null!==(l=Pn.expressionInterpreter)&&void 0!==l?l:h.expr)&&void 0!==c?c:kt}:{}});if(N.addSignalListener("autosize",((e,t)=>{const{type:n}=t;"fit-x"==n?(w.classList.add("fit-x"),w.classList.remove("fit-y")):"fit-y"==n?(w.classList.remove("fit-x"),w.classList.add("fit-y")):"fit"==n?w.classList.add("fit-x","fit-y"):w.classList.remove("fit-x","fit-y")})),!1!==h.tooltip){const e=Wn(h.tooltip)?h.tooltip:new Rn(!0===h.tooltip?{}:h.tooltip).call;N.tooltip(e)}let R,{hover:T}=h;if(void 0===T&&(T="vega"===b),T){const{hoverSet:e,updateSet:t}="boolean"==typeof T?{}:T;N.hover(e,t)}if(h&&(null!=h.width&&N.width(h.width),null!=h.height&&N.height(h.height),null!=h.padding&&N.padding(h.padding)),await N.initialize(w,h.bind).runAsync(),!1!==d){let e=E;if(!1!==h.defaultStyle){const t=document.createElement("details");t.title=f.CLICK_TO_VIEW_ACTIONS,E.append(t),e=t;const n=document.createElement("summary");n.innerHTML=Xn,t.append(n),R=e=>{t.contains(e.target)||t.removeAttribute("open")},document.addEventListener("click",R)}const t=document.createElement("div");if(e.append(t),t.classList.add("vega-actions"),!0===d||!1!==d.export)for(const e of["svg","png"])if(!0===d||!0===d.export||d.export[e]){const n=f["".concat(e.toUpperCase(),"_ACTION")],o=document.createElement("a");o.text=n,o.href="#",o.target="_blank",o.download="".concat(m,".").concat(e),o.addEventListener("mousedown",(async function(t){t.preventDefault();const n=await N.toImageURL(e,h.scaleFactor);this.href=n})),t.append(o)}if(!0===d||!1!==d.source){const e=document.createElement("a");e.text=f.SOURCE_ACTION,e.href="#",e.addEventListener("click",(function(e){var t,o;Hn(P(n),null!==(t=h.sourceHeader)&&void 0!==t?t:"",null!==(o=h.sourceFooter)&&void 0!==o?o:"",b),e.preventDefault()})),t.append(e)}if("vega-lite"===b&&(!0===d||!1!==d.compiled)){const e=document.createElement("a");e.text=f.COMPILED_ACTION,e.href="#",e.addEventListener("click",(function(e){var t,n;Hn(P(y),null!==(t=h.sourceHeader)&&void 0!==t?t:"",null!==(n=h.sourceFooter)&&void 0!==n?n:"","vega"),e.preventDefault()})),t.append(e)}if(!0===d||!1!==d.editor){var L;const e=null!==(L=h.editorUrl)&&void 0!==L?L:"https://vega.github.io/editor/",o=document.createElement("a");o.text=f.EDITOR_ACTION,o.href="#",o.addEventListener("click",(function(t){Tn(window,e,{config:u,mode:b,renderer:g,spec:P(n)}),t.preventDefault()})),t.append(o)}}function S(){R&&document.removeEventListener("click",R),N.finalize()}return{view:N,spec:n,vgSpec:y,finalize:S}}async function eo(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=document.createElement("div");o.classList.add("vega-embed-wrapper");const r=document.createElement("div");o.appendChild(r);const i=!0===n.actions||!1===n.actions?n.actions:{export:!0,source:!1,compiled:!0,editor:!0,...null!==(t=n.actions)&&void 0!==t?t:{}},a=await Jn(r,e,{actions:i,...null!=n?n:{}});return o.value=a.view,o}function to(e){return e instanceof HTMLElement}const no=function(){return arguments.length>1&&(e.isString(arguments.length<=0?void 0:arguments[0])&&!Sn(arguments.length<=0?void 0:arguments[0])||to(arguments.length<=0?void 0:arguments[0])||3===arguments.length)?Jn(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2]):eo(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1])};return no.vegaLite=_n,no.vl=_n,no.container=eo,no.embed=Jn,no.vega=Pn,no.default=Jn,no.version=kn,no}));
//# sourceMappingURL=vega-embed.min.js.map
</script>
<script>(function (global, factory) {
	typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :
	typeof define === 'function' && define.amd ? define(['exports'], factory) :
	(global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global.splink_vis_utils = {}));
})(this, (function (exports) { 'use strict';

	var commonjsGlobal = typeof globalThis !== 'undefined' ? globalThis : typeof window !== 'undefined' ? window : typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : {};

	var lodash_clonedeep = {exports: {}};

	/**
	 * lodash (Custom Build) <https://lodash.com/>
	 * Build: `lodash modularize exports="npm" -o ./`
	 * Copyright jQuery Foundation and other contributors <https://jquery.org/>
	 * Released under MIT license <https://lodash.com/license>
	 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
	 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
	 */

	(function (module, exports) {
	/** Used as the size to enable large array optimizations. */
	var LARGE_ARRAY_SIZE = 200;

	/** Used to stand-in for `undefined` hash values. */
	var HASH_UNDEFINED = '__lodash_hash_undefined__';

	/** Used as references for various `Number` constants. */
	var MAX_SAFE_INTEGER = 9007199254740991;

	/** `Object#toString` result references. */
	var argsTag = '[object Arguments]',
	    arrayTag = '[object Array]',
	    boolTag = '[object Boolean]',
	    dateTag = '[object Date]',
	    errorTag = '[object Error]',
	    funcTag = '[object Function]',
	    genTag = '[object GeneratorFunction]',
	    mapTag = '[object Map]',
	    numberTag = '[object Number]',
	    objectTag = '[object Object]',
	    promiseTag = '[object Promise]',
	    regexpTag = '[object RegExp]',
	    setTag = '[object Set]',
	    stringTag = '[object String]',
	    symbolTag = '[object Symbol]',
	    weakMapTag = '[object WeakMap]';

	var arrayBufferTag = '[object ArrayBuffer]',
	    dataViewTag = '[object DataView]',
	    float32Tag = '[object Float32Array]',
	    float64Tag = '[object Float64Array]',
	    int8Tag = '[object Int8Array]',
	    int16Tag = '[object Int16Array]',
	    int32Tag = '[object Int32Array]',
	    uint8Tag = '[object Uint8Array]',
	    uint8ClampedTag = '[object Uint8ClampedArray]',
	    uint16Tag = '[object Uint16Array]',
	    uint32Tag = '[object Uint32Array]';

	/**
	 * Used to match `RegExp`
	 * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).
	 */
	var reRegExpChar = /[\\^$.*+?()[\]{}|]/g;

	/** Used to match `RegExp` flags from their coerced string values. */
	var reFlags = /\w*$/;

	/** Used to detect host constructors (Safari). */
	var reIsHostCtor = /^\[object .+?Constructor\]$/;

	/** Used to detect unsigned integer values. */
	var reIsUint = /^(?:0|[1-9]\d*)$/;

	/** Used to identify `toStringTag` values supported by `_.clone`. */
	var cloneableTags = {};
	cloneableTags[argsTag] = cloneableTags[arrayTag] =
	cloneableTags[arrayBufferTag] = cloneableTags[dataViewTag] =
	cloneableTags[boolTag] = cloneableTags[dateTag] =
	cloneableTags[float32Tag] = cloneableTags[float64Tag] =
	cloneableTags[int8Tag] = cloneableTags[int16Tag] =
	cloneableTags[int32Tag] = cloneableTags[mapTag] =
	cloneableTags[numberTag] = cloneableTags[objectTag] =
	cloneableTags[regexpTag] = cloneableTags[setTag] =
	cloneableTags[stringTag] = cloneableTags[symbolTag] =
	cloneableTags[uint8Tag] = cloneableTags[uint8ClampedTag] =
	cloneableTags[uint16Tag] = cloneableTags[uint32Tag] = true;
	cloneableTags[errorTag] = cloneableTags[funcTag] =
	cloneableTags[weakMapTag] = false;

	/** Detect free variable `global` from Node.js. */
	var freeGlobal = typeof commonjsGlobal == 'object' && commonjsGlobal && commonjsGlobal.Object === Object && commonjsGlobal;

	/** Detect free variable `self`. */
	var freeSelf = typeof self == 'object' && self && self.Object === Object && self;

	/** Used as a reference to the global object. */
	var root = freeGlobal || freeSelf || Function('return this')();

	/** Detect free variable `exports`. */
	var freeExports = exports && !exports.nodeType && exports;

	/** Detect free variable `module`. */
	var freeModule = freeExports && 'object' == 'object' && module && !module.nodeType && module;

	/** Detect the popular CommonJS extension `module.exports`. */
	var moduleExports = freeModule && freeModule.exports === freeExports;

	/**
	 * Adds the key-value `pair` to `map`.
	 *
	 * @private
	 * @param {Object} map The map to modify.
	 * @param {Array} pair The key-value pair to add.
	 * @returns {Object} Returns `map`.
	 */
	function addMapEntry(map, pair) {
	  // Don't return `map.set` because it's not chainable in IE 11.
	  map.set(pair[0], pair[1]);
	  return map;
	}

	/**
	 * Adds `value` to `set`.
	 *
	 * @private
	 * @param {Object} set The set to modify.
	 * @param {*} value The value to add.
	 * @returns {Object} Returns `set`.
	 */
	function addSetEntry(set, value) {
	  // Don't return `set.add` because it's not chainable in IE 11.
	  set.add(value);
	  return set;
	}

	/**
	 * A specialized version of `_.forEach` for arrays without support for
	 * iteratee shorthands.
	 *
	 * @private
	 * @param {Array} [array] The array to iterate over.
	 * @param {Function} iteratee The function invoked per iteration.
	 * @returns {Array} Returns `array`.
	 */
	function arrayEach(array, iteratee) {
	  var index = -1,
	      length = array ? array.length : 0;

	  while (++index < length) {
	    if (iteratee(array[index], index, array) === false) {
	      break;
	    }
	  }
	  return array;
	}

	/**
	 * Appends the elements of `values` to `array`.
	 *
	 * @private
	 * @param {Array} array The array to modify.
	 * @param {Array} values The values to append.
	 * @returns {Array} Returns `array`.
	 */
	function arrayPush(array, values) {
	  var index = -1,
	      length = values.length,
	      offset = array.length;

	  while (++index < length) {
	    array[offset + index] = values[index];
	  }
	  return array;
	}

	/**
	 * A specialized version of `_.reduce` for arrays without support for
	 * iteratee shorthands.
	 *
	 * @private
	 * @param {Array} [array] The array to iterate over.
	 * @param {Function} iteratee The function invoked per iteration.
	 * @param {*} [accumulator] The initial value.
	 * @param {boolean} [initAccum] Specify using the first element of `array` as
	 *  the initial value.
	 * @returns {*} Returns the accumulated value.
	 */
	function arrayReduce(array, iteratee, accumulator, initAccum) {
	  var index = -1,
	      length = array ? array.length : 0;

	  if (initAccum && length) {
	    accumulator = array[++index];
	  }
	  while (++index < length) {
	    accumulator = iteratee(accumulator, array[index], index, array);
	  }
	  return accumulator;
	}

	/**
	 * The base implementation of `_.times` without support for iteratee shorthands
	 * or max array length checks.
	 *
	 * @private
	 * @param {number} n The number of times to invoke `iteratee`.
	 * @param {Function} iteratee The function invoked per iteration.
	 * @returns {Array} Returns the array of results.
	 */
	function baseTimes(n, iteratee) {
	  var index = -1,
	      result = Array(n);

	  while (++index < n) {
	    result[index] = iteratee(index);
	  }
	  return result;
	}

	/**
	 * Gets the value at `key` of `object`.
	 *
	 * @private
	 * @param {Object} [object] The object to query.
	 * @param {string} key The key of the property to get.
	 * @returns {*} Returns the property value.
	 */
	function getValue(object, key) {
	  return object == null ? undefined : object[key];
	}

	/**
	 * Checks if `value` is a host object in IE < 9.
	 *
	 * @private
	 * @param {*} value The value to check.
	 * @returns {boolean} Returns `true` if `value` is a host object, else `false`.
	 */
	function isHostObject(value) {
	  // Many host objects are `Object` objects that can coerce to strings
	  // despite having improperly defined `toString` methods.
	  var result = false;
	  if (value != null && typeof value.toString != 'function') {
	    try {
	      result = !!(value + '');
	    } catch (e) {}
	  }
	  return result;
	}

	/**
	 * Converts `map` to its key-value pairs.
	 *
	 * @private
	 * @param {Object} map The map to convert.
	 * @returns {Array} Returns the key-value pairs.
	 */
	function mapToArray(map) {
	  var index = -1,
	      result = Array(map.size);

	  map.forEach(function(value, key) {
	    result[++index] = [key, value];
	  });
	  return result;
	}

	/**
	 * Creates a unary function that invokes `func` with its argument transformed.
	 *
	 * @private
	 * @param {Function} func The function to wrap.
	 * @param {Function} transform The argument transform.
	 * @returns {Function} Returns the new function.
	 */
	function overArg(func, transform) {
	  return function(arg) {
	    return func(transform(arg));
	  };
	}

	/**
	 * Converts `set` to an array of its values.
	 *
	 * @private
	 * @param {Object} set The set to convert.
	 * @returns {Array} Returns the values.
	 */
	function setToArray(set) {
	  var index = -1,
	      result = Array(set.size);

	  set.forEach(function(value) {
	    result[++index] = value;
	  });
	  return result;
	}

	/** Used for built-in method references. */
	var arrayProto = Array.prototype,
	    funcProto = Function.prototype,
	    objectProto = Object.prototype;

	/** Used to detect overreaching core-js shims. */
	var coreJsData = root['__core-js_shared__'];

	/** Used to detect methods masquerading as native. */
	var maskSrcKey = (function() {
	  var uid = /[^.]+$/.exec(coreJsData && coreJsData.keys && coreJsData.keys.IE_PROTO || '');
	  return uid ? ('Symbol(src)_1.' + uid) : '';
	}());

	/** Used to resolve the decompiled source of functions. */
	var funcToString = funcProto.toString;

	/** Used to check objects for own properties. */
	var hasOwnProperty = objectProto.hasOwnProperty;

	/**
	 * Used to resolve the
	 * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)
	 * of values.
	 */
	var objectToString = objectProto.toString;

	/** Used to detect if a method is native. */
	var reIsNative = RegExp('^' +
	  funcToString.call(hasOwnProperty).replace(reRegExpChar, '\\$&')
	  .replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g, '$1.*?') + '$'
	);

	/** Built-in value references. */
	var Buffer = moduleExports ? root.Buffer : undefined,
	    Symbol = root.Symbol,
	    Uint8Array = root.Uint8Array,
	    getPrototype = overArg(Object.getPrototypeOf, Object),
	    objectCreate = Object.create,
	    propertyIsEnumerable = objectProto.propertyIsEnumerable,
	    splice = arrayProto.splice;

	/* Built-in method references for those with the same name as other `lodash` methods. */
	var nativeGetSymbols = Object.getOwnPropertySymbols,
	    nativeIsBuffer = Buffer ? Buffer.isBuffer : undefined,
	    nativeKeys = overArg(Object.keys, Object);

	/* Built-in method references that are verified to be native. */
	var DataView = getNative(root, 'DataView'),
	    Map = getNative(root, 'Map'),
	    Promise = getNative(root, 'Promise'),
	    Set = getNative(root, 'Set'),
	    WeakMap = getNative(root, 'WeakMap'),
	    nativeCreate = getNative(Object, 'create');

	/** Used to detect maps, sets, and weakmaps. */
	var dataViewCtorString = toSource(DataView),
	    mapCtorString = toSource(Map),
	    promiseCtorString = toSource(Promise),
	    setCtorString = toSource(Set),
	    weakMapCtorString = toSource(WeakMap);

	/** Used to convert symbols to primitives and strings. */
	var symbolProto = Symbol ? Symbol.prototype : undefined,
	    symbolValueOf = symbolProto ? symbolProto.valueOf : undefined;

	/**
	 * Creates a hash object.
	 *
	 * @private
	 * @constructor
	 * @param {Array} [entries] The key-value pairs to cache.
	 */
	function Hash(entries) {
	  var index = -1,
	      length = entries ? entries.length : 0;

	  this.clear();
	  while (++index < length) {
	    var entry = entries[index];
	    this.set(entry[0], entry[1]);
	  }
	}

	/**
	 * Removes all key-value entries from the hash.
	 *
	 * @private
	 * @name clear
	 * @memberOf Hash
	 */
	function hashClear() {
	  this.__data__ = nativeCreate ? nativeCreate(null) : {};
	}

	/**
	 * Removes `key` and its value from the hash.
	 *
	 * @private
	 * @name delete
	 * @memberOf Hash
	 * @param {Object} hash The hash to modify.
	 * @param {string} key The key of the value to remove.
	 * @returns {boolean} Returns `true` if the entry was removed, else `false`.
	 */
	function hashDelete(key) {
	  return this.has(key) && delete this.__data__[key];
	}

	/**
	 * Gets the hash value for `key`.
	 *
	 * @private
	 * @name get
	 * @memberOf Hash
	 * @param {string} key The key of the value to get.
	 * @returns {*} Returns the entry value.
	 */
	function hashGet(key) {
	  var data = this.__data__;
	  if (nativeCreate) {
	    var result = data[key];
	    return result === HASH_UNDEFINED ? undefined : result;
	  }
	  return hasOwnProperty.call(data, key) ? data[key] : undefined;
	}

	/**
	 * Checks if a hash value for `key` exists.
	 *
	 * @private
	 * @name has
	 * @memberOf Hash
	 * @param {string} key The key of the entry to check.
	 * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
	 */
	function hashHas(key) {
	  var data = this.__data__;
	  return nativeCreate ? data[key] !== undefined : hasOwnProperty.call(data, key);
	}

	/**
	 * Sets the hash `key` to `value`.
	 *
	 * @private
	 * @name set
	 * @memberOf Hash
	 * @param {string} key The key of the value to set.
	 * @param {*} value The value to set.
	 * @returns {Object} Returns the hash instance.
	 */
	function hashSet(key, value) {
	  var data = this.__data__;
	  data[key] = (nativeCreate && value === undefined) ? HASH_UNDEFINED : value;
	  return this;
	}

	// Add methods to `Hash`.
	Hash.prototype.clear = hashClear;
	Hash.prototype['delete'] = hashDelete;
	Hash.prototype.get = hashGet;
	Hash.prototype.has = hashHas;
	Hash.prototype.set = hashSet;

	/**
	 * Creates an list cache object.
	 *
	 * @private
	 * @constructor
	 * @param {Array} [entries] The key-value pairs to cache.
	 */
	function ListCache(entries) {
	  var index = -1,
	      length = entries ? entries.length : 0;

	  this.clear();
	  while (++index < length) {
	    var entry = entries[index];
	    this.set(entry[0], entry[1]);
	  }
	}

	/**
	 * Removes all key-value entries from the list cache.
	 *
	 * @private
	 * @name clear
	 * @memberOf ListCache
	 */
	function listCacheClear() {
	  this.__data__ = [];
	}

	/**
	 * Removes `key` and its value from the list cache.
	 *
	 * @private
	 * @name delete
	 * @memberOf ListCache
	 * @param {string} key The key of the value to remove.
	 * @returns {boolean} Returns `true` if the entry was removed, else `false`.
	 */
	function listCacheDelete(key) {
	  var data = this.__data__,
	      index = assocIndexOf(data, key);

	  if (index < 0) {
	    return false;
	  }
	  var lastIndex = data.length - 1;
	  if (index == lastIndex) {
	    data.pop();
	  } else {
	    splice.call(data, index, 1);
	  }
	  return true;
	}

	/**
	 * Gets the list cache value for `key`.
	 *
	 * @private
	 * @name get
	 * @memberOf ListCache
	 * @param {string} key The key of the value to get.
	 * @returns {*} Returns the entry value.
	 */
	function listCacheGet(key) {
	  var data = this.__data__,
	      index = assocIndexOf(data, key);

	  return index < 0 ? undefined : data[index][1];
	}

	/**
	 * Checks if a list cache value for `key` exists.
	 *
	 * @private
	 * @name has
	 * @memberOf ListCache
	 * @param {string} key The key of the entry to check.
	 * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
	 */
	function listCacheHas(key) {
	  return assocIndexOf(this.__data__, key) > -1;
	}

	/**
	 * Sets the list cache `key` to `value`.
	 *
	 * @private
	 * @name set
	 * @memberOf ListCache
	 * @param {string} key The key of the value to set.
	 * @param {*} value The value to set.
	 * @returns {Object} Returns the list cache instance.
	 */
	function listCacheSet(key, value) {
	  var data = this.__data__,
	      index = assocIndexOf(data, key);

	  if (index < 0) {
	    data.push([key, value]);
	  } else {
	    data[index][1] = value;
	  }
	  return this;
	}

	// Add methods to `ListCache`.
	ListCache.prototype.clear = listCacheClear;
	ListCache.prototype['delete'] = listCacheDelete;
	ListCache.prototype.get = listCacheGet;
	ListCache.prototype.has = listCacheHas;
	ListCache.prototype.set = listCacheSet;

	/**
	 * Creates a map cache object to store key-value pairs.
	 *
	 * @private
	 * @constructor
	 * @param {Array} [entries] The key-value pairs to cache.
	 */
	function MapCache(entries) {
	  var index = -1,
	      length = entries ? entries.length : 0;

	  this.clear();
	  while (++index < length) {
	    var entry = entries[index];
	    this.set(entry[0], entry[1]);
	  }
	}

	/**
	 * Removes all key-value entries from the map.
	 *
	 * @private
	 * @name clear
	 * @memberOf MapCache
	 */
	function mapCacheClear() {
	  this.__data__ = {
	    'hash': new Hash,
	    'map': new (Map || ListCache),
	    'string': new Hash
	  };
	}

	/**
	 * Removes `key` and its value from the map.
	 *
	 * @private
	 * @name delete
	 * @memberOf MapCache
	 * @param {string} key The key of the value to remove.
	 * @returns {boolean} Returns `true` if the entry was removed, else `false`.
	 */
	function mapCacheDelete(key) {
	  return getMapData(this, key)['delete'](key);
	}

	/**
	 * Gets the map value for `key`.
	 *
	 * @private
	 * @name get
	 * @memberOf MapCache
	 * @param {string} key The key of the value to get.
	 * @returns {*} Returns the entry value.
	 */
	function mapCacheGet(key) {
	  return getMapData(this, key).get(key);
	}

	/**
	 * Checks if a map value for `key` exists.
	 *
	 * @private
	 * @name has
	 * @memberOf MapCache
	 * @param {string} key The key of the entry to check.
	 * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
	 */
	function mapCacheHas(key) {
	  return getMapData(this, key).has(key);
	}

	/**
	 * Sets the map `key` to `value`.
	 *
	 * @private
	 * @name set
	 * @memberOf MapCache
	 * @param {string} key The key of the value to set.
	 * @param {*} value The value to set.
	 * @returns {Object} Returns the map cache instance.
	 */
	function mapCacheSet(key, value) {
	  getMapData(this, key).set(key, value);
	  return this;
	}

	// Add methods to `MapCache`.
	MapCache.prototype.clear = mapCacheClear;
	MapCache.prototype['delete'] = mapCacheDelete;
	MapCache.prototype.get = mapCacheGet;
	MapCache.prototype.has = mapCacheHas;
	MapCache.prototype.set = mapCacheSet;

	/**
	 * Creates a stack cache object to store key-value pairs.
	 *
	 * @private
	 * @constructor
	 * @param {Array} [entries] The key-value pairs to cache.
	 */
	function Stack(entries) {
	  this.__data__ = new ListCache(entries);
	}

	/**
	 * Removes all key-value entries from the stack.
	 *
	 * @private
	 * @name clear
	 * @memberOf Stack
	 */
	function stackClear() {
	  this.__data__ = new ListCache;
	}

	/**
	 * Removes `key` and its value from the stack.
	 *
	 * @private
	 * @name delete
	 * @memberOf Stack
	 * @param {string} key The key of the value to remove.
	 * @returns {boolean} Returns `true` if the entry was removed, else `false`.
	 */
	function stackDelete(key) {
	  return this.__data__['delete'](key);
	}

	/**
	 * Gets the stack value for `key`.
	 *
	 * @private
	 * @name get
	 * @memberOf Stack
	 * @param {string} key The key of the value to get.
	 * @returns {*} Returns the entry value.
	 */
	function stackGet(key) {
	  return this.__data__.get(key);
	}

	/**
	 * Checks if a stack value for `key` exists.
	 *
	 * @private
	 * @name has
	 * @memberOf Stack
	 * @param {string} key The key of the entry to check.
	 * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
	 */
	function stackHas(key) {
	  return this.__data__.has(key);
	}

	/**
	 * Sets the stack `key` to `value`.
	 *
	 * @private
	 * @name set
	 * @memberOf Stack
	 * @param {string} key The key of the value to set.
	 * @param {*} value The value to set.
	 * @returns {Object} Returns the stack cache instance.
	 */
	function stackSet(key, value) {
	  var cache = this.__data__;
	  if (cache instanceof ListCache) {
	    var pairs = cache.__data__;
	    if (!Map || (pairs.length < LARGE_ARRAY_SIZE - 1)) {
	      pairs.push([key, value]);
	      return this;
	    }
	    cache = this.__data__ = new MapCache(pairs);
	  }
	  cache.set(key, value);
	  return this;
	}

	// Add methods to `Stack`.
	Stack.prototype.clear = stackClear;
	Stack.prototype['delete'] = stackDelete;
	Stack.prototype.get = stackGet;
	Stack.prototype.has = stackHas;
	Stack.prototype.set = stackSet;

	/**
	 * Creates an array of the enumerable property names of the array-like `value`.
	 *
	 * @private
	 * @param {*} value The value to query.
	 * @param {boolean} inherited Specify returning inherited property names.
	 * @returns {Array} Returns the array of property names.
	 */
	function arrayLikeKeys(value, inherited) {
	  // Safari 8.1 makes `arguments.callee` enumerable in strict mode.
	  // Safari 9 makes `arguments.length` enumerable in strict mode.
	  var result = (isArray(value) || isArguments(value))
	    ? baseTimes(value.length, String)
	    : [];

	  var length = result.length,
	      skipIndexes = !!length;

	  for (var key in value) {
	    if ((inherited || hasOwnProperty.call(value, key)) &&
	        !(skipIndexes && (key == 'length' || isIndex(key, length)))) {
	      result.push(key);
	    }
	  }
	  return result;
	}

	/**
	 * Assigns `value` to `key` of `object` if the existing value is not equivalent
	 * using [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
	 * for equality comparisons.
	 *
	 * @private
	 * @param {Object} object The object to modify.
	 * @param {string} key The key of the property to assign.
	 * @param {*} value The value to assign.
	 */
	function assignValue(object, key, value) {
	  var objValue = object[key];
	  if (!(hasOwnProperty.call(object, key) && eq(objValue, value)) ||
	      (value === undefined && !(key in object))) {
	    object[key] = value;
	  }
	}

	/**
	 * Gets the index at which the `key` is found in `array` of key-value pairs.
	 *
	 * @private
	 * @param {Array} array The array to inspect.
	 * @param {*} key The key to search for.
	 * @returns {number} Returns the index of the matched value, else `-1`.
	 */
	function assocIndexOf(array, key) {
	  var length = array.length;
	  while (length--) {
	    if (eq(array[length][0], key)) {
	      return length;
	    }
	  }
	  return -1;
	}

	/**
	 * The base implementation of `_.assign` without support for multiple sources
	 * or `customizer` functions.
	 *
	 * @private
	 * @param {Object} object The destination object.
	 * @param {Object} source The source object.
	 * @returns {Object} Returns `object`.
	 */
	function baseAssign(object, source) {
	  return object && copyObject(source, keys(source), object);
	}

	/**
	 * The base implementation of `_.clone` and `_.cloneDeep` which tracks
	 * traversed objects.
	 *
	 * @private
	 * @param {*} value The value to clone.
	 * @param {boolean} [isDeep] Specify a deep clone.
	 * @param {boolean} [isFull] Specify a clone including symbols.
	 * @param {Function} [customizer] The function to customize cloning.
	 * @param {string} [key] The key of `value`.
	 * @param {Object} [object] The parent object of `value`.
	 * @param {Object} [stack] Tracks traversed objects and their clone counterparts.
	 * @returns {*} Returns the cloned value.
	 */
	function baseClone(value, isDeep, isFull, customizer, key, object, stack) {
	  var result;
	  if (customizer) {
	    result = object ? customizer(value, key, object, stack) : customizer(value);
	  }
	  if (result !== undefined) {
	    return result;
	  }
	  if (!isObject(value)) {
	    return value;
	  }
	  var isArr = isArray(value);
	  if (isArr) {
	    result = initCloneArray(value);
	    if (!isDeep) {
	      return copyArray(value, result);
	    }
	  } else {
	    var tag = getTag(value),
	        isFunc = tag == funcTag || tag == genTag;

	    if (isBuffer(value)) {
	      return cloneBuffer(value, isDeep);
	    }
	    if (tag == objectTag || tag == argsTag || (isFunc && !object)) {
	      if (isHostObject(value)) {
	        return object ? value : {};
	      }
	      result = initCloneObject(isFunc ? {} : value);
	      if (!isDeep) {
	        return copySymbols(value, baseAssign(result, value));
	      }
	    } else {
	      if (!cloneableTags[tag]) {
	        return object ? value : {};
	      }
	      result = initCloneByTag(value, tag, baseClone, isDeep);
	    }
	  }
	  // Check for circular references and return its corresponding clone.
	  stack || (stack = new Stack);
	  var stacked = stack.get(value);
	  if (stacked) {
	    return stacked;
	  }
	  stack.set(value, result);

	  if (!isArr) {
	    var props = isFull ? getAllKeys(value) : keys(value);
	  }
	  arrayEach(props || value, function(subValue, key) {
	    if (props) {
	      key = subValue;
	      subValue = value[key];
	    }
	    // Recursively populate clone (susceptible to call stack limits).
	    assignValue(result, key, baseClone(subValue, isDeep, isFull, customizer, key, value, stack));
	  });
	  return result;
	}

	/**
	 * The base implementation of `_.create` without support for assigning
	 * properties to the created object.
	 *
	 * @private
	 * @param {Object} prototype The object to inherit from.
	 * @returns {Object} Returns the new object.
	 */
	function baseCreate(proto) {
	  return isObject(proto) ? objectCreate(proto) : {};
	}

	/**
	 * The base implementation of `getAllKeys` and `getAllKeysIn` which uses
	 * `keysFunc` and `symbolsFunc` to get the enumerable property names and
	 * symbols of `object`.
	 *
	 * @private
	 * @param {Object} object The object to query.
	 * @param {Function} keysFunc The function to get the keys of `object`.
	 * @param {Function} symbolsFunc The function to get the symbols of `object`.
	 * @returns {Array} Returns the array of property names and symbols.
	 */
	function baseGetAllKeys(object, keysFunc, symbolsFunc) {
	  var result = keysFunc(object);
	  return isArray(object) ? result : arrayPush(result, symbolsFunc(object));
	}

	/**
	 * The base implementation of `getTag`.
	 *
	 * @private
	 * @param {*} value The value to query.
	 * @returns {string} Returns the `toStringTag`.
	 */
	function baseGetTag(value) {
	  return objectToString.call(value);
	}

	/**
	 * The base implementation of `_.isNative` without bad shim checks.
	 *
	 * @private
	 * @param {*} value The value to check.
	 * @returns {boolean} Returns `true` if `value` is a native function,
	 *  else `false`.
	 */
	function baseIsNative(value) {
	  if (!isObject(value) || isMasked(value)) {
	    return false;
	  }
	  var pattern = (isFunction(value) || isHostObject(value)) ? reIsNative : reIsHostCtor;
	  return pattern.test(toSource(value));
	}

	/**
	 * The base implementation of `_.keys` which doesn't treat sparse arrays as dense.
	 *
	 * @private
	 * @param {Object} object The object to query.
	 * @returns {Array} Returns the array of property names.
	 */
	function baseKeys(object) {
	  if (!isPrototype(object)) {
	    return nativeKeys(object);
	  }
	  var result = [];
	  for (var key in Object(object)) {
	    if (hasOwnProperty.call(object, key) && key != 'constructor') {
	      result.push(key);
	    }
	  }
	  return result;
	}

	/**
	 * Creates a clone of  `buffer`.
	 *
	 * @private
	 * @param {Buffer} buffer The buffer to clone.
	 * @param {boolean} [isDeep] Specify a deep clone.
	 * @returns {Buffer} Returns the cloned buffer.
	 */
	function cloneBuffer(buffer, isDeep) {
	  if (isDeep) {
	    return buffer.slice();
	  }
	  var result = new buffer.constructor(buffer.length);
	  buffer.copy(result);
	  return result;
	}

	/**
	 * Creates a clone of `arrayBuffer`.
	 *
	 * @private
	 * @param {ArrayBuffer} arrayBuffer The array buffer to clone.
	 * @returns {ArrayBuffer} Returns the cloned array buffer.
	 */
	function cloneArrayBuffer(arrayBuffer) {
	  var result = new arrayBuffer.constructor(arrayBuffer.byteLength);
	  new Uint8Array(result).set(new Uint8Array(arrayBuffer));
	  return result;
	}

	/**
	 * Creates a clone of `dataView`.
	 *
	 * @private
	 * @param {Object} dataView The data view to clone.
	 * @param {boolean} [isDeep] Specify a deep clone.
	 * @returns {Object} Returns the cloned data view.
	 */
	function cloneDataView(dataView, isDeep) {
	  var buffer = isDeep ? cloneArrayBuffer(dataView.buffer) : dataView.buffer;
	  return new dataView.constructor(buffer, dataView.byteOffset, dataView.byteLength);
	}

	/**
	 * Creates a clone of `map`.
	 *
	 * @private
	 * @param {Object} map The map to clone.
	 * @param {Function} cloneFunc The function to clone values.
	 * @param {boolean} [isDeep] Specify a deep clone.
	 * @returns {Object} Returns the cloned map.
	 */
	function cloneMap(map, isDeep, cloneFunc) {
	  var array = isDeep ? cloneFunc(mapToArray(map), true) : mapToArray(map);
	  return arrayReduce(array, addMapEntry, new map.constructor);
	}

	/**
	 * Creates a clone of `regexp`.
	 *
	 * @private
	 * @param {Object} regexp The regexp to clone.
	 * @returns {Object} Returns the cloned regexp.
	 */
	function cloneRegExp(regexp) {
	  var result = new regexp.constructor(regexp.source, reFlags.exec(regexp));
	  result.lastIndex = regexp.lastIndex;
	  return result;
	}

	/**
	 * Creates a clone of `set`.
	 *
	 * @private
	 * @param {Object} set The set to clone.
	 * @param {Function} cloneFunc The function to clone values.
	 * @param {boolean} [isDeep] Specify a deep clone.
	 * @returns {Object} Returns the cloned set.
	 */
	function cloneSet(set, isDeep, cloneFunc) {
	  var array = isDeep ? cloneFunc(setToArray(set), true) : setToArray(set);
	  return arrayReduce(array, addSetEntry, new set.constructor);
	}

	/**
	 * Creates a clone of the `symbol` object.
	 *
	 * @private
	 * @param {Object} symbol The symbol object to clone.
	 * @returns {Object} Returns the cloned symbol object.
	 */
	function cloneSymbol(symbol) {
	  return symbolValueOf ? Object(symbolValueOf.call(symbol)) : {};
	}

	/**
	 * Creates a clone of `typedArray`.
	 *
	 * @private
	 * @param {Object} typedArray The typed array to clone.
	 * @param {boolean} [isDeep] Specify a deep clone.
	 * @returns {Object} Returns the cloned typed array.
	 */
	function cloneTypedArray(typedArray, isDeep) {
	  var buffer = isDeep ? cloneArrayBuffer(typedArray.buffer) : typedArray.buffer;
	  return new typedArray.constructor(buffer, typedArray.byteOffset, typedArray.length);
	}

	/**
	 * Copies the values of `source` to `array`.
	 *
	 * @private
	 * @param {Array} source The array to copy values from.
	 * @param {Array} [array=[]] The array to copy values to.
	 * @returns {Array} Returns `array`.
	 */
	function copyArray(source, array) {
	  var index = -1,
	      length = source.length;

	  array || (array = Array(length));
	  while (++index < length) {
	    array[index] = source[index];
	  }
	  return array;
	}

	/**
	 * Copies properties of `source` to `object`.
	 *
	 * @private
	 * @param {Object} source The object to copy properties from.
	 * @param {Array} props The property identifiers to copy.
	 * @param {Object} [object={}] The object to copy properties to.
	 * @param {Function} [customizer] The function to customize copied values.
	 * @returns {Object} Returns `object`.
	 */
	function copyObject(source, props, object, customizer) {
	  object || (object = {});

	  var index = -1,
	      length = props.length;

	  while (++index < length) {
	    var key = props[index];

	    var newValue = customizer
	      ? customizer(object[key], source[key], key, object, source)
	      : undefined;

	    assignValue(object, key, newValue === undefined ? source[key] : newValue);
	  }
	  return object;
	}

	/**
	 * Copies own symbol properties of `source` to `object`.
	 *
	 * @private
	 * @param {Object} source The object to copy symbols from.
	 * @param {Object} [object={}] The object to copy symbols to.
	 * @returns {Object} Returns `object`.
	 */
	function copySymbols(source, object) {
	  return copyObject(source, getSymbols(source), object);
	}

	/**
	 * Creates an array of own enumerable property names and symbols of `object`.
	 *
	 * @private
	 * @param {Object} object The object to query.
	 * @returns {Array} Returns the array of property names and symbols.
	 */
	function getAllKeys(object) {
	  return baseGetAllKeys(object, keys, getSymbols);
	}

	/**
	 * Gets the data for `map`.
	 *
	 * @private
	 * @param {Object} map The map to query.
	 * @param {string} key The reference key.
	 * @returns {*} Returns the map data.
	 */
	function getMapData(map, key) {
	  var data = map.__data__;
	  return isKeyable(key)
	    ? data[typeof key == 'string' ? 'string' : 'hash']
	    : data.map;
	}

	/**
	 * Gets the native function at `key` of `object`.
	 *
	 * @private
	 * @param {Object} object The object to query.
	 * @param {string} key The key of the method to get.
	 * @returns {*} Returns the function if it's native, else `undefined`.
	 */
	function getNative(object, key) {
	  var value = getValue(object, key);
	  return baseIsNative(value) ? value : undefined;
	}

	/**
	 * Creates an array of the own enumerable symbol properties of `object`.
	 *
	 * @private
	 * @param {Object} object The object to query.
	 * @returns {Array} Returns the array of symbols.
	 */
	var getSymbols = nativeGetSymbols ? overArg(nativeGetSymbols, Object) : stubArray;

	/**
	 * Gets the `toStringTag` of `value`.
	 *
	 * @private
	 * @param {*} value The value to query.
	 * @returns {string} Returns the `toStringTag`.
	 */
	var getTag = baseGetTag;

	// Fallback for data views, maps, sets, and weak maps in IE 11,
	// for data views in Edge < 14, and promises in Node.js.
	if ((DataView && getTag(new DataView(new ArrayBuffer(1))) != dataViewTag) ||
	    (Map && getTag(new Map) != mapTag) ||
	    (Promise && getTag(Promise.resolve()) != promiseTag) ||
	    (Set && getTag(new Set) != setTag) ||
	    (WeakMap && getTag(new WeakMap) != weakMapTag)) {
	  getTag = function(value) {
	    var result = objectToString.call(value),
	        Ctor = result == objectTag ? value.constructor : undefined,
	        ctorString = Ctor ? toSource(Ctor) : undefined;

	    if (ctorString) {
	      switch (ctorString) {
	        case dataViewCtorString: return dataViewTag;
	        case mapCtorString: return mapTag;
	        case promiseCtorString: return promiseTag;
	        case setCtorString: return setTag;
	        case weakMapCtorString: return weakMapTag;
	      }
	    }
	    return result;
	  };
	}

	/**
	 * Initializes an array clone.
	 *
	 * @private
	 * @param {Array} array The array to clone.
	 * @returns {Array} Returns the initialized clone.
	 */
	function initCloneArray(array) {
	  var length = array.length,
	      result = array.constructor(length);

	  // Add properties assigned by `RegExp#exec`.
	  if (length && typeof array[0] == 'string' && hasOwnProperty.call(array, 'index')) {
	    result.index = array.index;
	    result.input = array.input;
	  }
	  return result;
	}

	/**
	 * Initializes an object clone.
	 *
	 * @private
	 * @param {Object} object The object to clone.
	 * @returns {Object} Returns the initialized clone.
	 */
	function initCloneObject(object) {
	  return (typeof object.constructor == 'function' && !isPrototype(object))
	    ? baseCreate(getPrototype(object))
	    : {};
	}

	/**
	 * Initializes an object clone based on its `toStringTag`.
	 *
	 * **Note:** This function only supports cloning values with tags of
	 * `Boolean`, `Date`, `Error`, `Number`, `RegExp`, or `String`.
	 *
	 * @private
	 * @param {Object} object The object to clone.
	 * @param {string} tag The `toStringTag` of the object to clone.
	 * @param {Function} cloneFunc The function to clone values.
	 * @param {boolean} [isDeep] Specify a deep clone.
	 * @returns {Object} Returns the initialized clone.
	 */
	function initCloneByTag(object, tag, cloneFunc, isDeep) {
	  var Ctor = object.constructor;
	  switch (tag) {
	    case arrayBufferTag:
	      return cloneArrayBuffer(object);

	    case boolTag:
	    case dateTag:
	      return new Ctor(+object);

	    case dataViewTag:
	      return cloneDataView(object, isDeep);

	    case float32Tag: case float64Tag:
	    case int8Tag: case int16Tag: case int32Tag:
	    case uint8Tag: case uint8ClampedTag: case uint16Tag: case uint32Tag:
	      return cloneTypedArray(object, isDeep);

	    case mapTag:
	      return cloneMap(object, isDeep, cloneFunc);

	    case numberTag:
	    case stringTag:
	      return new Ctor(object);

	    case regexpTag:
	      return cloneRegExp(object);

	    case setTag:
	      return cloneSet(object, isDeep, cloneFunc);

	    case symbolTag:
	      return cloneSymbol(object);
	  }
	}

	/**
	 * Checks if `value` is a valid array-like index.
	 *
	 * @private
	 * @param {*} value The value to check.
	 * @param {number} [length=MAX_SAFE_INTEGER] The upper bounds of a valid index.
	 * @returns {boolean} Returns `true` if `value` is a valid index, else `false`.
	 */
	function isIndex(value, length) {
	  length = length == null ? MAX_SAFE_INTEGER : length;
	  return !!length &&
	    (typeof value == 'number' || reIsUint.test(value)) &&
	    (value > -1 && value % 1 == 0 && value < length);
	}

	/**
	 * Checks if `value` is suitable for use as unique object key.
	 *
	 * @private
	 * @param {*} value The value to check.
	 * @returns {boolean} Returns `true` if `value` is suitable, else `false`.
	 */
	function isKeyable(value) {
	  var type = typeof value;
	  return (type == 'string' || type == 'number' || type == 'symbol' || type == 'boolean')
	    ? (value !== '__proto__')
	    : (value === null);
	}

	/**
	 * Checks if `func` has its source masked.
	 *
	 * @private
	 * @param {Function} func The function to check.
	 * @returns {boolean} Returns `true` if `func` is masked, else `false`.
	 */
	function isMasked(func) {
	  return !!maskSrcKey && (maskSrcKey in func);
	}

	/**
	 * Checks if `value` is likely a prototype object.
	 *
	 * @private
	 * @param {*} value The value to check.
	 * @returns {boolean} Returns `true` if `value` is a prototype, else `false`.
	 */
	function isPrototype(value) {
	  var Ctor = value && value.constructor,
	      proto = (typeof Ctor == 'function' && Ctor.prototype) || objectProto;

	  return value === proto;
	}

	/**
	 * Converts `func` to its source code.
	 *
	 * @private
	 * @param {Function} func The function to process.
	 * @returns {string} Returns the source code.
	 */
	function toSource(func) {
	  if (func != null) {
	    try {
	      return funcToString.call(func);
	    } catch (e) {}
	    try {
	      return (func + '');
	    } catch (e) {}
	  }
	  return '';
	}

	/**
	 * This method is like `_.clone` except that it recursively clones `value`.
	 *
	 * @static
	 * @memberOf _
	 * @since 1.0.0
	 * @category Lang
	 * @param {*} value The value to recursively clone.
	 * @returns {*} Returns the deep cloned value.
	 * @see _.clone
	 * @example
	 *
	 * var objects = [{ 'a': 1 }, { 'b': 2 }];
	 *
	 * var deep = _.cloneDeep(objects);
	 * console.log(deep[0] === objects[0]);
	 * // => false
	 */
	function cloneDeep(value) {
	  return baseClone(value, true, true);
	}

	/**
	 * Performs a
	 * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
	 * comparison between two values to determine if they are equivalent.
	 *
	 * @static
	 * @memberOf _
	 * @since 4.0.0
	 * @category Lang
	 * @param {*} value The value to compare.
	 * @param {*} other The other value to compare.
	 * @returns {boolean} Returns `true` if the values are equivalent, else `false`.
	 * @example
	 *
	 * var object = { 'a': 1 };
	 * var other = { 'a': 1 };
	 *
	 * _.eq(object, object);
	 * // => true
	 *
	 * _.eq(object, other);
	 * // => false
	 *
	 * _.eq('a', 'a');
	 * // => true
	 *
	 * _.eq('a', Object('a'));
	 * // => false
	 *
	 * _.eq(NaN, NaN);
	 * // => true
	 */
	function eq(value, other) {
	  return value === other || (value !== value && other !== other);
	}

	/**
	 * Checks if `value` is likely an `arguments` object.
	 *
	 * @static
	 * @memberOf _
	 * @since 0.1.0
	 * @category Lang
	 * @param {*} value The value to check.
	 * @returns {boolean} Returns `true` if `value` is an `arguments` object,
	 *  else `false`.
	 * @example
	 *
	 * _.isArguments(function() { return arguments; }());
	 * // => true
	 *
	 * _.isArguments([1, 2, 3]);
	 * // => false
	 */
	function isArguments(value) {
	  // Safari 8.1 makes `arguments.callee` enumerable in strict mode.
	  return isArrayLikeObject(value) && hasOwnProperty.call(value, 'callee') &&
	    (!propertyIsEnumerable.call(value, 'callee') || objectToString.call(value) == argsTag);
	}

	/**
	 * Checks if `value` is classified as an `Array` object.
	 *
	 * @static
	 * @memberOf _
	 * @since 0.1.0
	 * @category Lang
	 * @param {*} value The value to check.
	 * @returns {boolean} Returns `true` if `value` is an array, else `false`.
	 * @example
	 *
	 * _.isArray([1, 2, 3]);
	 * // => true
	 *
	 * _.isArray(document.body.children);
	 * // => false
	 *
	 * _.isArray('abc');
	 * // => false
	 *
	 * _.isArray(_.noop);
	 * // => false
	 */
	var isArray = Array.isArray;

	/**
	 * Checks if `value` is array-like. A value is considered array-like if it's
	 * not a function and has a `value.length` that's an integer greater than or
	 * equal to `0` and less than or equal to `Number.MAX_SAFE_INTEGER`.
	 *
	 * @static
	 * @memberOf _
	 * @since 4.0.0
	 * @category Lang
	 * @param {*} value The value to check.
	 * @returns {boolean} Returns `true` if `value` is array-like, else `false`.
	 * @example
	 *
	 * _.isArrayLike([1, 2, 3]);
	 * // => true
	 *
	 * _.isArrayLike(document.body.children);
	 * // => true
	 *
	 * _.isArrayLike('abc');
	 * // => true
	 *
	 * _.isArrayLike(_.noop);
	 * // => false
	 */
	function isArrayLike(value) {
	  return value != null && isLength(value.length) && !isFunction(value);
	}

	/**
	 * This method is like `_.isArrayLike` except that it also checks if `value`
	 * is an object.
	 *
	 * @static
	 * @memberOf _
	 * @since 4.0.0
	 * @category Lang
	 * @param {*} value The value to check.
	 * @returns {boolean} Returns `true` if `value` is an array-like object,
	 *  else `false`.
	 * @example
	 *
	 * _.isArrayLikeObject([1, 2, 3]);
	 * // => true
	 *
	 * _.isArrayLikeObject(document.body.children);
	 * // => true
	 *
	 * _.isArrayLikeObject('abc');
	 * // => false
	 *
	 * _.isArrayLikeObject(_.noop);
	 * // => false
	 */
	function isArrayLikeObject(value) {
	  return isObjectLike(value) && isArrayLike(value);
	}

	/**
	 * Checks if `value` is a buffer.
	 *
	 * @static
	 * @memberOf _
	 * @since 4.3.0
	 * @category Lang
	 * @param {*} value The value to check.
	 * @returns {boolean} Returns `true` if `value` is a buffer, else `false`.
	 * @example
	 *
	 * _.isBuffer(new Buffer(2));
	 * // => true
	 *
	 * _.isBuffer(new Uint8Array(2));
	 * // => false
	 */
	var isBuffer = nativeIsBuffer || stubFalse;

	/**
	 * Checks if `value` is classified as a `Function` object.
	 *
	 * @static
	 * @memberOf _
	 * @since 0.1.0
	 * @category Lang
	 * @param {*} value The value to check.
	 * @returns {boolean} Returns `true` if `value` is a function, else `false`.
	 * @example
	 *
	 * _.isFunction(_);
	 * // => true
	 *
	 * _.isFunction(/abc/);
	 * // => false
	 */
	function isFunction(value) {
	  // The use of `Object#toString` avoids issues with the `typeof` operator
	  // in Safari 8-9 which returns 'object' for typed array and other constructors.
	  var tag = isObject(value) ? objectToString.call(value) : '';
	  return tag == funcTag || tag == genTag;
	}

	/**
	 * Checks if `value` is a valid array-like length.
	 *
	 * **Note:** This method is loosely based on
	 * [`ToLength`](http://ecma-international.org/ecma-262/7.0/#sec-tolength).
	 *
	 * @static
	 * @memberOf _
	 * @since 4.0.0
	 * @category Lang
	 * @param {*} value The value to check.
	 * @returns {boolean} Returns `true` if `value` is a valid length, else `false`.
	 * @example
	 *
	 * _.isLength(3);
	 * // => true
	 *
	 * _.isLength(Number.MIN_VALUE);
	 * // => false
	 *
	 * _.isLength(Infinity);
	 * // => false
	 *
	 * _.isLength('3');
	 * // => false
	 */
	function isLength(value) {
	  return typeof value == 'number' &&
	    value > -1 && value % 1 == 0 && value <= MAX_SAFE_INTEGER;
	}

	/**
	 * Checks if `value` is the
	 * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)
	 * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)
	 *
	 * @static
	 * @memberOf _
	 * @since 0.1.0
	 * @category Lang
	 * @param {*} value The value to check.
	 * @returns {boolean} Returns `true` if `value` is an object, else `false`.
	 * @example
	 *
	 * _.isObject({});
	 * // => true
	 *
	 * _.isObject([1, 2, 3]);
	 * // => true
	 *
	 * _.isObject(_.noop);
	 * // => true
	 *
	 * _.isObject(null);
	 * // => false
	 */
	function isObject(value) {
	  var type = typeof value;
	  return !!value && (type == 'object' || type == 'function');
	}

	/**
	 * Checks if `value` is object-like. A value is object-like if it's not `null`
	 * and has a `typeof` result of "object".
	 *
	 * @static
	 * @memberOf _
	 * @since 4.0.0
	 * @category Lang
	 * @param {*} value The value to check.
	 * @returns {boolean} Returns `true` if `value` is object-like, else `false`.
	 * @example
	 *
	 * _.isObjectLike({});
	 * // => true
	 *
	 * _.isObjectLike([1, 2, 3]);
	 * // => true
	 *
	 * _.isObjectLike(_.noop);
	 * // => false
	 *
	 * _.isObjectLike(null);
	 * // => false
	 */
	function isObjectLike(value) {
	  return !!value && typeof value == 'object';
	}

	/**
	 * Creates an array of the own enumerable property names of `object`.
	 *
	 * **Note:** Non-object values are coerced to objects. See the
	 * [ES spec](http://ecma-international.org/ecma-262/7.0/#sec-object.keys)
	 * for more details.
	 *
	 * @static
	 * @since 0.1.0
	 * @memberOf _
	 * @category Object
	 * @param {Object} object The object to query.
	 * @returns {Array} Returns the array of property names.
	 * @example
	 *
	 * function Foo() {
	 *   this.a = 1;
	 *   this.b = 2;
	 * }
	 *
	 * Foo.prototype.c = 3;
	 *
	 * _.keys(new Foo);
	 * // => ['a', 'b'] (iteration order is not guaranteed)
	 *
	 * _.keys('hi');
	 * // => ['0', '1']
	 */
	function keys(object) {
	  return isArrayLike(object) ? arrayLikeKeys(object) : baseKeys(object);
	}

	/**
	 * This method returns a new empty array.
	 *
	 * @static
	 * @memberOf _
	 * @since 4.13.0
	 * @category Util
	 * @returns {Array} Returns the new empty array.
	 * @example
	 *
	 * var arrays = _.times(2, _.stubArray);
	 *
	 * console.log(arrays);
	 * // => [[], []]
	 *
	 * console.log(arrays[0] === arrays[1]);
	 * // => false
	 */
	function stubArray() {
	  return [];
	}

	/**
	 * This method returns `false`.
	 *
	 * @static
	 * @memberOf _
	 * @since 4.13.0
	 * @category Util
	 * @returns {boolean} Returns `false`.
	 * @example
	 *
	 * _.times(2, _.stubFalse);
	 * // => [false, false]
	 */
	function stubFalse() {
	  return false;
	}

	module.exports = cloneDeep;
	}(lodash_clonedeep, lodash_clonedeep.exports));

	var cloneDeep = lodash_clonedeep.exports;

	function dispatch(node, type, detail) {
	  detail = detail || {};
	  var document = node.ownerDocument, event = document.defaultView.CustomEvent;
	  if (typeof event === "function") {
	    event = new event(type, {detail: detail});
	  } else {
	    event = document.createEvent("Event");
	    event.initEvent(type, false, false);
	    event.detail = detail;
	  }
	  node.dispatchEvent(event);
	}

	// TODO https://twitter.com/mbostock/status/702737065121742848
	function isarray(value) {
	  return Array.isArray(value)
	      || value instanceof Int8Array
	      || value instanceof Int16Array
	      || value instanceof Int32Array
	      || value instanceof Uint8Array
	      || value instanceof Uint8ClampedArray
	      || value instanceof Uint16Array
	      || value instanceof Uint32Array
	      || value instanceof Float32Array
	      || value instanceof Float64Array;
	}

	// Non-integer keys in arrays, e.g. [1, 2, 0.5: "value"].
	function isindex(key) {
	  return key === (key | 0) + "";
	}

	function inspectName(name) {
	  const n = document.createElement("span");
	  n.className = "observablehq--cellname";
	  n.textContent = `${name} = `;
	  return n;
	}

	const symbolToString = Symbol.prototype.toString;

	// Symbols do not coerce to strings; they must be explicitly converted.
	function formatSymbol(symbol) {
	  return symbolToString.call(symbol);
	}

	const {getOwnPropertySymbols, prototype: {hasOwnProperty: hasOwnProperty$1}} = Object;
	const {toStringTag} = Symbol;

	const FORBIDDEN = {};

	const symbolsof = getOwnPropertySymbols;

	function isown(object, key) {
	  return hasOwnProperty$1.call(object, key);
	}

	function tagof(object) {
	  return object[toStringTag]
	      || (object.constructor && object.constructor.name)
	      || "Object";
	}

	function valueof$1(object, key) {
	  try {
	    const value = object[key];
	    if (value) value.constructor; // Test for SecurityError.
	    return value;
	  } catch (ignore) {
	    return FORBIDDEN;
	  }
	}

	const SYMBOLS = [
	  { symbol: "@@__IMMUTABLE_INDEXED__@@", name: "Indexed", modifier: true },
	  { symbol: "@@__IMMUTABLE_KEYED__@@", name: "Keyed", modifier: true },
	  { symbol: "@@__IMMUTABLE_LIST__@@", name: "List", arrayish: true },
	  { symbol: "@@__IMMUTABLE_MAP__@@", name: "Map" },
	  {
	    symbol: "@@__IMMUTABLE_ORDERED__@@",
	    name: "Ordered",
	    modifier: true,
	    prefix: true
	  },
	  { symbol: "@@__IMMUTABLE_RECORD__@@", name: "Record" },
	  {
	    symbol: "@@__IMMUTABLE_SET__@@",
	    name: "Set",
	    arrayish: true,
	    setish: true
	  },
	  { symbol: "@@__IMMUTABLE_STACK__@@", name: "Stack", arrayish: true }
	];

	function immutableName(obj) {
	  try {
	    let symbols = SYMBOLS.filter(({ symbol }) => obj[symbol] === true);
	    if (!symbols.length) return;

	    const name = symbols.find(s => !s.modifier);
	    const prefix =
	      name.name === "Map" && symbols.find(s => s.modifier && s.prefix);

	    const arrayish = symbols.some(s => s.arrayish);
	    const setish = symbols.some(s => s.setish);

	    return {
	      name: `${prefix ? prefix.name : ""}${name.name}`,
	      symbols,
	      arrayish: arrayish && !setish,
	      setish
	    };
	  } catch (e) {
	    return null;
	  }
	}

	const {getPrototypeOf, getOwnPropertyDescriptors} = Object;
	const objectPrototype = getPrototypeOf({});

	function inspectExpanded(object, _, name, proto) {
	  let arrayish = isarray(object);
	  let tag, fields, next, n;

	  if (object instanceof Map) {
	    if (object instanceof object.constructor) {
	      tag = `Map(${object.size})`;
	      fields = iterateMap$1;
	    } else { // avoid incompatible receiver error for prototype
	      tag = "Map()";
	      fields = iterateObject$1;
	    }
	  } else if (object instanceof Set) {
	    if (object instanceof object.constructor) {
	      tag = `Set(${object.size})`;
	      fields = iterateSet$1;
	    } else { // avoid incompatible receiver error for prototype
	      tag = "Set()";
	      fields = iterateObject$1;
	    }
	  } else if (arrayish) {
	    tag = `${object.constructor.name}(${object.length})`;
	    fields = iterateArray$1;
	  } else if ((n = immutableName(object))) {
	    tag = `Immutable.${n.name}${n.name === "Record" ? "" : `(${object.size})`}`;
	    arrayish = n.arrayish;
	    fields = n.arrayish
	      ? iterateImArray$1
	      : n.setish
	      ? iterateImSet$1
	      : iterateImObject$1;
	  } else if (proto) {
	    tag = tagof(object);
	    fields = iterateProto;
	  } else {
	    tag = tagof(object);
	    fields = iterateObject$1;
	  }

	  const span = document.createElement("span");
	  span.className = "observablehq--expanded";
	  if (name) {
	    span.appendChild(inspectName(name));
	  }
	  const a = span.appendChild(document.createElement("a"));
	  a.innerHTML = `<svg width=8 height=8 class='observablehq--caret'>
    <path d='M4 7L0 1h8z' fill='currentColor' />
  </svg>`;
	  a.appendChild(document.createTextNode(`${tag}${arrayish ? " [" : " {"}`));
	  a.addEventListener("mouseup", function(event) {
	    event.stopPropagation();
	    replace(span, inspectCollapsed(object, null, name, proto));
	  });

	  fields = fields(object);
	  for (let i = 0; !(next = fields.next()).done && i < 20; ++i) {
	    span.appendChild(next.value);
	  }

	  if (!next.done) {
	    const a = span.appendChild(document.createElement("a"));
	    a.className = "observablehq--field";
	    a.style.display = "block";
	    a.appendChild(document.createTextNode(`  â€¦ more`));
	    a.addEventListener("mouseup", function(event) {
	      event.stopPropagation();
	      span.insertBefore(next.value, span.lastChild.previousSibling);
	      for (let i = 0; !(next = fields.next()).done && i < 19; ++i) {
	        span.insertBefore(next.value, span.lastChild.previousSibling);
	      }
	      if (next.done) span.removeChild(span.lastChild.previousSibling);
	      dispatch(span, "load");
	    });
	  }

	  span.appendChild(document.createTextNode(arrayish ? "]" : "}"));

	  return span;
	}

	function* iterateMap$1(map) {
	  for (const [key, value] of map) {
	    yield formatMapField$1(key, value);
	  }
	  yield* iterateObject$1(map);
	}

	function* iterateSet$1(set) {
	  for (const value of set) {
	    yield formatSetField(value);
	  }
	  yield* iterateObject$1(set);
	}

	function* iterateImSet$1(set) {
	  for (const value of set) {
	    yield formatSetField(value);
	  }
	}

	function* iterateArray$1(array) {
	  for (let i = 0, n = array.length; i < n; ++i) {
	    if (i in array) {
	      yield formatField$1(i, valueof$1(array, i), "observablehq--index");
	    }
	  }
	  for (const key in array) {
	    if (!isindex(key) && isown(array, key)) {
	      yield formatField$1(key, valueof$1(array, key), "observablehq--key");
	    }
	  }
	  for (const symbol of symbolsof(array)) {
	    yield formatField$1(
	      formatSymbol(symbol),
	      valueof$1(array, symbol),
	      "observablehq--symbol"
	    );
	  }
	}

	function* iterateImArray$1(array) {
	  let i1 = 0;
	  for (const n = array.size; i1 < n; ++i1) {
	    yield formatField$1(i1, array.get(i1), true);
	  }
	}

	function* iterateProto(object) {
	  for (const key in getOwnPropertyDescriptors(object)) {
	    yield formatField$1(key, valueof$1(object, key), "observablehq--key");
	  }
	  for (const symbol of symbolsof(object)) {
	    yield formatField$1(
	      formatSymbol(symbol),
	      valueof$1(object, symbol),
	      "observablehq--symbol"
	    );
	  }

	  const proto = getPrototypeOf(object);
	  if (proto && proto !== objectPrototype) {
	    yield formatPrototype(proto);
	  }
	}

	function* iterateObject$1(object) {
	  for (const key in object) {
	    if (isown(object, key)) {
	      yield formatField$1(key, valueof$1(object, key), "observablehq--key");
	    }
	  }
	  for (const symbol of symbolsof(object)) {
	    yield formatField$1(
	      formatSymbol(symbol),
	      valueof$1(object, symbol),
	      "observablehq--symbol"
	    );
	  }

	  const proto = getPrototypeOf(object);
	  if (proto && proto !== objectPrototype) {
	    yield formatPrototype(proto);
	  }
	}

	function* iterateImObject$1(object) {
	  for (const [key, value] of object) {
	    yield formatField$1(key, value, "observablehq--key");
	  }
	}

	function formatPrototype(value) {
	  const item = document.createElement("div");
	  const span = item.appendChild(document.createElement("span"));
	  item.className = "observablehq--field";
	  span.className = "observablehq--prototype-key";
	  span.textContent = `  <prototype>`;
	  item.appendChild(document.createTextNode(": "));
	  item.appendChild(inspect(value, undefined, undefined, undefined, true));
	  return item;
	}

	function formatField$1(key, value, className) {
	  const item = document.createElement("div");
	  const span = item.appendChild(document.createElement("span"));
	  item.className = "observablehq--field";
	  span.className = className;
	  span.textContent = `  ${key}`;
	  item.appendChild(document.createTextNode(": "));
	  item.appendChild(inspect(value));
	  return item;
	}

	function formatMapField$1(key, value) {
	  const item = document.createElement("div");
	  item.className = "observablehq--field";
	  item.appendChild(document.createTextNode("  "));
	  item.appendChild(inspect(key));
	  item.appendChild(document.createTextNode(" => "));
	  item.appendChild(inspect(value));
	  return item;
	}

	function formatSetField(value) {
	  const item = document.createElement("div");
	  item.className = "observablehq--field";
	  item.appendChild(document.createTextNode("  "));
	  item.appendChild(inspect(value));
	  return item;
	}

	function hasSelection(elem) {
	  const sel = window.getSelection();
	  return (
	    sel.type === "Range" &&
	    (sel.containsNode(elem, true) ||
	      sel.anchorNode.isSelfOrDescendant(elem) ||
	      sel.focusNode.isSelfOrDescendant(elem))
	  );
	}

	function inspectCollapsed(object, shallow, name, proto) {
	  let arrayish = isarray(object);
	  let tag, fields, next, n;

	  if (object instanceof Map) {
	    if (object instanceof object.constructor) {
	      tag = `Map(${object.size})`;
	      fields = iterateMap;
	    } else { // avoid incompatible receiver error for prototype
	      tag = "Map()";
	      fields = iterateObject;
	    }
	  } else if (object instanceof Set) {
	    if (object instanceof object.constructor) {
	      tag = `Set(${object.size})`;
	      fields = iterateSet;
	    } else { // avoid incompatible receiver error for prototype
	      tag = "Set()";
	      fields = iterateObject;
	    }
	  } else if (arrayish) {
	    tag = `${object.constructor.name}(${object.length})`;
	    fields = iterateArray;
	  } else if ((n = immutableName(object))) {
	    tag = `Immutable.${n.name}${n.name === 'Record' ? '' : `(${object.size})`}`;
	    arrayish = n.arrayish;
	    fields = n.arrayish ? iterateImArray : n.setish ? iterateImSet : iterateImObject;
	  } else {
	    tag = tagof(object);
	    fields = iterateObject;
	  }

	  if (shallow) {
	    const span = document.createElement("span");
	    span.className = "observablehq--shallow";
	    if (name) {
	      span.appendChild(inspectName(name));
	    }
	    span.appendChild(document.createTextNode(tag));
	    span.addEventListener("mouseup", function(event) {
	      if (hasSelection(span)) return;
	      event.stopPropagation();
	      replace(span, inspectCollapsed(object));
	    });
	    return span;
	  }

	  const span = document.createElement("span");
	  span.className = "observablehq--collapsed";
	  if (name) {
	    span.appendChild(inspectName(name));
	  }
	  const a = span.appendChild(document.createElement("a"));
	  a.innerHTML = `<svg width=8 height=8 class='observablehq--caret'>
    <path d='M7 4L1 8V0z' fill='currentColor' />
  </svg>`;
	  a.appendChild(document.createTextNode(`${tag}${arrayish ? " [" : " {"}`));
	  span.addEventListener("mouseup", function(event) {
	    if (hasSelection(span)) return;
	    event.stopPropagation();
	    replace(span, inspectExpanded(object, null, name, proto));
	  }, true);

	  fields = fields(object);
	  for (let i = 0; !(next = fields.next()).done && i < 20; ++i) {
	    if (i > 0) span.appendChild(document.createTextNode(", "));
	    span.appendChild(next.value);
	  }

	  if (!next.done) span.appendChild(document.createTextNode(", â€¦"));
	  span.appendChild(document.createTextNode(arrayish ? "]" : "}"));

	  return span;
	}

	function* iterateMap(map) {
	  for (const [key, value] of map) {
	    yield formatMapField(key, value);
	  }
	  yield* iterateObject(map);
	}

	function* iterateSet(set) {
	  for (const value of set) {
	    yield inspect(value, true);
	  }
	  yield* iterateObject(set);
	}

	function* iterateImSet(set) {
	  for (const value of set) {
	    yield inspect(value, true);
	  }
	}

	function* iterateImArray(array) {
	  let i0 = -1, i1 = 0;
	  for (const n = array.size; i1 < n; ++i1) {
	    if (i1 > i0 + 1) yield formatEmpty(i1 - i0 - 1);
	    yield inspect(array.get(i1), true);
	    i0 = i1;
	  }
	  if (i1 > i0 + 1) yield formatEmpty(i1 - i0 - 1);
	}

	function* iterateArray(array) {
	  let i0 = -1, i1 = 0;
	  for (const n = array.length; i1 < n; ++i1) {
	    if (i1 in array) {
	      if (i1 > i0 + 1) yield formatEmpty(i1 - i0 - 1);
	      yield inspect(valueof$1(array, i1), true);
	      i0 = i1;
	    }
	  }
	  if (i1 > i0 + 1) yield formatEmpty(i1 - i0 - 1);
	  for (const key in array) {
	    if (!isindex(key) && isown(array, key)) {
	      yield formatField(key, valueof$1(array, key), "observablehq--key");
	    }
	  }
	  for (const symbol of symbolsof(array)) {
	    yield formatField(formatSymbol(symbol), valueof$1(array, symbol), "observablehq--symbol");
	  }
	}

	function* iterateObject(object) {
	  for (const key in object) {
	    if (isown(object, key)) {
	      yield formatField(key, valueof$1(object, key), "observablehq--key");
	    }
	  }
	  for (const symbol of symbolsof(object)) {
	    yield formatField(formatSymbol(symbol), valueof$1(object, symbol), "observablehq--symbol");
	  }
	}

	function* iterateImObject(object) {
	  for (const [key, value] of object) {
	    yield formatField(key, value, "observablehq--key");
	  }
	}

	function formatEmpty(e) {
	  const span = document.createElement("span");
	  span.className = "observablehq--empty";
	  span.textContent = e === 1 ? "empty" : `empty Ã— ${e}`;
	  return span;
	}

	function formatField(key, value, className) {
	  const fragment = document.createDocumentFragment();
	  const span = fragment.appendChild(document.createElement("span"));
	  span.className = className;
	  span.textContent = key;
	  fragment.appendChild(document.createTextNode(": "));
	  fragment.appendChild(inspect(value, true));
	  return fragment;
	}

	function formatMapField(key, value) {
	  const fragment = document.createDocumentFragment();
	  fragment.appendChild(inspect(key, true));
	  fragment.appendChild(document.createTextNode(" => "));
	  fragment.appendChild(inspect(value, true));
	  return fragment;
	}

	function format(date, fallback) {
	  if (!(date instanceof Date)) date = new Date(+date);
	  if (isNaN(date)) return typeof fallback === "function" ? fallback(date) : fallback;
	  const hours = date.getUTCHours();
	  const minutes = date.getUTCMinutes();
	  const seconds = date.getUTCSeconds();
	  const milliseconds = date.getUTCMilliseconds();
	  return `${formatYear$1(date.getUTCFullYear())}-${pad$1(date.getUTCMonth() + 1, 2)}-${pad$1(date.getUTCDate(), 2)}${
    hours || minutes || seconds || milliseconds ? `T${pad$1(hours, 2)}:${pad$1(minutes, 2)}${
      seconds || milliseconds ? `:${pad$1(seconds, 2)}${
        milliseconds ? `.${pad$1(milliseconds, 3)}` : ``
      }` : ``
    }Z` : ``
  }`;
	}

	function formatYear$1(year) {
	  return year < 0 ? `-${pad$1(-year, 6)}`
	    : year > 9999 ? `+${pad$1(year, 6)}`
	    : pad$1(year, 4);
	}

	function pad$1(value, width) {
	  return `${value}`.padStart(width, "0");
	}

	function formatDate$2(date) {
	  return format(date, "Invalid Date");
	}

	var errorToString = Error.prototype.toString;

	function formatError(value) {
	  return value.stack || errorToString.call(value);
	}

	var regExpToString = RegExp.prototype.toString;

	function formatRegExp(value) {
	  return regExpToString.call(value);
	}

	/* eslint-disable no-control-regex */
	const NEWLINE_LIMIT = 20;

	function formatString(string, shallow, expanded, name) {
	  if (shallow === false) {
	    // String has fewer escapes displayed with double quotes
	    if (count$1(string, /["\n]/g) <= count$1(string, /`|\${/g)) {
	      const span = document.createElement("span");
	      if (name) span.appendChild(inspectName(name));
	      const textValue = span.appendChild(document.createElement("span"));
	      textValue.className = "observablehq--string";
	      textValue.textContent = JSON.stringify(string);
	      return span;
	    }
	    const lines = string.split("\n");
	    if (lines.length > NEWLINE_LIMIT && !expanded) {
	      const div = document.createElement("div");
	      if (name) div.appendChild(inspectName(name));
	      const textValue = div.appendChild(document.createElement("span"));
	      textValue.className = "observablehq--string";
	      textValue.textContent = "`" + templatify(lines.slice(0, NEWLINE_LIMIT).join("\n"));
	      const splitter = div.appendChild(document.createElement("span"));
	      const truncatedCount = lines.length - NEWLINE_LIMIT;
	      splitter.textContent = `Show ${truncatedCount} truncated line${truncatedCount > 1 ? "s": ""}`; splitter.className = "observablehq--string-expand";
	      splitter.addEventListener("mouseup", function (event) {
	        event.stopPropagation();
	        replace(div, inspect(string, shallow, true, name));
	      });
	      return div;
	    }
	    const span = document.createElement("span");
	    if (name) span.appendChild(inspectName(name));
	    const textValue = span.appendChild(document.createElement("span"));
	    textValue.className = `observablehq--string${expanded ? " observablehq--expanded" : ""}`;
	    textValue.textContent = "`" + templatify(string) + "`";
	    return span;
	  }

	  const span = document.createElement("span");
	  if (name) span.appendChild(inspectName(name));
	  const textValue = span.appendChild(document.createElement("span"));
	  textValue.className = "observablehq--string";
	  textValue.textContent = JSON.stringify(string.length > 100 ?
	    `${string.slice(0, 50)}â€¦${string.slice(-49)}` : string);
	  return span;
	}

	function templatify(string) {
	  return string.replace(/[\\`\x00-\x09\x0b-\x19]|\${/g, templatifyChar);
	}

	function templatifyChar(char) {
	  var code = char.charCodeAt(0);
	  switch (code) {
	    case 0x8: return "\\b";
	    case 0x9: return "\\t";
	    case 0xb: return "\\v";
	    case 0xc: return "\\f";
	    case 0xd: return "\\r";
	  }
	  return code < 0x10 ? "\\x0" + code.toString(16)
	      : code < 0x20 ? "\\x" + code.toString(16)
	      : "\\" + char;
	}

	function count$1(string, re) {
	  var n = 0;
	  while (re.exec(string)) ++n;
	  return n;
	}

	var toString$1 = Function.prototype.toString,
	    TYPE_ASYNC = {prefix: "async Æ’"},
	    TYPE_ASYNC_GENERATOR = {prefix: "async Æ’*"},
	    TYPE_CLASS = {prefix: "class"},
	    TYPE_FUNCTION = {prefix: "Æ’"},
	    TYPE_GENERATOR = {prefix: "Æ’*"};

	function inspectFunction(f, name) {
	  var type, m, t = toString$1.call(f);

	  switch (f.constructor && f.constructor.name) {
	    case "AsyncFunction": type = TYPE_ASYNC; break;
	    case "AsyncGeneratorFunction": type = TYPE_ASYNC_GENERATOR; break;
	    case "GeneratorFunction": type = TYPE_GENERATOR; break;
	    default: type = /^class\b/.test(t) ? TYPE_CLASS : TYPE_FUNCTION; break;
	  }

	  // A class, possibly named.
	  // class Name
	  if (type === TYPE_CLASS) {
	    return formatFunction(type, "", name);
	  }

	  // An arrow function with a single argument.
	  // foo =>
	  // async foo =>
	  if ((m = /^(?:async\s*)?(\w+)\s*=>/.exec(t))) {
	    return formatFunction(type, "(" + m[1] + ")", name);
	  }

	  // An arrow function with parenthesized arguments.
	  // (â€¦)
	  // async (â€¦)
	  if ((m = /^(?:async\s*)?\(\s*(\w+(?:\s*,\s*\w+)*)?\s*\)/.exec(t))) {
	    return formatFunction(type, m[1] ? "(" + m[1].replace(/\s*,\s*/g, ", ") + ")" : "()", name);
	  }

	  // A function, possibly: async, generator, anonymous, simply arguments.
	  // function name(â€¦)
	  // function* name(â€¦)
	  // async function name(â€¦)
	  // async function* name(â€¦)
	  if ((m = /^(?:async\s*)?function(?:\s*\*)?(?:\s*\w+)?\s*\(\s*(\w+(?:\s*,\s*\w+)*)?\s*\)/.exec(t))) {
	    return formatFunction(type, m[1] ? "(" + m[1].replace(/\s*,\s*/g, ", ") + ")" : "()", name);
	  }

	  // Something else, like destructuring, comments or default values.
	  return formatFunction(type, "(â€¦)", name);
	}

	function formatFunction(type, args, cellname) {
	  var span = document.createElement("span");
	  span.className = "observablehq--function";
	  if (cellname) {
	    span.appendChild(inspectName(cellname));
	  }
	  var spanType = span.appendChild(document.createElement("span"));
	  spanType.className = "observablehq--keyword";
	  spanType.textContent = type.prefix;
	  span.appendChild(document.createTextNode(args));
	  return span;
	}

	const {prototype: {toString}} = Object;

	function inspect(value, shallow, expand, name, proto) {
	  let type = typeof value;
	  switch (type) {
	    case "boolean":
	    case "undefined": { value += ""; break; }
	    case "number": { value = value === 0 && 1 / value < 0 ? "-0" : value + ""; break; }
	    case "bigint": { value = value + "n"; break; }
	    case "symbol": { value = formatSymbol(value); break; }
	    case "function": { return inspectFunction(value, name); }
	    case "string": { return formatString(value, shallow, expand, name); }
	    default: {
	      if (value === null) { type = null, value = "null"; break; }
	      if (value instanceof Date) { type = "date", value = formatDate$2(value); break; }
	      if (value === FORBIDDEN) { type = "forbidden", value = "[forbidden]"; break; }
	      switch (toString.call(value)) {
	        case "[object RegExp]": { type = "regexp", value = formatRegExp(value); break; }
	        case "[object Error]": // https://github.com/lodash/lodash/blob/master/isError.js#L26
	        case "[object DOMException]": { type = "error", value = formatError(value); break; }
	        default: return (expand ? inspectExpanded : inspectCollapsed)(value, shallow, name, proto);
	      }
	      break;
	    }
	  }
	  const span = document.createElement("span");
	  if (name) span.appendChild(inspectName(name));
	  const n = span.appendChild(document.createElement("span"));
	  n.className = `observablehq--${type}`;
	  n.textContent = value;
	  return span;
	}

	function replace(spanOld, spanNew) {
	  if (spanOld.classList.contains("observablehq--inspect")) spanNew.classList.add("observablehq--inspect");
	  spanOld.parentNode.replaceChild(spanNew, spanOld);
	  dispatch(spanNew, "load");
	}

	const LOCATION_MATCH = /\s+\(\d+:\d+\)$/m;

	class Inspector {
	  constructor(node) {
	    if (!node) throw new Error("invalid node");
	    this._node = node;
	    node.classList.add("observablehq");
	  }
	  pending() {
	    const {_node} = this;
	    _node.classList.remove("observablehq--error");
	    _node.classList.add("observablehq--running");
	  }
	  fulfilled(value, name) {
	    const {_node} = this;
	    if (!isnode(value) || (value.parentNode && value.parentNode !== _node)) {
	      value = inspect(value, false, _node.firstChild // TODO Do this better.
	          && _node.firstChild.classList
	          && _node.firstChild.classList.contains("observablehq--expanded"), name);
	      value.classList.add("observablehq--inspect");
	    }
	    _node.classList.remove("observablehq--running", "observablehq--error");
	    if (_node.firstChild !== value) {
	      if (_node.firstChild) {
	        while (_node.lastChild !== _node.firstChild) _node.removeChild(_node.lastChild);
	        _node.replaceChild(value, _node.firstChild);
	      } else {
	        _node.appendChild(value);
	      }
	    }
	    dispatch(_node, "update");
	  }
	  rejected(error, name) {
	    const {_node} = this;
	    _node.classList.remove("observablehq--running");
	    _node.classList.add("observablehq--error");
	    while (_node.lastChild) _node.removeChild(_node.lastChild);
	    var div = document.createElement("div");
	    div.className = "observablehq--inspect";
	    if (name) div.appendChild(inspectName(name));
	    div.appendChild(document.createTextNode((error + "").replace(LOCATION_MATCH, "")));
	    _node.appendChild(div);
	    dispatch(_node, "error", {error: error});
	  }
	}

	Inspector.into = function(container) {
	  if (typeof container === "string") {
	    container = document.querySelector(container);
	    if (container == null) throw new Error("container not found");
	  }
	  return function() {
	    return new Inspector(container.appendChild(document.createElement("div")));
	  };
	};

	// Returns true if the given value is something that should be added to the DOM
	// by the inspector, rather than being inspected. This deliberately excludes
	// DocumentFragment since appending a fragment â€œdissolvesâ€ (mutates) the
	// fragment, and we wish for the inspector to not have side-effects. Also,
	// HTMLElement.prototype is an instanceof Element, but not an element!
	function isnode(value) {
	  return (value instanceof Element || value instanceof Text)
	      && (value instanceof value.constructor);
	}

	var EOL = {},
	    EOF = {},
	    QUOTE = 34,
	    NEWLINE = 10,
	    RETURN = 13;

	function objectConverter(columns) {
	  return new Function("d", "return {" + columns.map(function(name, i) {
	    return JSON.stringify(name) + ": d[" + i + "] || \"\"";
	  }).join(",") + "}");
	}

	function customConverter(columns, f) {
	  var object = objectConverter(columns);
	  return function(row, i) {
	    return f(object(row), i, columns);
	  };
	}

	// Compute unique columns in order of discovery.
	function inferColumns(rows) {
	  var columnSet = Object.create(null),
	      columns = [];

	  rows.forEach(function(row) {
	    for (var column in row) {
	      if (!(column in columnSet)) {
	        columns.push(columnSet[column] = column);
	      }
	    }
	  });

	  return columns;
	}

	function pad(value, width) {
	  var s = value + "", length = s.length;
	  return length < width ? new Array(width - length + 1).join(0) + s : s;
	}

	function formatYear(year) {
	  return year < 0 ? "-" + pad(-year, 6)
	    : year > 9999 ? "+" + pad(year, 6)
	    : pad(year, 4);
	}

	function formatDate$1(date) {
	  var hours = date.getUTCHours(),
	      minutes = date.getUTCMinutes(),
	      seconds = date.getUTCSeconds(),
	      milliseconds = date.getUTCMilliseconds();
	  return isNaN(date) ? "Invalid Date"
	      : formatYear(date.getUTCFullYear()) + "-" + pad(date.getUTCMonth() + 1, 2) + "-" + pad(date.getUTCDate(), 2)
	      + (milliseconds ? "T" + pad(hours, 2) + ":" + pad(minutes, 2) + ":" + pad(seconds, 2) + "." + pad(milliseconds, 3) + "Z"
	      : seconds ? "T" + pad(hours, 2) + ":" + pad(minutes, 2) + ":" + pad(seconds, 2) + "Z"
	      : minutes || hours ? "T" + pad(hours, 2) + ":" + pad(minutes, 2) + "Z"
	      : "");
	}

	function dsv$1(delimiter) {
	  var reFormat = new RegExp("[\"" + delimiter + "\n\r]"),
	      DELIMITER = delimiter.charCodeAt(0);

	  function parse(text, f) {
	    var convert, columns, rows = parseRows(text, function(row, i) {
	      if (convert) return convert(row, i - 1);
	      columns = row, convert = f ? customConverter(row, f) : objectConverter(row);
	    });
	    rows.columns = columns || [];
	    return rows;
	  }

	  function parseRows(text, f) {
	    var rows = [], // output rows
	        N = text.length,
	        I = 0, // current character index
	        n = 0, // current line number
	        t, // current token
	        eof = N <= 0, // current token followed by EOF?
	        eol = false; // current token followed by EOL?

	    // Strip the trailing newline.
	    if (text.charCodeAt(N - 1) === NEWLINE) --N;
	    if (text.charCodeAt(N - 1) === RETURN) --N;

	    function token() {
	      if (eof) return EOF;
	      if (eol) return eol = false, EOL;

	      // Unescape quotes.
	      var i, j = I, c;
	      if (text.charCodeAt(j) === QUOTE) {
	        while (I++ < N && text.charCodeAt(I) !== QUOTE || text.charCodeAt(++I) === QUOTE);
	        if ((i = I) >= N) eof = true;
	        else if ((c = text.charCodeAt(I++)) === NEWLINE) eol = true;
	        else if (c === RETURN) { eol = true; if (text.charCodeAt(I) === NEWLINE) ++I; }
	        return text.slice(j + 1, i - 1).replace(/""/g, "\"");
	      }

	      // Find next delimiter or newline.
	      while (I < N) {
	        if ((c = text.charCodeAt(i = I++)) === NEWLINE) eol = true;
	        else if (c === RETURN) { eol = true; if (text.charCodeAt(I) === NEWLINE) ++I; }
	        else if (c !== DELIMITER) continue;
	        return text.slice(j, i);
	      }

	      // Return last token before EOF.
	      return eof = true, text.slice(j, N);
	    }

	    while ((t = token()) !== EOF) {
	      var row = [];
	      while (t !== EOL && t !== EOF) row.push(t), t = token();
	      if (f && (row = f(row, n++)) == null) continue;
	      rows.push(row);
	    }

	    return rows;
	  }

	  function preformatBody(rows, columns) {
	    return rows.map(function(row) {
	      return columns.map(function(column) {
	        return formatValue(row[column]);
	      }).join(delimiter);
	    });
	  }

	  function format(rows, columns) {
	    if (columns == null) columns = inferColumns(rows);
	    return [columns.map(formatValue).join(delimiter)].concat(preformatBody(rows, columns)).join("\n");
	  }

	  function formatBody(rows, columns) {
	    if (columns == null) columns = inferColumns(rows);
	    return preformatBody(rows, columns).join("\n");
	  }

	  function formatRows(rows) {
	    return rows.map(formatRow).join("\n");
	  }

	  function formatRow(row) {
	    return row.map(formatValue).join(delimiter);
	  }

	  function formatValue(value) {
	    return value == null ? ""
	        : value instanceof Date ? formatDate$1(value)
	        : reFormat.test(value += "") ? "\"" + value.replace(/"/g, "\"\"") + "\""
	        : value;
	  }

	  return {
	    parse: parse,
	    parseRows: parseRows,
	    format: format,
	    formatBody: formatBody,
	    formatRows: formatRows,
	    formatRow: formatRow,
	    formatValue: formatValue
	  };
	}

	var csv = dsv$1(",");

	var csvParse = csv.parse;
	var csvParseRows = csv.parseRows;

	var tsv = dsv$1("\t");

	var tsvParse = tsv.parse;
	var tsvParseRows = tsv.parseRows;

	function autoType(object) {
	  for (var key in object) {
	    var value = object[key].trim(), number, m;
	    if (!value) value = null;
	    else if (value === "true") value = true;
	    else if (value === "false") value = false;
	    else if (value === "NaN") value = NaN;
	    else if (!isNaN(number = +value)) value = number;
	    else if (m = value.match(/^([-+]\d{2})?\d{4}(-\d{2}(-\d{2})?)?(T\d{2}:\d{2}(:\d{2}(\.\d{3})?)?(Z|[-+]\d{2}:\d{2})?)?$/)) {
	      if (fixtz && !!m[4] && !m[7]) value = value.replace(/-/g, "/").replace(/T/, " ");
	      value = new Date(value);
	    }
	    else continue;
	    object[key] = value;
	  }
	  return object;
	}

	// https://github.com/d3/d3-dsv/issues/45
	const fixtz = new Date("2019-01-01T00:00").getHours() || new Date("2019-07-01T00:00").getHours();

	function dependency(name, version, main) {
	  return {
	    resolve(path = main) {
	      return `${name}@${version}/${path}`;
	    }
	  };
	}

	const d3 = dependency("d3", "7.8.5", "dist/d3.min.js");
	const inputs = dependency("@observablehq/inputs", "0.10.6", "dist/inputs.min.js");
	const plot = dependency("@observablehq/plot", "0.6.11", "dist/plot.umd.min.js");
	const graphviz = dependency("@observablehq/graphviz", "0.2.1", "dist/graphviz.min.js");
	const highlight = dependency("@observablehq/highlight.js", "2.0.0", "highlight.min.js");
	const katex = dependency("@observablehq/katex", "0.11.1", "dist/katex.min.js");
	const lodash = dependency("lodash", "4.17.21", "lodash.min.js");
	const htl = dependency("htl", "0.3.1", "dist/htl.min.js");
	const jszip = dependency("jszip", "3.10.1", "dist/jszip.min.js");
	const marked = dependency("marked", "0.3.12", "marked.min.js");
	const sql = dependency("sql.js", "1.8.0", "dist/sql-wasm.js");
	const vega = dependency("vega", "5.22.1", "build/vega.min.js");
	const vegalite = dependency("vega-lite", "5.6.0", "build/vega-lite.min.js");
	const vegaliteApi = dependency("vega-lite-api", "5.0.0", "build/vega-lite-api.min.js");
	const arrow4 = dependency("apache-arrow", "4.0.1", "Arrow.es2015.min.js");
	const arrow9 = dependency("apache-arrow", "9.0.0", "+esm");
	const arrow11 = dependency("apache-arrow", "11.0.0", "+esm");
	const arquero = dependency("arquero", "4.8.8", "dist/arquero.min.js");
	const topojson = dependency("topojson-client", "3.1.0", "dist/topojson-client.min.js");
	const exceljs = dependency("exceljs", "4.3.0", "dist/exceljs.min.js");
	const mermaid$1 = dependency("mermaid", "9.2.2", "dist/mermaid.min.js");
	const leaflet$1 = dependency("leaflet", "1.9.3", "dist/leaflet.js");
	const duckdb = dependency("@duckdb/duckdb-wasm", "1.24.0", "+esm");

	const metas = new Map;
	const queue$1 = [];
	const map$2 = queue$1.map;
	const some = queue$1.some;
	const hasOwnProperty = queue$1.hasOwnProperty;
	const identifierRe = /^((?:@[^/@]+\/)?[^/@]+)(?:@([^/]+))?(?:\/(.*))?$/;
	const versionRe = /^\d+\.\d+\.\d+(-[\w-.+]+)?$/;
	const extensionRe = /(?:\.[^/]*|\/)$/;

	class RequireError extends Error {
	  constructor(message) {
	    super(message);
	  }
	}

	RequireError.prototype.name = RequireError.name;

	function parseIdentifier(identifier) {
	  const match = identifierRe.exec(identifier);
	  return match && {
	    name: match[1],
	    version: match[2],
	    path: match[3]
	  };
	}

	function resolveFrom(origin = "https://cdn.jsdelivr.net/npm/", mains = ["unpkg", "jsdelivr", "browser", "main"]) {
	  if (!/\/$/.test(origin)) throw new Error("origin lacks trailing slash");

	  function main(meta) {
	    for (const key of mains) {
	      let value = meta[key];
	      if (typeof value === "string") {
	        if (value.startsWith("./")) value = value.slice(2);
	        return extensionRe.test(value) ? value : `${value}.js`;
	      }
	    }
	  }

	  function resolveMeta(target) {
	    const url = `${origin}${target.name}${target.version ? `@${target.version}` : ""}/package.json`;
	    let meta = metas.get(url);
	    if (!meta) metas.set(url, meta = fetch(url).then(response => {
	      if (!response.ok) throw new RequireError("unable to load package.json");
	      if (response.redirected && !metas.has(response.url)) metas.set(response.url, meta);
	      return response.json();
	    }));
	    return meta;
	  }

	  return async function resolve(name, base) {
	    if (name.startsWith(origin)) name = name.substring(origin.length);
	    if (/^(\w+:)|\/\//i.test(name)) return name;
	    if (/^[.]{0,2}\//i.test(name)) return new URL(name, base == null ? location : base).href;
	    if (!name.length || /^[\s._]/.test(name) || /\s$/.test(name)) throw new RequireError("illegal name");
	    const target = parseIdentifier(name);
	    if (!target) return `${origin}${name}`;
	    if (!target.version && base != null && base.startsWith(origin)) {
	      const meta = await resolveMeta(parseIdentifier(base.substring(origin.length)));
	      target.version = meta.dependencies && meta.dependencies[target.name] || meta.peerDependencies && meta.peerDependencies[target.name];
	    }
	    if (target.path && !extensionRe.test(target.path)) target.path += ".js";
	    if (target.path && target.version && versionRe.test(target.version)) return `${origin}${target.name}@${target.version}/${target.path}`;
	    const meta = await resolveMeta(target);
	    return `${origin}${meta.name}@${meta.version}/${target.path || main(meta) || "index.js"}`;
	  };
	}

	var require = requireFrom(resolveFrom());

	function requireFrom(resolver) {
	  const cache = new Map;
	  const requireBase = requireRelative(null);

	  function requireAbsolute(url) {
	    if (typeof url !== "string") return url;
	    let module = cache.get(url);
	    if (!module) cache.set(url, module = new Promise((resolve, reject) => {
	      const script = document.createElement("script");
	      script.onload = () => {
	        try { resolve(queue$1.pop()(requireRelative(url))); }
	        catch (error) { reject(new RequireError("invalid module")); }
	        script.remove();
	      };
	      script.onerror = () => {
	        reject(new RequireError("unable to load module"));
	        script.remove();
	      };
	      script.async = true;
	      script.src = url;
	      window.define = define$2;
	      document.head.appendChild(script);
	    }));
	    return module;
	  }

	  function requireRelative(base) {
	    return name => Promise.resolve(resolver(name, base)).then(requireAbsolute);
	  }

	  function requireAlias(aliases) {
	    return requireFrom((name, base) => {
	      if (name in aliases) {
	        name = aliases[name], base = null;
	        if (typeof name !== "string") return name;
	      }
	      return resolver(name, base);
	    });
	  }

	  function require(name) {
	    return arguments.length > 1
	        ? Promise.all(map$2.call(arguments, requireBase)).then(merge)
	        : requireBase(name);
	  }

	  require.alias = requireAlias;
	  require.resolve = resolver;

	  return require;
	}

	function merge(modules) {
	  const o = {};
	  for (const m of modules) {
	    for (const k in m) {
	      if (hasOwnProperty.call(m, k)) {
	        if (m[k] == null) Object.defineProperty(o, k, {get: getter(m, k)});
	        else o[k] = m[k];
	      }
	    }
	  }
	  return o;
	}

	function getter(object, name) {
	  return () => object[name];
	}

	function isbuiltin(name) {
	  name = name + "";
	  return name === "exports" || name === "module";
	}

	function define$2(name, dependencies, factory) {
	  const n = arguments.length;
	  if (n < 2) factory = name, dependencies = [];
	  else if (n < 3) factory = dependencies, dependencies = typeof name === "string" ? [] : name;
	  queue$1.push(some.call(dependencies, isbuiltin) ? require => {
	    const exports = {};
	    const module = {exports};
	    return Promise.all(map$2.call(dependencies, name => {
	      name = name + "";
	      return name === "exports" ? exports : name === "module" ? module : require(name);
	    })).then(dependencies => {
	      factory.apply(null, dependencies);
	      return module.exports;
	    });
	  } : require => {
	    return Promise.all(map$2.call(dependencies, require)).then(dependencies => {
	      return typeof factory === "function" ? factory.apply(null, dependencies) : factory;
	    });
	  });
	}

	define$2.amd = {};

	// TODO Allow this to be overridden using the Libraryâ€™s resolver.
	const cdn = "https://cdn.observableusercontent.com/npm/";

	let requireDefault = require;

	function setDefaultRequire(require) {
	  requireDefault = require;
	}

	function requirer(resolver) {
	  return resolver == null ? requireDefault : requireFrom(resolver);
	}

	async function SQLite(require) {
	  const [init, dist] = await Promise.all([require(sql.resolve()), require.resolve(sql.resolve("dist/"))]);
	  return init({locateFile: file => `${dist}${file}`});
	}

	class SQLiteDatabaseClient {
	  constructor(db) {
	    Object.defineProperties(this, {
	      _db: {value: db}
	    });
	  }
	  static async open(source) {
	    const [SQL, buffer] = await Promise.all([SQLite(requireDefault), Promise.resolve(source).then(load)]);
	    return new SQLiteDatabaseClient(new SQL.Database(buffer));
	  }
	  async query(query, params) {
	    return await exec(this._db, query, params);
	  }
	  async queryRow(query, params) {
	    return (await this.query(query, params))[0] || null;
	  }
	  async explain(query, params) {
	    const rows = await this.query(`EXPLAIN QUERY PLAN ${query}`, params);
	    return element$1("pre", {className: "observablehq--inspect"}, [
	      text$2(rows.map(row => row.detail).join("\n"))
	    ]);
	  }
	  async describeTables({schema} = {}) {
	    return this.query(`SELECT NULLIF(schema, 'main') AS schema, name FROM pragma_table_list() WHERE type = 'table'${schema == null ? "" : ` AND schema = ?`} AND name NOT LIKE 'sqlite_%' ORDER BY schema, name`, schema == null ? [] : [schema]);
	  }
	  async describeColumns({schema, table} = {}) {
	    if (table == null) throw new Error(`missing table`);
	    const rows = await this.query(`SELECT name, type, "notnull" FROM pragma_table_info(?${schema == null ? "" : `, ?`}) ORDER BY cid`, schema == null ? [table] : [table, schema]);
	    if (!rows.length) throw new Error(`table not found: ${table}`);
	    return rows.map(({name, type, notnull}) => ({name, type: sqliteType(type), databaseType: type, nullable: !notnull}));
	  }
	  async describe(object) {
	    const rows = await (object === undefined
	      ? this.query(`SELECT name FROM sqlite_master WHERE type = 'table'`)
	      : this.query(`SELECT * FROM pragma_table_info(?)`, [object]));
	    if (!rows.length) throw new Error("Not found");
	    const {columns} = rows;
	    return element$1("table", {value: rows}, [
	      element$1("thead", [element$1("tr", columns.map(c => element$1("th", [text$2(c)])))]),
	      element$1("tbody", rows.map(r => element$1("tr", columns.map(c => element$1("td", [text$2(r[c])])))))
	    ]);
	  }
	  async sql() {
	    return this.query(...this.queryTag.apply(this, arguments));
	  }
	  queryTag(strings, ...params) {
	    return [strings.join("?"), params];
	  }
	}

	Object.defineProperty(SQLiteDatabaseClient.prototype, "dialect", {
	  value: "sqlite"
	});

	// https://www.sqlite.org/datatype3.html
	function sqliteType(type) {
	  switch (type) {
	    case "NULL":
	      return "null";
	    case "INT":
	    case "INTEGER":
	    case "TINYINT":
	    case "SMALLINT":
	    case "MEDIUMINT":
	    case "BIGINT":
	    case "UNSIGNED BIG INT":
	    case "INT2":
	    case "INT8":
	      return "integer";
	    case "TEXT":
	    case "CLOB":
	      return "string";
	    case "REAL":
	    case "DOUBLE":
	    case "DOUBLE PRECISION":
	    case "FLOAT":
	    case "NUMERIC":
	      return "number";
	    case "BLOB":
	      return "buffer";
	    case "DATE":
	    case "DATETIME":
	      return "string"; // TODO convert strings to Date instances in sql.js
	    default:
	      return /^(?:(?:(?:VARYING|NATIVE) )?CHARACTER|(?:N|VAR|NVAR)CHAR)\(/.test(type) ? "string"
	        : /^(?:DECIMAL|NUMERIC)\(/.test(type) ? "number"
	        : "other";
	  }
	}

	function load(source) {
	  return typeof source === "string" ? fetch(source).then(load)
	    : source instanceof Response || source instanceof Blob ? source.arrayBuffer().then(load)
	    : source instanceof ArrayBuffer ? new Uint8Array(source)
	    : source;
	}

	async function exec(db, query, params) {
	  const [result] = await db.exec(query, params);
	  if (!result) return [];
	  const {columns, values} = result;
	  const rows = values.map(row => Object.fromEntries(row.map((value, i) => [columns[i], value])));
	  rows.columns = columns;
	  return rows;
	}

	function element$1(name, props, children) {
	  if (arguments.length === 2) children = props, props = undefined;
	  const element = document.createElement(name);
	  if (props !== undefined) for (const p in props) element[p] = props[p];
	  if (children !== undefined) for (const c of children) element.appendChild(c);
	  return element;
	}

	function text$2(value) {
	  return document.createTextNode(value);
	}

	function ascending$1(a, b) {
	  return a == null || b == null ? NaN : a < b ? -1 : a > b ? 1 : a >= b ? 0 : NaN;
	}

	function greatest(values, compare = ascending$1) {
	  let max;
	  let defined = false;
	  if (compare.length === 1) {
	    let maxValue;
	    for (const element of values) {
	      const value = compare(element);
	      if (defined
	          ? ascending$1(value, maxValue) > 0
	          : ascending$1(value, value) === 0) {
	        max = element;
	        maxValue = value;
	        defined = true;
	      }
	    }
	  } else {
	    for (const value of values) {
	      if (defined
	          ? compare(value, max) > 0
	          : compare(value, value) === 0) {
	        max = value;
	        defined = true;
	      }
	    }
	  }
	  return max;
	}

	function reverse(values) {
	  if (typeof values[Symbol.iterator] !== "function") throw new TypeError("values is not iterable");
	  return Array.from(values).reverse();
	}

	function isArqueroTable(value) {
	  // Arquero tables have a `toArrowBuffer` function
	  return value && typeof value.toArrowBuffer === "function";
	}

	// Returns true if the vaue is an Apache Arrow table. This uses a â€œduckâ€ test
	// (instead of strict instanceof) because we want it to work with a range of
	// Apache Arrow versions at least 7.0.0 or above.
	// https://arrow.apache.org/docs/7.0/js/classes/Arrow_dom.Table.html
	function isArrowTable(value) {
	  return (
	    value &&
	    typeof value.getChild === "function" &&
	    typeof value.toArray === "function" &&
	    value.schema &&
	    Array.isArray(value.schema.fields)
	  );
	}

	function getArrowTableSchema(table) {
	  return table.schema.fields.map(getArrowFieldSchema);
	}

	function getArrowFieldSchema(field) {
	  return {
	    name: field.name,
	    type: getArrowType(field.type),
	    nullable: field.nullable,
	    databaseType: String(field.type)
	  };
	}

	// https://github.com/apache/arrow/blob/89f9a0948961f6e94f1ef5e4f310b707d22a3c11/js/src/enum.ts#L140-L141
	function getArrowType(type) {
	  switch (type.typeId) {
	    case 2: // Int
	      return "integer";
	    case 3: // Float
	    case 7: // Decimal
	      return "number";
	    case 4: // Binary
	    case 15: // FixedSizeBinary
	      return "buffer";
	    case 5: // Utf8
	      return "string";
	    case 6: // Bool
	      return "boolean";
	    case 8: // Date
	    case 9: // Time
	    case 10: // Timestamp
	      return "date";
	    case 12: // List
	    case 16: // FixedSizeList
	      return "array";
	    case 13: // Struct
	    case 14: // Union
	      return "object";
	    case 11: // Interval
	    case 17: // Map
	    default:
	      return "other";
	  }
	}

	async function loadArrow() {
	  return await import(`${cdn}${arrow11.resolve()}`);
	}

	// Adapted from https://observablehq.com/@cmudig/duckdb-client
	// Copyright 2021 CMU Data Interaction Group
	//
	// Redistribution and use in source and binary forms, with or without
	// modification, are permitted provided that the following conditions are met:
	//
	// 1. Redistributions of source code must retain the above copyright notice,
	//    this list of conditions and the following disclaimer.
	//
	// 2. Redistributions in binary form must reproduce the above copyright notice,
	//    this list of conditions and the following disclaimer in the documentation
	//    and/or other materials provided with the distribution.
	//
	// 3. Neither the name of the copyright holder nor the names of its contributors
	//    may be used to endorse or promote products derived from this software
	//    without specific prior written permission.
	//
	// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
	// AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
	// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
	// ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
	// LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
	// CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
	// SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
	// INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
	// CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
	// ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
	// POSSIBILITY OF SUCH DAMAGE.

	let promise;

	class DuckDBClient {
	  constructor(db) {
	    Object.defineProperties(this, {
	      _db: {value: db}
	    });
	  }

	  async queryStream(query, params) {
	    const connection = await this._db.connect();
	    let reader, batch;
	    try {
	      if (params?.length > 0) {
	        const statement = await connection.prepare(query);
	        reader = await statement.send(...params);
	      } else {
	        reader = await connection.send(query);
	      }
	      batch = await reader.next();
	      if (batch.done) throw new Error("missing first batch");
	    } catch (error) {
	      await connection.close();
	      throw error;
	    }
	    return {
	      schema: getArrowTableSchema(batch.value),
	      async *readRows() {
	        try {
	          while (!batch.done) {
	            yield batch.value.toArray();
	            batch = await reader.next();
	          }
	        } finally {
	          await connection.close();
	        }
	      }
	    };
	  }

	  async query(query, params) {
	    const result = await this.queryStream(query, params);
	    const results = [];
	    for await (const rows of result.readRows()) {
	      for (const row of rows) {
	        results.push(row);
	      }
	    }
	    results.schema = result.schema;
	    return results;
	  }

	  async queryRow(query, params) {
	    const result = await this.queryStream(query, params);
	    const reader = result.readRows();
	    try {
	      const {done, value} = await reader.next();
	      return done || !value.length ? null : value[0];
	    } finally {
	      await reader.return();
	    }
	  }

	  async sql(strings, ...args) {
	    return await this.query(strings.join("?"), args);
	  }

	  queryTag(strings, ...params) {
	    return [strings.join("?"), params];
	  }

	  escape(name) {
	    return `"${name}"`;
	  }

	  async describeTables() {
	    const tables = await this.query(`SHOW TABLES`);
	    return tables.map(({name}) => ({name}));
	  }

	  async describeColumns({table} = {}) {
	    const columns = await this.query(`DESCRIBE ${this.escape(table)}`);
	    return columns.map(({column_name, column_type, null: nullable}) => ({
	      name: column_name,
	      type: getDuckDBType(column_type),
	      nullable: nullable !== "NO",
	      databaseType: column_type
	    }));
	  }

	  static async of(sources = {}, config = {}) {
	    const db = await createDuckDB();
	    if (config.query?.castTimestampToDate === undefined) {
	      config = {...config, query: {...config.query, castTimestampToDate: true}};
	    }
	    if (config.query?.castBigIntToDouble === undefined) {
	      config = {...config, query: {...config.query, castBigIntToDouble: true}};
	    }
	    await db.open(config);
	    await Promise.all(
	      Object.entries(sources).map(async ([name, source]) => {
	        if (source instanceof FileAttachment) { // bare file
	          await insertFile(db, name, source);
	        } else if (isArrowTable(source)) { // bare arrow table
	          await insertArrowTable(db, name, source);
	        } else if (Array.isArray(source)) { // bare array of objects
	          await insertArray(db, name, source);
	        } else if (isArqueroTable(source)) {
	          await insertArqueroTable(db, name, source);
	        } else if ("data" in source) { // data + options
	          const {data, ...options} = source;
	          if (isArrowTable(data)) {
	            await insertArrowTable(db, name, data, options);
	          } else {
	            await insertArray(db, name, data, options);
	          }
	        } else if ("file" in source) { // file + options
	          const {file, ...options} = source;
	          await insertFile(db, name, file, options);
	        } else {
	          throw new Error(`invalid source: ${source}`);
	        }
	      })
	    );
	    return new DuckDBClient(db);
	  }
	}

	Object.defineProperty(DuckDBClient.prototype, "dialect", {
	  value: "duckdb"
	});

	async function insertFile(database, name, file, options) {
	  const url = await file.url();
	  if (url.startsWith("blob:")) {
	    const buffer = await file.arrayBuffer();
	    await database.registerFileBuffer(file.name, new Uint8Array(buffer));
	  } else {
	    await database.registerFileURL(file.name, url, 4); // duckdb.DuckDBDataProtocol.HTTP
	  }
	  const connection = await database.connect();
	  try {
	    switch (file.mimeType) {
	      case "text/csv":
	      case "text/tab-separated-values": {
	        return await connection.insertCSVFromPath(file.name, {
	          name,
	          schema: "main",
	          ...options
	        }).catch(async (error) => {
	          // If initial attempt to insert CSV resulted in a conversion
	          // error, try again, this time treating all columns as strings.
	          if (error.toString().includes("Could not convert")) {
	            return await insertUntypedCSV(connection, file, name);
	          }
	          throw error;
	        });
	      }
	      case "application/json":
	        return await connection.insertJSONFromPath(file.name, {
	          name,
	          schema: "main",
	          ...options
	        });
	      default:
	        if (/\.arrow$/i.test(file.name)) {
	          const buffer = new Uint8Array(await file.arrayBuffer());
	          return await connection.insertArrowFromIPCStream(buffer, {
	            name,
	            schema: "main",
	            ...options
	          });
	        }
	        if (/\.parquet$/i.test(file.name)) {
	          return await connection.query(
	            `CREATE VIEW '${name}' AS SELECT * FROM parquet_scan('${file.name}')`
	          );
	        }
	        throw new Error(`unknown file type: ${file.mimeType}`);
	    }
	  } finally {
	    await connection.close();
	  }
	}

	async function insertUntypedCSV(connection, file, name) {
	  const statement = await connection.prepare(
	    `CREATE TABLE '${name}' AS SELECT * FROM read_csv_auto(?, ALL_VARCHAR=TRUE)`
	  );
	  return await statement.send(file.name);
	}

	async function insertArrowTable(database, name, table, options) {
	  const connection = await database.connect();
	  try {
	    await connection.insertArrowTable(table, {
	      name,
	      schema: "main",
	      ...options
	    });
	  } finally {
	    await connection.close();
	  }
	}

	async function insertArqueroTable(database, name, source) {
	  // TODO When we have stdlib versioning and can upgrade Arquero to version 5,
	  // we can then call source.toArrow() directly, with insertArrowTable()
	  const arrow = await loadArrow();
	  const table = arrow.tableFromIPC(source.toArrowBuffer());
	  return await insertArrowTable(database, name, table);
	}

	async function insertArray(database, name, array, options) {
	  const arrow = await loadArrow();
	  const table = arrow.tableFromJSON(array);
	  return await insertArrowTable(database, name, table, options);
	}

	async function loadDuckDB() {
	  const module = await import(`${cdn}${duckdb.resolve()}`);
	  const bundle = await module.selectBundle({
	    mvp: {
	      mainModule: `${cdn}${duckdb.resolve("dist/duckdb-mvp.wasm")}`,
	      mainWorker: `${cdn}${duckdb.resolve("dist/duckdb-browser-mvp.worker.js")}`
	    },
	    eh: {
	      mainModule: `${cdn}${duckdb.resolve("dist/duckdb-eh.wasm")}`,
	      mainWorker: `${cdn}${duckdb.resolve("dist/duckdb-browser-eh.worker.js")}`
	    }
	  });
	  const logger = new module.ConsoleLogger();
	  return {module, bundle, logger};
	}

	async function createDuckDB() {
	  if (promise === undefined) promise = loadDuckDB();
	  const {module, bundle, logger} = await promise;
	  const worker = await module.createWorker(bundle.mainWorker);
	  const db = new module.AsyncDuckDB(logger, worker);
	  await db.instantiate(bundle.mainModule);
	  return db;
	}

	// https://duckdb.org/docs/sql/data_types/overview
	function getDuckDBType(type) {
	  switch (type) {
	    case "BIGINT":
	    case "HUGEINT":
	    case "UBIGINT":
	      return "bigint";
	    case "DOUBLE":
	    case "REAL":
	    case "FLOAT":
	      return "number";
	    case "INTEGER":
	    case "SMALLINT":
	    case "TINYINT":
	    case "USMALLINT":
	    case "UINTEGER":
	    case "UTINYINT":
	      return "integer";
	    case "BOOLEAN":
	      return "boolean";
	    case "DATE":
	    case "TIMESTAMP":
	    case "TIMESTAMP WITH TIME ZONE":
	      return "date";
	    case "VARCHAR":
	    case "UUID":
	      return "string";
	    // case "BLOB":
	    // case "INTERVAL":
	    // case "TIME":
	    default:
	      if (/^DECIMAL\(/.test(type)) return "integer";
	      return "other";
	  }
	}

	const nChecks = 20; // number of values to check in each array

	// We support two levels of DatabaseClient. The simplest DatabaseClient
	// implements only the client.sql tagged template literal. More advanced
	// DatabaseClients implement client.query and client.queryStream, which support
	// streaming and abort, and the client.queryTag tagged template literal is used
	// to translate the contents of a SQL cell or Table cell into the appropriate
	// arguments for calling client.query or client.queryStream. For table cells, we
	// additionally require client.describeColumns. The client.describeTables method
	// is optional.
	function isDatabaseClient(value, mode) {
	  return (
	    value &&
	    (typeof value.sql === "function" ||
	      (typeof value.queryTag === "function" &&
	        (typeof value.query === "function" ||
	          typeof value.queryStream === "function"))) &&
	    (mode !== "table" || typeof value.describeColumns === "function") &&
	    value !== __query // donâ€™t match our internal helper
	  );
	}

	// Returns true if the value is a typed array (for a single-column table), or if
	// itâ€™s an array. In the latter case, the elements of the array must be
	// consistently typed: either plain objects or primitives or dates.
	function isDataArray(value) {
	  return (
	    (Array.isArray(value) &&
	      (isQueryResultSetSchema(value.schema) ||
	        isQueryResultSetColumns(value.columns) ||
	        arrayContainsObjects(value) ||
	        arrayContainsPrimitives(value) ||
	        arrayContainsDates(value))) ||
	    isTypedArray(value)
	  );
	}

	// Given an array, checks that the given value is an array that does not contain
	// any primitive values (at least for the first few values that we check), and
	// that the first object contains enumerable keys (see computeSchema for how we
	// infer the columns). We assume that the contents of the table are homogenous,
	// but we donâ€™t currently enforce this.
	// https://observablehq.com/@observablehq/database-client-specification#Â§1
	function arrayContainsObjects(value) {
	  const n = Math.min(nChecks, value.length);
	  for (let i = 0; i < n; ++i) {
	    const v = value[i];
	    if (v === null || typeof v !== "object") return false;
	  }
	  return n > 0 && objectHasEnumerableKeys(value[0]);
	}

	// Using a for-in loop here means that we can abort after finding at least one
	// enumerable key (whereas Object.keys would require materializing the array of
	// all keys, which would be considerably slower if the value has many keys!).
	// This function assumes that value is an object; see arrayContainsObjects.
	function objectHasEnumerableKeys(value) {
	  for (const _ in value) return true;
	  return false;
	}

	function isQueryResultSetSchema(schemas) {
	  return (
	    Array.isArray(schemas) &&
	    schemas.every(isColumnSchema)
	  );
	}

	function isQueryResultSetColumns(columns) {
	  return (Array.isArray(columns) && columns.every((name) => typeof name === "string"));
	}

	function isColumnSchema(schema) {
	  return schema && typeof schema.name === "string" && typeof schema.type === "string";
	}

	// Returns true if the value represents an array of primitives (i.e., a
	// single-column table). This should only be passed values for which
	// isDataArray returns true.
	function arrayIsPrimitive(value) {
	  return (
	    isTypedArray(value) ||
	    arrayContainsPrimitives(value) ||
	    arrayContainsDates(value)
	  );
	}

	// Given an array, checks that the first n elements are primitives (number,
	// string, boolean, bigint) of a consistent type.
	function arrayContainsPrimitives(value) {
	  const n = Math.min(nChecks, value.length);
	  if (!(n > 0)) return false;
	  let type;
	  let hasPrimitive = false; // ensure we encounter 1+ primitives
	  for (let i = 0; i < n; ++i) {
	    const v = value[i];
	    if (v == null) continue; // ignore null and undefined
	    const t = typeof v;
	    if (type === undefined) {
	      switch (t) {
	        case "number":
	        case "boolean":
	        case "string":
	        case "bigint":
	          type = t;
	          break;
	        default:
	          return false;
	      }
	    } else if (t !== type) {
	      return false;
	    }
	    hasPrimitive = true;
	  }
	  return hasPrimitive;
	}

	// Given an array, checks that the first n elements are dates.
	function arrayContainsDates(value) {
	  const n = Math.min(nChecks, value.length);
	  if (!(n > 0)) return false;
	  let hasDate = false; // ensure we encounter 1+ dates
	  for (let i = 0; i < n; ++i) {
	    const v = value[i];
	    if (v == null) continue; // ignore null and undefined
	    if (!(v instanceof Date)) return false;
	    hasDate = true;
	  }
	  return hasDate;
	}

	function isTypedArray(value) {
	  return (
	    value instanceof Int8Array ||
	    value instanceof Int16Array ||
	    value instanceof Int32Array ||
	    value instanceof Uint8Array ||
	    value instanceof Uint8ClampedArray ||
	    value instanceof Uint16Array ||
	    value instanceof Uint32Array ||
	    value instanceof Float32Array ||
	    value instanceof Float64Array
	  );
	}

	// __query is used by table cells; __query.sql is used by SQL cells.
	const __query = Object.assign(
	  async (source, operations, invalidation, name) => {
	    source = await loadTableDataSource(await source, name);
	    if (isDatabaseClient(source)) return evaluateQuery(source, makeQueryTemplate(operations, source), invalidation);
	    if (isDataArray(source)) return __table(source, operations);
	    if (!source) throw new Error("missing data source");
	    throw new Error("invalid data source");
	  },
	  {
	    sql(source, invalidation, name) {
	      return async function () {
	        return evaluateQuery(await loadSqlDataSource(await source, name), arguments, invalidation);
	      };
	    }
	  }
	);

	// We use a weak map to cache loaded data sources by key so that we donâ€™t have
	// to e.g. create separate SQLiteDatabaseClients every time weâ€™re querying the
	// same SQLite file attachment. Since this is a weak map, unused references will
	// be garbage collected when they are no longer desired. Note: the name should
	// be consistent, as it is not part of the cache key!
	function sourceCache(loadSource) {
	  const cache = new WeakMap();
	  return (source, name) => {
	    if (!source || typeof source !== "object") throw new Error("invalid data source");
	    let promise = cache.get(source);
	    if (!promise || (isDataArray(source) && source.length !== promise._numRows)) {
	      // Warning: do not await here! We need to populate the cache synchronously.
	      promise = loadSource(source, name);
	      promise._numRows = source.length; // This will be undefined for DatabaseClients
	      cache.set(source, promise);
	    }
	    return promise;
	  };
	}

	const loadTableDataSource = sourceCache(async (source, name) => {
	  if (source instanceof FileAttachment) {
	    switch (source.mimeType) {
	      case "text/csv": return source.csv();
	      case "text/tab-separated-values": return source.tsv();
	      case "application/json": return source.json();
	      case "application/x-sqlite3": return source.sqlite();
	    }
	    if (/\.(arrow|parquet)$/i.test(source.name)) return loadDuckDBClient(source, name);
	    throw new Error(`unsupported file type: ${source.mimeType}`);
	  }
	  if (isArrowTable(source) || isArqueroTable(source)) return loadDuckDBClient(source, name);
	  if (isDataArray(source) && arrayIsPrimitive(source))
	    return Array.from(source, (value) => ({value}));
	  return source;
	});

	const loadSqlDataSource = sourceCache(async (source, name) => {
	  if (source instanceof FileAttachment) {
	    switch (source.mimeType) {
	      case "text/csv":
	      case "text/tab-separated-values":
	      case "application/json": return loadDuckDBClient(source, name);
	      case "application/x-sqlite3": return source.sqlite();
	    }
	    if (/\.(arrow|parquet)$/i.test(source.name)) return loadDuckDBClient(source, name);
	    throw new Error(`unsupported file type: ${source.mimeType}`);
	  }
	  if (isDataArray(source)) return loadDuckDBClient(await asArrowTable(source, name), name);
	  if (isArrowTable(source) || isArqueroTable(source)) return loadDuckDBClient(source, name);
	  return source;
	});

	async function asArrowTable(array, name) {
	  const arrow = await loadArrow();
	  return arrayIsPrimitive(array)
	    ? arrow.tableFromArrays({[name]: array})
	    : arrow.tableFromJSON(array);
	}

	function loadDuckDBClient(
	  source,
	  name = source instanceof FileAttachment
	    ? getFileSourceName(source)
	    : "__table"
	) {
	  return DuckDBClient.of({[name]: source});
	}

	function getFileSourceName(file) {
	  return file.name
	    .replace(/@\d+(?=\.|$)/, "") // strip Observable file version number
	    .replace(/\.\w+$/, ""); // strip file extension
	}

	async function evaluateQuery(source, args, invalidation) {
	  if (!source) throw new Error("missing data source");

	  // If this DatabaseClient supports abort and streaming, use that.
	  if (typeof source.queryTag === "function") {
	    const abortController = new AbortController();
	    const options = {signal: abortController.signal};
	    invalidation.then(() => abortController.abort("invalidated"));
	    if (typeof source.queryStream === "function") {
	      return accumulateQuery(
	        source.queryStream(...source.queryTag.apply(source, args), options)
	      );
	    }
	    if (typeof source.query === "function") {
	      return source.query(...source.queryTag.apply(source, args), options);
	    }
	  }

	  // Otherwise, fallback to the basic sql tagged template literal.
	  if (typeof source.sql === "function") {
	    return source.sql.apply(source, args);
	  }

	  // TODO: test if source is a file attachment, and support CSV etc.
	  throw new Error("source does not implement query, queryStream, or sql");
	}

	// Generator function that yields accumulated query results client.queryStream
	async function* accumulateQuery(queryRequest) {
	  let then = performance.now();
	  const queryResponse = await queryRequest;
	  const values = [];
	  values.done = false;
	  values.error = null;
	  values.schema = queryResponse.schema;
	  try {
	    for await (const rows of queryResponse.readRows()) {
	      if (performance.now() - then > 150 && values.length > 0) {
	        yield values;
	        then = performance.now();
	      }
	      for (const value of rows) {
	        values.push(value);
	      }
	    }
	    values.done = true;
	    yield values;
	  } catch (error) {
	    values.error = error;
	    yield values;
	  }
	}

	/**
	 * Returns a SQL query in the form [[parts], ...params] where parts is an array
	 * of sub-strings and params are the parameter values to be inserted between each
	 * sub-string.
	 */
	function makeQueryTemplate(operations, source) {
	  const escaper =
	    typeof source.escape === "function" ? source.escape : (i) => i;
	  const {select, from, filter, sort, slice} = operations;
	  if (!from.table)
	    throw new Error("missing from table");
	  if (select.columns && select.columns.length === 0)
	    throw new Error("at least one column must be selected");
	  const names = new Map(operations.names?.map(({column, name}) => [column, name]));
	  const columns = select.columns ? select.columns.map((column) =>  {
	    const override = names.get(column);
	    return override ? `${escaper(column)} AS ${escaper(override)}` : escaper(column);
	  }).join(", ") : "*";
	  const args = [
	    [`SELECT ${columns} FROM ${formatTable(from.table, escaper)}`]
	  ];
	  for (let i = 0; i < filter.length; ++i) {
	    appendSql(i ? `\nAND ` : `\nWHERE `, args);
	    appendWhereEntry(filter[i], args, escaper);
	  }
	  for (let i = 0; i < sort.length; ++i) {
	    appendSql(i ? `, ` : `\nORDER BY `, args);
	    appendOrderBy(sort[i], args, escaper);
	  }
	  if (source.dialect === "mssql" || source.dialect === "oracle") {
	    if (slice.to !== null || slice.from !== null) {
	      if (!sort.length) {
	        if (!select.columns)
	          throw new Error(
	              "at least one column must be explicitly specified. Received '*'."
	          );
	        appendSql(`\nORDER BY `, args);
	        appendOrderBy(
	          {column: select.columns[0], direction: "ASC"},
	          args,
	          escaper
	        );
	      }
	      appendSql(`\nOFFSET ${slice.from || 0} ROWS`, args);
	      appendSql(
	        `\nFETCH NEXT ${
          slice.to !== null ? slice.to - (slice.from || 0) : 1e9
        } ROWS ONLY`,
	        args
	      );
	    }
	  } else {
	    if (slice.to !== null || slice.from !== null) {
	      appendSql(
	        `\nLIMIT ${slice.to !== null ? slice.to - (slice.from || 0) : 1e9}`,
	        args
	      );
	    }
	    if (slice.from !== null) {
	      appendSql(` OFFSET ${slice.from}`, args);
	    }
	  }
	  return args;
	}

	function formatTable(table, escaper) {
	  if (typeof table === "object") { // i.e., not a bare string specifier
	    let from = "";
	    if (table.database != null) from += escaper(table.database) + ".";
	    if (table.schema != null) from += escaper(table.schema) + ".";
	    from += escaper(table.table);
	    return from;
	  } else {
	    return escaper(table);
	  }
	}

	function appendSql(sql, args) {
	  const strings = args[0];
	  strings[strings.length - 1] += sql;
	}

	function appendOrderBy({column, direction}, args, escaper) {
	  appendSql(`${escaper(column)} ${direction.toUpperCase()}`, args);
	}

	function appendWhereEntry({type, operands}, args, escaper) {
	  if (operands.length < 1) throw new Error("Invalid operand length");

	  // Unary operations
	  // We treat `v` and `nv` as `NULL` and `NOT NULL` unary operations in SQL,
	  // since the database already validates column types.
	  if (operands.length === 1 || type === "v" || type === "nv") {
	    appendOperand(operands[0], args, escaper);
	    switch (type) {
	      case "n":
	      case "nv":
	        appendSql(` IS NULL`, args);
	        return;
	      case "nn":
	      case "v":
	        appendSql(` IS NOT NULL`, args);
	        return;
	      default:
	        throw new Error("Invalid filter operation");
	    }
	  }

	  // Binary operations
	  if (operands.length === 2) {
	    if (["in", "nin"].includes(type)) ; else if (["c", "nc"].includes(type)) {
	      // TODO: Case (in)sensitive?
	      appendOperand(operands[0], args, escaper);
	      switch (type) {
	        case "c":
	          appendSql(` LIKE `, args);
	          break;
	        case "nc":
	          appendSql(` NOT LIKE `, args);
	          break;
	      }
	      appendOperand(likeOperand(operands[1]), args, escaper);
	      return;
	    } else {
	      appendOperand(operands[0], args, escaper);
	      switch (type) {
	        case "eq":
	          appendSql(` = `, args);
	          break;
	        case "ne":
	          appendSql(` <> `, args);
	          break;
	        case "gt":
	          appendSql(` > `, args);
	          break;
	        case "lt":
	          appendSql(` < `, args);
	          break;
	        case "gte":
	          appendSql(` >= `, args);
	          break;
	        case "lte":
	          appendSql(` <= `, args);
	          break;
	        default:
	          throw new Error("Invalid filter operation");
	      }
	      appendOperand(operands[1], args, escaper);
	      return;
	    }
	  }

	  // List operations
	  appendOperand(operands[0], args, escaper);
	  switch (type) {
	    case "in":
	      appendSql(` IN (`, args);
	      break;
	    case "nin":
	      appendSql(` NOT IN (`, args);
	      break;
	    default:
	      throw new Error("Invalid filter operation");
	  }
	  appendListOperands(operands.slice(1), args);
	  appendSql(")", args);
	}

	function appendOperand(o, args, escaper) {
	  if (o.type === "column") {
	    appendSql(escaper(o.value), args);
	  } else {
	    args.push(o.value);
	    args[0].push("");
	  }
	}

	// TODO: Support column operands here?
	function appendListOperands(ops, args) {
	  let first = true;
	  for (const op of ops) {
	    if (first) first = false;
	    else appendSql(",", args);
	    args.push(op.value);
	    args[0].push("");
	  }
	}

	function likeOperand(operand) {
	  return {...operand, value: `%${operand.value}%`};
	}

	// Comparator function that moves null values (undefined, null, NaN) to the
	// end of the array.
	function defined$1(a, b) {
	  return (a == null || !(a >= a)) - (b == null || !(b >= b));
	}

	// Comparator function that sorts values in ascending order, with null values at
	// the end.
	function ascendingDefined(a, b) {
	  return defined$1(a, b) || (a < b ? -1 : a > b ? 1 : 0);
	}

	// Comparator function that sorts values in descending order, with null values
	// at the end.
	function descendingDefined(a, b) {
	  return defined$1(a, b) || (a > b ? -1 : a < b ? 1 : 0);
	}

	// Functions for checking type validity
	const isValidNumber = (value) => typeof value === "number" && !Number.isNaN(value);
	const isValidInteger = (value) => Number.isInteger(value) && !Number.isNaN(value);
	const isValidString = (value) => typeof value === "string";
	const isValidBoolean = (value) => typeof value === "boolean";
	const isValidBigint = (value) => typeof value === "bigint";
	const isValidDate = (value) => value instanceof Date && !isNaN(value);
	const isValidBuffer = (value) => value instanceof ArrayBuffer;
	const isValidArray = (value) => Array.isArray(value);
	const isValidObject = (value) => typeof value === "object" && value !== null;
	const isValidOther = (value) => value != null;

	// Function to get the correct validity checking function based on type
	function getTypeValidator(colType) {
	  switch (colType) {
	    case "string":
	      return isValidString;
	    case "bigint":
	      return isValidBigint;
	    case "boolean":
	      return isValidBoolean;
	    case "number":
	      return isValidNumber;
	    case "integer":
	      return isValidInteger;
	    case "date":
	      return isValidDate;
	    case "buffer":
	      return isValidBuffer;
	    case "array":
	      return isValidArray;
	    case "object":
	      return isValidObject;
	    case "other":
	    default:
	      return isValidOther;
	  }
	}

	// Accepts dates in the form of ISOString and LocaleDateString, with or without time
	const DATE_TEST = /^(([-+]\d{2})?\d{4}(-\d{2}(-\d{2}))|(\d{1,2})\/(\d{1,2})\/(\d{2,4}))([T ]\d{2}:\d{2}(:\d{2}(\.\d{3})?)?(Z|[-+]\d{2}:\d{2})?)?$/;

	function coerceToType(value, type) {
	  switch (type) {
	    case "string":
	      return typeof value === "string" || value == null ? value : String(value);
	    case "boolean":
	      if (typeof value === "string") {
	        const trimValue = value.trim().toLowerCase();
	        return trimValue === "true"
	          ? true
	          : trimValue === "false"
	          ? false
	          : null;
	      }
	      return typeof value === "boolean" || value == null
	        ? value
	        : Boolean(value);
	    case "bigint":
	      return typeof value === "bigint" || value == null
	        ? value
	        : Number.isInteger(typeof value === "string" && !value.trim() ? NaN : +value)
	        ? BigInt(value) // eslint-disable-line no-undef
	        : undefined;
	    case "integer": // not a target type for coercion, but can be inferred
	    case "number": {
	      return typeof value === "number"
	        ? value
	        : value == null || (typeof value === "string" && !value.trim())
	        ? NaN
	        : Number(value);
	    }
	    case "date": {
	      if (value instanceof Date || value == null) return value;
	      if (typeof value === "number") return new Date(value);
	      const trimValue = String(value).trim();
	      if (typeof value === "string" && !trimValue) return null;
	      return new Date(DATE_TEST.test(trimValue) ? trimValue : NaN);
	    }
	    case "array":
	    case "object":
	    case "buffer":
	    case "other":
	      return value;
	    default:
	      throw new Error(`Unable to coerce to type: ${type}`);
	  }
	}

	function getSchema(source) {
	  const {columns} = source;
	  let {schema} = source;
	  if (!isQueryResultSetSchema(schema)) {
	    schema = inferSchema(source, isQueryResultSetColumns(columns) ? columns : undefined);
	    return {schema, inferred: true};
	  }
	  return {schema, inferred: false};
	}

	// This function infers a schema from the source data, if one doesn't already
	// exist, and merges type assertions into that schema. If the schema was
	// inferred or if there are type assertions, it then coerces the rows in the
	// source data to the types specified in the schema.
	function applyTypes(source, operations) {
	  const input = source;
	  let {schema, inferred} = getSchema(source);
	  const types = new Map(schema.map(({name, type}) => [name, type]));
	  if (operations.types) {
	    for (const {name, type} of operations.types) {
	      types.set(name, type);
	      // update schema with user-selected type
	      if (schema === input.schema) schema = schema.slice(); // copy on write
	      const colIndex = schema.findIndex((col) => col.name === name);
	      if (colIndex > -1) schema[colIndex] = {...schema[colIndex], type};
	    }
	    source = source.map(d => coerceRow(d, types, schema));
	  } else if (inferred) {
	    // Coerce data according to new schema, unless that happened due to
	    // operations.types, above.
	    source = source.map(d => coerceRow(d, types, schema));
	  }
	  return {source, schema};
	}

	function applyNames(source, operations) {
	  if (!operations.names) return source;
	  const overridesByName = new Map(operations.names.map((n) => [n.column, n]));
	  return source.map((d) =>
	    Object.fromEntries(Object.keys(d).map((k) => {
	      const override = overridesByName.get(k);
	      return [override?.name ?? k, d[k]];
	    }))
	  );
	}

	// This function applies table cell operations to an in-memory table (array of
	// objects); it should be equivalent to the corresponding SQL query. TODO Use
	// DuckDBClient for data arrays, too, and then we wouldnâ€™t need our own __table
	// function to do table operations on in-memory data?
	function __table(source, operations) {
	  const errors = new Map();
	  const input = source;
	  const typed = applyTypes(source, operations);
	  source = typed.source;
	  let schema = typed.schema;
	  if (operations.derive) {
	    // Derived columns may depend on coerced values from the original data source,
	    // so we must evaluate derivations after the initial inference and coercion
	    // step.
	    const derivedSource = [];
	    operations.derive.map(({name, value}) => {
	      let columnErrors = [];
	      // Derived column formulas may reference renamed columns, so we must
	      // compute derivations on the renamed source. However, we don't modify the
	      // source itself with renamed names until after the other operations are
	      // applied, because operations like filter and sort reference original
	      // column names.
	      // TODO Allow derived columns to reference other derived columns.
	      applyNames(source, operations).map((row, index) => {
	        let resolved;
	        try {
	          // TODO Support referencing `index` and `rows` in the derive function.
	          resolved = value(row);
	        } catch (error) {
	          columnErrors.push({index, error});
	          resolved = undefined;
	        }
	        if (derivedSource[index]) {
	          derivedSource[index] = {...derivedSource[index], [name]: resolved};
	        } else {
	          derivedSource.push({[name]: resolved});
	        }
	      });
	      if (columnErrors.length) errors.set(name, columnErrors);
	    });
	    // Since derived columns are untyped by default, we do a pass of type
	    // inference and coercion after computing the derived values.
	    const typedDerived = applyTypes(derivedSource, operations);
	    // Merge derived source and schema with the source dataset.
	    source = source.map((row, i) => ({...row, ...typedDerived.source[i]}));
	    schema = [...schema, ...typedDerived.schema];
	  }
	  for (const {type, operands} of operations.filter) {
	    const [{value: column}] = operands;
	    const values = operands.slice(1).map(({value}) => value);
	    switch (type) {
	      // valid (matches the column type)
	      case "v": {
	        const [colType] = values;
	        const isValid = getTypeValidator(colType);
	        source = source.filter(d => isValid(d[column]));
	        break;
	      }
	      // not valid (doesn't match the column type)
	      case "nv": {
	        const [colType] = values;
	        const isValid = getTypeValidator(colType);
	        source = source.filter(d => !isValid(d[column]));
	        break;
	      }
	      case "eq": {
	        const [value] = values;
	        if (value instanceof Date) {
	          const time = +value; // compare as primitive
	          source = source.filter((d) => +d[column] === time);
	        } else {
	          source = source.filter((d) => d[column] === value);
	        }
	        break;
	      }
	      case "ne": {
	        const [value] = values;
	        source = source.filter((d) => d[column] !== value);
	        break;
	      }
	      case "c": {
	        const [value] = values;
	        source = source.filter(
	          (d) => typeof d[column] === "string" && d[column].includes(value)
	        );
	        break;
	      }
	      case "nc": {
	        const [value] = values;
	        source = source.filter(
	          (d) => typeof d[column] === "string" && !d[column].includes(value)
	        );
	        break;
	      }
	      case "in": {
	        const set = new Set(values); // TODO support dates?
	        source = source.filter((d) => set.has(d[column]));
	        break;
	      }
	      case "nin": {
	        const set = new Set(values); // TODO support dates?
	        source = source.filter((d) => !set.has(d[column]));
	        break;
	      }
	      case "n": {
	        source = source.filter((d) => d[column] == null);
	        break;
	      }
	      case "nn": {
	        source = source.filter((d) => d[column] != null);
	        break;
	      }
	      case "lt": {
	        const [value] = values;
	        source = source.filter((d) => d[column] < value);
	        break;
	      }
	      case "lte": {
	        const [value] = values;
	        source = source.filter((d) => d[column] <= value);
	        break;
	      }
	      case "gt": {
	        const [value] = values;
	        source = source.filter((d) => d[column] > value);
	        break;
	      }
	      case "gte": {
	        const [value] = values;
	        source = source.filter((d) => d[column] >= value);
	        break;
	      }
	      default:
	        throw new Error(`unknown filter type: ${type}`);
	    }
	  }
	  for (const {column, direction} of reverse(operations.sort)) {
	    const compare = direction === "desc" ? descendingDefined : ascendingDefined;
	    if (source === input) source = source.slice(); // defensive copy
	    source.sort((a, b) => compare(a[column], b[column]));
	  }
	  let {from, to} = operations.slice;
	  from = from == null ? 0 : Math.max(0, from);
	  to = to == null ? Infinity : Math.max(0, to);
	  if (from > 0 || to < Infinity) {
	    source = source.slice(Math.max(0, from), Math.max(0, to));
	  }
	  // Preserve the schema for all columns.
	  let fullSchema = schema.slice();
	  if (operations.select.columns) {
	    if (schema) {
	      const schemaByName = new Map(schema.map((s) => [s.name, s]));
	      schema = operations.select.columns.map((c) => schemaByName.get(c));
	    }
	    source = source.map((d) =>
	      Object.fromEntries(operations.select.columns.map((c) => [c, d[c]]))
	    );
	  }
	  if (operations.names) {
	    const overridesByName = new Map(operations.names.map((n) => [n.column, n]));
	    if (schema) {
	      schema = schema.map((s) => {
	        const override = overridesByName.get(s.name);
	        return ({...s, ...(override ? {name: override.name} : null)});
	      });
	    }
	    if (fullSchema) {
	      fullSchema = fullSchema.map((s) => {
	        const override = overridesByName.get(s.name);
	        return ({...s, ...(override ? {name: override.name} : null)});
	      });
	    }
	    source = applyNames(source, operations);
	  }
	  if (source !== input) {
	    if (schema) source.schema = schema;
	  }
	  source.fullSchema = fullSchema;
	  source.errors = errors;
	  return source;
	}

	function coerceRow(object, types, schema) {
	  const coerced = {};
	  for (const col of schema) {
	    const type = types.get(col.name);
	    const value = object[col.name];
	    coerced[col.name] = type === "raw" ? value : coerceToType(value, type);
	  }
	  return coerced;
	}

	function createTypeCount() {
	  return {
	    boolean: 0,
	    integer: 0,
	    number: 0,
	    date: 0,
	    string: 0,
	    array: 0,
	    object: 0,
	    bigint: 0,
	    buffer: 0,
	    defined: 0
	  };
	}

	// Caution: the order below matters! ðŸŒ¶ï¸ The first one that passes the â‰¥90% test
	// should be the one that we chose, and therefore these types should be listed
	// from most specific to least specific.
	const types = [
	  "boolean",
	  "integer",
	  "number",
	  "date",
	  "bigint",
	  "array",
	  "object",
	  "buffer"
	  // Note: "other" and "string" are intentionally omitted; see below!
	];

	// We need to show *all* keys present in the array of Objects
	function getAllKeys(rows) {
	  const keys = new Set();
	  for (const row of rows) {
	    // avoid crash if row is null or undefined
	    if (row) {
	      // only enumerable properties
	      for (const key in row) {
	        // only own properties
	        if (Object.prototype.hasOwnProperty.call(row, key)) {
	          // unique properties, in the order they appear
	          keys.add(key);
	        }
	      }
	    }
	  }
	  return Array.from(keys);
	}

	function inferSchema(source, columns = getAllKeys(source)) {
	  const schema = [];
	  const sampleSize = 100;
	  const sample = source.slice(0, sampleSize);
	  for (const col of columns) {
	    const colCount = createTypeCount();
	    for (const d of sample) {
	      let value = d[col];
	      if (value == null) continue;
	      const type = typeof value;
	      if (type !== "string") {
	        ++colCount.defined;
	        if (Array.isArray(value)) ++colCount.array;
	        else if (value instanceof Date) ++colCount.date;
	        else if (value instanceof ArrayBuffer) ++colCount.buffer;
	        else if (type === "number") {
	          ++colCount.number;
	          if (Number.isInteger(value)) ++colCount.integer;
	        }
	        // bigint, boolean, or object
	        else if (type in colCount) ++colCount[type];
	      } else {
	        value = value.trim();
	        if (!value) continue;
	        ++colCount.defined;
	        ++colCount.string;
	        if (/^(true|false)$/i.test(value)) {
	          ++colCount.boolean;
	        } else if (value && !isNaN(value)) {
	          ++colCount.number;
	          if (Number.isInteger(+value)) ++colCount.integer;
	        } else if (DATE_TEST.test(value)) ++colCount.date;
	      }
	    }
	    // Chose the non-string, non-other type with the greatest count that is also
	    // â‰¥90%; or if no such type meets that criterion, fallback to string if
	    // â‰¥90%; and lastly fallback to other.
	    const minCount = Math.max(1, colCount.defined * 0.9);
	    const type =
	      greatest(types, (type) =>
	        colCount[type] >= minCount ? colCount[type] : NaN
	      ) ?? (colCount.string >= minCount ? "string" : "other");
	    schema.push({
	      name: col,
	      type: type,
	      inferred: type
	    });
	  }
	  return schema;
	}

	class Workbook {
	  constructor(workbook) {
	    Object.defineProperties(this, {
	      _: {value: workbook},
	      sheetNames: {
	        value: workbook.worksheets.map((s) => s.name),
	        enumerable: true
	      }
	    });
	  }
	  sheet(name, options) {
	    const sname =
	      typeof name === "number"
	        ? this.sheetNames[name]
	        : this.sheetNames.includes((name += ""))
	        ? name
	        : null;
	    if (sname == null) throw new Error(`Sheet not found: ${name}`);
	    const sheet = this._.getWorksheet(sname);
	    return extract(sheet, options);
	  }
	}

	function extract(sheet, {range, headers} = {}) {
	  let [[c0, r0], [c1, r1]] = parseRange(range, sheet);
	  const headerRow = headers ? sheet._rows[r0++] : null;
	  let names = new Set(["#"]);
	  for (let n = c0; n <= c1; n++) {
	    const value = headerRow ? valueOf(headerRow.findCell(n + 1)) : null;
	    let name = (value && value + "") || toColumn(n);
	    while (names.has(name)) name += "_";
	    names.add(name);
	  }
	  names = new Array(c0).concat(Array.from(names));

	  const output = new Array(r1 - r0 + 1);
	  for (let r = r0; r <= r1; r++) {
	    const row = (output[r - r0] = Object.create(null, {"#": {value: r + 1}}));
	    const _row = sheet.getRow(r + 1);
	    if (_row.hasValues)
	      for (let c = c0; c <= c1; c++) {
	        const value = valueOf(_row.findCell(c + 1));
	        if (value != null) row[names[c + 1]] = value;
	      }
	  }

	  output.columns = names.filter(() => true); // Filter sparse columns
	  return output;
	}

	function valueOf(cell) {
	  if (!cell) return;
	  const {value} = cell;
	  if (value && typeof value === "object" && !(value instanceof Date)) {
	    if (value.formula || value.sharedFormula) {
	      return value.result && value.result.error ? NaN : value.result;
	    }
	    if (value.richText) {
	      return richText(value);
	    }
	    if (value.text) {
	      let {text} = value;
	      if (text.richText) text = richText(text);
	      return value.hyperlink && value.hyperlink !== text
	        ? `${value.hyperlink} ${text}`
	        : text;
	    }
	    return value;
	  }
	  return value;
	}

	function richText(value) {
	  return value.richText.map((d) => d.text).join("");
	}

	function parseRange(specifier = ":", {columnCount, rowCount}) {
	  specifier += "";
	  if (!specifier.match(/^[A-Z]*\d*:[A-Z]*\d*$/))
	    throw new Error("Malformed range specifier");
	  const [[c0 = 0, r0 = 0], [c1 = columnCount - 1, r1 = rowCount - 1]] =
	    specifier.split(":").map(fromCellReference);
	  return [
	    [c0, r0],
	    [c1, r1]
	  ];
	}

	// Returns the default column name for a zero-based column index.
	// For example: 0 -> "A", 1 -> "B", 25 -> "Z", 26 -> "AA", 27 -> "AB".
	function toColumn(c) {
	  let sc = "";
	  c++;
	  do {
	    sc = String.fromCharCode(64 + (c % 26 || 26)) + sc;
	  } while ((c = Math.floor((c - 1) / 26)));
	  return sc;
	}

	// Returns the zero-based indexes from a cell reference.
	// For example: "A1" -> [0, 0], "B2" -> [1, 1], "AA10" -> [26, 9].
	function fromCellReference(s) {
	  const [, sc, sr] = s.match(/^([A-Z]*)(\d*)$/);
	  let c = 0;
	  if (sc)
	    for (let i = 0; i < sc.length; i++)
	      c += Math.pow(26, sc.length - i - 1) * (sc.charCodeAt(i) - 64);
	  return [c ? c - 1 : undefined, sr ? +sr - 1 : undefined];
	}

	async function remote_fetch(file) {
	  const response = await fetch(await file.url());
	  if (!response.ok) throw new Error(`Unable to load file: ${file.name}`);
	  return response;
	}

	function enforceSchema(source, schema) {
	  const types = new Map(schema.map(({name, type}) => [name, type]));
	  return Object.assign(source.map(d => coerceRow(d, types, schema)), {schema});
	}

	async function dsv(file, delimiter, {array = false, typed = false} = {}) {
	  const text = await file.text();
	  const parse = (delimiter === "\t"
	    ? (array ? tsvParseRows : tsvParse)
	    : (array ? csvParseRows : csvParse));
	  if (typed === "auto" && !array) {
	    const source = parse(text);
	    return enforceSchema(source, inferSchema(source, source.columns));
	  }
	  return parse(text, typed && autoType);
	}

	class AbstractFile {
	  constructor(name, mimeType) {
	    Object.defineProperty(this, "name", {value: name, enumerable: true});
	    if (mimeType !== undefined) Object.defineProperty(this, "mimeType", {value: mimeType + "", enumerable: true});
	  }
	  async blob() {
	    return (await remote_fetch(this)).blob();
	  }
	  async arrayBuffer() {
	    return (await remote_fetch(this)).arrayBuffer();
	  }
	  async text() {
	    return (await remote_fetch(this)).text();
	  }
	  async json() {
	    return (await remote_fetch(this)).json();
	  }
	  async stream() {
	    return (await remote_fetch(this)).body;
	  }
	  async csv(options) {
	    return dsv(this, ",", options);
	  }
	  async tsv(options) {
	    return dsv(this, "\t", options);
	  }
	  async image(props) {
	    const url = await this.url();
	    return new Promise((resolve, reject) => {
	      const i = new Image();
	      if (new URL(url, document.baseURI).origin !== new URL(location).origin) {
	        i.crossOrigin = "anonymous";
	      }
	      Object.assign(i, props);
	      i.onload = () => resolve(i);
	      i.onerror = () => reject(new Error(`Unable to load file: ${this.name}`));
	      i.src = url;
	    });
	  }
	  async arrow({version = 4} = {}) {
	    switch (version) {
	      case 4: {
	        const [Arrow, response] = await Promise.all([requireDefault(arrow4.resolve()), remote_fetch(this)]);
	        return Arrow.Table.from(response);
	      }
	      case 9: {
	        const [Arrow, response] = await Promise.all([import(`${cdn}${arrow9.resolve()}`), remote_fetch(this)]);
	        return Arrow.tableFromIPC(response);
	      }
	      case 11: {
	        const [Arrow, response] = await Promise.all([import(`${cdn}${arrow11.resolve()}`), remote_fetch(this)]);
	        return Arrow.tableFromIPC(response);
	      }
	      default: throw new Error(`unsupported arrow version: ${version}`);
	    }
	  }
	  async sqlite() {
	    return SQLiteDatabaseClient.open(remote_fetch(this));
	  }
	  async zip() {
	    const [JSZip, buffer] = await Promise.all([requireDefault(jszip.resolve()), this.arrayBuffer()]);
	    return new ZipArchive(await JSZip.loadAsync(buffer));
	  }
	  async xml(mimeType = "application/xml") {
	    return (new DOMParser).parseFromString(await this.text(), mimeType);
	  }
	  async html() {
	    return this.xml("text/html");
	  }
	  async xlsx() {
	    const [ExcelJS, buffer] = await Promise.all([requireDefault(exceljs.resolve()), this.arrayBuffer()]);
	    return new Workbook(await new ExcelJS.Workbook().xlsx.load(buffer));
	  }
	}

	class FileAttachment extends AbstractFile {
	  constructor(url, name, mimeType) {
	    super(name, mimeType);
	    Object.defineProperty(this, "_url", {value: url});
	  }
	  async url() {
	    return (await this._url) + "";
	  }
	}

	function NoFileAttachments(name) {
	  throw new Error(`File not found: ${name}`);
	}

	function FileAttachments(resolve) {
	  return Object.assign(
	    name => {
	      const result = resolve(name += "");
	      if (result == null) throw new Error(`File not found: ${name}`);
	      if (typeof result === "object" && "url" in result) {
	        const {url, mimeType} = result;
	        return new FileAttachment(url, name, mimeType);
	      }
	      return new FileAttachment(result, name);
	    },
	    {prototype: FileAttachment.prototype} // instanceof
	  );
	}

	class ZipArchive {
	  constructor(archive) {
	    Object.defineProperty(this, "_", {value: archive});
	    this.filenames = Object.keys(archive.files).filter(name => !archive.files[name].dir);
	  }
	  file(path) {
	    const object = this._.file(path += "");
	    if (!object || object.dir) throw new Error(`file not found: ${path}`);
	    return new ZipArchiveEntry(object);
	  }
	}

	class ZipArchiveEntry extends AbstractFile {
	  constructor(object) {
	    super(object.name);
	    Object.defineProperty(this, "_", {value: object});
	    Object.defineProperty(this, "_url", {writable: true});
	  }
	  async url() {
	    return this._url || (this._url = this.blob().then(URL.createObjectURL));
	  }
	  async blob() {
	    return this._.async("blob");
	  }
	  async arrayBuffer() {
	    return this._.async("arraybuffer");
	  }
	  async text() {
	    return this._.async("text");
	  }
	  async json() {
	    return JSON.parse(await this.text());
	  }
	}

	function canvas(width, height) {
	  var canvas = document.createElement("canvas");
	  canvas.width = width;
	  canvas.height = height;
	  return canvas;
	}

	function context2d(width, height, dpi) {
	  if (dpi == null) dpi = devicePixelRatio;
	  var canvas = document.createElement("canvas");
	  canvas.width = width * dpi;
	  canvas.height = height * dpi;
	  canvas.style.width = width + "px";
	  var context = canvas.getContext("2d");
	  context.scale(dpi, dpi);
	  return context;
	}

	function download(value, name = "untitled", label = "Save") {
	  const a = document.createElement("a");
	  const b = a.appendChild(document.createElement("button"));
	  b.textContent = label;
	  a.download = name;

	  async function reset() {
	    await new Promise(requestAnimationFrame);
	    URL.revokeObjectURL(a.href);
	    a.removeAttribute("href");
	    b.textContent = label;
	    b.disabled = false;
	  }

	  a.onclick = async event => {
	    b.disabled = true;
	    if (a.href) return reset(); // Already saved.
	    b.textContent = "Savingâ€¦";
	    try {
	      const object = await (typeof value === "function" ? value() : value);
	      b.textContent = "Download";
	      a.href = URL.createObjectURL(object); // eslint-disable-line require-atomic-updates
	    } catch (ignore) {
	      b.textContent = label;
	    }
	    if (event.eventPhase) return reset(); // Already downloaded.
	    b.disabled = false;
	  };

	  return a;
	}

	var namespaces = {
	  math: "http://www.w3.org/1998/Math/MathML",
	  svg: "http://www.w3.org/2000/svg",
	  xhtml: "http://www.w3.org/1999/xhtml",
	  xlink: "http://www.w3.org/1999/xlink",
	  xml: "http://www.w3.org/XML/1998/namespace",
	  xmlns: "http://www.w3.org/2000/xmlns/"
	};

	function element(name, attributes) {
	  var prefix = name += "", i = prefix.indexOf(":"), value;
	  if (i >= 0 && (prefix = name.slice(0, i)) !== "xmlns") name = name.slice(i + 1);
	  var element = namespaces.hasOwnProperty(prefix) // eslint-disable-line no-prototype-builtins
	      ? document.createElementNS(namespaces[prefix], name)
	      : document.createElement(name);
	  if (attributes) for (var key in attributes) {
	    prefix = key, i = prefix.indexOf(":"), value = attributes[key];
	    if (i >= 0 && (prefix = key.slice(0, i)) !== "xmlns") key = key.slice(i + 1);
	    if (namespaces.hasOwnProperty(prefix)) element.setAttributeNS(namespaces[prefix], key, value); // eslint-disable-line no-prototype-builtins
	    else element.setAttribute(key, value);
	  }
	  return element;
	}

	function input$1(type) {
	  var input = document.createElement("input");
	  if (type != null) input.type = type;
	  return input;
	}

	function range$2(min, max, step) {
	  if (arguments.length === 1) max = min, min = null;
	  var input = document.createElement("input");
	  input.min = min = min == null ? 0 : +min;
	  input.max = max = max == null ? 1 : +max;
	  input.step = step == null ? "any" : step = +step;
	  input.type = "range";
	  return input;
	}

	function select$1(values) {
	  var select = document.createElement("select");
	  Array.prototype.forEach.call(values, function(value) {
	    var option = document.createElement("option");
	    option.value = option.textContent = value;
	    select.appendChild(option);
	  });
	  return select;
	}

	function svg$1(width, height) {
	  var svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
	  svg.setAttribute("viewBox", [0, 0, width, height]);
	  svg.setAttribute("width", width);
	  svg.setAttribute("height", height);
	  return svg;
	}

	function text$1(value) {
	  return document.createTextNode(value);
	}

	var count = 0;

	function uid(name) {
	  return new Id("O-" + (name == null ? "" : name + "-") + ++count);
	}

	function Id(id) {
	  this.id = id;
	  this.href = new URL(`#${id}`, location) + "";
	}

	Id.prototype.toString = function() {
	  return "url(" + this.href + ")";
	};

	var DOM = /*#__PURE__*/Object.freeze({
		__proto__: null,
		canvas: canvas,
		context2d: context2d,
		download: download,
		element: element,
		input: input$1,
		range: range$2,
		select: select$1,
		svg: svg$1,
		text: text$1,
		uid: uid
	});

	function buffer(file) {
	  return new Promise(function(resolve, reject) {
	    var reader = new FileReader;
	    reader.onload = function() { resolve(reader.result); };
	    reader.onerror = reject;
	    reader.readAsArrayBuffer(file);
	  });
	}

	function text(file) {
	  return new Promise(function(resolve, reject) {
	    var reader = new FileReader;
	    reader.onload = function() { resolve(reader.result); };
	    reader.onerror = reject;
	    reader.readAsText(file);
	  });
	}

	function url(file) {
	  return new Promise(function(resolve, reject) {
	    var reader = new FileReader;
	    reader.onload = function() { resolve(reader.result); };
	    reader.onerror = reject;
	    reader.readAsDataURL(file);
	  });
	}

	var Files = /*#__PURE__*/Object.freeze({
		__proto__: null,
		buffer: buffer,
		text: text,
		url: url
	});

	function that() {
	  return this;
	}

	function disposable(value, dispose) {
	  let done = false;
	  if (typeof dispose !== "function") {
	    throw new Error("dispose is not a function");
	  }
	  return {
	    [Symbol.iterator]: that,
	    next: () => done ? {done: true} : (done = true, {done: false, value}),
	    return: () => (done = true, dispose(value), {done: true}),
	    throw: () => ({done: done = true})
	  };
	}

	function* filter(iterator, test) {
	  var result, index = -1;
	  while (!(result = iterator.next()).done) {
	    if (test(result.value, ++index)) {
	      yield result.value;
	    }
	  }
	}

	function observe(initialize) {
	  let stale = false;
	  let value;
	  let resolve;
	  const dispose = initialize(change);

	  if (dispose != null && typeof dispose !== "function") {
	    throw new Error(typeof dispose.then === "function"
	        ? "async initializers are not supported"
	        : "initializer returned something, but not a dispose function");
	  }

	  function change(x) {
	    if (resolve) resolve(x), resolve = null;
	    else stale = true;
	    return value = x;
	  }

	  function next() {
	    return {done: false, value: stale
	        ? (stale = false, Promise.resolve(value))
	        : new Promise(_ => (resolve = _))};
	  }

	  return {
	    [Symbol.iterator]: that,
	    throw: () => ({done: true}),
	    return: () => (dispose != null && dispose(), {done: true}),
	    next
	  };
	}

	function input(input) {
	  return observe(function(change) {
	    var event = eventof(input), value = valueof(input);
	    function inputted() { change(valueof(input)); }
	    input.addEventListener(event, inputted);
	    if (value !== undefined) change(value);
	    return function() { input.removeEventListener(event, inputted); };
	  });
	}

	function valueof(input) {
	  switch (input.type) {
	    case "range":
	    case "number": return input.valueAsNumber;
	    case "date": return input.valueAsDate;
	    case "checkbox": return input.checked;
	    case "file": return input.multiple ? input.files : input.files[0];
	    case "select-multiple": return Array.from(input.selectedOptions, o => o.value);
	    default: return input.value;
	  }
	}

	function eventof(input) {
	  switch (input.type) {
	    case "button":
	    case "submit":
	    case "checkbox": return "click";
	    case "file": return "change";
	    default: return "input";
	  }
	}

	function* map$1(iterator, transform) {
	  var result, index = -1;
	  while (!(result = iterator.next()).done) {
	    yield transform(result.value, ++index);
	  }
	}

	function queue(initialize) {
	  let resolve;
	  const queue = [];
	  const dispose = initialize(push);

	  if (dispose != null && typeof dispose !== "function") {
	    throw new Error(typeof dispose.then === "function"
	        ? "async initializers are not supported"
	        : "initializer returned something, but not a dispose function");
	  }

	  function push(x) {
	    queue.push(x);
	    if (resolve) resolve(queue.shift()), resolve = null;
	    return x;
	  }

	  function next() {
	    return {done: false, value: queue.length
	        ? Promise.resolve(queue.shift())
	        : new Promise(_ => (resolve = _))};
	  }

	  return {
	    [Symbol.iterator]: that,
	    throw: () => ({done: true}),
	    return: () => (dispose != null && dispose(), {done: true}),
	    next
	  };
	}

	function* range$1(start, stop, step) {
	  start = +start;
	  stop = +stop;
	  step = (n = arguments.length) < 2 ? (stop = start, start = 0, 1) : n < 3 ? 1 : +step;
	  var i = -1, n = Math.max(0, Math.ceil((stop - start) / step)) | 0;
	  while (++i < n) {
	    yield start + i * step;
	  }
	}

	function valueAt(iterator, i) {
	  if (!isFinite(i = +i) || i < 0 || i !== i | 0) return;
	  var result, index = -1;
	  while (!(result = iterator.next()).done) {
	    if (++index === i) {
	      return result.value;
	    }
	  }
	}

	function worker(source) {
	  const url = URL.createObjectURL(new Blob([source], {type: "text/javascript"}));
	  const worker = new Worker(url);
	  return disposable(worker, () => {
	    worker.terminate();
	    URL.revokeObjectURL(url);
	  });
	}

	var Generators = /*#__PURE__*/Object.freeze({
		__proto__: null,
		disposable: disposable,
		filter: filter,
		input: input,
		map: map$1,
		observe: observe,
		queue: queue,
		range: range$1,
		valueAt: valueAt,
		worker: worker
	});

	function template(render, wrapper) {
	  return function(strings) {
	    var string = strings[0],
	        parts = [], part,
	        root = null,
	        node, nodes,
	        walker,
	        i, n, j, m, k = -1;

	    // Concatenate the text using comments as placeholders.
	    for (i = 1, n = arguments.length; i < n; ++i) {
	      part = arguments[i];
	      if (part instanceof Node) {
	        parts[++k] = part;
	        string += "<!--o:" + k + "-->";
	      } else if (Array.isArray(part)) {
	        for (j = 0, m = part.length; j < m; ++j) {
	          node = part[j];
	          if (node instanceof Node) {
	            if (root === null) {
	              parts[++k] = root = document.createDocumentFragment();
	              string += "<!--o:" + k + "-->";
	            }
	            root.appendChild(node);
	          } else {
	            root = null;
	            string += node;
	          }
	        }
	        root = null;
	      } else {
	        string += part;
	      }
	      string += strings[i];
	    }

	    // Render the text.
	    root = render(string);

	    // Walk the rendered content to replace comment placeholders.
	    if (++k > 0) {
	      nodes = new Array(k);
	      walker = document.createTreeWalker(root, NodeFilter.SHOW_COMMENT, null, false);
	      while (walker.nextNode()) {
	        node = walker.currentNode;
	        if (/^o:/.test(node.nodeValue)) {
	          nodes[+node.nodeValue.slice(2)] = node;
	        }
	      }
	      for (i = 0; i < k; ++i) {
	        if (node = nodes[i]) {
	          node.parentNode.replaceChild(parts[i], node);
	        }
	      }
	    }

	    // Is the rendered content
	    // â€¦ a parent of a single child? Detach and return the child.
	    // â€¦ a document fragment? Replace the fragment with an element.
	    // â€¦ some other node? Return it.
	    return root.childNodes.length === 1 ? root.removeChild(root.firstChild)
	        : root.nodeType === 11 ? ((node = wrapper()).appendChild(root), node)
	        : root;
	  };
	}

	const html$1 = template(function(string) {
	  var template = document.createElement("template");
	  template.innerHTML = string.trim();
	  return document.importNode(template.content, true);
	}, function() {
	  return document.createElement("span");
	});

	async function leaflet(require) {
	  const L = await require(leaflet$1.resolve());
	  if (!L._style) {
	    const link = document.createElement("link");
	    link.rel = "stylesheet";
	    link.href = await require.resolve(leaflet$1.resolve("dist/leaflet.css"));
	    L._style = document.head.appendChild(link);
	  }
	  return L;
	}

	function md(require) {
	  return require(marked.resolve()).then(function(marked) {
	    return template(
	      function(string) {
	        var root = document.createElement("div");
	        root.innerHTML = marked(string, {langPrefix: ""}).trim();
	        var code = root.querySelectorAll("pre code[class]");
	        if (code.length > 0) {
	          require(highlight.resolve()).then(function(hl) {
	            code.forEach(function(block) {
	              function done() {
	                hl.highlightBlock(block);
	                block.parentNode.classList.add("observablehq--md-pre");
	              }
	              if (hl.getLanguage(block.className)) {
	                done();
	              } else {
	                require(highlight.resolve("async-languages/index.js"))
	                  .then(index => {
	                    if (index.has(block.className)) {
	                      return require(highlight.resolve("async-languages/" + index.get(block.className))).then(language => {
	                        hl.registerLanguage(block.className, language);
	                      });
	                    }
	                  })
	                  .then(done, done);
	              }
	            });
	          });
	        }
	        return root;
	      },
	      function() {
	        return document.createElement("div");
	      }
	    );
	  });
	}

	async function mermaid(require) {
	  const mer = await require(mermaid$1.resolve());
	  mer.initialize({securityLevel: "loose", theme: "neutral"});
	  return function mermaid() {
	    const root = document.createElement("div");
	    root.innerHTML = mer.render(uid().id, String.raw.apply(String, arguments));
	    return root.removeChild(root.firstChild);
	  };
	}

	function Mutable(value) {
	  let change;
	  Object.defineProperties(this, {
	    generator: {value: observe(_ => void (change = _))},
	    value: {get: () => value, set: x => change(value = x)} // eslint-disable-line no-setter-return
	  });
	  if (value !== undefined) change(value);
	}

	function* now() {
	  while (true) {
	    yield Date.now();
	  }
	}

	function delay(duration, value) {
	  return new Promise(function(resolve) {
	    setTimeout(function() {
	      resolve(value);
	    }, duration);
	  });
	}

	var timeouts = new Map;

	function timeout(now, time) {
	  var t = new Promise(function(resolve) {
	    timeouts.delete(time);
	    var delay = time - now;
	    if (!(delay > 0)) throw new Error("invalid time");
	    if (delay > 0x7fffffff) throw new Error("too long to wait");
	    setTimeout(resolve, delay);
	  });
	  timeouts.set(time, t);
	  return t;
	}

	function when(time, value) {
	  var now;
	  return (now = timeouts.get(time = +time)) ? now.then(() => value)
	      : (now = Date.now()) >= time ? Promise.resolve(value)
	      : timeout(now, time).then(() => value);
	}

	function tick(duration, value) {
	  return when(Math.ceil((Date.now() + 1) / duration) * duration, value);
	}

	var Promises = /*#__PURE__*/Object.freeze({
		__proto__: null,
		delay: delay,
		tick: tick,
		when: when
	});

	function resolve$1(name, base) {
	  if (/^(\w+:)|\/\//i.test(name)) return name;
	  if (/^[.]{0,2}\//i.test(name)) return new URL(name, base == null ? location : base).href;
	  if (!name.length || /^[\s._]/.test(name) || /\s$/.test(name)) throw new Error("illegal name");
	  return "https://unpkg.com/" + name;
	}

	const svg = template(function(string) {
	  var root = document.createElementNS("http://www.w3.org/2000/svg", "g");
	  root.innerHTML = string.trim();
	  return root;
	}, function() {
	  return document.createElementNS("http://www.w3.org/2000/svg", "g");
	});

	var raw = String.raw;

	function style(href) {
	  return new Promise(function(resolve, reject) {
	    var link = document.createElement("link");
	    link.rel = "stylesheet";
	    link.href = href;
	    link.onerror = reject;
	    link.onload = resolve;
	    document.head.appendChild(link);
	  });
	}

	function tex(require) {
	  return Promise.all([
	    require(katex.resolve()),
	    require.resolve(katex.resolve("dist/katex.min.css")).then(style)
	  ]).then(function(values) {
	    var katex = values[0], tex = renderer();

	    function renderer(options) {
	      return function() {
	        var root = document.createElement("div");
	        katex.render(raw.apply(String, arguments), root, options);
	        return root.removeChild(root.firstChild);
	      };
	    }

	    tex.options = renderer;
	    tex.block = renderer({displayMode: true});
	    return tex;
	  });
	}

	async function vl(require) {
	  const [v, vl, api] = await Promise.all([vega, vegalite, vegaliteApi].map(d => require(d.resolve())));
	  return api.register(v, vl);
	}

	function width$2() {
	  return observe(function(change) {
	    var width = change(document.body.clientWidth);
	    function resized() {
	      var w = document.body.clientWidth;
	      if (w !== width) change(width = w);
	    }
	    window.addEventListener("resize", resized);
	    return function() {
	      window.removeEventListener("resize", resized);
	    };
	  });
	}

	const Library = Object.assign(Object.defineProperties(function Library(resolver) {
	  const require = requirer(resolver);
	  Object.defineProperties(this, properties({
	    FileAttachment: () => NoFileAttachments,
	    Mutable: () => Mutable,
	    now,
	    width: width$2,

	    // Tagged template literals
	    dot: () => require(graphviz.resolve()),
	    htl: () => require(htl.resolve()),
	    html: () => html$1,
	    md: () => md(require),
	    svg: () => svg,
	    tex: () => tex(require),

	    // Recommended libraries
	    // https://observablehq.com/@observablehq/recommended-libraries
	    _: () => require(lodash.resolve()),
	    aq: () => require.alias({"apache-arrow": arrow4.resolve()})(arquero.resolve()), // TODO upgrade to apache-arrow@9
	    Arrow: () => require(arrow4.resolve()), // TODO upgrade to apache-arrow@9
	    d3: () => require(d3.resolve()),
	    DuckDBClient: () => DuckDBClient,
	    Inputs: () => require(inputs.resolve()).then(Inputs => ({...Inputs, file: Inputs.fileOf(AbstractFile)})),
	    L: () => leaflet(require),
	    mermaid: () => mermaid(require),
	    Plot: () => require(plot.resolve()),
	    __query: () => __query,
	    require: () => require,
	    resolve: () => resolve$1, // deprecated; use async require.resolve instead
	    SQLite: () => SQLite(require),
	    SQLiteDatabaseClient: () => SQLiteDatabaseClient,
	    topojson: () => require(topojson.resolve()),
	    vl: () => vl(require),

	    // Sample datasets
	    // https://observablehq.com/@observablehq/sample-datasets
	    aapl: () => new FileAttachment("https://static.observableusercontent.com/files/3ccff97fd2d93da734e76829b2b066eafdaac6a1fafdec0faf6ebc443271cfc109d29e80dd217468fcb2aff1e6bffdc73f356cc48feb657f35378e6abbbb63b9").csv({typed: true}),
	    alphabet: () => new FileAttachment("https://static.observableusercontent.com/files/75d52e6c3130b1cae83cda89305e17b50f33e7420ef205587a135e8562bcfd22e483cf4fa2fb5df6dff66f9c5d19740be1cfaf47406286e2eb6574b49ffc685d").csv({typed: true}),
	    cars: () => new FileAttachment("https://static.observableusercontent.com/files/048ec3dfd528110c0665dfa363dd28bc516ffb7247231f3ab25005036717f5c4c232a5efc7bb74bc03037155cb72b1abe85a33d86eb9f1a336196030443be4f6").csv({typed: true}),
	    citywages: () => new FileAttachment("https://static.observableusercontent.com/files/39837ec5121fcc163131dbc2fe8c1a2e0b3423a5d1e96b5ce371e2ac2e20a290d78b71a4fb08b9fa6a0107776e17fb78af313b8ea70f4cc6648fad68ddf06f7a").csv({typed: true}),
	    diamonds: () => new FileAttachment("https://static.observableusercontent.com/files/87942b1f5d061a21fa4bb8f2162db44e3ef0f7391301f867ab5ba718b225a63091af20675f0bfe7f922db097b217b377135203a7eab34651e21a8d09f4e37252").csv({typed: true}),
	    flare: () => new FileAttachment("https://static.observableusercontent.com/files/a6b0d94a7f5828fd133765a934f4c9746d2010e2f342d335923991f31b14120de96b5cb4f160d509d8dc627f0107d7f5b5070d2516f01e4c862b5b4867533000").csv({typed: true}),
	    industries: () => new FileAttachment("https://static.observableusercontent.com/files/76f13741128340cc88798c0a0b7fa5a2df8370f57554000774ab8ee9ae785ffa2903010cad670d4939af3e9c17e5e18e7e05ed2b38b848ac2fc1a0066aa0005f").csv({typed: true}),
	    miserables: () => new FileAttachment("https://static.observableusercontent.com/files/31d904f6e21d42d4963ece9c8cc4fbd75efcbdc404bf511bc79906f0a1be68b5a01e935f65123670ed04e35ca8cae3c2b943f82bf8db49c5a67c85cbb58db052").json(),
	    olympians: () => new FileAttachment("https://static.observableusercontent.com/files/31ca24545a0603dce099d10ee89ee5ae72d29fa55e8fc7c9ffb5ded87ac83060d80f1d9e21f4ae8eb04c1e8940b7287d179fe8060d887fb1f055f430e210007c").csv({typed: true}),
	    penguins: () => new FileAttachment("https://static.observableusercontent.com/files/715db1223e067f00500780077febc6cebbdd90c151d3d78317c802732252052ab0e367039872ab9c77d6ef99e5f55a0724b35ddc898a1c99cb14c31a379af80a").csv({typed: true}),
	    pizza: () => new FileAttachment("https://static.observableusercontent.com/files/c653108ab176088cacbb338eaf2344c4f5781681702bd6afb55697a3f91b511c6686ff469f3e3a27c75400001a2334dbd39a4499fe46b50a8b3c278b7d2f7fb5").csv({typed: true}),
	    weather: () => new FileAttachment("https://static.observableusercontent.com/files/693a46b22b33db0f042728700e0c73e836fa13d55446df89120682d55339c6db7cc9e574d3d73f24ecc9bc7eb9ac9a1e7e104a1ee52c00aab1e77eb102913c1f").csv({typed: true}),

	    // Note: these are namespace objects, and thus exposed directly rather than
	    // being wrapped in a function. This allows library.Generators to resolve,
	    // rather than needing module.value.
	    DOM,
	    Files,
	    Generators,
	    Promises
	  }));
	}, {
	  resolve: {
	    get: () => requireDefault.resolve,
	    enumerable: true,
	    configurable: true
	  },
	  require: {
	    get: () => requireDefault,
	    set: setDefaultRequire,
	    enumerable: true,
	    configurable: true
	  }
	}), {
	  resolveFrom,
	  requireFrom
	});

	function properties(values) {
	  return Object.fromEntries(Object.entries(values).map(property));
	}

	function property([key, value]) {
	  return [key, ({value, writable: true, enumerable: true})];
	}

	class RuntimeError extends Error {
	  constructor(message, input) {
	    super(message);
	    this.input = input;
	  }
	}

	RuntimeError.prototype.name = "RuntimeError";

	function generatorish(value) {
	  return value
	      && typeof value.next === "function"
	      && typeof value.return === "function";
	}

	function constant(x) {
	  return () => x;
	}

	function identity$1(x) {
	  return x;
	}

	function rethrow(error) {
	  return () => {
	    throw error;
	  };
	}

	const prototype = Array.prototype;
	const map = prototype.map;

	function noop() {}

	const TYPE_NORMAL = 1; // a normal variable
	const TYPE_IMPLICIT = 2; // created on reference
	const TYPE_DUPLICATE = 3; // created on duplicate definition

	const no_observer = Symbol("no-observer");

	function Variable(type, module, observer, options) {
	  if (!observer) observer = no_observer;
	  Object.defineProperties(this, {
	    _observer: {value: observer, writable: true},
	    _definition: {value: variable_undefined, writable: true},
	    _duplicate: {value: undefined, writable: true},
	    _duplicates: {value: undefined, writable: true},
	    _indegree: {value: NaN, writable: true}, // The number of computing inputs.
	    _inputs: {value: [], writable: true},
	    _invalidate: {value: noop, writable: true},
	    _module: {value: module},
	    _name: {value: null, writable: true},
	    _outputs: {value: new Set, writable: true},
	    _promise: {value: Promise.resolve(undefined), writable: true},
	    _reachable: {value: observer !== no_observer, writable: true}, // Is this variable transitively visible?
	    _rejector: {value: variable_rejector(this)},
	    _shadow: {value: initShadow(module, options)},
	    _type: {value: type},
	    _value: {value: undefined, writable: true},
	    _version: {value: 0, writable: true}
	  });
	}

	Object.defineProperties(Variable.prototype, {
	  _pending: {value: variable_pending, writable: true, configurable: true},
	  _fulfilled: {value: variable_fulfilled, writable: true, configurable: true},
	  _rejected: {value: variable_rejected, writable: true, configurable: true},
	  _resolve: {value: variable_resolve, writable: true, configurable: true},
	  define: {value: variable_define, writable: true, configurable: true},
	  delete: {value: variable_delete, writable: true, configurable: true},
	  import: {value: variable_import, writable: true, configurable: true}
	});

	function initShadow(module, options) {
	  if (!options?.shadow) return null;
	  return new Map(
	    Object.entries(options.shadow)
	      .map(([name, definition]) => [name, (new Variable(TYPE_IMPLICIT, module)).define([], definition)])
	  );
	}

	function variable_attach(variable) {
	  variable._module._runtime._dirty.add(variable);
	  variable._outputs.add(this);
	}

	function variable_detach(variable) {
	  variable._module._runtime._dirty.add(variable);
	  variable._outputs.delete(this);
	}

	function variable_undefined() {
	  throw variable_undefined;
	}

	function variable_stale() {
	  throw variable_stale;
	}

	function variable_rejector(variable) {
	  return (error) => {
	    if (error === variable_stale) throw error;
	    if (error === variable_undefined) throw new RuntimeError(`${variable._name} is not defined`, variable._name);
	    if (error instanceof Error && error.message) throw new RuntimeError(error.message, variable._name);
	    throw new RuntimeError(`${variable._name} could not be resolved`, variable._name);
	  };
	}

	function variable_duplicate(name) {
	  return () => {
	    throw new RuntimeError(`${name} is defined more than once`);
	  };
	}

	function variable_define(name, inputs, definition) {
	  switch (arguments.length) {
	    case 1: {
	      definition = name, name = inputs = null;
	      break;
	    }
	    case 2: {
	      definition = inputs;
	      if (typeof name === "string") inputs = null;
	      else inputs = name, name = null;
	      break;
	    }
	  }
	  return variable_defineImpl.call(this,
	    name == null ? null : String(name),
	    inputs == null ? [] : map.call(inputs, this._resolve, this),
	    typeof definition === "function" ? definition : constant(definition)
	  );
	}

	function variable_resolve(name) {
	  return this._shadow?.get(name) ?? this._module._resolve(name);
	}

	function variable_defineImpl(name, inputs, definition) {
	  const scope = this._module._scope, runtime = this._module._runtime;

	  this._inputs.forEach(variable_detach, this);
	  inputs.forEach(variable_attach, this);
	  this._inputs = inputs;
	  this._definition = definition;
	  this._value = undefined;

	  // Is this an active variable (that may require disposal)?
	  if (definition === noop) runtime._variables.delete(this);
	  else runtime._variables.add(this);

	  // Did the variableâ€™s name change? Time to patch references!
	  if (name !== this._name || scope.get(name) !== this) {
	    let error, found;

	    if (this._name) { // Did this variable previously have a name?
	      if (this._outputs.size) { // And did other variables reference this variable?
	        scope.delete(this._name);
	        found = this._module._resolve(this._name);
	        found._outputs = this._outputs, this._outputs = new Set;
	        found._outputs.forEach(function(output) { output._inputs[output._inputs.indexOf(this)] = found; }, this);
	        found._outputs.forEach(runtime._updates.add, runtime._updates);
	        runtime._dirty.add(found).add(this);
	        scope.set(this._name, found);
	      } else if ((found = scope.get(this._name)) === this) { // Do no other variables reference this variable?
	        scope.delete(this._name); // Itâ€™s safe to delete!
	      } else if (found._type === TYPE_DUPLICATE) { // Do other variables assign this name?
	        found._duplicates.delete(this); // This variable no longer assigns this name.
	        this._duplicate = undefined;
	        if (found._duplicates.size === 1) { // Is there now only one variable assigning this name?
	          found = found._duplicates.keys().next().value; // Any references are now fixed!
	          error = scope.get(this._name);
	          found._outputs = error._outputs, error._outputs = new Set;
	          found._outputs.forEach(function(output) { output._inputs[output._inputs.indexOf(error)] = found; });
	          found._definition = found._duplicate, found._duplicate = undefined;
	          runtime._dirty.add(error).add(found);
	          runtime._updates.add(found);
	          scope.set(this._name, found);
	        }
	      } else {
	        throw new Error;
	      }
	    }

	    if (this._outputs.size) throw new Error;

	    if (name) { // Does this variable have a new name?
	      if (found = scope.get(name)) { // Do other variables reference or assign this name?
	        if (found._type === TYPE_DUPLICATE) { // Do multiple other variables already define this name?
	          this._definition = variable_duplicate(name), this._duplicate = definition;
	          found._duplicates.add(this);
	        } else if (found._type === TYPE_IMPLICIT) { // Are the variable references broken?
	          this._outputs = found._outputs, found._outputs = new Set; // Now theyâ€™re fixed!
	          this._outputs.forEach(function(output) { output._inputs[output._inputs.indexOf(found)] = this; }, this);
	          runtime._dirty.add(found).add(this);
	          scope.set(name, this);
	        } else { // Does another variable define this name?
	          found._duplicate = found._definition, this._duplicate = definition; // Now theyâ€™re duplicates.
	          error = new Variable(TYPE_DUPLICATE, this._module);
	          error._name = name;
	          error._definition = this._definition = found._definition = variable_duplicate(name);
	          error._outputs = found._outputs, found._outputs = new Set;
	          error._outputs.forEach(function(output) { output._inputs[output._inputs.indexOf(found)] = error; });
	          error._duplicates = new Set([this, found]);
	          runtime._dirty.add(found).add(error);
	          runtime._updates.add(found).add(error);
	          scope.set(name, error);
	        }
	      } else {
	        scope.set(name, this);
	      }
	    }

	    this._name = name;
	  }

	  // If this redefined variable was previously evaluated, invalidate it. (If the
	  // variable was never evaluated, then the invalidated value could never have
	  // been exposed and we can avoid this extra work.)
	  if (this._version > 0) ++this._version;

	  runtime._updates.add(this);
	  runtime._compute();
	  return this;
	}

	function variable_import(remote, name, module) {
	  if (arguments.length < 3) module = name, name = remote;
	  return variable_defineImpl.call(this, String(name), [module._resolve(String(remote))], identity$1);
	}

	function variable_delete() {
	  return variable_defineImpl.call(this, null, [], noop);
	}

	function variable_pending() {
	  if (this._observer.pending) this._observer.pending();
	}

	function variable_fulfilled(value) {
	  if (this._observer.fulfilled) this._observer.fulfilled(value, this._name);
	}

	function variable_rejected(error) {
	  if (this._observer.rejected) this._observer.rejected(error, this._name);
	}

	const variable_variable = Symbol("variable");
	const variable_invalidation = Symbol("invalidation");
	const variable_visibility = Symbol("visibility");

	function Module(runtime, builtins = []) {
	  Object.defineProperties(this, {
	    _runtime: {value: runtime},
	    _scope: {value: new Map},
	    _builtins: {value: new Map([
	      ["@variable", variable_variable],
	      ["invalidation", variable_invalidation],
	      ["visibility", variable_visibility],
	      ...builtins
	    ])},
	    _source: {value: null, writable: true}
	  });
	}

	Object.defineProperties(Module.prototype, {
	  _resolve: {value: module_resolve, writable: true, configurable: true},
	  redefine: {value: module_redefine, writable: true, configurable: true},
	  define: {value: module_define, writable: true, configurable: true},
	  derive: {value: module_derive, writable: true, configurable: true},
	  import: {value: module_import, writable: true, configurable: true},
	  value: {value: module_value, writable: true, configurable: true},
	  variable: {value: module_variable, writable: true, configurable: true},
	  builtin: {value: module_builtin, writable: true, configurable: true}
	});

	function module_redefine(name) {
	  const v = this._scope.get(name);
	  if (!v) throw new RuntimeError(`${name} is not defined`);
	  if (v._type === TYPE_DUPLICATE) throw new RuntimeError(`${name} is defined more than once`);
	  return v.define.apply(v, arguments);
	}

	function module_define() {
	  const v = new Variable(TYPE_NORMAL, this);
	  return v.define.apply(v, arguments);
	}

	function module_import() {
	  const v = new Variable(TYPE_NORMAL, this);
	  return v.import.apply(v, arguments);
	}

	function module_variable(observer, options) {
	  return new Variable(TYPE_NORMAL, this, observer, options);
	}

	async function module_value(name) {
	  let v = this._scope.get(name);
	  if (!v) throw new RuntimeError(`${name} is not defined`);
	  if (v._observer === no_observer) {
	    v = this.variable(true).define([name], identity$1);
	    try {
	      return await module_revalue(this._runtime, v);
	    } finally {
	      v.delete();
	    }
	  } else {
	    return module_revalue(this._runtime, v);
	  }
	}

	// If the variable is redefined before its value resolves, try again.
	async function module_revalue(runtime, variable) {
	  await runtime._compute();
	  try {
	    return await variable._promise;
	  } catch (error) {
	    if (error === variable_stale) return module_revalue(runtime, variable);
	    throw error;
	  }
	}

	function module_derive(injects, injectModule) {
	  const map = new Map();
	  const modules = new Set();
	  const copies = [];

	  // Given a module, derives an alias of that module with an initially-empty
	  // definition. The variables will be copied later in a second pass below.
	  function alias(source) {
	    let target = map.get(source);
	    if (target) return target;
	    target = new Module(source._runtime, source._builtins);
	    target._source = source;
	    map.set(source, target);
	    copies.push([target, source]);
	    modules.add(source);
	    return target;
	  }

	  // Inject the given variables as reverse imports into the derived module.
	  const derive = alias(this);
	  for (const inject of injects) {
	    const {alias, name} = typeof inject === "object" ? inject : {name: inject};
	    derive.import(name, alias == null ? name : alias, injectModule);
	  }

	  // Iterate over all the variables (currently) in this module. If any
	  // represents an import-with (i.e., an import of a module with a _source), the
	  // transitive import-with must be copied, too, as direct injections may affect
	  // transitive injections. Note that an import-with can only be created with
	  // module.derive and hence itâ€™s not possible for an import-with to be added
	  // later; therefore we only need to apply this check once, now.
	  for (const module of modules) {
	    for (const [name, variable] of module._scope) {
	      if (variable._definition === identity$1) { // import
	        if (module === this && derive._scope.has(name)) continue; // overridden by injection
	        const importedModule = variable._inputs[0]._module;
	        if (importedModule._source) alias(importedModule);
	      }
	    }
	  }

	  // Finally, with the modules resolved, copy the variable definitions.
	  for (const [target, source] of copies) {
	    for (const [name, sourceVariable] of source._scope) {
	      const targetVariable = target._scope.get(name);
	      if (targetVariable && targetVariable._type !== TYPE_IMPLICIT) continue; // preserve injection
	      if (sourceVariable._definition === identity$1) { // import
	        const sourceInput = sourceVariable._inputs[0];
	        const sourceModule = sourceInput._module;
	        target.import(sourceInput._name, name, map.get(sourceModule) || sourceModule);
	      } else { // non-import
	        target.define(name, sourceVariable._inputs.map(variable_name), sourceVariable._definition);
	      }
	    }
	  }

	  return derive;
	}

	function module_resolve(name) {
	  let variable = this._scope.get(name), value;
	  if (!variable) {
	    variable = new Variable(TYPE_IMPLICIT, this);
	    if (this._builtins.has(name)) {
	      variable.define(name, constant(this._builtins.get(name)));
	    } else if (this._runtime._builtin._scope.has(name)) {
	      variable.import(name, this._runtime._builtin);
	    } else {
	      try {
	        value = this._runtime._global(name);
	      } catch (error) {
	        return variable.define(name, rethrow(error));
	      }
	      if (value === undefined) {
	        this._scope.set(variable._name = name, variable);
	      } else {
	        variable.define(name, constant(value));
	      }
	    }
	  }
	  return variable;
	}

	function module_builtin(name, value) {
	  this._builtins.set(name, value);
	}

	function variable_name(variable) {
	  return variable._name;
	}

	const frame = typeof requestAnimationFrame === "function" ? requestAnimationFrame
	  : typeof setImmediate === "function" ? setImmediate
	  : f => setTimeout(f, 0);

	function Runtime(builtins = new Library, global = window_global) {
	  const builtin = this.module();
	  Object.defineProperties(this, {
	    _dirty: {value: new Set},
	    _updates: {value: new Set},
	    _precomputes: {value: [], writable: true},
	    _computing: {value: null, writable: true},
	    _init: {value: null, writable: true},
	    _modules: {value: new Map},
	    _variables: {value: new Set},
	    _disposed: {value: false, writable: true},
	    _builtin: {value: builtin},
	    _global: {value: global}
	  });
	  if (builtins) for (const name in builtins) {
	    (new Variable(TYPE_IMPLICIT, builtin)).define(name, [], builtins[name]);
	  }
	}

	Object.defineProperties(Runtime.prototype, {
	  _precompute: {value: runtime_precompute, writable: true, configurable: true},
	  _compute: {value: runtime_compute, writable: true, configurable: true},
	  _computeSoon: {value: runtime_computeSoon, writable: true, configurable: true},
	  _computeNow: {value: runtime_computeNow, writable: true, configurable: true},
	  dispose: {value: runtime_dispose, writable: true, configurable: true},
	  module: {value: runtime_module, writable: true, configurable: true},
	  fileAttachments: {value: FileAttachments, writable: true, configurable: true}
	});

	function runtime_dispose() {
	  this._computing = Promise.resolve();
	  this._disposed = true;
	  this._variables.forEach(v => {
	    v._invalidate();
	    v._version = NaN;
	  });
	}

	function runtime_module(define, observer = noop) {
	  let module;
	  if (define === undefined) {
	    if (module = this._init) {
	      this._init = null;
	      return module;
	    }
	    return new Module(this);
	  }
	  module = this._modules.get(define);
	  if (module) return module;
	  this._init = module = new Module(this);
	  this._modules.set(define, module);
	  try {
	    define(this, observer);
	  } finally {
	    this._init = null;
	  }
	  return module;
	}

	function runtime_precompute(callback) {
	  this._precomputes.push(callback);
	  this._compute();
	}

	function runtime_compute() {
	  return this._computing || (this._computing = this._computeSoon());
	}

	function runtime_computeSoon() {
	  return new Promise(frame).then(() => this._disposed ? undefined : this._computeNow());
	}

	async function runtime_computeNow() {
	  let queue = [],
	      variables,
	      variable,
	      precomputes = this._precomputes;

	  // If there are any paused generators, resume them before computing so they
	  // can update (if synchronous) before computing downstream variables.
	  if (precomputes.length) {
	    this._precomputes = [];
	    for (const callback of precomputes) callback();
	    await runtime_defer(3);
	  }

	  // Compute the reachability of the transitive closure of dirty variables.
	  // Any newly-reachable variable must also be recomputed.
	  // Any no-longer-reachable variable must be terminated.
	  variables = new Set(this._dirty);
	  variables.forEach(function(variable) {
	    variable._inputs.forEach(variables.add, variables);
	    const reachable = variable_reachable(variable);
	    if (reachable > variable._reachable) {
	      this._updates.add(variable);
	    } else if (reachable < variable._reachable) {
	      variable._invalidate();
	    }
	    variable._reachable = reachable;
	  }, this);

	  // Compute the transitive closure of updating, reachable variables.
	  variables = new Set(this._updates);
	  variables.forEach(function(variable) {
	    if (variable._reachable) {
	      variable._indegree = 0;
	      variable._outputs.forEach(variables.add, variables);
	    } else {
	      variable._indegree = NaN;
	      variables.delete(variable);
	    }
	  });

	  this._computing = null;
	  this._updates.clear();
	  this._dirty.clear();

	  // Compute the indegree of updating variables.
	  variables.forEach(function(variable) {
	    variable._outputs.forEach(variable_increment);
	  });

	  do {
	    // Identify the root variables (those with no updating inputs).
	    variables.forEach(function(variable) {
	      if (variable._indegree === 0) {
	        queue.push(variable);
	      }
	    });

	    // Compute the variables in topological order.
	    while (variable = queue.pop()) {
	      variable_compute(variable);
	      variable._outputs.forEach(postqueue);
	      variables.delete(variable);
	    }

	    // Any remaining variables are circular, or depend on them.
	    variables.forEach(function(variable) {
	      if (variable_circular(variable)) {
	        variable_error(variable, new RuntimeError("circular definition"));
	        variable._outputs.forEach(variable_decrement);
	        variables.delete(variable);
	      }
	    });
	  } while (variables.size);

	  function postqueue(variable) {
	    if (--variable._indegree === 0) {
	      queue.push(variable);
	    }
	  }
	}

	// We want to give generators, if theyâ€™re defined synchronously, a chance to
	// update before computing downstream variables. This creates a synchronous
	// promise chain of the given depth that weâ€™ll await before recomputing
	// downstream variables.
	function runtime_defer(depth = 0) {
	  let p = Promise.resolve();
	  for (let i = 0; i < depth; ++i) p = p.then(() => {});
	  return p;
	}

	function variable_circular(variable) {
	  const inputs = new Set(variable._inputs);
	  for (const i of inputs) {
	    if (i === variable) return true;
	    i._inputs.forEach(inputs.add, inputs);
	  }
	  return false;
	}

	function variable_increment(variable) {
	  ++variable._indegree;
	}

	function variable_decrement(variable) {
	  --variable._indegree;
	}

	function variable_value(variable) {
	  return variable._promise.catch(variable._rejector);
	}

	function variable_invalidator(variable) {
	  return new Promise(function(resolve) {
	    variable._invalidate = resolve;
	  });
	}

	function variable_intersector(invalidation, variable) {
	  let node = typeof IntersectionObserver === "function" && variable._observer && variable._observer._node;
	  let visible = !node, resolve = noop, reject = noop, promise, observer;
	  if (node) {
	    observer = new IntersectionObserver(([entry]) => (visible = entry.isIntersecting) && (promise = null, resolve()));
	    observer.observe(node);
	    invalidation.then(() => (observer.disconnect(), observer = null, reject()));
	  }
	  return function(value) {
	    if (visible) return Promise.resolve(value);
	    if (!observer) return Promise.reject();
	    if (!promise) promise = new Promise((y, n) => (resolve = y, reject = n));
	    return promise.then(() => value);
	  };
	}

	function variable_compute(variable) {
	  variable._invalidate();
	  variable._invalidate = noop;
	  variable._pending();

	  const value0 = variable._value;
	  const version = ++variable._version;

	  // Lazily-constructed invalidation variable; only constructed if referenced as an input.
	  let invalidation = null;

	  // If the variable doesnâ€™t have any inputs, we can optimize slightly.
	  const promise = variable._promise = (variable._inputs.length
	      ? Promise.all(variable._inputs.map(variable_value)).then(define)
	      : new Promise(resolve => resolve(variable._definition.call(value0))))
	    .then(generate);

	  // Compute the initial value of the variable.
	  function define(inputs) {
	    if (variable._version !== version) throw variable_stale;

	    // Replace any reference to invalidation with the promise, lazily.
	    for (let i = 0, n = inputs.length; i < n; ++i) {
	      switch (inputs[i]) {
	        case variable_invalidation: {
	          inputs[i] = invalidation = variable_invalidator(variable);
	          break;
	        }
	        case variable_visibility: {
	          if (!invalidation) invalidation = variable_invalidator(variable);
	          inputs[i] = variable_intersector(invalidation, variable);
	          break;
	        }
	        case variable_variable: {
	          inputs[i] = variable;
	          break;
	        }
	      }
	    }

	    return variable._definition.apply(value0, inputs);
	  }

	  // If the value is a generator, then retrieve its first value, and dispose of
	  // the generator if the variable is invalidated. Note that the cell may
	  // already have been invalidated here, in which case we need to terminate the
	  // generator immediately!
	  function generate(value) {
	    if (variable._version !== version) throw variable_stale;
	    if (generatorish(value)) {
	      (invalidation || variable_invalidator(variable)).then(variable_return(value));
	      return variable_generate(variable, version, value);
	    }
	    return value;
	  }

	  promise.then((value) => {
	    variable._value = value;
	    variable._fulfilled(value);
	  }, (error) => {
	    if (error === variable_stale) return;
	    variable._value = undefined;
	    variable._rejected(error);
	  });
	}

	function variable_generate(variable, version, generator) {
	  const runtime = variable._module._runtime;
	  let currentValue; // so that yield resolves to the yielded value

	  // Retrieve the next value from the generator; if successful, invoke the
	  // specified callback. The returned promise resolves to the yielded value, or
	  // to undefined if the generator is done.
	  function compute(onfulfilled) {
	    return new Promise(resolve => resolve(generator.next(currentValue))).then(({done, value}) => {
	      return done ? undefined : Promise.resolve(value).then(onfulfilled);
	    });
	  }

	  // Retrieve the next value from the generator; if successful, fulfill the
	  // variable, compute downstream variables, and schedule the next value to be
	  // pulled from the generator at the start of the next animation frame. If not
	  // successful, reject the variable, compute downstream variables, and return.
	  function recompute() {
	    const promise = compute((value) => {
	      if (variable._version !== version) throw variable_stale;
	      currentValue = value;
	      postcompute(value, promise).then(() => runtime._precompute(recompute));
	      variable._fulfilled(value);
	      return value;
	    });
	    promise.catch((error) => {
	      if (error === variable_stale || variable._version !== version) return;
	      postcompute(undefined, promise);
	      variable._rejected(error);
	    });
	  }

	  // After the generator fulfills or rejects, set its current value, promise,
	  // and schedule any downstream variables for update.
	  function postcompute(value, promise) {
	    variable._value = value;
	    variable._promise = promise;
	    variable._outputs.forEach(runtime._updates.add, runtime._updates);
	    return runtime._compute();
	  }

	  // When retrieving the first value from the generator, the promise graph is
	  // already established, so we only need to queue the next pull.
	  return compute((value) => {
	    if (variable._version !== version) throw variable_stale;
	    currentValue = value;
	    runtime._precompute(recompute);
	    return value;
	  });
	}

	function variable_error(variable, error) {
	  variable._invalidate();
	  variable._invalidate = noop;
	  variable._pending();
	  ++variable._version;
	  variable._indegree = NaN;
	  (variable._promise = Promise.reject(error)).catch(noop);
	  variable._value = undefined;
	  variable._rejected(error);
	}

	function variable_return(generator) {
	  return function() {
	    generator.return();
	  };
	}

	function variable_reachable(variable) {
	  if (variable._observer !== no_observer) return true; // Directly reachable.
	  const outputs = new Set(variable._outputs);
	  for (const output of outputs) {
	    if (output._observer !== no_observer) return true;
	    output._outputs.forEach(outputs.add, outputs);
	  }
	  return false;
	}

	function window_global(name) {
	  return globalThis[name];
	}

	function renderHtml(string) {
	  const template = document.createElement("template");
	  template.innerHTML = string;
	  return document.importNode(template.content, true);
	}

	function renderSvg(string) {
	  const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
	  g.innerHTML = string;
	  return g;
	}

	const html = Object.assign(hypertext(renderHtml, fragment => {
	  if (fragment.firstChild === null) return null;
	  if (fragment.firstChild === fragment.lastChild) return fragment.removeChild(fragment.firstChild);
	  const span = document.createElement("span");
	  span.appendChild(fragment);
	  return span;
	}), {fragment: hypertext(renderHtml, fragment => fragment)});

	Object.assign(hypertext(renderSvg, g => {
	  if (g.firstChild === null) return null;
	  if (g.firstChild === g.lastChild) return g.removeChild(g.firstChild);
	  return g;
	}), {fragment: hypertext(renderSvg, g => {
	  const fragment = document.createDocumentFragment();
	  while (g.firstChild) fragment.appendChild(g.firstChild);
	  return fragment;
	})});

	const
	CODE_TAB = 9,
	CODE_LF = 10,
	CODE_FF = 12,
	CODE_CR = 13,
	CODE_SPACE = 32,
	CODE_UPPER_A = 65,
	CODE_UPPER_Z = 90,
	CODE_LOWER_A = 97,
	CODE_LOWER_Z = 122,
	CODE_LT = 60,
	CODE_GT = 62,
	CODE_SLASH = 47,
	CODE_DASH = 45,
	CODE_BANG = 33,
	CODE_EQ = 61,
	CODE_DQUOTE = 34,
	CODE_SQUOTE = 39,
	CODE_QUESTION = 63,
	STATE_DATA = 1,
	STATE_TAG_OPEN = 2,
	STATE_END_TAG_OPEN = 3,
	STATE_TAG_NAME = 4,
	STATE_BOGUS_COMMENT = 5,
	STATE_BEFORE_ATTRIBUTE_NAME = 6,
	STATE_AFTER_ATTRIBUTE_NAME = 7,
	STATE_ATTRIBUTE_NAME = 8,
	STATE_BEFORE_ATTRIBUTE_VALUE = 9,
	STATE_ATTRIBUTE_VALUE_DOUBLE_QUOTED = 10,
	STATE_ATTRIBUTE_VALUE_SINGLE_QUOTED = 11,
	STATE_ATTRIBUTE_VALUE_UNQUOTED = 12,
	STATE_AFTER_ATTRIBUTE_VALUE_QUOTED = 13,
	STATE_SELF_CLOSING_START_TAG = 14,
	STATE_COMMENT_START = 15,
	STATE_COMMENT_START_DASH = 16,
	STATE_COMMENT = 17,
	STATE_COMMENT_LESS_THAN_SIGN = 18,
	STATE_COMMENT_LESS_THAN_SIGN_BANG = 19,
	STATE_COMMENT_LESS_THAN_SIGN_BANG_DASH = 20,
	STATE_COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH = 21,
	STATE_COMMENT_END_DASH = 22,
	STATE_COMMENT_END = 23,
	STATE_COMMENT_END_BANG = 24,
	STATE_MARKUP_DECLARATION_OPEN = 25,
	STATE_RAWTEXT = 26,
	STATE_RAWTEXT_LESS_THAN_SIGN = 27,
	STATE_RAWTEXT_END_TAG_OPEN = 28,
	STATE_RAWTEXT_END_TAG_NAME = 29,
	SHOW_COMMENT = 128,
	SHOW_ELEMENT = 1,
	TYPE_COMMENT = 8,
	TYPE_ELEMENT = 1,
	NS_SVG = "http://www.w3.org/2000/svg",
	NS_XLINK = "http://www.w3.org/1999/xlink",
	NS_XML = "http://www.w3.org/XML/1998/namespace",
	NS_XMLNS = "http://www.w3.org/2000/xmlns/";

	const svgAdjustAttributes = new Map([
	  "attributeName",
	  "attributeType",
	  "baseFrequency",
	  "baseProfile",
	  "calcMode",
	  "clipPathUnits",
	  "diffuseConstant",
	  "edgeMode",
	  "filterUnits",
	  "glyphRef",
	  "gradientTransform",
	  "gradientUnits",
	  "kernelMatrix",
	  "kernelUnitLength",
	  "keyPoints",
	  "keySplines",
	  "keyTimes",
	  "lengthAdjust",
	  "limitingConeAngle",
	  "markerHeight",
	  "markerUnits",
	  "markerWidth",
	  "maskContentUnits",
	  "maskUnits",
	  "numOctaves",
	  "pathLength",
	  "patternContentUnits",
	  "patternTransform",
	  "patternUnits",
	  "pointsAtX",
	  "pointsAtY",
	  "pointsAtZ",
	  "preserveAlpha",
	  "preserveAspectRatio",
	  "primitiveUnits",
	  "refX",
	  "refY",
	  "repeatCount",
	  "repeatDur",
	  "requiredExtensions",
	  "requiredFeatures",
	  "specularConstant",
	  "specularExponent",
	  "spreadMethod",
	  "startOffset",
	  "stdDeviation",
	  "stitchTiles",
	  "surfaceScale",
	  "systemLanguage",
	  "tableValues",
	  "targetX",
	  "targetY",
	  "textLength",
	  "viewBox",
	  "viewTarget",
	  "xChannelSelector",
	  "yChannelSelector",
	  "zoomAndPan"
	].map(name => [name.toLowerCase(), name]));

	const svgForeignAttributes = new Map([
	  ["xlink:actuate", NS_XLINK],
	  ["xlink:arcrole", NS_XLINK],
	  ["xlink:href", NS_XLINK],
	  ["xlink:role", NS_XLINK],
	  ["xlink:show", NS_XLINK],
	  ["xlink:title", NS_XLINK],
	  ["xlink:type", NS_XLINK],
	  ["xml:lang", NS_XML],
	  ["xml:space", NS_XML],
	  ["xmlns", NS_XMLNS],
	  ["xmlns:xlink", NS_XMLNS]
	]);

	function hypertext(render, postprocess) {
	  return function({raw: strings}) {
	    let state = STATE_DATA;
	    let string = "";
	    let tagNameStart; // either an open tag or an end tag
	    let tagName; // only open; beware nesting! used only for rawtext
	    let attributeNameStart;
	    let attributeNameEnd;
	    let nodeFilter = 0;

	    for (let j = 0, m = arguments.length; j < m; ++j) {
	      const input = strings[j];

	      if (j > 0) {
	        const value = arguments[j];
	        switch (state) {
	          case STATE_RAWTEXT: {
	            if (value != null) {
	              const text = `${value}`;
	              if (isEscapableRawText(tagName)) {
	                string += text.replace(/[<]/g, entity);
	              } else if (new RegExp(`</${tagName}[\\s>/]`, "i").test(string.slice(-tagName.length - 2) + text)) {
	                throw new Error("unsafe raw text"); // appropriate end tag
	              } else {
	                string += text;
	              }
	            }
	            break;
	          }
	          case STATE_DATA: {
	            if (value == null) ; else if (value instanceof Node
	                || (typeof value !== "string" && value[Symbol.iterator])
	                || (/(?:^|>)$/.test(strings[j - 1]) && /^(?:<|$)/.test(input))) {
	              string += "<!--::" + j + "-->";
	              nodeFilter |= SHOW_COMMENT;
	            } else {
	              string += `${value}`.replace(/[<&]/g, entity);
	            }
	            break;
	          }
	          case STATE_BEFORE_ATTRIBUTE_VALUE: {
	            state = STATE_ATTRIBUTE_VALUE_UNQUOTED;
	            let text;
	            if (/^[\s>]/.test(input)) {
	              if (value == null || value === false) {
	                string = string.slice(0, attributeNameStart - strings[j - 1].length);
	                break;
	              }
	              if (value === true || (text = `${value}`) === "") {
	                string += "''";
	                break;
	              }
	              const name = strings[j - 1].slice(attributeNameStart, attributeNameEnd);
	              if ((name === "style" && isObjectLiteral(value)) || typeof value === "function") {
	                string += "::" + j;
	                nodeFilter |= SHOW_ELEMENT;
	                break;
	              }
	            }
	            if (text === undefined) text = `${value}`;
	            if (text === "") throw new Error("unsafe unquoted empty string");
	            string += text.replace(/^['"]|[\s>&]/g, entity);
	            break;
	          }
	          case STATE_ATTRIBUTE_VALUE_UNQUOTED: {
	            string += `${value}`.replace(/[\s>&]/g, entity);
	            break;
	          }
	          case STATE_ATTRIBUTE_VALUE_SINGLE_QUOTED: {
	            string += `${value}`.replace(/['&]/g, entity);
	            break;
	          }
	          case STATE_ATTRIBUTE_VALUE_DOUBLE_QUOTED: {
	            string += `${value}`.replace(/["&]/g, entity);
	            break;
	          }
	          case STATE_BEFORE_ATTRIBUTE_NAME: {
	            if (isObjectLiteral(value)) {
	              string += "::" + j + "=''";
	              nodeFilter |= SHOW_ELEMENT;
	              break;
	            }
	            throw new Error("invalid binding");
	          }
	          case STATE_COMMENT: break;
	          default: throw new Error("invalid binding");
	        }
	      }

	      for (let i = 0, n = input.length; i < n; ++i) {
	        const code = input.charCodeAt(i);

	        switch (state) {
	          case STATE_DATA: {
	            if (code === CODE_LT) {
	              state = STATE_TAG_OPEN;
	            }
	            break;
	          }
	          case STATE_TAG_OPEN: {
	            if (code === CODE_BANG) {
	              state = STATE_MARKUP_DECLARATION_OPEN;
	            } else if (code === CODE_SLASH) {
	              state = STATE_END_TAG_OPEN;
	            } else if (isAsciiAlphaCode(code)) {
	              tagNameStart = i, tagName = undefined;
	              state = STATE_TAG_NAME, --i;
	            } else if (code === CODE_QUESTION) {
	              state = STATE_BOGUS_COMMENT, --i;
	            } else {
	              state = STATE_DATA, --i;
	            }
	            break;
	          }
	          case STATE_END_TAG_OPEN: {
	            if (isAsciiAlphaCode(code)) {
	              state = STATE_TAG_NAME, --i;
	            } else if (code === CODE_GT) {
	              state = STATE_DATA;
	            } else {
	              state = STATE_BOGUS_COMMENT, --i;
	            }
	            break;
	          }
	          case STATE_TAG_NAME: {
	            if (isSpaceCode(code)) {
	              state = STATE_BEFORE_ATTRIBUTE_NAME;
	              tagName = lower(input, tagNameStart, i);
	            } else if (code === CODE_SLASH) {
	              state = STATE_SELF_CLOSING_START_TAG;
	            } else if (code === CODE_GT) {
	              tagName = lower(input, tagNameStart, i);
	              state = isRawText(tagName) ? STATE_RAWTEXT : STATE_DATA;
	            }
	            break;
	          }
	          case STATE_BEFORE_ATTRIBUTE_NAME: {
	            if (isSpaceCode(code)) ; else if (code === CODE_SLASH || code === CODE_GT) {
	              state = STATE_AFTER_ATTRIBUTE_NAME, --i;
	            } else if (code === CODE_EQ) {
	              state = STATE_ATTRIBUTE_NAME;
	              attributeNameStart = i + 1, attributeNameEnd = undefined;
	            } else {
	              state = STATE_ATTRIBUTE_NAME, --i;
	              attributeNameStart = i + 1, attributeNameEnd = undefined;
	            }
	            break;
	          }
	          case STATE_ATTRIBUTE_NAME: {
	            if (isSpaceCode(code) || code === CODE_SLASH || code === CODE_GT) {
	              state = STATE_AFTER_ATTRIBUTE_NAME, --i;
	              attributeNameEnd = i;
	            } else if (code === CODE_EQ) {
	              state = STATE_BEFORE_ATTRIBUTE_VALUE;
	              attributeNameEnd = i;
	            }
	            break;
	          }
	          case STATE_AFTER_ATTRIBUTE_NAME: {
	            if (isSpaceCode(code)) ; else if (code === CODE_SLASH) {
	              state = STATE_SELF_CLOSING_START_TAG;
	            } else if (code === CODE_EQ) {
	              state = STATE_BEFORE_ATTRIBUTE_VALUE;
	            } else if (code === CODE_GT) {
	              state = isRawText(tagName) ? STATE_RAWTEXT : STATE_DATA;
	            } else {
	              state = STATE_ATTRIBUTE_NAME, --i;
	              attributeNameStart = i + 1, attributeNameEnd = undefined;
	            }
	            break;
	          }
	          case STATE_BEFORE_ATTRIBUTE_VALUE: {
	            if (isSpaceCode(code)) ; else if (code === CODE_DQUOTE) {
	              state = STATE_ATTRIBUTE_VALUE_DOUBLE_QUOTED;
	            } else if (code === CODE_SQUOTE) {
	              state = STATE_ATTRIBUTE_VALUE_SINGLE_QUOTED;
	            } else if (code === CODE_GT) {
	              state = isRawText(tagName) ? STATE_RAWTEXT : STATE_DATA;
	            } else {
	              state = STATE_ATTRIBUTE_VALUE_UNQUOTED, --i;
	            }
	            break;
	          }
	          case STATE_ATTRIBUTE_VALUE_DOUBLE_QUOTED: {
	            if (code === CODE_DQUOTE) {
	              state = STATE_AFTER_ATTRIBUTE_VALUE_QUOTED;
	            }
	            break;
	          }
	          case STATE_ATTRIBUTE_VALUE_SINGLE_QUOTED: {
	            if (code === CODE_SQUOTE) {
	              state = STATE_AFTER_ATTRIBUTE_VALUE_QUOTED;
	            }
	            break;
	          }
	          case STATE_ATTRIBUTE_VALUE_UNQUOTED: {
	            if (isSpaceCode(code)) {
	              state = STATE_BEFORE_ATTRIBUTE_NAME;
	            } else if (code === CODE_GT) {
	              state = isRawText(tagName) ? STATE_RAWTEXT : STATE_DATA;
	            }
	            break;
	          }
	          case STATE_AFTER_ATTRIBUTE_VALUE_QUOTED: {
	            if (isSpaceCode(code)) {
	              state = STATE_BEFORE_ATTRIBUTE_NAME;
	            } else if (code === CODE_SLASH) {
	              state = STATE_SELF_CLOSING_START_TAG;
	            } else if (code === CODE_GT) {
	              state = isRawText(tagName) ? STATE_RAWTEXT : STATE_DATA;
	            } else {
	              state = STATE_BEFORE_ATTRIBUTE_NAME, --i;
	            }
	            break;
	          }
	          case STATE_SELF_CLOSING_START_TAG: {
	            if (code === CODE_GT) {
	              state = STATE_DATA;
	            } else {
	              state = STATE_BEFORE_ATTRIBUTE_NAME, --i;
	            }
	            break;
	          }
	          case STATE_BOGUS_COMMENT: {
	            if (code === CODE_GT) {
	              state = STATE_DATA;
	            }
	            break;
	          }
	          case STATE_COMMENT_START: {
	            if (code === CODE_DASH) {
	              state = STATE_COMMENT_START_DASH;
	            } else if (code === CODE_GT) {
	              state = STATE_DATA;
	            } else {
	              state = STATE_COMMENT, --i;
	            }
	            break;
	          }
	          case STATE_COMMENT_START_DASH: {
	            if (code === CODE_DASH) {
	              state = STATE_COMMENT_END;
	            } else if (code === CODE_GT) {
	              state = STATE_DATA;
	            } else {
	              state = STATE_COMMENT, --i;
	            }
	            break;
	          }
	          case STATE_COMMENT: {
	            if (code === CODE_LT) {
	              state = STATE_COMMENT_LESS_THAN_SIGN;
	            } else if (code === CODE_DASH) {
	              state = STATE_COMMENT_END_DASH;
	            }
	            break;
	          }
	          case STATE_COMMENT_LESS_THAN_SIGN: {
	            if (code === CODE_BANG) {
	              state = STATE_COMMENT_LESS_THAN_SIGN_BANG;
	            } else if (code !== CODE_LT) {
	              state = STATE_COMMENT, --i;
	            }
	            break;
	          }
	          case STATE_COMMENT_LESS_THAN_SIGN_BANG: {
	            if (code === CODE_DASH) {
	              state = STATE_COMMENT_LESS_THAN_SIGN_BANG_DASH;
	            } else {
	              state = STATE_COMMENT, --i;
	            }
	            break;
	          }
	          case STATE_COMMENT_LESS_THAN_SIGN_BANG_DASH: {
	            if (code === CODE_DASH) {
	              state = STATE_COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH;
	            } else {
	              state = STATE_COMMENT_END, --i;
	            }
	            break;
	          }
	          case STATE_COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH: {
	            state = STATE_COMMENT_END, --i;
	            break;
	          }
	          case STATE_COMMENT_END_DASH: {
	            if (code === CODE_DASH) {
	              state = STATE_COMMENT_END;
	            } else {
	              state = STATE_COMMENT, --i;
	            }
	            break;
	          }
	          case STATE_COMMENT_END: {
	            if (code === CODE_GT) {
	              state = STATE_DATA;
	            } else if (code === CODE_BANG) {
	              state = STATE_COMMENT_END_BANG;
	            } else if (code !== CODE_DASH) {
	              state = STATE_COMMENT, --i;
	            }
	            break;
	          }
	          case STATE_COMMENT_END_BANG: {
	            if (code === CODE_DASH) {
	              state = STATE_COMMENT_END_DASH;
	            } else if (code === CODE_GT) {
	              state = STATE_DATA;
	            } else {
	              state = STATE_COMMENT, --i;
	            }
	            break;
	          }
	          case STATE_MARKUP_DECLARATION_OPEN: {
	            if (code === CODE_DASH && input.charCodeAt(i + 1) === CODE_DASH) {
	              state = STATE_COMMENT_START, ++i;
	            } else { // Note: CDATA and DOCTYPE unsupported!
	              state = STATE_BOGUS_COMMENT, --i;
	            }
	            break;
	          }
	          case STATE_RAWTEXT: {
	            if (code === CODE_LT) {
	              state = STATE_RAWTEXT_LESS_THAN_SIGN;
	            }
	            break;
	          }
	          case STATE_RAWTEXT_LESS_THAN_SIGN: {
	            if (code === CODE_SLASH) {
	              state = STATE_RAWTEXT_END_TAG_OPEN;
	            } else {
	              state = STATE_RAWTEXT, --i;
	            }
	            break;
	          }
	          case STATE_RAWTEXT_END_TAG_OPEN: {
	            if (isAsciiAlphaCode(code)) {
	              tagNameStart = i;
	              state = STATE_RAWTEXT_END_TAG_NAME, --i;
	            } else {
	              state = STATE_RAWTEXT, --i;
	            }
	            break;
	          }
	          case STATE_RAWTEXT_END_TAG_NAME: {
	            if (isSpaceCode(code) && tagName === lower(input, tagNameStart, i)) {
	              state = STATE_BEFORE_ATTRIBUTE_NAME;
	            } else if (code === CODE_SLASH && tagName === lower(input, tagNameStart, i)) {
	              state = STATE_SELF_CLOSING_START_TAG;
	            } else if (code === CODE_GT && tagName === lower(input, tagNameStart, i)) {
	              state = STATE_DATA;
	            } else if (!isAsciiAlphaCode(code)) {
	              state = STATE_RAWTEXT, --i;
	            }
	            break;
	          }
	          default: {
	            state = undefined;
	            break;
	          }
	        }
	      }

	      string += input;
	    }

	    const root = render(string);

	    const walker = document.createTreeWalker(root, nodeFilter, null, false);
	    const removeNodes = [];
	    while (walker.nextNode()) {
	      const node = walker.currentNode;
	      switch (node.nodeType) {
	        case TYPE_ELEMENT: {
	          const attributes = node.attributes;
	          for (let i = 0, n = attributes.length; i < n; ++i) {
	            const {name, value: currentValue} = attributes[i];
	            if (/^::/.test(name)) {
	              const value = arguments[+name.slice(2)];
	              removeAttribute(node, name), --i, --n;
	              for (const key in value) {
	                const subvalue = value[key];
	                if (subvalue == null || subvalue === false) ; else if (typeof subvalue === "function") {
	                  node[key] = subvalue;
	                } else if (key === "style" && isObjectLiteral(subvalue)) {
	                  setStyles(node[key], subvalue);
	                } else {
	                  setAttribute(node, key, subvalue === true ? "" : subvalue);
	                }
	              }
	            } else if (/^::/.test(currentValue)) {
	              const value = arguments[+currentValue.slice(2)];
	              removeAttribute(node, name), --i, --n;
	              if (typeof value === "function") {
	                node[name] = value;
	              } else { // style
	                setStyles(node[name], value);
	              }
	            }
	          }
	          break;
	        }
	        case TYPE_COMMENT: {
	          if (/^::/.test(node.data)) {
	            const parent = node.parentNode;
	            const value = arguments[+node.data.slice(2)];
	            if (value instanceof Node) {
	              parent.insertBefore(value, node);
	            } else if (typeof value !== "string" && value[Symbol.iterator]) {
	              if (value instanceof NodeList || value instanceof HTMLCollection) {
	                for (let i = value.length - 1, r = node; i >= 0; --i) {
	                  r = parent.insertBefore(value[i], r);
	                }
	              } else {
	                for (const subvalue of value) {
	                  if (subvalue == null) continue;
	                  parent.insertBefore(subvalue instanceof Node ? subvalue : document.createTextNode(subvalue), node);
	                }
	              }
	            } else {
	              parent.insertBefore(document.createTextNode(value), node);
	            }
	            removeNodes.push(node);
	          }
	          break;
	        }
	      }
	    }

	    for (const node of removeNodes) {
	      node.parentNode.removeChild(node);
	    }

	    return postprocess(root);
	  };
	}

	function entity(character) {
	  return `&#${character.charCodeAt(0).toString()};`;
	}

	function isAsciiAlphaCode(code) {
	  return (CODE_UPPER_A <= code && code <= CODE_UPPER_Z)
	      || (CODE_LOWER_A <= code && code <= CODE_LOWER_Z);
	}

	function isSpaceCode(code) {
	  return code === CODE_TAB
	      || code === CODE_LF
	      || code === CODE_FF
	      || code === CODE_SPACE
	      || code === CODE_CR; // normalize newlines
	}

	function isObjectLiteral(value) {
	  return value && value.toString === Object.prototype.toString;
	}

	function isRawText(tagName) {
	  return tagName === "script" || tagName === "style" || isEscapableRawText(tagName);
	}

	function isEscapableRawText(tagName) {
	  return tagName === "textarea" || tagName === "title";
	}

	function lower(input, start, end) {
	  return input.slice(start, end).toLowerCase();
	}

	function setAttribute(node, name, value) {
	  if (node.namespaceURI === NS_SVG) {
	    name = name.toLowerCase();
	    name = svgAdjustAttributes.get(name) || name;
	    if (svgForeignAttributes.has(name)) {
	      node.setAttributeNS(svgForeignAttributes.get(name), name, value);
	      return;
	    }
	  }
	  node.setAttribute(name, value);
	}

	function removeAttribute(node, name) {
	  if (node.namespaceURI === NS_SVG) {
	    name = name.toLowerCase();
	    name = svgAdjustAttributes.get(name) || name;
	    if (svgForeignAttributes.has(name)) {
	      node.removeAttributeNS(svgForeignAttributes.get(name), name);
	      return;
	    }
	  }
	  node.removeAttribute(name);
	}

	// We canâ€™t use Object.assign because custom propertiesâ€¦
	function setStyles(style, values) {
	  for (const name in values) {
	    const value = values[name];
	    if (name.startsWith("--")) style.setProperty(name, value);
	    else style[name] = value;
	  }
	}

	function length(x) {
	  return x == null ? null : typeof x === "number" ? `${x}px` : `${x}`;
	}

	function maybeWidth(width) {
	  return {"--input-width": length(width)};
	}

	const bubbles = {bubbles: true};

	function preventDefault(event) {
	  event.preventDefault();
	}

	function dispatchInput({currentTarget}) {
	  (currentTarget.form || currentTarget).dispatchEvent(new Event("input", bubbles));
	}

	function checkValidity(input) {
	  return input.checkValidity();
	}

	function identity(x) {
	  return x;
	}

	let nextId = 0;

	function newId() {
	  return `__ns__-${++nextId}`;
	}

	function maybeLabel(label, input) {
	  if (!label) return;
	  label = html`<label>${label}`;
	  if (input !== undefined) label.htmlFor = input.id = newId();
	  return label;
	}

	function arrayify(array) {
	  return Array.isArray(array) ? array : Array.from(array);
	}

	function iterable(array) {
	  return array ? typeof array[Symbol.iterator] === "function" : false;
	}

	function maybeColumns(data) {
	  if (iterable(data.columns)) return data.columns; // d3-dsv, FileAttachment
	  if (data.schema && iterable(data.schema.fields)) return Array.from(data.schema.fields, f => f.name); // apache-arrow
	  if (typeof data.columnNames === "function") return data.columnNames(); // arquero
	}

	// Note: use formatAuto (or any other localized format) to present values to the
	// user; stringify is only intended for machine values.
	function stringify(x) {
	  return x == null ? "" : `${x}`;
	}

	const formatLocaleAuto = localize(locale => {
	  const formatNumber = formatLocaleNumber(locale);
	  return value => value == null ? ""
	    : typeof value === "number" ? formatNumber(value)
	    : value instanceof Date ? formatDate(value)
	    : `${value}`;
	});

	const formatLocaleNumber = localize(locale => {
	  return value => value === 0 ? "0" : value.toLocaleString(locale); // handle negative zero
	});

	formatLocaleAuto();

	formatLocaleNumber();

	function formatTrim(value) {
	  const s = value.toString();
	  const n = s.length;
	  let i0 = -1, i1;
	  out: for (let i = 1; i < n; ++i) {
	    switch (s[i]) {
	      case ".": i0 = i1 = i; break;
	      case "0": if (i0 === 0) i0 = i; i1 = i; break;
	      default: if (!+s[i]) break out; if (i0 > 0) i0 = 0; break;
	    }
	  }
	  return i0 > 0 ? s.slice(0, i0) + s.slice(i1 + 1) : s;
	}

	function formatDate(date) {
	  return format(date, "Invalid Date");
	}

	// Memoize the last-returned locale.
	function localize(f) {
	  let key = localize, value;
	  return (locale = "en") => locale === key ? value : (value = f(key = locale));
	}

	function ascending(a, b) {
	  return defined(b) - defined(a) || (a < b ? -1 : a > b ? 1 : a >= b ? 0 : NaN);
	}

	function descending(b, a) {
	  return defined(a) - defined(b) || (a < b ? -1 : a > b ? 1 : a >= b ? 0 : NaN);
	}

	function defined(d) {
	  return d != null && !Number.isNaN(d);
	}

	const first = ([x]) => x;
	const second = ([, x]) => x;

	function createChooser({multiple: fixedMultiple, render, selectedIndexes, select}) {
	  return function chooser(data, {
	    locale,
	    keyof = data instanceof Map ? first : identity,
	    valueof = data instanceof Map ? second : identity,
	    format = data instanceof Map ? first : formatLocaleAuto(locale),
	    multiple,
	    key,
	    value,
	    disabled = false,
	    sort,
	    unique,
	    ...options
	  } = {}) {
	    if (typeof keyof !== "function") throw new TypeError("keyof is not a function");
	    if (typeof valueof !== "function") throw new TypeError("valueof is not a function");
	    if (typeof format !== "function") throw new TypeError("format is not a function");
	    if (fixedMultiple !== undefined) multiple = fixedMultiple;
	    sort = maybeSort(sort);
	    let size = +multiple;
	    if (value === undefined) value = key !== undefined && data instanceof Map ? (size > 0 ? Array.from(key, k => data.get(k)) : data.get(key)) : undefined;
	    unique = !!unique;
	    data = arrayify(data);
	    let keys = data.map((d, i) => [keyof(d, i, data), i]);
	    if (sort !== undefined) keys.sort(([a], [b]) => sort(a, b));
	    if (unique) keys = [...new Map(keys.map(o => [intern(o[0]), o])).values()];
	    const index = keys.map(second);
	    if (multiple === true) size = Math.max(1, Math.min(10, index.length));
	    else if (size > 0) multiple = true;
	    else multiple = false, size = undefined;
	    const [form, input] = render(
	      data,
	      index,
	      maybeSelection(data, index, value, multiple, valueof),
	      maybeDisabled(data, index, disabled, valueof),
	      {
	        ...options,
	        format,
	        multiple,
	        size
	      }
	    );
	    form.onchange = dispatchInput;
	    form.oninput = oninput;
	    form.onsubmit = preventDefault;
	    function oninput(event) {
	      if (event && event.isTrusted) form.onchange = null;
	      if (multiple) {
	        value = selectedIndexes(input).map(i => valueof(data[i], i, data));
	      } else {
	        const i = selectedIndex(input);
	        value = i < 0 ? null : valueof(data[i], i, data);
	      }
	    }
	    oninput();
	    return Object.defineProperty(form, "value", {
	      get() {
	        return value;
	      },
	      set(v) {
	        if (multiple) {
	          const selection = new Set(v);
	          for (const e of input) {
	            const i = +e.value;
	            select(e, selection.has(valueof(data[i], i, data)));
	          }
	        } else {
	          input.value = index.find(i => v === valueof(data[i], i, data));
	        }
	        oninput();
	      }
	    });
	  };
	}

	function maybeSelection(data, index, value, multiple, valueof) {
	  const values = new Set(value === undefined ? [] : multiple ? arrayify(value) : [value]);
	  if (!values.size) return () => false;
	  const selection = new Set();
	  for (const i of index) {
	    if (values.has(valueof(data[i], i, data))) {
	      selection.add(i);
	    }
	  }
	  return i => selection.has(i);
	}

	function maybeDisabled(data, index, value, valueof) {
	  if (typeof value === "boolean") return value;
	  const values = new Set(arrayify(value));
	  const disabled = new Set();
	  for (const i of index) {
	    if (values.has(valueof(data[i], i, data))) {
	      disabled.add(i);
	    }
	  }
	  return i => disabled.has(i);
	}

	function maybeSort(sort) {
	  if (sort === undefined || sort === false) return;
	  if (sort === true || sort === "ascending") return ascending;
	  if (sort === "descending") return descending;
	  if (typeof sort === "function") return sort;
	  throw new TypeError("sort is not a function");
	}

	function selectedIndex(input) {
	  return input.value ? +input.value : -1;
	}

	function intern(value) {
	  return value !== null && typeof value === "object" ? value.valueOf() : value;
	}

	function createCheckbox(multiple, type) {
	  return createChooser({
	    multiple,
	    render(data, index, selected, disabled, {format, label}) {
	      const form = html`<form class="__ns__ __ns__-checkbox">
      ${maybeLabel(label)}<div>
        ${index.map(i => html`<label><input type=${type} disabled=${typeof disabled === "function" ? disabled(i) : disabled} name=input value=${i} checked=${selected(i)}>${format(data[i], i, data)}`)}
      </div>
    </form>`;
	      return [form, inputof$1(form.elements.input, multiple)];
	    },
	    selectedIndexes(input) {
	      return Array.from(input).filter(i => i.checked).map(i => +i.value);
	    },
	    select(input, selected) {
	      input.checked = selected;
	    }
	  });
	}

	const checkbox = createCheckbox(true, "checkbox");

	// The input is undefined if there are no options, or an individual input
	// element if there is only one; we want these two cases to behave the same as
	// when there are two or more options, i.e., a RadioNodeList.
	function inputof$1(input, multiple) {
	  return input === undefined ? new OptionZero(multiple ? [] : null)
	    : typeof input.length === "undefined" ? new (multiple ? MultipleOptionOne : OptionOne)(input)
	    : input;
	}

	class OptionZero {
	  constructor(value) {
	    this._value = value;
	  }
	  get value() {
	    return this._value;
	  }
	  set value(v) {
	    // ignore
	  }
	  *[Symbol.iterator]() {
	    // empty
	  }
	}

	// TODO If we allow selected radios to be cleared by command-clicking, then
	// assigning a radioâ€™s value programmatically should also clear the selection.
	// This will require changing this class and also wrapping RadioNodeList in the
	// common case to change the value setterâ€™s behavior.
	class OptionOne {
	  constructor(input) {
	    this._input = input;
	  }
	  get value() {
	    const {_input} = this;
	    return _input.checked ? _input.value : "";
	  }
	  set value(v) {
	    const {_input} = this;
	    if (_input.checked) return;
	    _input.checked = stringify(v) === _input.value;
	  }
	  *[Symbol.iterator]() {
	    yield this._input;
	  }
	}

	class MultipleOptionOne {
	  constructor(input) {
	    this._input = input;
	    this._value = input.checked ? [input.value] : [];
	  }
	  get value() {
	    return this._value;
	  }
	  set value(v) {
	    const {_input} = this;
	    if (_input.checked) return;
	    _input.checked = stringify(v) === _input.value;
	    this._value = _input.checked ? [_input.value] : [];
	  }
	  *[Symbol.iterator]() {
	    yield this._input;
	  }
	}

	const epsilon = 1e-6;

	function range(extent = [0, 1], options) {
	  return createRange({extent, range: true}, options);
	}

	function createRange({
	  extent: [min, max],
	  range
	}, {
	  format = formatTrim,
	  transform,
	  invert,
	  label = "",
	  value: initialValue,
	  step,
	  disabled,
	  placeholder,
	  validate = checkValidity,
	  width
	} = {}) {
	  let value;
	  if (typeof format !== "function") throw new TypeError("format is not a function");
	  if (min == null || isNaN(min = +min)) min = -Infinity;
	  if (max == null || isNaN(max = +max)) max = Infinity;
	  if (min > max) [min, max] = [max, min], transform === undefined && (transform = negate);
	  if (step !== undefined) step = +step;
	  const number = html`<input type=number min=${isFinite(min) ? min : null} max=${isFinite(max) ? max : null} step=${step == undefined ? "any" : step} name=number required placeholder=${placeholder} oninput=${onnumber} disabled=${disabled}>`;
	  let irange; // untransformed range for coercion
	  if (range) {
	    if (transform === undefined) transform = identity;
	    if (typeof transform !== "function") throw new TypeError("transform is not a function");
	    if (invert === undefined) invert = transform.invert === undefined ? solver(transform) : transform.invert;
	    if (typeof invert !== "function") throw new TypeError("invert is not a function");
	    let tmin = +transform(min), tmax = +transform(max);
	    if (tmin > tmax) [tmin, tmax] = [tmax, tmin];
	    range = html`<input type=range min=${isFinite(tmin) ? tmin : null} max=${isFinite(tmax) ? tmax : null} step=${step === undefined || (transform !== identity && transform !== negate) ? "any" : step} name=range oninput=${onrange} disabled=${disabled}>`;
	    irange = transform === identity ? range : html`<input type=range min=${min} max=${max} step=${step === undefined ? "any" : step} name=range disabled=${disabled}>`;
	  } else {
	    range = null;
	    transform = invert = identity;
	  }
	  const form = html`<form class=__ns__ onsubmit=${preventDefault} style=${maybeWidth(width)}>
    ${maybeLabel(label, number)}<div class=__ns__-input>
      ${number}${range}
    </div>
  </form>`;
	  // If range, use an untransformed range to round to the nearest valid value.
	  function coerce(v) {
	    if (!irange) return +v;
	    v = Math.max(min, Math.min(max, v));
	    if (!isFinite(v)) return v;
	    irange.valueAsNumber = v;
	    return irange.valueAsNumber;
	  }
	  function onrange(event) {
	    const v = coerce(invert(range.valueAsNumber));
	    if (isFinite(v)) {
	      number.valueAsNumber = Math.max(min, Math.min(max, v));
	      if (validate(number)) {
	        value = number.valueAsNumber;
	        number.value = format(value);
	        return;
	      }
	    }
	    if (event) event.stopPropagation();
	  }
	  function onnumber(event) {
	    const v = coerce(number.valueAsNumber);
	    if (isFinite(v)) {
	      if (range) range.valueAsNumber = transform(v);
	      if (validate(number)) {
	        value = v;
	        return;
	      }
	    }
	    if (event) event.stopPropagation();
	  }
	  Object.defineProperty(form, "value", {
	    get() {
	      return value;
	    },
	    set(v) {
	      v = coerce(v);
	      if (isFinite(v)) {
	        number.valueAsNumber = v;
	        if (range) range.valueAsNumber = transform(v);
	        if (validate(number)) {
	          value = v;
	          number.value = format(value);
	        }
	      }
	    }
	  });
	  if (initialValue === undefined && irange) initialValue = irange.valueAsNumber; // (min + max) / 2
	  if (initialValue !== undefined) form.value = initialValue; // invoke setter
	  return form;
	}

	function negate(x) {
	  return -x;
	}

	function square(x) {
	  return x * x;
	}

	function solver(f) {
	  if (f === identity || f === negate) return f;
	  if (f === Math.sqrt) return square;
	  if (f === Math.log) return Math.exp;
	  if (f === Math.exp) return Math.log;
	  return x => solve(f, x, x);
	}

	function solve(f, y, x) {
	  let steps = 100, delta, f0, f1;
	  x = x === undefined ? 0 : +x;
	  y = +y;
	  do {
	    f0 = f(x);
	    f1 = f(x + epsilon);
	    if (f0 === f1) f1 = f0 + epsilon;
	    x -= delta = (-1 * epsilon * (f0 - y)) / (f0 - f1);
	  } while (steps-- > 0 && Math.abs(delta) > epsilon);
	  return steps < 0 ? NaN : x;
	}

	const select = createChooser({
	  render(data, index, selected, disabled, {format, multiple, size, label, width}) {
	    const select = html`<select class=__ns__-input disabled=${disabled === true} multiple=${multiple} size=${size} name=input>
      ${index.map(i => html`<option value=${i} disabled=${typeof disabled === "function" ? disabled(i) : false} selected=${selected(i)}>${stringify(format(data[i], i, data))}`)}
    </select>`;
	    const form = html`<form class=__ns__ style=${maybeWidth(width)}>${maybeLabel(label, select)}${select}`;
	    return [form, select];
	  },
	  selectedIndexes(input) {
	    return Array.from(input.selectedOptions, i => +i.value);
	  },
	  select(input, selected) {
	    input.selected = selected;
	  }
	});

	const rowHeight = 22;

	function table$1(data, options = {}) {
	  const {
	    rows = 11.5, // maximum number of rows to show
	    height,
	    maxHeight = height === undefined ? (rows + 1) * rowHeight - 1 : undefined,
	    width = {}, // object of column name to width, or overall table width
	    maxWidth
	  } = options;
	  const id = newId();
	  const root = html`<form class="__ns__ __ns__-table" id=${id} style=${{height: length(height), maxHeight: length(maxHeight), width: typeof width === "string" || typeof width === "number" ? length(width) : undefined, maxWidth: length(maxWidth)}}>`;
	  // The outer form element is created synchronously, while the table is lazily
	  // created when the data promise resolves. This allows you to pass a promise
	  // of data to the table without an explicit await.
	  if (data && typeof data.then === "function") {
	    Object.defineProperty(root, "value", {
	      configurable: true, // allow defineProperty again on initialization
	      set() {
	        throw new Error("cannot set value while data is unresolved");
	      }
	    });
	    Promise.resolve(data).then(data => initialize({root, id}, data, options));
	  } else {
	    initialize({root, id}, data, options);
	  }
	  return root;
	}

	function initialize(
	  {
	    root,
	    id
	  },
	  data,
	  {
	    columns = maybeColumns(data), // array of column names
	    value, // initial selection
	    required = true, // if true, the value is everything if nothing is selected
	    sort, // name of column to sort by, if any
	    reverse = false, // if sorting, true for descending and false for ascending
	    format, // object of column name to format function
	    locale,
	    align, // object of column name to left, right, or center
	    header, // object of column name to string or HTML element
	    rows = 11.5, // maximum number of rows to show
	    width = {}, // object of column name to width, or overall table width
	    multiple = true,
	    layout // "fixed" or "auto"
	  } = {}
	) {
	  columns = columns === undefined ? columnsof(data) : arrayify(columns);
	  if (layout === undefined) layout = columns.length >= 12 ? "auto" : "fixed";
	  format = formatof(format, data, columns, locale);
	  align = alignof(align, data, columns);

	  let array = [];
	  let index = [];
	  let iterator = data[Symbol.iterator]();
	  let iterindex = 0;
	  let N = lengthof(data); // total number of rows (if known)
	  let n = minlengthof(rows * 2); // number of currently-shown rows

	  // Defer materializing index and data arrays until needed.
	  function materialize() {
	    if (iterindex >= 0) {
	      iterindex = iterator = undefined;
	      index = Uint32Array.from(array = arrayify(data), (_, i) => i);
	      N = index.length;
	    }
	  }

	  function minlengthof(length) {
	    length = Math.floor(length);
	    if (N !== undefined) return Math.min(N, length);
	    if (length <= iterindex) return length;
	    while (length > iterindex) {
	      const {done, value} = iterator.next();
	      if (done) return N = iterindex;
	      index.push(iterindex++);
	      array.push(value);
	    }
	    return iterindex;
	  }

	  let currentSortHeader = null, currentReverse = false;
	  let selected = new Set();
	  let anchor = null, head = null;

	  const tbody = html`<tbody>`;
	  const tr = html`<tr><td><input type=${multiple ? "checkbox" : "radio"} name=${multiple ? null : "radio"}></td>${columns.map(() => html`<td>`)}`;
	  const theadr = html`<tr><th><input type=checkbox onclick=${reselectAll} disabled=${!multiple}></th>${columns.map((column) => html`<th title=${column} onclick=${event => resort(event, column)}><span></span>${header && column in header ? header[column] : column}</th>`)}</tr>`;
	  root.appendChild(html.fragment`<table style=${{tableLayout: layout}}>
  <thead>${minlengthof(1) || columns.length ? theadr : null}</thead>
  ${tbody}
</table>
<style>${columns.map((column, i) => {
  const rules = [];
  if (align[column] != null) rules.push(`text-align:${align[column]}`);
  if (width[column] != null) rules.push(`width:${length(width[column])}`);
  if (rules.length) return `#${id} tr>:nth-child(${i + 2}){${rules.join(";")}}`;
}).filter(identity).join("\n")}</style>`);
	  function appendRows(i, j) {
	    if (iterindex === i) {
	      for (; i < j; ++i) {
	        appendRow(iterator.next().value, i);
	      }
	      iterindex = j;
	    } else {
	      for (let k; i < j; ++i) {
	        k = index[i];
	        appendRow(array[k], k);
	      }
	    }
	  }

	  function appendRow(d, i) {
	    const itr = tr.cloneNode(true);
	    const input = inputof(itr);
	    input.onclick = reselect;
	    input.checked = selected.has(i);
	    input.value = i;
	    if (d != null) for (let j = 0; j < columns.length; ++j) {
	      let column = columns[j];
	      let value = d[column];
	      if (!defined(value)) continue;
	      value = format[column](value, i, data);
	      if (!(value instanceof Node)) value = document.createTextNode(value);
	      itr.childNodes[j + 1].appendChild(value);
	    }
	    tbody.append(itr);
	  }

	  function unselect(i) {
	    materialize();
	    let j = index.indexOf(i);
	    if (j < tbody.childNodes.length) {
	      const tr = tbody.childNodes[j];
	      inputof(tr).checked = false;
	    }
	    selected.delete(i);
	  }

	  function select(i) {
	    materialize();
	    let j = index.indexOf(i);
	    if (j < tbody.childNodes.length) {
	      const tr = tbody.childNodes[j];
	      inputof(tr).checked = true;
	    }
	    selected.add(i);
	  }

	  function* range(i, j) {
	    materialize();
	    i = index.indexOf(i), j = index.indexOf(j);
	    if (i < j) while (i <= j) yield index[i++];
	    else while (j <= i) yield index[j++];
	  }

	  function first(set) {
	    return set[Symbol.iterator]().next().value;
	  }

	  function reselectAll(event) {
	    materialize();
	    if (this.checked) {
	      selected = new Set(index);
	      for (const tr of tbody.childNodes) {
	        inputof(tr).checked = true;
	      }
	    } else {
	      for (let i of selected) unselect(i);
	      anchor = head = null;
	      if (event.detail) event.currentTarget.blur();
	    }
	    reinput();
	  }

	  function reselect(event) {
	    materialize();
	    let i = +this.value;
	    if (!multiple) {
	      for (let i of selected) unselect(i);
	      select(i);
	    } else if (event.shiftKey) {
	      if (anchor === null) anchor = selected.size ? first(selected) : index[0];
	      else for (let i of range(anchor, head)) unselect(i);
	      head = i;
	      for (let i of range(anchor, head)) select(i);
	    } else {
	      anchor = head = i;
	      if (selected.has(i)) {
	        unselect(i);
	        anchor = head = null;
	        if (event.detail) event.currentTarget.blur();
	      } else {
	        select(i);
	      }
	    }
	    reinput();
	  }

	  function resort(event, column) {
	    materialize();
	    const th = event.currentTarget;
	    let compare;
	    if (currentSortHeader === th && event.metaKey) {
	      orderof(currentSortHeader).textContent = "";
	      currentSortHeader = null;
	      currentReverse = false;
	      compare = ascending;
	    } else {
	      if (currentSortHeader === th) {
	        currentReverse = !currentReverse;
	      } else {
	        if (currentSortHeader) {
	          orderof(currentSortHeader).textContent = "";
	        }
	        currentSortHeader = th;
	        currentReverse = event.altKey;
	      }
	      const order = currentReverse ? descending : ascending;
	      compare = (a, b) => order(array[a][column], array[b][column]);
	      orderof(th).textContent = currentReverse ? "â–¾"  : "â–´";
	    }
	    index.sort(compare);
	    selected = new Set(Array.from(selected).sort(compare));
	    root.scrollTo(root.scrollLeft, 0);
	    while (tbody.firstChild) tbody.firstChild.remove();
	    appendRows(0, n = minlengthof(rows * 2));
	    anchor = head = null;
	    reinput();
	  }

	  function reinput() {
	    const check = inputof(theadr);
	    check.disabled = !multiple && !selected.size;
	    check.indeterminate = multiple && selected.size && selected.size !== N; // assume materalized!
	    check.checked = selected.size;
	    value = undefined; // lazily computed
	  }

	  root.onscroll = () => {
	    if (root.scrollHeight - root.scrollTop < rows * rowHeight * 1.5 && n < minlengthof(n + 1)) {
	      appendRows(n, n = minlengthof(n + rows));
	    }
	  };

	  if (sort === undefined && reverse) {
	    materialize();
	    index.reverse();
	  }

	  if (value !== undefined) {
	    materialize();
	    if (multiple) {
	      const values = new Set(value);
	      selected = new Set(index.filter(i => values.has(array[i])));
	    } else {
	      const i = array.indexOf(value);
	      selected = i < 0 ? new Set() : new Set([i]);
	    }
	    reinput();
	  }

	  if (minlengthof(1)) {
	    appendRows(0, n);
	  } else {
	    tbody.append(html`<tr>${columns.length ? html`<td>` : null}<td rowspan=${columns.length} style="padding-left: var(--length3); font-style: italic;">No results.</td></tr>`);
	  }

	  if (sort !== undefined) {
	    let i = columns.indexOf(sort);
	    if (i >= 0) {
	      if (reverse) currentSortHeader = theadr.childNodes[i + 1];
	      resort({currentTarget: theadr.childNodes[i + 1]}, columns[i]);
	    }
	  }

	  return Object.defineProperty(root, "value", {
	    get() {
	      if (value === undefined) {
	        materialize();
	        if (multiple) {
	          value = Array.from(required && selected.size === 0 ? index : selected, i => array[i]);
	          value.columns = columns;
	        } else if (selected.size) {
	          const [i] = selected;
	          value = array[i];
	        } else {
	          value = null;
	        }
	      }
	      return value;
	    },
	    set(v) {
	      materialize();
	      if (multiple) {
	        const values = new Set(v);
	        const selection = new Set(index.filter(i => values.has(array[i])));
	        for (const i of selected) if (!selection.has(i)) unselect(i);
	        for (const i of selection) if (!selected.has(i)) select(i);
	      } else {
	        const i = array.indexOf(v);
	        selected = i < 0 ? new Set() : new Set([i]);
	      }
	      value = undefined; // lazily computed
	    }
	  });
	}

	function inputof(tr) {
	  return tr.firstChild.firstChild;
	}

	function orderof(th) {
	  return th.firstChild;
	}

	function formatof(base = {}, data, columns, locale) {
	  const format = Object.create(null);
	  for (const column of columns) {
	    if (column in base) {
	      format[column] = base[column];
	      continue;
	    }
	    switch (type(data, column)) {
	      case "number": format[column] = formatLocaleNumber(locale); break;
	      case "date": format[column] = formatDate; break;
	      default: format[column] = formatLocaleAuto(locale); break;
	    }
	  }
	  return format;
	}

	function alignof(base = {}, data, columns) {
	  const align = Object.create(null);
	  for (const column of columns) {
	    if (column in base) {
	      align[column] = base[column];
	    } else if (type(data, column) === "number") {
	      align[column] = "right";
	    }
	  }
	  return align;
	}

	function type(data, column) {
	  for (const d of data) {
	    if (d == null) continue;
	    const value = d[column];
	    if (value == null) continue;
	    if (typeof value === "number") return "number";
	    if (value instanceof Date) return "date";
	    return;
	  }
	}

	function lengthof(data) {
	  if (typeof data.length === "number") return data.length; // array or array-like
	  if (typeof data.size === "number") return data.size; // map, set
	  if (typeof data.numRows === "function") return data.numRows(); // arquero
	}

	function columnsof(data) {
	  const columns = new Set();
	  for (const row of data) {
	    for (const name in row) {
	      columns.add(name);
	    }
	  }
	  return Array.from(columns);
	}

	function formatRowToAppearInTable(row) {
	    let formattedRow = {};
	    for (const key in row) {
	        if (typeof row[key] === "object") {
	            formattedRow[key] = JSON.stringify(row[key]);
	        } else {
	            formattedRow[key] = row[key];
	        }
	    }
	    return formattedRow;
	}

	function _1$1(md){return(
	md`# Splink cluster studio (splink3 version)`
	)}

	function _selected_cluster_id(splink_vis_utils,cluster_unique_ids){return(
	splink_vis_utils.select(cluster_unique_ids, {
	  label: "Choose cluster: "
	})
	)}

	function _edge_colour_metric(splink_vis_utils,raw_edges_data)
	{
	  const node_size_options = splink_vis_utils.detect_edge_colour_metrics(
	    raw_edges_data
	  );

	  let v = splink_vis_utils.select(node_size_options, {
	    label: "Choose metric for edge colour: "
	  });
	  if (node_size_options.length == 1) {
	    v.style.visibility = "hidden";
	  }
	  return v;
	}


	function _node_size_metric(splink_vis_utils,raw_nodes_data)
	{
	  const node_size_options = splink_vis_utils.detect_node_size_metrics(
	    raw_nodes_data
	  );
	  let v = splink_vis_utils.select(node_size_options, {
	    label: "Choose metric for node size: "
	  });
	  if (node_size_options.length == 1) {
	    v.style.visibility = "hidden";
	  }
	  return v;
	}


	function _node_colour_metric(splink_vis_utils,raw_nodes_data)
	{
	  const node_size_options = splink_vis_utils.detect_node_colour_metrics(
	    raw_nodes_data
	  );

	  let v = splink_vis_utils.select(node_size_options, {
	    label: "Choose metric for node colour: "
	  });
	  if (node_size_options.length == 1) {
	    v.style.visibility = "hidden";
	  }
	  return v;
	}


	function _show_edge_comparison_type$1(splink_vis_utils){return(
	splink_vis_utils.checkbox(
	  new Map([
	    ["Show waterfall chart on edge click", "show_waterfall"],
	    ["Show raw edge data on edge click", "raw_edge_data"],

	    ["Show comparison columns on edge click", "cc_data"],
	    ["Show history of node clicks", "node_history"]
	  ]),
	  {
	    label: "",
	    value: ["show_waterfall", "raw_edge_data", "node_history"]
	  }
	)
	)}

	function _show_full_tables(raw_clusters_data,splink_vis_utils)
	{
	  let options;
	  
	  if (raw_clusters_data == null) {
	    options = new Map([
	      ["Show table of all edges", "edges"],
	      ["Show table of all nodes", "nodes"]
	    ]);
	  } else {
	    options = new Map([
	      ["Show cluster info", "clusters"],
	      ["Show table of all edges", "edges"],
	      ["Show table of all nodes", "nodes"],
	      ["Show table of all clusters", "all_clusters"]
	    ]);
	  }

	  return splink_vis_utils.checkbox(options, {
	    label: ""
	  });
	}


	function _score_threshold_filter(splink_vis_utils){return(
	splink_vis_utils.range([-20, 20], {
	  label: 'Filter out edges with match weight below threshold:',
	  value: -20,
	  step: 0.1
	})
	)}

	function _corresponding_probability(html,splink_vis_utils,score_threshold_filter){return(
	html`Your chosen threshold corresponds to a match probability of ${splink_vis_utils
  .log2_bayes_factor_to_prob(score_threshold_filter)
  .toPrecision(4)}`
	)}

	function _additional_graph_controls(splink_vis_utils){return(
	splink_vis_utils.checkbox(
	  new Map([["Show additional graph controls", "graph_controls"]]),
	  {
	    label: ""
	  }
	)
	)}

	function _edge_table(selected_edge,html,show_edge_comparison_type,splink_vis_utils,ss)
	{
	  if (selected_edge == undefined) {
	    return html``;
	  }

	  if (show_edge_comparison_type.includes("raw_edge_data")) {
	    return html`
  <h3>Rows compared by selected edge</h3>   
    ${splink_vis_utils.edge_row_to_table(selected_edge, ss)}

`;
	  }

	  return html``;
	}


	function _nothing_selected_message$1(no_edge_selected,no_node_selected,html,selected_edge)
	{
	  if (no_edge_selected && no_node_selected) {
	    return html`<span style="color:red"'>Click on nodes and/or edges in the below graph to show data and chart</span>`;
	  }

	  if (typeof selected_edge == 'undefined') {
	    return html`<span style="color:red"'>Click on an edges in the below graph to show waterfall chart and table</span>`;
	  }

	  return html``;
	}


	function _force_directed_chart(vegaEmbed,splink_vis_utils,spec){return(
	vegaEmbed(splink_vis_utils.cloneDeep(spec))
	)}

	function _node_history_table(node_history,html,show_edge_comparison_type,splink_vis_utils,ss)
	{
	  if (node_history.length == 0) {
	    return html``;
	  }
	  if (show_edge_comparison_type.includes("node_history")) {
	    return html`
<h3>History of clicked nodes</h3> 
${splink_vis_utils.node_rows_to_table(node_history, ss)}
`;
	  }
	  return html``;
	}


	function _refresh$1(Inputs){return(
	Inputs.button("refresh splink_vis_utils javascript lib")
	)}

	function _cluster_table(selected_cluster_metrics,html,show_full_tables,splink_vis_utils)
	{
	  if (selected_cluster_metrics == null) {
	    return html``;
	  }
	  if (!show_full_tables.includes("clusters")) {
	    return html``;
	  }
	  return html`
  <h3> Cluster metrics </h3>
  ${splink_vis_utils.single_cluster_table(selected_cluster_metrics)}
`;
	}


	function _comparison_columns_table$1(no_edge_selected,html,show_edge_comparison_type,splink_vis_utils,selected_edge,ss)
	{
	  if (no_edge_selected) {
	    return html``;
	  }
	  if (show_edge_comparison_type.includes("cc_data")) {
	    return splink_vis_utils.comparison_column_table(selected_edge, ss);
	  }
	  return html``;
	}


	function _waterfall_chart$1(no_edge_selected,html,show_edge_comparison_type,splink_vis_utils,selected_edge,ss,vegaEmbed)
	{
	  if (no_edge_selected) {
	    return html``;
	  } else if (!show_edge_comparison_type.includes("show_waterfall")) {
	    return html``;
	  } else {
	    let waterfall_data = splink_vis_utils.get_waterfall_chart_data(
	      selected_edge,
	      ss
	    );

	    return vegaEmbed(
	      splink_vis_utils.get_waterfall_chart_spec(waterfall_data, {})
	    );
	  }
	}


	function _edges_full_table(show_full_tables,filtered_edges,splink_vis_utils,html)
	{
	  if (show_full_tables.includes("edges")) {
	    // const filtered_edges = filtered_edges.filter(
	    //   d => d[svu_options.cluster_colname + "_l"] == selected_cluster_id
	    // );
	    let filtered_edges2 = filtered_edges.map(
	      splink_vis_utils.formatRowToAppearInTable
	    );
	    return html`
    <h3>Edges corresponding to selected cluster, filtered by threshold</h3>
    Click column headers to sort
    
    ${splink_vis_utils.table(filtered_edges2, { layout: "auto" })}

  `;
	  } else {
	    return html``;
	  }
	}


	function _nodes_full_table(show_full_tables,raw_nodes_data,svu_options,selected_cluster_id,html,splink_vis_utils)
	{
	  if (show_full_tables.includes("nodes")) {
	    const filtered_nodes = raw_nodes_data.filter(
	      d => d[svu_options.cluster_colname] == selected_cluster_id
	    );

	    return html`
    <h3>All nodes corresponding to selected cluster</h3>
    Click column headers to sort
    
    ${splink_vis_utils.table(filtered_nodes, { layout: "auto" })}

  `;
	  } else {
	    return html``;
	  }
	}


	function _clusters_full_table(show_full_tables,html,splink_vis_utils,raw_clusters_data)
	{
	  if (show_full_tables.includes("all_clusters")) {
	    return html`
    <h3>All clusters</h3>
    Click column headers to sort
    
    ${splink_vis_utils.table(raw_clusters_data, { layout: "auto" })}

  `;
	  } else {
	    return html``;
	  }
	}


	function _22$1(md){return(
	md`## Outputs`
	)}

	function _spec(splink_vis_utils,filtered_nodes,ss,filtered_edges,edge_colour_metric,node_size_metric,node_colour_metric,width,additional_graph_controls)
	{
	  let formatted_nodes = splink_vis_utils.format_nodes_data_for_force_directed(
	    filtered_nodes,
	    ss
	  );

	  let formatted_edges = splink_vis_utils.format_edges_data_for_force_directed(
	    filtered_edges,
	    ss
	  );
	  let s = new splink_vis_utils.ForceDirectedChart(
	    formatted_nodes,
	    formatted_edges
	  );

	  let edge_colour_args =
	    splink_vis_utils.metric_vis_args["edge_colour"][edge_colour_metric];

	  s.set_edge_colour_metric(...Object.values(edge_colour_args));

	  if (node_size_metric != "none") {
	    let node_size_args =
	      splink_vis_utils.metric_vis_args["node_size"][node_size_metric];
	    s.set_node_area_metric(...Object.values(node_size_args));
	  }

	  if (node_colour_metric != "none") {
	    let node_size_args =
	      splink_vis_utils.metric_vis_args["node_colour"][node_colour_metric];
	    s.set_node_colour_metric(...Object.values(node_size_args));
	  }

	  s.set_height_from_nodes_data();

	  let new_width = width;
	  if (width > 1500) {
	    new_width = 1500;
	  }
	  s.set_starting_width(new_width);
	  if (additional_graph_controls.length == 0) {
	    s.remove_all_sliders();
	  }

	  return s.spec;
	}


	function _ss$1(splink_vis_utils,splink_settings){return(
	new splink_vis_utils.SplinkSettings(JSON.stringify(splink_settings))
	)}

	function _no_edge_selected$1(selected_edge){return(
	typeof selected_edge == 'undefined'
	)}

	function _no_node_selected(selected_node){return(
	typeof selected_node == 'undefined'
	)}

	function _27(md){return(
	md`## Data processing`
	)}

	function _cluster_unique_ids(splink_vis_utils,raw_nodes_data,svu_options,named_clusters)
	{
	  let cluster_ids = splink_vis_utils.get_unique_cluster_ids_from_nodes_data(
	    raw_nodes_data,
	    svu_options.cluster_colname
	  );
	  cluster_ids = cluster_ids.map(d => d.toString());

	  if (named_clusters != null) {
	    let cid_map = new Map();

	    Object.entries(named_clusters).forEach(e => {
	      cid_map.set(e[1], e[0]);

	      const index = cluster_ids.indexOf(e[0]);

	      if (index > -1) {
	        cluster_ids.splice(index, 1);
	      }
	    });

	    cluster_ids.forEach(d => cid_map.set(d, d));

	    return cid_map;
	  }
	  return cluster_ids;
	}


	function _selected_edge$1(observe_chart_data,force_directed_chart){return(
	observe_chart_data(force_directed_chart, "edge_click")
	)}

	function _observe_chart_data$1(Generators){return(
	function observe_chart_data(chart, signal_name) {
	  return Generators.observe(function(notify) {
	    // change is a function; calling change triggers the resolution of the current promise with the passed value.

	    // Yield the elementâ€™s initial value.
	    const signaled = (name, value) => notify(chart.signal(signal_name));
	    chart.addSignalListener(signal_name, signaled);
	    notify(chart.signal(signal_name));

	    return () => chart.removeSignalListener(signal_name, signaled);
	  });
	}
	)}

	function _selected_node(observe_chart_data,force_directed_chart){return(
	observe_chart_data(force_directed_chart, "node_click")
	)}

	function _selected_cluster_metrics(raw_clusters_data,svu_options,selected_cluster_id)
	{
	  if (raw_clusters_data == null) {
	    return null;
	  } else {
	    let data = raw_clusters_data.filter(
	      d => d[svu_options.cluster_colname] == selected_cluster_id
	    );
	    return data[0];
	  }
	}


	function _filtered_nodes(splink_vis_utils,raw_nodes_data,svu_options,selected_cluster_id){return(
	splink_vis_utils.filter_nodes_with_cluster_id(
	  raw_nodes_data,
	  svu_options.cluster_colname,
	  selected_cluster_id
	)
	)}

	function _filtered_edges(splink_vis_utils,raw_edges_data,svu_options,selected_cluster_id,score_threshold_filter)
	{
	  let edges = splink_vis_utils.filter_edges_with_cluster_id(
	    raw_edges_data,
	    svu_options.cluster_colname,
	    selected_cluster_id
	  );

	  edges = edges.filter(
	    d =>
	      d[svu_options.prob_colname] >=
	      splink_vis_utils.log2_bayes_factor_to_prob(score_threshold_filter)
	  );

	  return edges;
	}


	function _node_history(){return(
	[]
	)}

	function _control_node_history(selected_node,force_directed_chart,$0)
	{

	  if (typeof force_directed_chart._signals.node_click.value == 'undefined') {
	    $0.value = [];
	  } else {
	    $0.value.unshift(
	      force_directed_chart._signals.node_click.value
	    );
	    $0.value = $0.value;
	  }
	}


	function _37(md){return(
	md`## Following are global variables embedded in final html so not needed in final version`
	)}

	function define$1(runtime, observer) {
	  const main = runtime.module();
	  main.variable(observer()).define(["md"], _1$1);
	  main.variable(observer("viewof selected_cluster_id")).define("viewof selected_cluster_id", ["splink_vis_utils","cluster_unique_ids"], _selected_cluster_id);
	  main.variable(observer("selected_cluster_id")).define("selected_cluster_id", ["Generators", "viewof selected_cluster_id"], (G, _) => G.input(_));
	  main.variable(observer("viewof edge_colour_metric")).define("viewof edge_colour_metric", ["splink_vis_utils","raw_edges_data"], _edge_colour_metric);
	  main.variable(observer("edge_colour_metric")).define("edge_colour_metric", ["Generators", "viewof edge_colour_metric"], (G, _) => G.input(_));
	  main.variable(observer("viewof node_size_metric")).define("viewof node_size_metric", ["splink_vis_utils","raw_nodes_data"], _node_size_metric);
	  main.variable(observer("node_size_metric")).define("node_size_metric", ["Generators", "viewof node_size_metric"], (G, _) => G.input(_));
	  main.variable(observer("viewof node_colour_metric")).define("viewof node_colour_metric", ["splink_vis_utils","raw_nodes_data"], _node_colour_metric);
	  main.variable(observer("node_colour_metric")).define("node_colour_metric", ["Generators", "viewof node_colour_metric"], (G, _) => G.input(_));
	  main.variable(observer("viewof show_edge_comparison_type")).define("viewof show_edge_comparison_type", ["splink_vis_utils"], _show_edge_comparison_type$1);
	  main.variable(observer("show_edge_comparison_type")).define("show_edge_comparison_type", ["Generators", "viewof show_edge_comparison_type"], (G, _) => G.input(_));
	  main.variable(observer("viewof show_full_tables")).define("viewof show_full_tables", ["raw_clusters_data","splink_vis_utils"], _show_full_tables);
	  main.variable(observer("show_full_tables")).define("show_full_tables", ["Generators", "viewof show_full_tables"], (G, _) => G.input(_));
	  main.variable(observer("viewof score_threshold_filter")).define("viewof score_threshold_filter", ["splink_vis_utils"], _score_threshold_filter);
	  main.variable(observer("score_threshold_filter")).define("score_threshold_filter", ["Generators", "viewof score_threshold_filter"], (G, _) => G.input(_));
	  main.variable(observer("corresponding_probability")).define("corresponding_probability", ["html","splink_vis_utils","score_threshold_filter"], _corresponding_probability);
	  main.variable(observer("viewof additional_graph_controls")).define("viewof additional_graph_controls", ["splink_vis_utils"], _additional_graph_controls);
	  main.variable(observer("additional_graph_controls")).define("additional_graph_controls", ["Generators", "viewof additional_graph_controls"], (G, _) => G.input(_));
	  main.variable(observer("edge_table")).define("edge_table", ["selected_edge","html","show_edge_comparison_type","splink_vis_utils","ss"], _edge_table);
	  main.variable(observer("nothing_selected_message")).define("nothing_selected_message", ["no_edge_selected","no_node_selected","html","selected_edge"], _nothing_selected_message$1);
	  main.variable(observer("viewof force_directed_chart")).define("viewof force_directed_chart", ["vegaEmbed","splink_vis_utils","spec"], _force_directed_chart);
	  main.variable(observer("force_directed_chart")).define("force_directed_chart", ["Generators", "viewof force_directed_chart"], (G, _) => G.input(_));
	  main.variable(observer("node_history_table")).define("node_history_table", ["node_history","html","show_edge_comparison_type","splink_vis_utils","ss"], _node_history_table);
	  main.variable(observer("viewof refresh")).define("viewof refresh", ["Inputs"], _refresh$1);
	  main.variable(observer("refresh")).define("refresh", ["Generators", "viewof refresh"], (G, _) => G.input(_));
	  main.variable(observer("cluster_table")).define("cluster_table", ["selected_cluster_metrics","html","show_full_tables","splink_vis_utils"], _cluster_table);
	  main.variable(observer("comparison_columns_table")).define("comparison_columns_table", ["no_edge_selected","html","show_edge_comparison_type","splink_vis_utils","selected_edge","ss"], _comparison_columns_table$1);
	  main.variable(observer("waterfall_chart")).define("waterfall_chart", ["no_edge_selected","html","show_edge_comparison_type","splink_vis_utils","selected_edge","ss","vegaEmbed"], _waterfall_chart$1);
	  main.variable(observer("edges_full_table")).define("edges_full_table", ["show_full_tables","filtered_edges","splink_vis_utils","html"], _edges_full_table);
	  main.variable(observer("nodes_full_table")).define("nodes_full_table", ["show_full_tables","raw_nodes_data","svu_options","selected_cluster_id","html","splink_vis_utils"], _nodes_full_table);
	  main.variable(observer("clusters_full_table")).define("clusters_full_table", ["show_full_tables","html","splink_vis_utils","raw_clusters_data"], _clusters_full_table);
	  main.variable(observer()).define(["md"], _22$1);
	  main.variable(observer("spec")).define("spec", ["splink_vis_utils","filtered_nodes","ss","filtered_edges","edge_colour_metric","node_size_metric","node_colour_metric","width","additional_graph_controls"], _spec);
	  main.variable(observer("ss")).define("ss", ["splink_vis_utils","splink_settings"], _ss$1);
	  main.variable(observer("no_edge_selected")).define("no_edge_selected", ["selected_edge"], _no_edge_selected$1);
	  main.variable(observer("no_node_selected")).define("no_node_selected", ["selected_node"], _no_node_selected);
	  main.variable(observer()).define(["md"], _27);
	  main.variable(observer("cluster_unique_ids")).define("cluster_unique_ids", ["splink_vis_utils","raw_nodes_data","svu_options","named_clusters"], _cluster_unique_ids);
	  main.variable(observer("selected_edge")).define("selected_edge", ["observe_chart_data","force_directed_chart"], _selected_edge$1);
	  main.variable(observer("observe_chart_data")).define("observe_chart_data", ["Generators"], _observe_chart_data$1);
	  main.variable(observer("selected_node")).define("selected_node", ["observe_chart_data","force_directed_chart"], _selected_node);
	  main.variable(observer("selected_cluster_metrics")).define("selected_cluster_metrics", ["raw_clusters_data","svu_options","selected_cluster_id"], _selected_cluster_metrics);
	  main.variable(observer("filtered_nodes")).define("filtered_nodes", ["splink_vis_utils","raw_nodes_data","svu_options","selected_cluster_id"], _filtered_nodes);
	  main.variable(observer("filtered_edges")).define("filtered_edges", ["splink_vis_utils","raw_edges_data","svu_options","selected_cluster_id","score_threshold_filter"], _filtered_edges);
	  main.define("initial node_history", _node_history);
	  main.variable(observer("mutable node_history")).define("mutable node_history", ["Mutable", "initial node_history"], (M, _) => new M(_));
	  main.variable(observer("node_history")).define("node_history", ["mutable node_history"], _ => _.generator);
	  main.variable(observer("control_node_history")).define("control_node_history", ["selected_node","force_directed_chart","mutable node_history"], _control_node_history);
	  main.variable(observer()).define(["md"], _37);
	  return main;
	}

	function _1(md){return(
	md`# splink_comparison_viewer splink3 version`
	)}

	function _show_edge_comparison_type(splink_vis_utils){return(
	splink_vis_utils.checkbox(
	  new Map([
	    ["Show simple comparison table", "show_simple_comparison_table"],
	    [
	      "Show case statement comparison table",
	      "show_case_statement_comparison_table"
	    ]
	  ]),
	  {
	    label: "",
	    value: ["show_simple_comparison_table"]
	  }
	)
	)}

	function _sort_bars_option(splink_vis_utils)
	{
	  let select_options = new Map([
	    ["Sort histogram by match weight", "sort_match_weight"],
	    ["Sort histogram by sum of matches in bar", "sort_sum_matches"]
	  ]);
	  return splink_vis_utils.select(select_options, {
	    label: "Sort histogram bars by: ",
	    value: "sort_match_weight"
	  });
	}


	function _gamma_filters(get_gammas_filters,ss){return(
	get_gammas_filters(ss)
	)}

	function _filter_count(splink_vis_utils){return(
	splink_vis_utils.range([1, 1000], {
	  label: "Filter out comparison vector counts below",
	  step: 1,
	  value: 1
	})
	)}

	function _comparison_vector_distribution_chart(vegaEmbed,chart_spec_with_data){return(
	vegaEmbed(
	  chart_spec_with_data
	)
	)}

	function _nothing_selected_message(no_edge_selected,html)
	{
	  if (no_edge_selected) {
	    return html`<span style="color:red; font-weight:bold; background-color: #FFFF00"'>Click on a bar in the comparison vector chart above to show an example record comparison`;
	  }

	  return html``;
	}


	function _example_index(no_edge_selected,comparison_vector_row_lookup,cv_chart_selection,splink_vis_utils)
	{
	  if (!no_edge_selected) {
	    let num_options =
	      comparison_vector_row_lookup[cv_chart_selection["gam_concat"]].length;

	    let select_options = [...Array(num_options).keys()];
	    return splink_vis_utils.select(select_options, {
	      label: "Choose example record",
	      value: 0
	    });
	  } else {
	    let hidden = splink_vis_utils.select([1], {
	      label: "Choose example record",
	      value: 0
	    });

	    hidden.style.visibility = "hidden";
	    return hidden;
	  }
	}


	function _compairson_non_null_table(no_edge_selected,html,show_edge_comparison_type,splink_vis_utils,selected_edge,ss)
	{
	  if (no_edge_selected) {
	    return html``;
	  }

	  if (show_edge_comparison_type.includes("show_simple_comparison_table")) {
	    return html`  <h3>Comparison of non-null fields</h3>   
    ${splink_vis_utils.edge_row_to_table(selected_edge, ss)}
`;
	  }

	  return html``;
	}


	function _comparison_columns_table(no_edge_selected,html,show_edge_comparison_type,splink_vis_utils,selected_edge,ss)
	{
	  if (no_edge_selected) {
	    return html``;
	  }
	  if (
	    show_edge_comparison_type.includes("show_case_statement_comparison_table")
	  ) {
	    return html`
  <h3>Record comparison and associated case expression</h3>   
${splink_vis_utils.comparison_column_table(selected_edge, ss)}`;
	  }

	  return html``;
	}


	function _waterfall_chart(no_edge_selected,html,splink_vis_utils,selected_edge,ss,vegaEmbed)
	{
	  if (no_edge_selected) {
	    return html``;
	  } else {
	    let waterfall_data = splink_vis_utils.get_waterfall_chart_data(
	      selected_edge,
	      ss
	    );

	    return vegaEmbed(
	      splink_vis_utils.get_waterfall_chart_spec(waterfall_data, { height: 250 })
	    );
	  }
	}


	function _refresh(Inputs){return(
	Inputs.button("refresh splink_vis_utils javascript lib")
	)}

	function _get_gammas_filters(html,splink_vis_utils){return(
	function get_gammas_filters(splink_settings_object) {
	  // splink settings Comparisons
	  let ss_cols = splink_settings_object.comparisons;

	  function get_id_from_comparison(cc) {
	    return `id_${cc.sanitised_name}`;
	  }

	  const form = html`<form>
    ${ss_cols.map((cc) => {
      let select_values = cc.comparison_levels.map((cl) => {
        return [cl.label_for_charts, cl.comparison_vector_value];
      });
      select_values.unshift(["Any", "Any"]);
      select_values = new Map(select_values);

      return html`<div id='${get_id_from_comparison(
        cc
      )}'>${splink_vis_utils.select(select_values, {
        label: `Filter '${cc.name}'`
      })}</div>`;
    })}

</form>`;

	  form.oninput = function () {
	    let mydict = {};
	    ss_cols.forEach((cc) => {
	      mydict[cc.sanitised_name] = form.querySelector(
	        `#${get_id_from_comparison(cc)} form`
	      ).value;
	    });
	    form.value = mydict;
	  };
	  form.oninput();
	  return form;
	}
	)}

	function _14(md){return(
	md`## Interations`
	)}

	function _cv_chart_selection(observe_chart_data,comparison_vector_distribution_chart){return(
	observe_chart_data(
	  comparison_vector_distribution_chart,
	  "gam_concat_signal"
	)
	)}

	function _selected_edge(no_edge_selected,comparison_vector_row_lookup,cv_chart_selection,example_index)
	{
	  if (!no_edge_selected) {
	    return comparison_vector_row_lookup[cv_chart_selection["gam_concat"][0]][
	      example_index
	    ];
	  } else {
	    return undefined;
	  }
	}


	function _no_edge_selected(cv_chart_selection){return(
	!("gam_concat" in cv_chart_selection)
	)}

	function _18(md){return(
	md`## Other`
	)}

	function _new_width(width)
	{
	  if (width - 200 > 1200) {
	    return 1000;
	  }
	  return width - 200;
	}


	function _ss(splink_vis_utils,splink_settings){return(
	new splink_vis_utils.SplinkSettings(JSON.stringify(splink_settings))
	)}

	function _filtered_comparison_vector_data(gamma_filters,comparison_vector_data,filter_count)
	{
	  let gam_keys = Object.keys(gamma_filters);

	  let cvd_filtered = comparison_vector_data;

	  cvd_filtered = cvd_filtered.filter((d) => d.row_example_index == 1);

	  gam_keys.forEach((gk) => {
	    cvd_filtered = cvd_filtered.filter((d) => {
	      let this_filter = gamma_filters[gk];
	      if (this_filter == "Any") {
	        return true;
	      }

	      return d[`gamma_${gk}`] == this_filter;
	    });
	  });

	  cvd_filtered = cvd_filtered.filter(
	    (d) => d.count >= filter_count
	  );

	  if (cvd_filtered.length == 0) {
	    cvd_filtered = [{}];
	  }

	  return cvd_filtered;
	}


	function _22(md){return(
	md`## Functions`
	)}

	function _create_comparison_vector_row_lookup(){return(
	function create_comparison_vector_row_lookup(sample_edges) {
	  let lookup = {};
	  sample_edges.forEach(d => {
	    let gc = d["gam_concat"];
	    lookup[gc] = lookup[gc] || [];

	    lookup[gc].push(d);
	  });
	  return lookup;
	}
	)}

	function _comparison_vector_row_lookup(create_comparison_vector_row_lookup,comparison_vector_data){return(
	create_comparison_vector_row_lookup(
	  comparison_vector_data
	)
	)}

	function _observe_chart_data(Generators){return(
	function observe_chart_data(chart, signal_name) {
	  return Generators.observe(function (notify) {
	    const signaled = (name, value) => notify(chart.signal(signal_name));
	    chart.addSignalListener(signal_name, signaled);
	    notify(chart.signal(signal_name));
	  });
	}
	)}

	function _26(md){return(
	md`## External libs`
	)}

	function _chart_spec_with_data(splink_vis_utils,filtered_comparison_vector_data,ss,new_width,sort_bars_option)
	{
	  let cs_with_data = splink_vis_utils.get_gamma_distribution_chart(
	    filtered_comparison_vector_data,
	    ss,
	    new_width,
	    sort_bars_option
	  );

	  return cs_with_data;
	}


	function _28(md){return(
	md`## Data`
	)}

	function _localUrl(){return(
	"http://127.0.0.1:8080/dist/splink_vis_utils.js"
	)}

	function define(runtime, observer) {
	  const main = runtime.module();
	  main.variable(observer()).define(["md"], _1);
	  main.variable(observer("viewof show_edge_comparison_type")).define("viewof show_edge_comparison_type", ["splink_vis_utils"], _show_edge_comparison_type);
	  main.variable(observer("show_edge_comparison_type")).define("show_edge_comparison_type", ["Generators", "viewof show_edge_comparison_type"], (G, _) => G.input(_));
	  main.variable(observer("viewof sort_bars_option")).define("viewof sort_bars_option", ["splink_vis_utils"], _sort_bars_option);
	  main.variable(observer("sort_bars_option")).define("sort_bars_option", ["Generators", "viewof sort_bars_option"], (G, _) => G.input(_));
	  main.variable(observer("viewof gamma_filters")).define("viewof gamma_filters", ["get_gammas_filters","ss"], _gamma_filters);
	  main.variable(observer("gamma_filters")).define("gamma_filters", ["Generators", "viewof gamma_filters"], (G, _) => G.input(_));
	  main.variable(observer("viewof filter_count")).define("viewof filter_count", ["splink_vis_utils"], _filter_count);
	  main.variable(observer("filter_count")).define("filter_count", ["Generators", "viewof filter_count"], (G, _) => G.input(_));
	  main.variable(observer("viewof comparison_vector_distribution_chart")).define("viewof comparison_vector_distribution_chart", ["vegaEmbed","chart_spec_with_data"], _comparison_vector_distribution_chart);
	  main.variable(observer("comparison_vector_distribution_chart")).define("comparison_vector_distribution_chart", ["Generators", "viewof comparison_vector_distribution_chart"], (G, _) => G.input(_));
	  main.variable(observer("nothing_selected_message")).define("nothing_selected_message", ["no_edge_selected","html"], _nothing_selected_message);
	  main.variable(observer("viewof example_index")).define("viewof example_index", ["no_edge_selected","comparison_vector_row_lookup","cv_chart_selection","splink_vis_utils"], _example_index);
	  main.variable(observer("example_index")).define("example_index", ["Generators", "viewof example_index"], (G, _) => G.input(_));
	  main.variable(observer("compairson_non_null_table")).define("compairson_non_null_table", ["no_edge_selected","html","show_edge_comparison_type","splink_vis_utils","selected_edge","ss"], _compairson_non_null_table);
	  main.variable(observer("comparison_columns_table")).define("comparison_columns_table", ["no_edge_selected","html","show_edge_comparison_type","splink_vis_utils","selected_edge","ss"], _comparison_columns_table);
	  main.variable(observer("waterfall_chart")).define("waterfall_chart", ["no_edge_selected","html","splink_vis_utils","selected_edge","ss","vegaEmbed"], _waterfall_chart);
	  main.variable(observer("viewof refresh")).define("viewof refresh", ["Inputs"], _refresh);
	  main.variable(observer("refresh")).define("refresh", ["Generators", "viewof refresh"], (G, _) => G.input(_));
	  main.variable(observer("get_gammas_filters")).define("get_gammas_filters", ["html","splink_vis_utils"], _get_gammas_filters);
	  main.variable(observer()).define(["md"], _14);
	  main.variable(observer("cv_chart_selection")).define("cv_chart_selection", ["observe_chart_data","comparison_vector_distribution_chart"], _cv_chart_selection);
	  main.variable(observer("selected_edge")).define("selected_edge", ["no_edge_selected","comparison_vector_row_lookup","cv_chart_selection","example_index"], _selected_edge);
	  main.variable(observer("no_edge_selected")).define("no_edge_selected", ["cv_chart_selection"], _no_edge_selected);
	  main.variable(observer()).define(["md"], _18);
	  main.variable(observer("new_width")).define("new_width", ["width"], _new_width);
	  main.variable(observer("ss")).define("ss", ["splink_vis_utils","splink_settings"], _ss);
	  main.variable(observer("filtered_comparison_vector_data")).define("filtered_comparison_vector_data", ["gamma_filters","comparison_vector_data","filter_count"], _filtered_comparison_vector_data);
	  main.variable(observer()).define(["md"], _22);
	  main.variable(observer("create_comparison_vector_row_lookup")).define("create_comparison_vector_row_lookup", _create_comparison_vector_row_lookup);
	  main.variable(observer("comparison_vector_row_lookup")).define("comparison_vector_row_lookup", ["create_comparison_vector_row_lookup","comparison_vector_data"], _comparison_vector_row_lookup);
	  main.variable(observer("observe_chart_data")).define("observe_chart_data", ["Generators"], _observe_chart_data);
	  main.variable(observer()).define(["md"], _26);
	  main.variable(observer("chart_spec_with_data")).define("chart_spec_with_data", ["splink_vis_utils","filtered_comparison_vector_data","ss","new_width","sort_bars_option"], _chart_spec_with_data);
	  main.variable(observer()).define(["md"], _28);
	  main.variable(observer("localUrl")).define("localUrl", _localUrl);
	  return main;
	}

	const log2 = Math.log2;

	function bayes_factor_to_prob(b) {
	  return b / (b + 1);
	}

	function prob_to_bayes_factor(p) {
	  return p / (1 - p);
	}

	function prob_to_log2_bayes_factor(p) {
	  return log2(prob_to_bayes_factor(p));
	}

	function log2_bayes_factor_to_prob(log2_b) {
	  return bayes_factor_to_prob(2 ** log2_b);
	}

	function get_waterfall_row_single_column(gamma_key, row, splink_settings) {
	  let rows_for_column = [];
	  let key = gamma_key;
	  let gamma_value = row[key];
	  let col_name = key.replace("gamma_", "");

	  let this_cc = splink_settings.get_col_by_name(col_name);
	  let this_cl = this_cc.get_comparison_level(gamma_value);

	  const columns_used = this_cc.columns_used;

	  function get_data_value(dataset_suffix) {
	    // dataset_suffix is 'l' or 'r'
	    // for each column used, get the row value,
	    // and join together in comma-separated fashion
	    return columns_used.map(
	      (col_name) => row[`${col_name}_${dataset_suffix}`]
	    ).join(", ");
	  }

	  let value_l = get_data_value("l");
	  let value_r = get_data_value("r");

	  let bayes_factor = row["bf_" + col_name];

	  let single_row = {
	    bayes_factor: bayes_factor,
	    column_name: col_name,
	    gamma_column_name: "ð›¾_" + col_name,
	    gamma_index: gamma_value,

	    level_name: "level_" + gamma_value,

	    log2_bayes_factor: log2(bayes_factor),
	    m_probability: this_cl["m_probability"],

	    num_levels: this_cc.num_levels,
	    u_probability: this_cl["u_probability"],
	    value_l: value_l,
	    value_r: value_r,
	    sql_condition: this_cl.sql_condition,
	  };
	  rows_for_column.push(single_row);

	  // If there's a term frequency adjustment for this column, we need a second row

	  let bf_tf_col_name = "bf_tf_adj_" + col_name;
	  if (bf_tf_col_name in row) {
	    let tf_row = cloneDeep(single_row);
	    tf_row["column_name"] = "tf_" + col_name;
	    bayes_factor = row[bf_tf_col_name];
	    tf_row["bayes_factor"] = bayes_factor;
	    tf_row["log2_bayes_factor"] = log2(bayes_factor);
	    tf_row["m_probability"] = null;
	    tf_row["u_probability"] = null;

	    rows_for_column.push(tf_row);
	  }
	  return rows_for_column;
	}

	function get_waterfall_data_comparison_columns(
	  row,
	  splink_settings,
	  term_freqs
	) {
	  let keys = Object.keys(row);
	  keys = keys.filter((key) => key.startsWith("gamma_"));

	  let column_rows = [];
	  keys.forEach((gamma_key) => {
	    let rows = get_waterfall_row_single_column(
	      gamma_key,
	      row,
	      splink_settings);
	    column_rows.push(...rows);
	  });
	  return column_rows;
	}

	function get_waterfall_data_lambda_row(splink_settings) {
	  let row = {
	    bayes_factor: prob_to_bayes_factor(
	      splink_settings.settings_dict.probability_two_random_records_match
	    ),
	    column_name: "Prior",
	    gamma_column_name: "",
	    gamma_index: "",

	    level_name: null,

	    log2_bayes_factor: prob_to_log2_bayes_factor(
	      splink_settings.settings_dict.probability_two_random_records_match
	    ),
	    m_probability: null,

	    num_levels: null,
	    u_probability: null,
	    value_l: "",
	    value_r: "",
	  };

	  return row;
	}

	function get_waterfall_data_final_row() {
	  let row = {
	    bayes_factor: null,
	    column_name: "Final score",
	    gamma_column_name: "",
	    gamma_index: "",

	    level_name: null,

	    log2_bayes_factor: null,
	    m_probability: null,

	    num_levels: null,
	    u_probability: null,
	    value_l: "",
	    value_r: "",
	  };

	  return row;
	}

	function get_waterfall_chart_data(
	  row,
	  splink_settings,
	  term_freqs = {}
	) {
	  let lambda_row = get_waterfall_data_lambda_row(splink_settings);
	  let waterfall_data_other_rows = get_waterfall_data_comparison_columns(
	    row,
	    splink_settings);

	  let rows_except_final = [lambda_row].concat(waterfall_data_other_rows);
	  let final_row = get_waterfall_data_final_row();

	  let cumulative_log2_bayes_factor = rows_except_final.reduce(
	    (a, b) => a + b["log2_bayes_factor"],
	    0
	  );

	  final_row["bayes_factor"] = 2 ** cumulative_log2_bayes_factor;
	  final_row["log2_bayes_factor"] = cumulative_log2_bayes_factor;

	  return rows_except_final.concat([final_row]);
	}

	var $schema$2 = "https://vega.github.io/schema/vega/v5.json";
	var description = "Links and nodes";
	var padding = 0;
	var autosize = "none";
	var signals = [
		{
			name: "node_click",
			on: [
				{
					events: "@nodes:click",
					update: "datum"
				}
			]
		},
		{
			name: "nodeRadius",
			value: 1,
			bind: {
				input: "range",
				min: 0.2,
				max: 4,
				step: 0.1
			}
		},
		{
			name: "nodeCollideStrength",
			value: 1,
			bind: {
				input: "range",
				min: 0.2,
				max: 4,
				step: 0.1
			}
		},
		{
			name: "nodeCollideRadius",
			value: 1.4,
			bind: {
				input: "range",
				min: 0.2,
				max: 4,
				step: 0.1
			}
		},
		{
			name: "linkStrength",
			value: 0.5,
			bind: {
				input: "range",
				min: 0,
				max: 2,
				step: 0.01
			}
		},
		{
			name: "edge_click",
			on: [
				{
					events: "@edges:click",
					update: "datum"
				}
			]
		},
		{
			name: "cx",
			update: "width / 2"
		},
		{
			name: "cy",
			update: "height / 2"
		},
		{
			name: "nodeCharge",
			value: 30,
			bind: {
				input: "range",
				min: -2000,
				max: 500,
				step: 1
			}
		},
		{
			name: "linkDistance",
			value: 0.5,
			bind: {
				input: "range",
				min: 0.1,
				max: 2,
				step: 0.1
			}
		},
		{
			name: "vis_height",
			value: 200,
			bind: {
				input: "range",
				min: 400,
				max: 2000,
				step: 50
			}
		},
		{
			name: "vis_width",
			value: 1000,
			bind: {
				input: "range",
				min: 400,
				max: 2000,
				step: 20
			}
		},
		{
			name: "static",
			value: true,
			bind: {
				input: "checkbox"
			}
		},
		{
			description: "State variable for active node fix status.",
			name: "fix",
			value: false,
			on: [
				{
					events: "symbol:mouseout[!event.buttons], window:mouseup",
					update: "false"
				},
				{
					events: "symbol:mouseover",
					update: "fix || true"
				},
				{
					events: "[symbol:mousedown, window:mouseup] > window:mousemove!",
					update: "xy()",
					force: true
				}
			]
		},
		{
			description: "Graph node most recently interacted with.",
			name: "node",
			value: null,
			on: [
				{
					events: "symbol:mouseover",
					update: "fix === true ? item() : node"
				}
			]
		},
		{
			description: "Flag to restart Force simulation upon data changes.",
			name: "restart",
			value: false,
			on: [
				{
					events: {
						signal: "fix"
					},
					update: "fix && fix.length"
				}
			]
		}
	];
	var width$1 = {
		signal: "vis_width"
	};
	var height$1 = {
		signal: "vis_height"
	};
	var data$2 = [
		{
			name: "node-data",
			values: null
		},
		{
			name: "link-data",
			values: null
		}
	];
	var scales = [
		{
			name: "color",
			type: "ordinal",
			domain: {
				data: "node-data",
				field: "cluster_id"
			},
			range: {
				scheme: "category20c"
			}
		}
	];
	var legends = [
	];
	var marks = [
		{
			name: "nodes",
			type: "symbol",
			zindex: 1,
			from: {
				data: "node-data"
			},
			on: [
				{
					trigger: "fix",
					modify: "node",
					values: "fix === true ? {fx: node.x, fy: node.y} : {fx: fix[0], fy: fix[1]}"
				}
			],
			encode: {
				enter: {
					stroke: {
						value: "black"
					},
					tooltip: {
						signal: "datum.tooltip"
					}
				},
				update: {
					size: {
						value: 1000,
						mult: {
							signal: "nodeRadius"
						}
					},
					cursor: {
						value: "pointer"
					},
					fill: {
						scale: "color",
						field: "cluster_id"
					}
				}
			},
			transform: [
				{
					type: "force",
					iterations: 400,
					restart: {
						signal: "restart"
					},
					"static": {
						signal: "static"
					},
					signal: "force",
					forces: [
						{
							force: "center",
							x: {
								signal: "cx"
							},
							y: {
								signal: "cy"
							}
						},
						{
							force: "collide",
							radius: {
								expr: "pow(1000*nodeRadius,0.5)*nodeCollideStrength*nodeCollideRadius"
							},
							strength: {
								signal: "nodeCollideStrength"
							}
						},
						{
							force: "nbody",
							strength: {
								signal: "nodeCharge"
							}
						},
						{
							description: "Uses link-data to find links between nodes constraining x and y of nodes.  Tranforms link-data so source and target are objects that include e.g. x and y coords",
							force: "link",
							links: "link-data",
							distance: {
								expr: "50*linkDistance"
							},
							id: "datum.__node_id",
							strength: {
								signal: "linkStrength"
							}
						}
					]
				}
			]
		},
		{
			description: "The force link transform will replace source and target with objects containing x and y coords.  We need to extract x and y to plot a path between them",
			type: "path",
			name: "edges",
			from: {
				data: "link-data"
			},
			interactive: true,
			encode: {
				update: {
					stroke: {
						value: "black"
					},
					tooltip: {
						signal: "datum.tooltip"
					},
					strokeWidth: {
						value: 2
					}
				}
			},
			transform: [
				{
					type: "linkpath",
					require: {
						signal: "force"
					},
					shape: "line",
					sourceX: "datum.source.x",
					sourceY: "datum.source.y",
					targetX: "datum.target.x",
					targetY: "datum.target.y"
				}
			]
		},
		{
			type: "text",
			from: {
				data: "nodes"
			},
			interactive: false,
			zindex: 2,
			encode: {
				enter: {
					align: {
						value: "center"
					},
					baseline: {
						value: "middle"
					},
					fontSize: {
						value: 12
					},
					fontWeight: {
						value: "bold"
					},
					text: {
						field: "datum.__node_id"
					}
				},
				update: {
					x: {
						field: "x"
					},
					y: {
						field: "y"
					}
				}
			}
		}
	];
	var base_spec$2 = {
		$schema: $schema$2,
		description: description,
		padding: padding,
		autosize: autosize,
		signals: signals,
		width: width$1,
		height: height$1,
		data: data$2,
		scales: scales,
		legends: legends,
		marks: marks
	};

	function find_obj_in_list(list, key, value) {
	  return list.find(function (item) {
	    if (item[key] === value) {
	      return true;
	    }
	  });
	}

	function replace_in_list_or_push(list, key, value, obj) {
	  const foundIndex = list.findIndex(function (item) {
	    if (item[key] === value) {
	      return true;
	    }
	  });

	  if (foundIndex == -1) {
	    list.push(obj);
	  } else {
	    list[foundIndex] = obj;
	  }
	}

	class ForceDirectedChart {
	  constructor(nodes_data, links_data) {
	    let base_spec_cp = cloneDeep(base_spec$2);
	    this.spec = base_spec_cp;
	    this.set_force_directed_node_data(nodes_data);
	    this.set_force_directed_edge_data(links_data);
	    this.nodes_data = nodes_data;
	  }

	  set_force_directed_node_data(data) {
	    let obj = find_obj_in_list(this.spec.data, "name", "node-data");
	    obj["values"] = data;
	  }

	  set_force_directed_edge_data(data) {
	    let obj = find_obj_in_list(this.spec.data, "name", "link-data");
	    obj["values"] = data;
	  }

	  set_edge_colour_metric(
	    edge_metric_name,
	    reverse = false,
	    domain = null,
	    range = null
	  ) {
	    if (domain == null) {
	      domain = { data: "link-data", field: edge_metric_name };
	    }

	    if (range == null) {
	      range = { scheme: "redyellowgreen" };
	    }
	    const new_link_scale = {
	      name: "link_colour",
	      type: "linear",
	      domain: domain,
	      range: range,
	      reverse: reverse,
	    };

	    replace_in_list_or_push(
	      this.spec.scales,
	      "name",
	      "link_colour",
	      new_link_scale
	    );

	    let link_mark = find_obj_in_list(this.spec.marks, "name", "edges");

	    link_mark.encode.update.stroke = {
	      scale: "link_colour",
	      field: edge_metric_name,
	    };
	  }

	  set_edge_thickness_metric(edge_metric_name, reverse = false) {
	    const new_thickness_scale = {
	      name: "link_thickness",
	      type: "linear",
	      domain: { data: "link-data", field: edge_metric_name },
	      range: [0.5, 5],
	      reverse: reverse,
	    };

	    replace_in_list_or_push(
	      this.spec.scales,
	      "name",
	      "link_thickness",
	      new_thickness_scale
	    );

	    let link_mark = find_obj_in_list(this.spec.marks, "name", "edges");

	    link_mark.encode.update.strokeWidth = {
	      scale: "link_thickness",
	      field: edge_metric_name,
	    };
	  }

	  set_edge_length_metric(edge_metric_name, reverse = false) {
	    const new_edge_length_scale = {
	      name: "edge_length_scale",
	      type: "linear",
	      domain: { data: "link-data", field: edge_metric_name },
	      range: [50, 200],
	      reverse: reverse,
	    };

	    replace_in_list_or_push(
	      this.spec.scales,
	      "name",
	      "edge_length_scale",
	      new_edge_length_scale
	    );

	    const new_force = {
	      force: "link",
	      id: "datum.__node_id",
	      links: "link-data",
	      distance: {
	        expr: `scale('edge_length_scale',datum.${edge_metric_name})*linkDistance`,
	      },
	    };

	    let link_mark = find_obj_in_list(this.spec.marks, "name", "nodes");
	    let force_transform = find_obj_in_list(
	      link_mark.transform,
	      "type",
	      "force"
	    );
	    replace_in_list_or_push(force_transform.forces, "force", "link", new_force);
	  }

	  set_node_area_metric(
	    node_metric_name,
	    reverse = false,
	    domain = null,
	    range = null
	  ) {
	    if (domain == null) {
	      domain = { data: "node-data", field: node_metric_name };
	    }

	    if (range == null) {
	      range = [400, 2000];
	    }

	    const new_node_area_scale = {
	      name: "node_area_scale",
	      type: "linear",
	      nice: false,
	      reverse: reverse,
	      domain: domain,
	      range: range,
	    };

	    replace_in_list_or_push(
	      this.spec.scales,
	      "name",
	      "node_area_scale",
	      new_node_area_scale
	    );

	    let node_mark = find_obj_in_list(this.spec.marks, "name", "nodes");

	    node_mark.encode.update.size = {
	      scale: "node_area_scale",
	      field: node_metric_name,
	      mult: { signal: "nodeRadius" },
	    };

	    let force_transform = find_obj_in_list(
	      node_mark.transform,
	      "type",
	      "force"
	    );
	    let force_collide = find_obj_in_list(
	      force_transform.forces,
	      "force",
	      "collide"
	    );
	    force_collide.radius.expr = `pow(scale('node_area_scale',datum.datum.${node_metric_name})*nodeRadius,0.5)`;
	  }

	  set_node_colour_metric(
	    node_metric_name,

	    domain = null,
	    range = null
	  ) {
	    if (domain == null) {
	      domain = { data: "node-data", field: node_metric_name };
	    }

	    if (range == null) {
	      range = {
	        scheme: "category10",
	      };
	    }

	    const new_node_colour_scale = {
	      name: "node_colour_scale",
	      type: "ordinal",

	      domain: domain,
	      range: range,
	    };

	    replace_in_list_or_push(
	      this.spec.scales,
	      "name",
	      "node_colour_scale",
	      new_node_colour_scale
	    );

	    let node_mark = find_obj_in_list(this.spec.marks, "name", "nodes");

	    node_mark.encode.update.fill = {
	      scale: "node_colour_scale",
	      field: node_metric_name,
	    };
	  }

	  set_height_from_nodes_data() {
	    const min_height = 200;
	    const node_height = 150;
	    const num_nodes = this.nodes_data.length;
	    const sqrt_nodes = Math.sqrt(num_nodes);
	    let height = sqrt_nodes * node_height;
	    height = height + 20;
	    height = Math.max(min_height, height);

	    let height_signal = find_obj_in_list(
	      this.spec.signals,
	      "name",
	      "vis_height"
	    );

	    height_signal.value = height;
	  }

	  set_starting_width(new_width) {
	    let width_signal = find_obj_in_list(this.spec.signals, "name", "vis_width");
	    width_signal.value = new_width;
	  }

	  remove_all_sliders() {
	    this.spec.signals.forEach((signal) => {
	      delete signal.bind;
	    });
	  }
	}

	class Comparison {
	  constructor(cc) {
	    this.original_dict = cc;
	  }

	  get name() {
	    return this.original_dict["column_name"];
	  }

	  get num_levels() {
	    return this.comparison_levels.length;
	  }

	  get comparison_levels() {
	    return this.original_dict["comparison_levels"];
	  }

	  get columns_used() {
	    return this.original_dict["input_columns_used_by_case_statement"];
	  }

	  get sanitised_name() {
	    // replace spaces in names in same fashion as Splink does behind the scenes
	    return this.name.replaceAll(' ', '_')
	  };

	  // get column_case_expression_lookup() {
	  //   let lookup = {};
	  //   let comparison_levels = this.original_dict["comparison_levels"];
	  //   comparison_levels.forEach((d) => {
	  //     lookup[d["comparison_vector_value"]] = d["sql_condition"];
	  //   });

	  //   return lookup;
	  // }

	  get comparison_level_lookup() {
	    let lookup = {};
	    let comparison_levels = this.original_dict["comparison_levels"];
	    comparison_levels.forEach((d) => {
	      lookup[d["comparison_vector_value"]] = d;
	    });

	    return lookup;
	  }

	  get_case_expression_for_level(level) {
	    return this.get_comparison_level(level)["sql_condition"];
	  }

	  get_comparison_level(comparison_vector_value) {
	    return this.comparison_level_lookup[comparison_vector_value];
	  }

	  get m_probabilities() {
	    let comparison_levels = this.original_dict["comparison_levels"];
	    return comparison_levels.map((d) => d["m_probability"]);
	  }

	  get u_probabilities() {
	    let comparison_levels = this.original_dict["comparison_levels"];
	    return comparison_levels.map((d) => d["u_probability"]);
	  }

	  data_from_row(edge_row_as_dict) {
	    let data = {
	      left: [],
	      right: [],
	    };
	    this.columns_used.forEach((col) => {
	      let left_data = {
	        col_name: col,
	        col_value: edge_row_as_dict[`${col}_l`],
	      };
	      let right_data = {
	        col_name: col,
	        col_value: edge_row_as_dict[`${col}_r`],
	      };
	      data["left"].push(left_data);
	      data["right"].push(right_data);
	    });
	    return data;
	  }

	  concat_data_from_row(edge_row_as_dict) {
	    let left_right_data = this.data_from_row(edge_row_as_dict);

	    let left_data = left_right_data["left"];
	    let right_data = left_right_data["right"];

	    left_data = left_data.map((d) => d.col_value);
	    left_data = left_data.filter((d) => d != null);
	    left_data = left_data.join(" | ");

	    right_data = right_data.map((d) => d.col_value);
	    right_data = right_data.filter((d) => d != null);
	    right_data = right_data.join(" | ");

	    return {
	      left: left_data,
	      right: right_data,
	    };
	  }

	  level_from_row(edge_row_as_dict) {
	    let key = "gamma_" + this.name;
	    return edge_row_as_dict[key];
	  }

	  case_expression_from_row(edge_row_as_dict) {
	    let lev = this.level_from_row(edge_row_as_dict);
	    return this.get_case_expression_for_level(lev);
	  }
	}

	class SplinkSettings {
	  constructor(settings_json) {
	    const s = JSON.parse(settings_json);
	    this.settings_dict = s;
	  }

	  get comparisons() {
	    let comparisons = this.settings_dict["comparisons"];
	    return comparisons.map((d) => {
	      return new Comparison(d);
	    });
	  }

	  get comparison_column_lookup() {
	    let lookup = {};

	    this.comparisons.forEach((cc) => {
	      lookup[cc.sanitised_name] = cc;
	    });

	    return lookup;
	  }

	  get cols_used_by_model() {
	    const ccs = this.comparisons;
	    let cols_in_use = [];
	    ccs.forEach((cc) => {
	      cc.columns_used.forEach((used_col) => {
	        if (cols_in_use.indexOf(used_col) == -1) {
	          cols_in_use.push(used_col);
	        }
	      });
	    });
	    return cols_in_use;
	  }

	  get cols_used_by_model_inc_add_to_retain() {
	    let all_cols = [];
	    if (this.settings_dict.link_type == "dedupe_only") {
	      all_cols.push(this.settings_dict.unique_id_column_name);
	    } else {
	      all_cols.push(this.settings_dict.unique_id_column_name);
	      all_cols.push(this.settings_dict.source_dataset_column_name);
	    }

	    let ccs = this.cols_used_by_model;
	    all_cols.push(...ccs);

	    if ("additional_columns_to_retain" in this.settings_dict) {
	      all_cols.push(...this.settings_dict["additional_columns_to_retain"]);
	    }

	    let cols_in_order_deduped = [];
	    all_cols.forEach((col) => {
	      if (cols_in_order_deduped.indexOf(col) == -1) {
	        cols_in_order_deduped.push(col);
	      }
	    });

	    return cols_in_order_deduped;
	  }

	  get_col_by_name(col_name) {
	    return this.comparison_column_lookup[col_name];
	  }
	}

	function format_nodes_data_for_force_directed(
	  nodes_data,
	  splink_settings
	) {
	  // Create a __node_id field that uniquely identifies the row
	  if (splink_settings.settings_dict.link_type == "dedupe_only") {
	    let c = splink_settings.settings_dict.unique_id_column_name;
	    nodes_data.forEach(function (node) {
	      node.__node_id = node[c];
	    });
	  } else {
	    let c = splink_settings.settings_dict.unique_id_column_name;
	    let sds = splink_settings.settings_dict.source_dataset_column_name;
	    nodes_data.forEach(function (node) {
	      node.__node_id = node[sds] + "-__-" + node[c];
	    });
	  }

	  // Create a tooltip field that contains only the info used by the model
	  let cols_for_tooltip = splink_settings.cols_used_by_model_inc_add_to_retain;

	  nodes_data.forEach(function (node) {
	    let tooltip = {};
	    cols_for_tooltip.forEach(function (col) {
	      if (node[col] != null) {
	        tooltip[col] = node[col];
	      }
	    });
	    node.tooltip = tooltip;
	  });

	  return nodes_data;
	}

	function format_edges_data_for_force_directed(
	  edge_data,
	  splink_settings
	) {
	  if (splink_settings.settings_dict.link_type == "dedupe_only") {
	    let c = splink_settings.settings_dict.unique_id_column_name;
	    edge_data.forEach(function (edge) {
	      edge.source = edge[`${c}_l`];
	      edge.target = edge[`${c}_r`];
	    });
	  } else {
	    let c = splink_settings.settings_dict.unique_id_column_name;
	    let sds = splink_settings.settings_dict.source_dataset_column_name;
	    edge_data.forEach(function (edge) {
	      edge.source = edge[`${sds}_l`] + "-__-" + edge[`${c}_l`];
	      edge.target = edge[`${sds}_r`] + "-__-" + edge[`${c}_r`];
	    });
	  }

	  // Create a tooltip field that contains only the info used by the model
	  let cols_for_tooltip = splink_settings.cols_used_by_model_inc_add_to_retain;

	  let additional_cols = [
	    "match_probability",
	    "tf_adjusted_match_prob",
	    "match_weight",
	  ];

	  const first_edge = edge_data.length > 0 ? edge_data[0] : [];
	  additional_cols = additional_cols.filter((col) => {
	    return col in first_edge;
	  });

	  edge_data.forEach(function (edge) {
	    let tooltip = {};
	    cols_for_tooltip.forEach(function (col) {
	      if (edge[`${col}_l`] && edge[`${col}_r`]) {
	        tooltip[`${col}_l`] = edge[`${col}_l`];
	        tooltip[`${col}_r`] = edge[`${col}_r`];
	      }
	    });
	    additional_cols.forEach((d) => (tooltip[d] = edge[d]));
	    edge.tooltip = tooltip;
	  });

	  return edge_data;
	}

	function get_unique_cluster_ids_from_nodes_data(
	  nodes_data,
	  cluster_field
	) {
	  let cluster_ids = nodes_data.map((d) => d[cluster_field]);
	  return [...new Set(cluster_ids)];
	}

	function filter_nodes_with_cluster_id(
	  nodes_data,
	  cluster_field,
	  selected_cluster_id
	) {
	  return nodes_data.filter((d) => d[cluster_field] == selected_cluster_id);
	}

	function filter_edges_with_cluster_id(
	  edges_data,
	  cluster_field,
	  selected_cluster_id
	) {
	  return edges_data
	    .filter((d) => d[`${cluster_field}_l`] == selected_cluster_id)
	    .filter((d) => d[`${cluster_field}_r`] == selected_cluster_id);
	}

	var config$1 = {
		view: {
			continuousWidth: 400,
			continuousHeight: 300
		}
	};
	var title = {
		text: "Match weights waterfall chart",
		subtitle: "How each comparison column contributes to the final match score"
	};
	var transform = [
		{
			filter: "(datum.bayes_factor !== 1.0)"
		},
		{
			window: [
				{
					op: "sum",
					field: "log2_bayes_factor",
					as: "sum"
				},
				{
					op: "lead",
					field: "column_name",
					as: "lead"
				}
			],
			frame: [
				null,
				0
			]
		},
		{
			calculate: "datum.column_name === \"Final score\" ? datum.sum - datum.log2_bayes_factor : datum.sum",
			as: "sum"
		},
		{
			calculate: "datum.lead === null ? datum.column_name : datum.lead",
			as: "lead"
		},
		{
			calculate: "datum.column_name === \"Final score\" || datum.column_name === \"Prior lambda\" ? 0 : datum.sum - datum.log2_bayes_factor",
			as: "previous_sum"
		},
		{
			calculate: "datum.sum > datum.previous_sum ? datum.column_name : \"\"",
			as: "top_label"
		},
		{
			calculate: "datum.sum < datum.previous_sum ? datum.column_name : \"\"",
			as: "bottom_label"
		},
		{
			calculate: "datum.sum > datum.previous_sum ? datum.sum : datum.previous_sum",
			as: "sum_top"
		},
		{
			calculate: "datum.sum < datum.previous_sum ? datum.sum : datum.previous_sum",
			as: "sum_bottom"
		},
		{
			calculate: "(datum.sum + datum.previous_sum) / 2",
			as: "center"
		},
		{
			calculate: "(datum.log2_bayes_factor > 0 ? \"+\" : \"\") + datum.log2_bayes_factor",
			as: "text_log2_bayes_factor"
		},
		{
			calculate: "datum.sum < datum.previous_sum ? 4 : -4",
			as: "dy"
		},
		{
			calculate: "datum.sum < datum.previous_sum ? \"top\" : \"bottom\"",
			as: "baseline"
		},
		{
			calculate: "1. / (1 + pow(2, -1.*datum.sum))",
			as: "prob"
		},
		{
			calculate: "0*datum.sum",
			as: "zero"
		}
	];
	var layer = [
		{
			layer: [
				{
					mark: "rule",
					encoding: {
						y: {
							field: "zero",
							type: "quantitative"
						},
						size: {
							value: 0.5
						},
						color: {
							value: "black"
						}
					}
				},
				{
					mark: {
						type: "bar",
						width: 60
					},
					encoding: {
						color: {
							condition: {
								value: "red",
								test: "(datum.log2_bayes_factor < 0)"
							},
							value: "green"
						},
						opacity: {
							condition: {
								value: 1,
								test: "datum.column_name == 'Prior lambda' || datum.column_name == 'Final score'"
							},
							value: 0.5
						},
						tooltip: [
							{
								type: "nominal",
								field: "column_name",
								title: "Comparison column"
							},
							{
								type: "nominal",
								field: "value_l",
								title: "Value (L)"
							},
							{
								type: "nominal",
								field: "value_r",
								title: "Value (R)"
							},
							{
								type: "nominal",
								field: "gamma_index",
								title: "Gamma level"
							},
							{
								type: "nominal",
								field: "sql_condition",
								title: "SQL condition"
							},
							{
								type: "quantitative",
								field: "bayes_factor",
								format: ".3r",
								title: "Bayes factor"
							},
							{
								type: "quantitative",
								field: "log2_bayes_factor",
								format: ".3r",
								title: "Match weight"
							},
							{
								type: "quantitative",
								field: "prob",
								format: ".3r",
								title: "Match probability"
							}
						],
						x: {
							type: "nominal",
							axis: {
								labelExpr: "datum.value == 'Prior lambda' || datum.value == 'Final score' ? '' : datum.value",
								labelAngle: -20,
								labelAlign: "center",
								labelPadding: 10,
								title: "Column",
								grid: true,
								tickBand: "extent"
							},
							field: "column_name",
							sort: null
						},
						y: {
							type: "quantitative",
							axis: {
								grid: false,
								orient: "left",
								title: "Match weight"
							},
							field: "previous_sum"
						},
						y2: {
							field: "sum"
						}
					}
				},
				{
					mark: {
						type: "text",
						fontWeight: "bold"
					},
					encoding: {
						color: {
							value: "white"
						},
						text: {
							condition: {
								type: "nominal",
								field: "log2_bayes_factor",
								format: ".2f",
								test: "abs(datum.log2_bayes_factor) > 1"
							},
							value: ""
						},
						x: {
							type: "nominal",
							axis: {
								labelAngle: 0,
								title: "Column"
							},
							field: "column_name",
							sort: null
						},
						y: {
							type: "quantitative",
							axis: {
								orient: "left"
							},
							field: "center"
						}
					}
				},
				{
					mark: {
						type: "text",
						baseline: "bottom",
						dy: -5,
						fontWeight: "bold"
					},
					encoding: {
						color: {
							value: "black"
						},
						text: {
							condition: {
								type: "nominal",
								field: "top_label",
								test: "abs(datum.log2_bayes_factor) > 1"
							},
							value: ""
						},
						x: {
							type: "nominal",
							axis: {
								labelAngle: 0,
								title: "Column"
							},
							field: "column_name",
							sort: null
						},
						y: {
							type: "quantitative",
							field: "sum_top"
						}
					}
				},
				{
					mark: {
						type: "text",
						baseline: "top",
						dy: 5,
						fontWeight: "bold"
					},
					encoding: {
						color: {
							value: "black"
						},
						text: {
							condition: {
								type: "nominal",
								field: "bottom_label",
								test: "abs(datum.log2_bayes_factor) > 1"
							},
							value: ""
						},
						x: {
							type: "nominal",
							axis: {
								labelAngle: 0,
								title: "Column"
							},
							field: "column_name",
							sort: null
						},
						y: {
							type: "quantitative",
							field: "sum_bottom"
						}
					}
				}
			]
		},
		{
			mark: {
				type: "rule",
				color: "black",
				strokeWidth: 2,
				x2Offset: 30,
				xOffset: -30
			},
			encoding: {
				x: {
					type: "nominal",
					axis: {
						labelAngle: 0,
						title: "Column"
					},
					field: "column_name",
					sort: null
				},
				x2: {
					field: "lead"
				},
				y: {
					type: "quantitative",
					axis: {
						labelExpr: "format(1 / (1 + pow(2, -1*datum.value)), '.2r')",
						orient: "right",
						title: "Probability"
					},
					field: "sum",
					scale: {
						zero: false
					}
				}
			}
		}
	];
	var height = 450;
	var resolve = {
		axis: {
			y: "independent"
		}
	};
	var width = {
		step: 75
	};
	var $schema$1 = "https://vega.github.io/schema/vega-lite/v4.8.1.json";
	var data$1 = {
		values: null
	};
	var waterfall = {
		config: config$1,
		title: title,
		transform: transform,
		layer: layer,
		height: height,
		resolve: resolve,
		width: width,
		$schema: $schema$1,
		data: data$1
	};

	var base_spec$1 = /*#__PURE__*/Object.freeze({
		__proto__: null,
		config: config$1,
		title: title,
		transform: transform,
		layer: layer,
		height: height,
		resolve: resolve,
		width: width,
		$schema: $schema$1,
		data: data$1,
		'default': waterfall
	});

	function get_waterfall_chart_spec(data, overrides, simplified = false) {
	  let base_spec_2 = cloneDeep(base_spec$1);

	  base_spec_2.data.values = data;
	  let spec = { ...base_spec_2, ...overrides };
	  if (simplified) {
	    // Remove right hand axis
	    spec["layer"][1]["encoding"]["y"]["axis"] = false;

	    // Remove bayes factor text overlays
	    // spec["layer"][0]["layer"].splice(2, 1);
	    spec["layer"][0]["layer"][2]["encoding"]["text"] = {
	      type: "nominal",
	      field: "up_down_emoji",
	    };
	    spec["layer"][0]["layer"][2]["encoding"]["opacity"] = {
	      condition: {
	        value: 0,
	        test: "datum.column_name == 'Final score' || datum.column_name == 'Prior'",
	      },
	    };

	    // Make left hand side axis probability
	    let expr = "format(1 / (1 + pow(2, -1*datum.value)), '.2r')";
	    spec["layer"][0]["layer"][1]["encoding"]["y"]["axis"]["labelExpr"] = expr;
	    spec["layer"][0]["layer"][1]["encoding"]["y"]["axis"]["title"] =
	      "probability";

	    // Tooltip

	    spec["layer"][0]["layer"][1]["encoding"]["tooltip"] = [
	      {
	        type: "quantitative",
	        field: "prob",
	        format: ".3r",
	        title: "Cumulative match probability",
	      },
	    ];
	  }

	  return spec;
	}

	function table(...args) {
	  let tab = table$1(...args);
	  tab.removeAttribute("style");
	  return tab;
	}

	function node_row_to_table(node_as_dict, splink_settings) {
	  const first_cols = splink_settings.cols_used_by_model_inc_add_to_retain;
	  let all_cols = Object.keys(node_as_dict);

	  all_cols = all_cols.filter(function (el) {
	    return !first_cols.includes(el);
	  });

	  let cols = first_cols.concat(all_cols);

	  let d2 = {};
	  cols.forEach((c) => {
	    d2[c] = node_as_dict[c];
	  });

	  return table([d2], { layout: "auto" });
	}

	function edge_row_to_table(edge_as_dict, splink_settings) {
	  const cols_in_use = splink_settings.cols_used_by_model;
	  const row_1 = {};
	  const row_2 = {};

	  let col_priority = { 2: [], 1: [], 0: [] };

	  cols_in_use.forEach((col) => {
	    let l_val = edge_as_dict[col + "_l"];
	    let r_val = edge_as_dict[col + "_r"];

	    row_1[col] = edge_as_dict[col + "_l"];
	    row_2[col] = edge_as_dict[col + "_r"];

	    if (l_val && r_val) {
	      col_priority[2].push(col);
	    } else if (l_val || r_val) {
	      col_priority[1].push(col);
	    } else {
	      col_priority[0].push(col);
	    }
	  });

	  col_priority = col_priority[2]
	    .concat(col_priority[1])
	    .concat(col_priority[0]);

	  let row_1_ordered = {};
	  let row_2_ordered = {};
	  col_priority.forEach((col) => {
	    row_1_ordered[col] = row_1[col];
	    row_2_ordered[col] = row_2[col];
	  });

	  row_1_ordered = formatRowToAppearInTable(row_1_ordered);
	  row_2_ordered = formatRowToAppearInTable(row_2_ordered);

	  let table_data = [row_1_ordered, row_2_ordered];

	  return table(table_data, { layout: "auto" });
	}

	function comparison_column_table(edge_as_dict, splink_settings) {
	  // let splink_settings = new SplinkSettings
	  let ccs = splink_settings.comparisons;

	  let rows = [];

	  ccs.forEach((cc) => {
	    let this_row = {};
	    this_row["comparison_column_name"] = cc.name;

	    let expr = cc.case_expression_from_row(edge_as_dict);
	    let data = cc.concat_data_from_row(edge_as_dict);

	    this_row["data_left"] = data["left"];

	    this_row["data_right"] = data["right"];
	    this_row["case expression"] = expr;

	    rows.push(this_row);
	  });
	  return table(rows, { layout: "auto" });
	}

	function single_cluster_table(cluster_as_dict) {
	  let rows = [];
	  rows.push(cluster_as_dict);
	  return table(rows, { layout: "auto" });
	}

	function detect_node_size_metrics(data) {
	  const node_metrics = new Map([["None", "none"]]);
	  const keys = Object.keys(data[0]);

	  if (keys.includes("eigen_centrality")) {
	    node_metrics.set("Eigen Centrality", "eigen_centrality");
	  }

	  return node_metrics;
	}

	function detect_node_colour_metrics(data) {
	  const node_metrics = new Map([["None", "none"]]);
	  const keys = Object.keys(data[0]);

	  if (keys.includes("ground_truth_cluster")) {
	    node_metrics.set("Ground truth cluster", "ground_truth_cluster");
	  }

	  if (keys.includes("source_dataset")) {
	    node_metrics.set("Source dataset", "source_dataset");
	  }

	  return node_metrics;
	}

	function detect_edge_colour_metrics(data) {
	  const edge_metrics = new Map();
	  const keys = Object.keys(data[0]);

	  if (keys.includes("match_probability")) {
	    edge_metrics.set("Match probability", "match_probability");
	  }

	  if (keys.includes("match_weight")) {
	    edge_metrics.set("Match weight (log2 bayes factor)", "match_weight");
	  }

	  if (keys.includes("tf_adjusted_match_prob")) {
	    edge_metrics.set("TF adjusted match probability", "tf_adjusted_match_prob");
	  }

	  if (keys.includes("edge_betweenness")) {
	    edge_metrics.set("Edge betweenness", "edge_betweenness");
	  }

	  if (keys.includes("is_bridge")) {
	    edge_metrics.set("Is bridge", "is_bridge");
	  }

	  if (keys.includes("is_false_positive")) {
	    edge_metrics.set("Is false positive", "is_false_positive");
	  }

	  return edge_metrics;
	}

	const metric_vis_args = {
	  edge_colour: {
	    match_probability: {
	      edge_metric_name: "match_probability",
	      reverse: false,
	      domain: [0, 1],
	      range: { scheme: "redyellowgreen" },
	    },
	    tf_adjusted_match_prob: {
	      edge_metric_name: "tf_adjusted_match_prob",
	      reverse: false,
	      domain: [0, 1],
	      range: { scheme: "redyellowgreen" },
	    },
	    match_weight: {
	      edge_metric_name: "match_weight",
	      reverse: false,
	      domain: [-20, 20],
	      range: { scheme: "redyellowgreen" },
	    },
	    edge_betweenness: {
	      edge_metric_name: "edge_betweenness",
	      reverse: true,
	      domain: [0, 1],
	      range: { scheme: "redyellowgreen" },
	    },
	    is_bridge: {
	      edge_metric_name: "is_bridge",
	      reverse: true,
	      domain: [0, 1],
	      range: { scheme: "redyellowgreen" },
	    },
	    is_false_positive: {
	      edge_metric_name: "is_false_positive",
	      reverse: true,
	      domain: [0, 1],
	      range: { scheme: "redyellowgreen" },
	    },
	  },
	  node_size: {
	    eigen_centrality: {
	      node_metric_name: "eigen_centrality",
	      reverse: false,
	      domain: { data: "node-data", field: "eigen_centrality" },
	      range: [100, 2000],
	    },
	  },
	  node_colour: {
	    ground_truth_cluster: {
	      node_metric_name: "ground_truth_cluster",

	      domain: { data: "node-data", field: "ground_truth_cluster" },
	      range: { scheme: "category10" },
	    },
	    source_dataset: {
	      node_metric_name: "source_dataset",

	      domain: { data: "node-data", field: "source_dataset" },
	      range: { scheme: "category10" },
	    },
	  },
	};

	function node_rows_to_table(nodes_list_of_dicts, splink_settings) {
	  const first_cols = splink_settings.cols_used_by_model_inc_add_to_retain;
	  let all_cols = Object.keys(nodes_list_of_dicts[0]);

	  all_cols = all_cols.filter(function (el) {
	    return !first_cols.includes(el);
	  });

	  let cols = first_cols.concat(all_cols);

	  let new_data = nodes_list_of_dicts.map((d) => {
	    let d2 = {};
	    cols.forEach((c) => {
	      d2[c] = d[c];
	    });
	    return d2;
	  });

	  new_data = new_data.map(formatRowToAppearInTable);

	  return table(new_data, { layout: "auto" });
	}

	var $schema = "https://vega.github.io/schema/vega-lite/v5.json";
	var config = {
		view: {
			continuousHeight: 300,
			continuousWidth: 400
		}
	};
	var data = {
		values: [
		]
	};
	var vconcat = [
		{
			encoding: {
				color: {
					field: "avg_match_probability",
					scale: {
						domain: [
							0,
							0.5,
							1
						],
						range: [
							"red",
							"orange",
							"green"
						]
					},
					type: "quantitative",
					legend: {
						title: "Match probability",
						offset: -70
					}
				},
				tooltip: [
					{
						field: "gam_concat",
						type: "nominal"
					},
					{
						field: "count",
						type: "quantitative"
					},
					{
						field: "avg_match_probability",
						type: "quantitative",
						format: ",.1%",
						title: "Match probability"
					},
					{
						field: "sort_avg_match_weight",
						type: "quantitative",
						format: ",.2f",
						title: "Match weight"
					},
					{
						field: "sum_matches",
						type: "quantitative",
						format: ",.1f"
					},
					{
						field: "proportion_of_comparisons",
						type: "quantitative",
						format: ",.1%"
					}
				],
				x: {
					field: "gam_concat",
					sort: {
						field: "sort_avg_match_weight",
						op: "sum",
						order: "ascending"
					},
					title: "",
					type: "nominal",
					axis: {
						labels: false,
						ticks: false,
						grid: false
					}
				},
				y: {
					field: "count",
					scale: {
						constant: 40,
						type: "symlog"
					},
					type: "quantitative",
					title: "Frequency count of comparison vector"
				}
			},
			mark: {
				type: "bar",
				clip: true
			},
			title: {
				subtitle: "Click bars on upmost chart to display example. Brush bottom chart to zoom. ",
				text: "Count of comparison vector values"
			},
			width: 1000,
			transform: [
				{
					filter: {
						param: "brush"
					}
				}
			],
			params: [
				{
					name: "gam_concat_signal",
					select: {
						type: "point",
						encodings: [
							"x"
						]
					}
				}
			]
		},
		{
			layer: [
				{
					data: {
						values: [
						]
					},
					mark: "rect",
					width: 1000,
					height: {
						step: 10
					},
					transform: [
						{
							filter: {
								param: "brush"
							}
						}
					],
					encoding: {
						y: {
							field: "gam_name",
							type: "nominal",
							title: "",
							sort: {
								field: "gam_key_count",
								op: "sum",
								order: "ascending"
							}
						},
						x: {
							field: "gam_concat",
							type: "ordinal",
							sort: {
								field: "gamma_concat_id",
								op: "sum",
								order: "ascending"
							},
							axis: {
								labels: false,
								ticks: 0,
								grid: false
							},
							title: ""
						},
						color: {
							field: "match_weight",
							type: "quantitative",
							scale: {
								domain: [
									-10,
									0,
									10
								],
								range: [
									"red",
									"#bbbbbb",
									"green"
								]
							},
							legend: {
								title: "Match weight"
							}
						},
						tooltip: [
							{
								field: "gam_name",
								type: "nominal"
							},
							{
								field: "label_for_charts",
								type: "nominal"
							},
							{
								field: "gam_value",
								type: "quantitative"
							},
							{
								field: "match_weight",
								type: "quantitative"
							},
							{
								field: "sql_condition",
								type: "nominal"
							}
						]
					}
				},
				{
					data: {
						values: [
						]
					},
					mark: {
						type: "text",
						fontSize: 8
					},
					width: 1000,
					height: {
						step: 10
					},
					transform: [
						{
							filter: {
								param: "brush"
							}
						}
					],
					encoding: {
						y: {
							field: "gam_name",
							type: "nominal",
							title: "",
							sort: {
								field: "gam_key_count",
								op: "sum",
								order: "ascending"
							}
						},
						x: {
							field: "gam_concat",
							type: "ordinal",
							sort: {
								field: "gamma_concat_id",
								op: "sum",
								order: "ascending"
							},
							axis: {
								labels: false,
								ticks: 0,
								grid: false
							},
							title: ""
						},
						text: {
							field: "gam_value"
						}
					}
				}
			],
			resolve: {
				scale: {
					color: "independent"
				}
			}
		},
		{
			encoding: {
				color: {
					field: "avg_match_probability",
					legend: null,
					scale: {
						domain: [
							0,
							0.5,
							1
						],
						range: [
							"red",
							"orange",
							"green"
						]
					},
					type: "quantitative"
				},
				x: {
					field: "gam_concat",
					sort: {
						field: "sort_avg_match_weight",
						op: "sum",
						order: "ascending"
					},
					title: "Comparison vector value.  (Brush bottom chart to zoom. Click to reset.)",
					type: "nominal",
					axis: {
						labels: false,
						ticks: 0,
						grid: false
					}
				},
				y: {
					field: "count",
					scale: {
						constant: 1,
						type: "symlog"
					},
					type: "quantitative",
					axis: {
						tickCount: 0,
						grid: false
					},
					title: null
				}
			},
			mark: {
				type: "bar",
				clip: true
			},
			title: {
				text: ""
			},
			width: 1000,
			height: 40,
			params: [
				{
					name: "brush",
					select: {
						type: "interval",
						encodings: [
							"x"
						]
					}
				}
			]
		}
	];
	var base_spec = {
		$schema: $schema,
		config: config,
		data: data,
		vconcat: vconcat
	};

	function sort_match_weight(a, b) {
	  return a.match_weight - b.match_weight;
	}

	function sort_sum_matches(a, b) {
	  return a.sum_matches - b.sum_matches;
	}

	function get_gamma_distribution_chart(
	  data,
	  ss_object,
	  width,
	  sort_bars = "sort_match_weight"
	) {
	  let base_spec_2 = cloneDeep(base_spec);
	  let sort_field;
	  data.forEach((d) => {
	    d.sum_matches = d.match_probability * d.count;

	    const bf = Math.pow(2, d.sort_avg_match_weight);
	    d.avg_match_probability = bf / (1 + bf);
	  });
	  if (sort_bars == "sort_match_weight") {
	    data.sort(sort_match_weight);
	    sort_field = "sort_avg_match_weight";
	  }
	  if (sort_bars == "sort_sum_matches") {

	    data.sort(sort_sum_matches);
	    sort_field = "sum_matches";
	  }

	  let gamma_data = gamma_table_data(data, ss_object);

	  base_spec_2.data.values = data;
	  base_spec_2.vconcat[1]["layer"][0].data.values = gamma_data;
	  base_spec_2.vconcat[1]["layer"][1].data.values = gamma_data;

	  base_spec_2.vconcat[0].width = width;
	  base_spec_2.vconcat[1]["layer"][0].width = width;
	  base_spec_2.vconcat[1]["layer"][1].width = width;
	  base_spec_2.vconcat[2].width = width;

	  base_spec_2.vconcat[0]["encoding"]["x"]["sort"]["field"] = sort_field;
	  base_spec_2.vconcat[1]["layer"][0]["encoding"]["x"]["sort"]["field"] =
	    sort_field;
	  base_spec_2.vconcat[1]["layer"][1]["encoding"]["x"]["sort"]["field"] =
	    sort_field;
	  base_spec_2.vconcat[2]["encoding"]["x"]["sort"]["field"] = sort_field;

	  return base_spec_2;
	}

	function gamma_table_data(data, ss_object) {
	  let gamma_keys = Object.keys(data[0]);

	  let result_data = [];
	  gamma_keys = gamma_keys.filter((d) => d.startsWith("gamma_"));

	  let counter = 0;
	  data.forEach((d) => {
	    counter += 1;
	    let gam_key_counter = 0;
	    gamma_keys.forEach((k) => {
	      let data_col_name = k.replace("gamma_", "");
	      let settings_col = ss_object.get_col_by_name(data_col_name);
	      settings_col.num_levels;

	      let row = {};
	      row["gam_name"] = k;
	      row["gam_value"] = d[k];

	      row["gam_concat"] = d["gam_concat"];
	      row["gam_concat_id"] = counter;
	      row["gam_key_count"] = gam_key_counter;
	      row["bayes_factor"] = d[`bf_${data_col_name}`];
	      const log2 = Math.log2;
	      row["match_weight"] = log2(d[`bf_${data_col_name}`]);
	      row["sort_avg_match_weight"] = d["sort_avg_match_weight"];

	      row["label_for_charts"] = settings_col.comparison_level_lookup[row["gam_value"]]["label_for_charts"];
	      row["sql_condition"] = settings_col.comparison_level_lookup[row["gam_value"]]["sql_condition"];
	      result_data.push(row);
	      gam_key_counter += 1;
	    });
	  });
	  return result_data;
	}

	exports.Comparison = Comparison;
	exports.ForceDirectedChart = ForceDirectedChart;
	exports.Inspector = Inspector;
	exports.Runtime = Runtime;
	exports.SplinkSettings = SplinkSettings;
	exports.bayes_factor_to_prob = bayes_factor_to_prob;
	exports.checkbox = checkbox;
	exports.cloneDeep = cloneDeep;
	exports.comparison_column_table = comparison_column_table;
	exports.define_cluster = define$1;
	exports.define_comparison = define;
	exports.detect_edge_colour_metrics = detect_edge_colour_metrics;
	exports.detect_node_colour_metrics = detect_node_colour_metrics;
	exports.detect_node_size_metrics = detect_node_size_metrics;
	exports.edge_row_to_table = edge_row_to_table;
	exports.filter_edges_with_cluster_id = filter_edges_with_cluster_id;
	exports.filter_nodes_with_cluster_id = filter_nodes_with_cluster_id;
	exports.formatRowToAppearInTable = formatRowToAppearInTable;
	exports.format_edges_data_for_force_directed = format_edges_data_for_force_directed;
	exports.format_nodes_data_for_force_directed = format_nodes_data_for_force_directed;
	exports.get_gamma_distribution_chart = get_gamma_distribution_chart;
	exports.get_unique_cluster_ids_from_nodes_data = get_unique_cluster_ids_from_nodes_data;
	exports.get_waterfall_chart_data = get_waterfall_chart_data;
	exports.get_waterfall_chart_spec = get_waterfall_chart_spec;
	exports.log2 = log2;
	exports.log2_bayes_factor_to_prob = log2_bayes_factor_to_prob;
	exports.metric_vis_args = metric_vis_args;
	exports.node_row_to_table = node_row_to_table;
	exports.node_rows_to_table = node_rows_to_table;
	exports.prob_to_bayes_factor = prob_to_bayes_factor;
	exports.prob_to_log2_bayes_factor = prob_to_log2_bayes_factor;
	exports.range = range;
	exports.select = select;
	exports.single_cluster_table = single_cluster_table;
	exports.table = table;

	Object.defineProperty(exports, '__esModule', { value: true });

}));
 </script>



<script>

 comparison_vector_data = [{"match_weight": 0.45585535329930627, "match_probability": 0.578342980964481, "unique_id_l": "1378-4056", "unique_id_r": "15477036", "publisher_l": "oficina international de aranceles de aduanas", "publisher_r": "officina internacional de aranceles de aduanas", "gamma_publisher": 1, "bf_publisher": 170.5594320449288, "title_l": "boletin internacional de aduanas.", "title_r": "boletin internacional de aduanas", "gamma_title": 1, "bf_title": 44.22847448684245, "place_l": "brussels", "place_r": "brussels", "gamma_place": 1, "tf_place_l": 0.4905019726517818, "tf_place_r": 0.4905019726517818, "bf_place": 3.4289727593629187, "bf_tf_adj_place": 0.5302015184299302, "url_l": null, "url_r": null, "dataSource_l": "ISSN", "dataSource_r": "KBR", "match_key": "0", "rec_comparison_id": "1378-4056-15477036", "gam_concat": "1,1,1", "sort_avg_match_weight": 1.3712426462798872, "rand_order": 8.23156416018982e-05, "row_example_index": 1, "sum_gam": 3, "count": 4496, "proportion_of_comparisons": 0.04139772430062294}, {"match_weight": 0.45585535329930627, "match_probability": 0.578342980964481, "unique_id_l": "0772-098X", "unique_id_r": "16690092", "publisher_l": "ami press", "publisher_r": "ami-press", "gamma_publisher": 1, "bf_publisher": 170.5594320449288, "title_l": "la plaisance en belgique.", "title_r": "la plaisance en belgique", "gamma_title": 1, "bf_title": 44.22847448684245, "place_l": "brussels", "place_r": "brussels", "gamma_place": 1, "tf_place_l": 0.4905019726517818, "tf_place_r": 0.4905019726517818, "bf_place": 3.4289727593629187, "bf_tf_adj_place": 0.5302015184299302, "url_l": null, "url_r": null, "dataSource_l": "ISSN", "dataSource_r": "KBR", "match_key": "0", "rec_comparison_id": "0772-098X-16690092", "gam_concat": "1,1,1", "sort_avg_match_weight": 1.3712426462798872, "rand_order": 0.0005236498589712527, "row_example_index": 2, "sum_gam": 3, "count": 4496, "proportion_of_comparisons": 0.04139772430062294}, {"match_weight": -0.12416654536684799, "match_probability": 0.4784968490145515, "unique_id_l": "0774-4927", "unique_id_r": "15409936", "publisher_l": "abbaye de westmalle", "publisher_r": "cistercienser abdij", "gamma_publisher": 0, "bf_publisher": 0.7473121322606429, "title_l": "citeaux in de nederlanden", "title_r": "mededelingen over het cistercienser leven van de xiie tot de xviiie eeuw", "gamma_title": 0, "bf_title": 0.9945584977395406, "place_l": "westmalle", "place_r": "westmalle", "gamma_place": 1, "tf_place_l": 7.224360543753537e-05, "tf_place_r": 7.224360543753537e-05, "bf_place": 3.4289727593629187, "bf_tf_adj_place": 3599.8326650199238, "url_l": null, "url_r": null, "dataSource_l": "ISSN", "dataSource_r": "KBR", "match_key": "0", "rec_comparison_id": "0774-4927-15409936", "gam_concat": "0,0,1", "sort_avg_match_weight": -11.937880675762559, "rand_order": 0.0009448725332750544, "row_example_index": 1, "sum_gam": -1, "count": 882, "proportion_of_comparisons": 0.008121172897517681}, {"match_weight": -1.124166545366848, "match_probability": 0.31448955508546805, "unique_id_l": "0775-132X", "unique_id_r": "16679173", "publisher_l": "n. de jamblinne de meux", "publisher_r": "association nationale du tourisme equestre de randonnee et d'endurance hippotour", "gamma_publisher": 0, "bf_publisher": 0.7473121322606429, "title_l": "belgische gids voor ruitertoerisme", "title_r": "de belgische gids voor ruitertoerisme", "gamma_title": 0, "bf_title": 0.9945584977395406, "place_l": "rosieres", "place_r": "rosieres", "gamma_place": 1, "tf_place_l": 0.00014448721087507074, "tf_place_r": 0.00014448721087507074, "bf_place": 3.4289727593629187, "bf_tf_adj_place": 1799.9163325099619, "url_l": null, "url_r": null, "dataSource_l": "ISSN", "dataSource_r": "KBR", "match_key": "0", "rec_comparison_id": "0775-132X-16679173", "gam_concat": "0,0,1", "sort_avg_match_weight": -11.937880675762559, "rand_order": 0.0027653952822442036, "row_example_index": 2, "sum_gam": -1, "count": 882, "proportion_of_comparisons": 0.008121172897517681}, {"match_weight": -1.3328459491545885, "match_probability": 0.28417236904555443, "unique_id_l": "16336456", "unique_id_r": "2033-6497", "publisher_l": "peeters", "publisher_r": "peeters ;", "gamma_publisher": 1, "bf_publisher": 170.5594320449288, "title_l": "bibliografisch repertorium van de wijsbegeerte", "title_r": "international philosophical bibliography", "gamma_title": 0, "bf_title": 0.9945584977395406, "place_l": "leuven", "place_r": "leuven", "gamma_place": 1, "tf_place_l": 0.03810850186829991, "tf_place_r": 0.03810850186829991, "bf_place": 3.4289727593629187, "bf_tf_adj_place": 6.824327327051988, "url_l": null, "url_r": null, "dataSource_l": "KBR", "dataSource_r": "ISSN", "match_key": "0", "rec_comparison_id": "16336456-2033-6497", "gam_concat": "1,0,1", "sort_avg_match_weight": -4.1035327959557515, "rand_order": 0.00014310138834356756, "row_example_index": 1, "sum_gam": 1, "count": 9722, "proportion_of_comparisons": 0.08951705694198608}, {"match_weight": -1.3328459491545885, "match_probability": 0.28417236904555443, "unique_id_l": "16336456", "unique_id_r": "2033-6497", "publisher_l": "peeters", "publisher_r": "peeters ;", "gamma_publisher": 1, "bf_publisher": 170.5594320449288, "title_l": "international philosophical bibliography", "title_r": "bibliografisch repertorium van de wijsbegeerte", "gamma_title": 0, "bf_title": 0.9945584977395406, "place_l": "leuven", "place_r": "leuven", "gamma_place": 1, "tf_place_l": 0.03810850186829991, "tf_place_r": 0.03810850186829991, "bf_place": 3.4289727593629187, "bf_tf_adj_place": 6.824327327051988, "url_l": null, "url_r": null, "dataSource_l": "KBR", "dataSource_r": "ISSN", "match_key": "0", "rec_comparison_id": "16336456-2033-6497", "gam_concat": "1,0,1", "sort_avg_match_weight": -4.1035327959557515, "rand_order": 0.00023205694840591572, "row_example_index": 2, "sum_gam": 1, "count": 9722, "proportion_of_comparisons": 0.08951705694198608}, {"match_weight": -0.01812591940612352, "match_probability": 0.49685905883411335, "unique_id_l": "1378-4056", "unique_id_r": "15469569", "publisher_l": "oficina international de aranceles de aduanas", "publisher_r": "officina internacional de aranceles de aduanas", "gamma_publisher": 1, "bf_publisher": 170.5594320449288, "title_l": "boletin internacional de aduanas", "title_r": "boletin internacional de aduanas", "gamma_title": 2, "bf_title": 31.843396141030183, "place_l": "brussels", "place_r": "brussels", "gamma_place": 1, "tf_place_l": 0.4905019726517818, "tf_place_r": 0.4905019726517818, "bf_place": 3.4289727593629187, "bf_tf_adj_place": 0.5302015184299302, "url_l": null, "url_r": null, "dataSource_l": "ISSN", "dataSource_r": "KBR", "match_key": "0", "rec_comparison_id": "1378-4056-15469569", "gam_concat": "1,2,1", "sort_avg_match_weight": 0.8972613735744573, "rand_order": 0.00012635395396239107, "row_example_index": 1, "sum_gam": 4, "count": 7632, "proportion_of_comparisons": 0.0702730044722557}, {"match_weight": 3.66794822037562, "match_probability": 0.9270631688947656, "unique_id_l": "16336456", "unique_id_r": "2033-6497", "publisher_l": "peeters", "publisher_r": "peeters ;", "gamma_publisher": 1, "bf_publisher": 170.5594320449288, "title_l": "repertoire bibliographique de la philosophie", "title_r": "repertoire bibliographique de la philosophie", "gamma_title": 2, "bf_title": 31.843396141030183, "place_l": "leuven", "place_r": "leuven", "gamma_place": 1, "tf_place_l": 0.03810850186829991, "tf_place_r": 0.03810850186829991, "bf_place": 3.4289727593629187, "bf_tf_adj_place": 6.824327327051988, "url_l": null, "url_r": null, "dataSource_l": "KBR", "dataSource_r": "ISSN", "match_key": "0", "rec_comparison_id": "16336456-2033-6497", "gam_concat": "1,2,1", "sort_avg_match_weight": 0.8972613735744573, "rand_order": 0.0001521377553890219, "row_example_index": 2, "sum_gam": 4, "count": 7632, "proportion_of_comparisons": 0.0702730044722557}, {"match_weight": 0.9337620271332007, "match_probability": 0.6563869969516369, "unique_id_l": "0773-2260", "unique_id_r": "15511705", "publisher_l": "filharmonische vereniging van brussel", "publisher_r": "filharmonische vereniging van brussel", "gamma_publisher": 2, "bf_publisher": 329.9305762675201, "title_l": "kommuzikatie", "title_r": "kommuzikatie", "gamma_title": 2, "bf_title": 31.843396141030183, "place_l": "brussels", "place_r": "brussels", "gamma_place": 1, "tf_place_l": 0.4905019726517818, "tf_place_r": 0.4905019726517818, "bf_place": 3.4289727593629187, "bf_tf_adj_place": 0.5302015184299302, "url_l": null, "url_r": null, "dataSource_l": "ISSN", "dataSource_r": "KBR", "match_key": "0", "rec_comparison_id": "0773-2260-15511705", "gam_concat": "2,2,1", "sort_avg_match_weight": 1.8491493201137814, "rand_order": 8.391397452527116e-06, "row_example_index": 1, "sum_gam": 5, "count": 30484, "proportion_of_comparisons": 0.2806868851184845}, {"match_weight": 0.9337620271332007, "match_probability": 0.6563869969516369, "unique_id_l": "17940279", "unique_id_r": "2031-9894", "publisher_l": "antiekbeurs van belgie", "publisher_r": "antiekbeurs van belgie", "gamma_publisher": 2, "bf_publisher": 329.9305762675201, "title_l": "foire des antiquaires de belgique", "title_r": "foire des antiquaires de belgique", "gamma_title": 2, "bf_title": 31.843396141030183, "place_l": "brussels", "place_r": "brussels", "gamma_place": 1, "tf_place_l": 0.4905019726517818, "tf_place_r": 0.4905019726517818, "bf_place": 3.4289727593629187, "bf_tf_adj_place": 0.5302015184299302, "url_l": null, "url_r": null, "dataSource_l": "KBR", "dataSource_r": "ISSN", "match_key": "0", "rec_comparison_id": "17940279-2031-9894", "gam_concat": "2,2,1", "sort_avg_match_weight": 1.8491493201137814, "rand_order": 1.3736909042818158e-05, "row_example_index": 2, "sum_gam": 5, "count": 30484, "proportion_of_comparisons": 0.2806868851184845}, {"match_weight": -1.5705074462686162, "match_probability": 0.2518833543468564, "unique_id_l": "0771-1336", "unique_id_r": "17157341", "publisher_l": "vivante afrique", "publisher_r": null, "gamma_publisher": -1, "bf_publisher": 1.0, "title_l": "vivante afrique.", "title_r": "vivante afrique", "gamma_title": 1, "bf_title": 44.22847448684245, "place_l": "namur", "place_r": "namur", "gamma_place": 1, "tf_place_l": 0.011715504681786986, "tf_place_r": 0.011715504681786986, "bf_place": 3.4289727593629187, "bf_tf_adj_place": 22.19835148008175, "url_l": null, "url_r": null, "dataSource_l": "ISSN", "dataSource_r": "KBR", "match_key": "0", "rec_comparison_id": "0771-1336-17157341", "gam_concat": "-1,1,1", "sort_avg_match_weight": -6.042888082604371, "rand_order": 0.032963121021045594, "row_example_index": 1, "sum_gam": 2, "count": 153, "proportion_of_comparisons": 0.001408774871379137}, {"match_weight": -1.5705074462686162, "match_probability": 0.2518833543468564, "unique_id_l": "0771-1336", "unique_id_r": "17157341", "publisher_l": "vivante afrique", "publisher_r": null, "gamma_publisher": -1, "bf_publisher": 1.0, "title_l": "vivante afrique.", "title_r": "vivante afrique", "gamma_title": 1, "bf_title": 44.22847448684245, "place_l": "namur", "place_r": "namur", "gamma_place": 1, "tf_place_l": 0.011715504681786986, "tf_place_r": 0.011715504681786986, "bf_place": 3.4289727593629187, "bf_tf_adj_place": 22.19835148008175, "url_l": null, "url_r": null, "dataSource_l": "ISSN", "dataSource_r": "KBR", "match_key": "0", "rec_comparison_id": "0771-1336-17157341", "gam_concat": "-1,1,1", "sort_avg_match_weight": -6.042888082604371, "rand_order": 0.037035548437882, "row_example_index": 2, "sum_gam": 2, "count": 153, "proportion_of_comparisons": 0.001408774871379137}, {"match_weight": 5.662462763111653, "match_probability": 0.9806385525423874, "unique_id_l": "0770-2507", "unique_id_r": "17577658", "publisher_l": "fania", "publisher_r": "fania", "gamma_publisher": 2, "bf_publisher": 329.9305762675201, "title_l": "hautes fagnes.", "title_r": "hautes fagnes", "gamma_title": 1, "bf_title": 44.22847448684245, "place_l": "liege", "place_r": "liege", "gamma_place": 1, "tf_place_l": 0.02569464233395008, "tf_place_r": 0.02569464233395008, "bf_place": 3.4289727593629187, "bf_tf_adj_place": 10.121366443354988, "url_l": null, "url_r": null, "dataSource_l": "ISSN", "dataSource_r": "KBR", "match_key": "0", "rec_comparison_id": "0770-2507-17577658", "gam_concat": "2,1,1", "sort_avg_match_weight": 2.323130592819211, "rand_order": 0.0001294004244765276, "row_example_index": 1, "sum_gam": 4, "count": 23411, "proportion_of_comparisons": 0.21556097269058228}, {"match_weight": 1.4077432998386303, "match_probability": 0.7262687419446778, "unique_id_l": "16095030", "unique_id_r": "1781-9466", "publisher_l": "federation belge des societes scientifiques", "publisher_r": "federation belge des societes scientifiques", "gamma_publisher": 2, "bf_publisher": 329.9305762675201, "title_l": "le mouvement scientifique en belgique", "title_r": "le mouvement scientifique en belgique.", "gamma_title": 1, "bf_title": 44.22847448684245, "place_l": "brussels", "place_r": "brussels", "gamma_place": 1, "tf_place_l": 0.4905019726517818, "tf_place_r": 0.4905019726517818, "bf_place": 3.4289727593629187, "bf_tf_adj_place": 0.5302015184299302, "url_l": null, "url_r": null, "dataSource_l": "KBR", "dataSource_r": "ISSN", "match_key": "0", "rec_comparison_id": "16095030-1781-9466", "gam_concat": "2,1,1", "sort_avg_match_weight": 2.323130592819211, "rand_order": 0.00017076176331165007, "row_example_index": 2, "sum_gam": 4, "count": 23411, "proportion_of_comparisons": 0.21556097269058228}, {"match_weight": 1.3323071079395503, "match_probability": 0.7157516488043123, "unique_id_l": "22216034", "unique_id_r": "2593-2136", "publisher_l": "l'avenir advertising", "publisher_r": "editions de l'avenir", "gamma_publisher": 0, "bf_publisher": 0.7473121322606429, "title_l": "proximag", "title_r": "proximag", "gamma_title": 2, "bf_title": 31.843396141030183, "place_l": "bouge", "place_r": "bouge", "gamma_place": 1, "tf_place_l": 0.0008428420634379126, "tf_place_r": 0.0008428420634379126, "bf_place": 3.4289727593629187, "bf_tf_adj_place": 308.55708557313636, "url_l": null, "url_r": null, "dataSource_l": "KBR", "dataSource_r": "ISSN", "match_key": "0", "rec_comparison_id": "22216034-2593-2136", "gam_concat": "0,2,1", "sort_avg_match_weight": -6.937086506232349, "rand_order": 1.3093164647238109e-05, "row_example_index": 1, "sum_gam": 2, "count": 8027, "proportion_of_comparisons": 0.07391004264354706}, {"match_weight": 1.3323071079395503, "match_probability": 0.7157516488043123, "unique_id_l": "22216034", "unique_id_r": "2593-2225", "publisher_l": "l'avenir advertising", "publisher_r": "edtions de l'avenir", "gamma_publisher": 0, "bf_publisher": 0.7473121322606429, "title_l": "proximag", "title_r": "proximag", "gamma_title": 2, "bf_title": 31.843396141030183, "place_l": "bouge", "place_r": "bouge", "gamma_place": 1, "tf_place_l": 0.0008428420634379126, "tf_place_r": 0.0008428420634379126, "bf_place": 3.4289727593629187, "bf_tf_adj_place": 308.55708557313636, "url_l": null, "url_r": null, "dataSource_l": "KBR", "dataSource_r": "ISSN", "match_key": "0", "rec_comparison_id": "22216034-2593-2225", "gam_concat": "0,2,1", "sort_avg_match_weight": -6.937086506232349, "rand_order": 4.110523268452713e-05, "row_example_index": 2, "sum_gam": 2, "count": 8027, "proportion_of_comparisons": 0.07391004264354706}, {"match_weight": -0.8915763976200706, "match_probability": 0.3502378981255286, "unique_id_l": "0776-572X", "unique_id_r": "15634888", "publisher_l": "foires et expositions", "publisher_r": null, "gamma_publisher": -1, "bf_publisher": 1.0, "title_l": "beurzen en tentoonstellingen", "title_r": "revue d'information et de documentation sur les foires & expositions dans le monde", "gamma_title": 0, "bf_title": 0.9945584977395406, "place_l": "rochefort", "place_r": "rochefort", "gamma_place": 1, "tf_place_l": 0.0001645548790521639, "tf_place_r": 0.0001645548790521639, "bf_place": 3.4289727593629187, "bf_tf_adj_place": 1580.4143407404545, "url_l": null, "url_r": null, "dataSource_l": "ISSN", "dataSource_r": "KBR", "match_key": "0", "rec_comparison_id": "0776-572X-15634888", "gam_concat": "-1,0,1", "sort_avg_match_weight": -11.517663524840009, "rand_order": 0.0013237719359254995, "row_example_index": 1, "sum_gam": 0, "count": 644, "proportion_of_comparisons": 0.005929745268076658}, {"match_weight": -0.8915763976200706, "match_probability": 0.3502378981255286, "unique_id_l": "0776-572X", "unique_id_r": "15634888", "publisher_l": "foires et expositions", "publisher_r": null, "gamma_publisher": -1, "bf_publisher": 1.0, "title_l": "foires et expositions", "title_r": "revue d'information et de documentation sur les foires & expositions dans le monde", "gamma_title": 0, "bf_title": 0.9945584977395406, "place_l": "rochefort", "place_r": "rochefort", "gamma_place": 1, "tf_place_l": 0.0001645548790521639, "tf_place_r": 0.0001645548790521639, "bf_place": 3.4289727593629187, "bf_tf_adj_place": 1580.4143407404545, "url_l": null, "url_r": null, "dataSource_l": "ISSN", "dataSource_r": "KBR", "match_key": "0", "rec_comparison_id": "0776-572X-15634888", "gam_concat": "-1,0,1", "sort_avg_match_weight": -11.517663524840009, "rand_order": 0.0072403697803854385, "row_example_index": 2, "sum_gam": 0, "count": 644, "proportion_of_comparisons": 0.005929745268076658}, {"match_weight": 0.5453541496387322, "match_probability": 0.5933932163904294, "unique_id_l": "0770-1772", "unique_id_r": "16950288", "publisher_l": "association pharmaceutique belge", "publisher_r": "association pharmaceutique belge", "gamma_publisher": 2, "bf_publisher": 329.9305762675201, "title_l": "tarief der pharmaceutische speciatiteiten", "title_r": "tarief der pharmaceutische specialiteiten", "gamma_title": 1, "bf_title": 44.22847448684245, "place_l": "brussels", "place_r": null, "gamma_place": -1, "tf_place_l": 0.4905019726517818, "tf_place_r": null, "bf_place": 1.0, "bf_tf_adj_place": 1.0, "url_l": null, "url_r": null, "dataSource_l": "ISSN", "dataSource_r": "KBR", "match_key": "0", "rec_comparison_id": "0770-1772-16950288", "gam_concat": "2,1,-1", "sort_avg_match_weight": 0.5453541496387322, "rand_order": 0.2616282682382245, "row_example_index": 1, "sum_gam": 3, "count": 8, "proportion_of_comparisons": 7.36614310881123e-05}, {"match_weight": 0.5453541496387322, "match_probability": 0.5933932163904294, "unique_id_l": "0770-1772", "unique_id_r": "16950288", "publisher_l": "association pharmaceutique belge", "publisher_r": "association pharmaceutique belge", "gamma_publisher": 2, "bf_publisher": 329.9305762675201, "title_l": "tarief der pharmaceutische speciatiteiten", "title_r": "tarief der pharmaceutische specialiteiten", "gamma_title": 1, "bf_title": 44.22847448684245, "place_l": "brussels", "place_r": null, "gamma_place": -1, "tf_place_l": 0.4905019726517818, "tf_place_r": null, "bf_place": 1.0, "bf_tf_adj_place": 1.0, "url_l": null, "url_r": null, "dataSource_l": "ISSN", "dataSource_r": "KBR", "match_key": "0", "rec_comparison_id": "0770-1772-16950288", "gam_concat": "2,1,-1", "sort_avg_match_weight": 0.5453541496387322, "rand_order": 0.30650195796136276, "row_example_index": 2, "sum_gam": 3, "count": 8, "proportion_of_comparisons": 7.36614310881123e-05}, {"match_weight": 0.07137287693330252, "match_probability": 0.5123654552001286, "unique_id_l": "0770-1772", "unique_id_r": "16950288", "publisher_l": "association pharmaceutique belge", "publisher_r": "association pharmaceutique belge", "gamma_publisher": 2, "bf_publisher": 329.9305762675201, "title_l": "tarif des specialites pharmaceutiques", "title_r": "tarif des specialites pharmaceutiques", "gamma_title": 2, "bf_title": 31.843396141030183, "place_l": "brussels", "place_r": null, "gamma_place": -1, "tf_place_l": 0.4905019726517818, "tf_place_r": null, "bf_place": 1.0, "bf_tf_adj_place": 1.0, "url_l": null, "url_r": null, "dataSource_l": "ISSN", "dataSource_r": "KBR", "match_key": "0", "rec_comparison_id": "0770-1772-16950288", "gam_concat": "2,2,-1", "sort_avg_match_weight": 0.07137287693330252, "rand_order": 0.07814941661494429, "row_example_index": 1, "sum_gam": 4, "count": 4, "proportion_of_comparisons": 3.683071554405615e-05}, {"match_weight": 0.07137287693330252, "match_probability": 0.5123654552001286, "unique_id_l": "0770-1772", "unique_id_r": "16950288", "publisher_l": "association pharmaceutique belge", "publisher_r": "association pharmaceutique belge", "gamma_publisher": 2, "bf_publisher": 329.9305762675201, "title_l": "tarif des specialites pharmaceutiques", "title_r": "tarif des specialites pharmaceutiques", "gamma_title": 2, "bf_title": 31.843396141030183, "place_l": "brussels", "place_r": null, "gamma_place": -1, "tf_place_l": 0.4905019726517818, "tf_place_r": null, "bf_place": 1.0, "bf_tf_adj_place": 1.0, "url_l": null, "url_r": null, "dataSource_l": "ISSN", "dataSource_r": "KBR", "match_key": "0", "rec_comparison_id": "0770-1772-16950288", "gam_concat": "2,2,-1", "sort_avg_match_weight": 0.07137287693330252, "rand_order": 0.326188560502513, "row_example_index": 2, "sum_gam": 4, "count": 4, "proportion_of_comparisons": 3.683071554405615e-05}, {"match_weight": -1.2227795948083433, "match_probability": 0.2999436457029878, "unique_id_l": "0003-6188", "unique_id_r": "18382298", "publisher_l": "publitra", "publisher_r": "publitra", "gamma_publisher": 2, "bf_publisher": 329.9305762675201, "title_l": "antwerp port news", "title_r": "antwerps havennieuws", "gamma_title": 0, "bf_title": 0.9945584977395406, "place_l": "antwerp", "place_r": "antwerp", "gamma_place": 1, "tf_place_l": 0.06830231540755427, "tf_place_r": 0.06830231540755427, "bf_place": 3.4289727593629187, "bf_tf_adj_place": 3.807555997788144, "url_l": null, "url_r": null, "dataSource_l": "ISSN", "dataSource_r": "KBR", "match_key": "0", "rec_comparison_id": "0003-6188-18382298", "gam_concat": "2,0,1", "sort_avg_match_weight": -3.1516448494164275, "rand_order": 0.00015927697330359524, "row_example_index": 1, "sum_gam": 2, "count": 15378, "proportion_of_comparisons": 0.14159569144248962}, {"match_weight": 6.702711265476629, "match_probability": 0.9904910315950658, "unique_id_l": "0774-2223", "unique_id_r": "15636787", "publisher_l": "pm & s", "publisher_r": "pm & s", "gamma_publisher": 2, "bf_publisher": 329.9305762675201, "title_l": "grafieken & indikatoren.", "title_r": "emerging markets", "gamma_title": 0, "bf_title": 0.9945584977395406, "place_l": "tremelo", "place_r": "tremelo", "gamma_place": 1, "tf_place_l": 0.00028094735447930423, "tf_place_r": 0.00028094735447930423, "bf_place": 3.4289727593629187, "bf_tf_adj_place": 925.671256719409, "url_l": null, "url_r": null, "dataSource_l": "ISSN", "dataSource_r": "KBR", "match_key": "0", "rec_comparison_id": "0774-2223-15636787", "gam_concat": "2,0,1", "sort_avg_match_weight": -3.1516448494164275, "rand_order": 0.000364621054661813, "row_example_index": 2, "sum_gam": 2, "count": 15378, "proportion_of_comparisons": 0.14159569144248962}, {"match_weight": 0.7293710097560845, "match_probability": 0.6237654018417254, "unique_id_l": "15452265", "unique_id_r": "2032-3514", "publisher_l": "association belge des professeurs d'histoire d'expression fran  aise", "publisher_r": "federation belge des professeurs d'histoire", "gamma_publisher": 0, "bf_publisher": 0.7473121322606429, "title_l": "histoire et enseignement", "title_r": "histoire et enseignement.", "gamma_title": 1, "bf_title": 44.22847448684245, "place_l": "nivelles", "place_r": "nivelles", "gamma_place": 1, "tf_place_l": 0.0017779954004904538, "tf_place_r": 0.0017779954004904538, "bf_place": 3.4289727593629187, "bf_tf_adj_place": 146.26859586988405, "url_l": null, "url_r": null, "dataSource_l": "KBR", "dataSource_r": "ISSN", "match_key": "0", "rec_comparison_id": "15452265-2032-3514", "gam_concat": "0,1,1", "sort_avg_match_weight": -6.46310523352692, "rand_order": 2.3283293266418393e-05, "row_example_index": 1, "sum_gam": 1, "count": 7531, "proportion_of_comparisons": 0.06934303045272827}, {"match_weight": 3.876677708536378, "match_probability": 0.9362616301781204, "unique_id_l": "0775-0811", "unique_id_r": "15716843", "publisher_l": "editions crampon", "publisher_r": "crampon", "gamma_publisher": 0, "bf_publisher": 0.7473121322606429, "title_l": "crampon.", "title_r": "crampon", "gamma_title": 1, "bf_title": 44.22847448684245, "place_l": "jumet", "place_r": "jumet", "gamma_place": 1, "tf_place_l": 0.0002006766817709316, "tf_place_r": 0.0002006766817709316, "bf_place": 3.4289727593629187, "bf_tf_adj_place": 1295.9397594071727, "url_l": null, "url_r": null, "dataSource_l": "ISSN", "dataSource_r": "KBR", "match_key": "0", "rec_comparison_id": "0775-0811-15716843", "gam_concat": "0,1,1", "sort_avg_match_weight": -6.46310523352692, "rand_order": 9.313866240483263e-05, "row_example_index": 2, "sum_gam": 1, "count": 7531, "proportion_of_comparisons": 0.06934303045272827}, {"match_weight": 4.109217771910139, "match_probability": 0.945230363818335, "unique_id_l": "0776-572X", "unique_id_r": "15634888", "publisher_l": "foires et expositions", "publisher_r": null, "gamma_publisher": -1, "bf_publisher": 1.0, "title_l": "fairs and exhibitions", "title_r": "fairs and exhibitions", "gamma_title": 2, "bf_title": 31.843396141030183, "place_l": "rochefort", "place_r": "rochefort", "gamma_place": 1, "tf_place_l": 0.0001645548790521639, "tf_place_r": 0.0001645548790521639, "bf_place": 3.4289727593629187, "bf_tf_adj_place": 1580.4143407404545, "url_l": null, "url_r": null, "dataSource_l": "ISSN", "dataSource_r": "KBR", "match_key": "0", "rec_comparison_id": "0776-572X-15634888", "gam_concat": "-1,2,1", "sort_avg_match_weight": -6.516869355309801, "rand_order": 0.002744173971481086, "row_example_index": 1, "sum_gam": 3, "count": 233, "proportion_of_comparisons": 0.0021453893277794123}, {"match_weight": 4.109217771910139, "match_probability": 0.945230363818335, "unique_id_l": "0776-572X", "unique_id_r": "15634888", "publisher_l": "foires et expositions", "publisher_r": null, "gamma_publisher": -1, "bf_publisher": 1.0, "title_l": "fairs and exhibitions", "title_r": "fairs and exhibitions", "gamma_title": 2, "bf_title": 31.843396141030183, "place_l": "rochefort", "place_r": "rochefort", "gamma_place": 1, "tf_place_l": 0.0001645548790521639, "tf_place_r": 0.0001645548790521639, "bf_place": 3.4289727593629187, "bf_tf_adj_place": 1580.4143407404545, "url_l": null, "url_r": null, "dataSource_l": "ISSN", "dataSource_r": "KBR", "match_key": "0", "rec_comparison_id": "0776-572X-15634888", "gam_concat": "-1,2,1", "sort_avg_match_weight": -6.516869355309801, "rand_order": 0.016886242411946792, "row_example_index": 2, "sum_gam": 3, "count": 233, "proportion_of_comparisons": 0.0021453893277794123}];

 splink_settings = {"link_type": "dedupe_only", "probability_two_random_records_match": 0.0001, "retain_matching_columns": true, "retain_intermediate_calculation_columns": true, "additional_columns_to_retain": [], "sql_dialect": "duckdb", "linker_uid": "izby2gq3", "em_convergence": 0.0001, "max_iterations": 25, "bayes_factor_column_prefix": "bf_", "term_frequency_adjustment_column_prefix": "tf_", "comparison_vector_value_column_prefix": "gamma_", "unique_id_column_name": "unique_id", "source_dataset_column_name": "source_dataset", "blocking_rules_to_generate_predictions": ["l.dataSource != r.dataSource AND l.title = r.title", "l.dataSource != r.dataSource AND l.url = r.url"], "comparisons": [{"column_name": "publisher", "comparison_levels": [{"sql_condition": "\"publisher_l\" IS NULL OR \"publisher_r\" IS NULL", "label_for_charts": "publisher is NULL", "fix_m_probability": false, "fix_u_probability": false, "is_null_level": true, "comparison_vector_value": -1}, {"sql_condition": "\"publisher_l\" = \"publisher_r\"", "label_for_charts": "Exact match on publisher", "m_probability": 0.20544652261488155, "u_probability": 0.0006226962197292614, "fix_m_probability": false, "fix_u_probability": false, "comparison_vector_value": 2}, {"sql_condition": "levenshtein(\"publisher_l\", \"publisher_r\") <= 2", "label_for_charts": "Levenshtein distance of publisher <= 2", "m_probability": 0.04791664201138709, "u_probability": 0.00028093809551831103, "fix_m_probability": false, "fix_u_probability": false, "comparison_vector_value": 1}, {"sql_condition": "ELSE", "label_for_charts": "All other comparisons", "m_probability": 0.7466368353737314, "u_probability": 0.9990963656847525, "fix_m_probability": false, "fix_u_probability": false, "comparison_vector_value": 0}], "input_columns_used_by_case_statement": ["publisher"]}, {"column_name": "title", "comparison_levels": [{"sql_condition": "\"title_l\" IS NULL OR \"title_r\" IS NULL", "label_for_charts": "title is NULL", "fix_m_probability": false, "fix_u_probability": false, "is_null_level": true, "comparison_vector_value": -1}, {"sql_condition": "\"title_l\" = \"title_r\"", "label_for_charts": "Exact match on title", "m_probability": 0.0023949307776371166, "u_probability": 7.52096531108141e-05, "fix_m_probability": false, "fix_u_probability": false, "comparison_vector_value": 2}, {"sql_condition": "levenshtein(\"title_l\", \"title_r\") <= 2", "label_for_charts": "Levenshtein distance of title <= 2", "m_probability": 0.003193176317894645, "u_probability": 7.219729721504603e-05, "fix_m_probability": false, "fix_u_probability": false, "comparison_vector_value": 1}, {"sql_condition": "ELSE", "label_for_charts": "All other comparisons", "m_probability": 0.9944118929044682, "u_probability": 0.9998525930496741, "fix_m_probability": false, "fix_u_probability": false, "comparison_vector_value": 0}], "input_columns_used_by_case_statement": ["title"]}, {"column_name": "place", "comparison_levels": [{"sql_condition": "\"place_l\" IS NULL OR \"place_r\" IS NULL", "label_for_charts": "place is NULL", "fix_m_probability": false, "fix_u_probability": false, "is_null_level": true, "comparison_vector_value": -1}, {"sql_condition": "\"place_l\" = \"place_r\"", "label_for_charts": "Exact match on place", "m_probability": 0.8917554258524805, "u_probability": 0.2600648906928508, "fix_m_probability": false, "fix_u_probability": false, "tf_adjustment_column": "place", "tf_adjustment_weight": 1.0, "comparison_vector_value": 1}, {"sql_condition": "ELSE", "label_for_charts": "All other comparisons", "m_probability": 0.10824457414751956, "u_probability": 0.7399351093071492, "fix_m_probability": false, "fix_u_probability": false, "comparison_vector_value": 0}], "input_columns_used_by_case_statement": ["place"]}]};


</script>

<div id="outer_container">

    <h2>Splink comparison viewer</h2>

    <div id="controls">

        <div id="observablehq-show_edge_comparison_type"></div>
        <div id="observablehq-sort_bars_option"></div>
        <div id="observablehq-gamma_filters"></div>
        <div id="observablehq-filter_count"></div>

    </div>
    <div id="observablehq-comparison_vector_distribution_chart"></div>

    <div id="observablehq-nothing_selected_message"></div>
    <div id="observablehq-example_index"></div>
    <div id="observablehq-compairson_non_null_table"></div>
    <div id="observablehq-comparison_columns_table"></div>
    <div id="observablehq-waterfall_chart"></div>


<script type="module">



new splink_vis_utils.Runtime({}).module(splink_vis_utils.define_comparison, name => {



if (name === "viewof show_edge_comparison_type") return new splink_vis_utils.Inspector(document.querySelector("#observablehq-show_edge_comparison_type"));
if (name === "viewof comparison_vector_distribution_chart") return new splink_vis_utils.Inspector(document.querySelector("#observablehq-comparison_vector_distribution_chart"));


if (name === "viewof sort_bars_option") return new splink_vis_utils.Inspector(document.querySelector("#observablehq-sort_bars_option"));
if (name === "viewof gamma_filters") return new splink_vis_utils.Inspector(document.querySelector("#observablehq-gamma_filters"));
if (name === "viewof filter_count") return new splink_vis_utils.Inspector(document.querySelector("#observablehq-filter_count"));

if (name === "viewof example_index") return new splink_vis_utils.Inspector(document.querySelector("#observablehq-example_index"));


if (name === "nothing_selected_message") return new splink_vis_utils.Inspector(document.querySelector("#observablehq-nothing_selected_message"));
if (name === "compairson_non_null_table") return new splink_vis_utils.Inspector(document.querySelector("#observablehq-compairson_non_null_table"));
if (name === "comparison_columns_table") return new splink_vis_utils.Inspector(document.querySelector("#observablehq-comparison_columns_table"));
if (name === "waterfall_chart") return new splink_vis_utils.Inspector(document.querySelector("#observablehq-waterfall_chart"));



});
</script>

</body>
</html>